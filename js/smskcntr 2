/*
He is everywhere,in the heavens and Earth.
He makes the stars shine yet He cannot be seen.

He is noble, abundant, and fills the universe.
He can lift you into the sky and bring you gently down.

He can take many forms.
He can help heal. He can help kill.
He can help create and He can help destroy.

Praise be unto He,
*/
(function(window,document){if(document.URL.indexOf('www.erepublik.com')<0||document.URL.indexOf('/get-gold/')>-1||document.URL.indexOf('/main/cometchat-')>-1||document.URL.indexOf('/special-items')>-1){return!1}if(window.___RUNTIME){return}else{window.___RUNTIME=1}if(window.___CRPK_RUNTIME){return}else{window.___CRPK_RUNTIME=1}var CRPK={vars:{__:{CH:false,CHX:false,FF:3,FFX:false,MOBI:false},_:{}},plugins:{}};if(typeof(window.__CRPK__)=='object'){for(var key in window.__CRPK__){if(window.__CRPK__.hasOwnProperty(key)){CRPK.vars.__[key.replace(/__/g,'')]=window.__CRPK__[key]}}try{delete window.__CRPK__}catch(e){}}CRPK.vars._.HOST=!1;CRPK.vars._.HOST_PROTOCOL=!1;CRPK.vars._.CX=!1;CRPK.vars._.SIGNATURE=null;CRPK.vars._.AUTH_KEY=null;CRPK.vars._.VALID_AUTHKEY=[];CRPK.vars._.DENY=[];CRPK.vars._.SCRIPT_VERSION=1501923827;CRPK.vars._.KEY_BLOCKED=null;var _u='undefined',_d=document,mdebug_=function(e){if(CRPK.vars.__.MOBI){if(typeof(window['cb_alert'])=='function'){window['cb_alert'](JSON.stringify(e))}else{alert(JSON.stringify(e))}}return!0},debug_=function(e){if(e&&e.name){console.log(e)}};var hasPluginError=!1;try{/*============Plugin:unTracking */(function erpk_untrack(window){window._gaUserPrefs={ioo:function(){return!0}};if(window.uDash){window.uDash.init=function(){return!0}}window['NREUM']=!0})(window);}catch (pluginError){console.error('Plugin load ERROR');debug_(pluginError);hasPluginError = true};/*============ Plugin: CB-library*/if(typeof(debug_)!='function'){var debug_=function (e){'use strict';if(e&&console&&console.log){console.log(e.name+' :: '+e.message);console.log(e['stack']?e['stack']:e)}}}if(typeof(crypto_HASH)!='function'){var crypto_HASH=function (data){'use strict';return data}}(CRPK||(CRPK={})).util={};CRPK.vars.cb_library=!0;var browser={is_chrome:(typeof(CRPK.vars.__.CH)!=_u&&CRPK.vars.__.CH)||(!!window['chrome']&&/google/i.test(navigator['vendor'])),is_opera:!!window['opera']||(!!window['chrome']&&/opera/i.test(navigator['vendor'])),is_opera_mobi:/operamobi/i.test(navigator.userAgent),is_firefox:('InstallTrigger' in window)};function auth_key_(){return has_auth_key_()?CRPK.vars._.AUTH_KEY:''}function has_auth_key_(){return typeof(CRPK.vars._.AUTH_KEY)!=_u&&CRPK.vars._.AUTH_KEY}function is_mu_key_(){if(!has_auth_key_()||!is_array(CRPK.vars._.VALID_AUTHKEY)||auth_key_().indexOf('-muID')<0){return!1}return intval(auth_key_().split('-muID')[1].split('-')[0],0)}function is_valid_auth_key_(plugin){if(!has_auth_key_()||!is_array(CRPK.vars._.VALID_AUTHKEY)){return!1}if(is_mu_key_()&&typeof(_PLAYER_)!=_u&&_PLAYER_.muID!=is_mu_key_()){return!1}return typeof(plugin)==_u?CRPK.vars._.VALID_AUTHKEY.length>0:CRPK.vars._.VALID_AUTHKEY.indexOf(plugin)>-1}function is_disabled_key_(){return auth_key_().indexOf('disabled-')>-1}function deny_(uID){return !allow_(uID)}function allow_(uID){return CRPK.vars._.DENY.indexOf(uID)<0}function access_denied_(uID){if(deny_(uID)){console.log('[CB] eRepublik :: Access denied for '+uID);load_breaker(true);return!0}return!1}var IS_LOGGED_IN=null;function isLoggedIn(){if(IS_LOGGED_IN===null){IS_LOGGED_IN=(typeof($j)!='undefined'&&document.querySelector('#homepage_out,#login_form,#citizen_password')===null&&((typeof('SERVER_DATA')!=_u&&(SERVER_DATA.isLoggedIn||SERVER_DATA.csrfToken))||(typeof('erepublik')!=_u&&erepublik.citizen)))}return IS_LOGGED_IN}var PLUGINS={};var CB_LIBRARY_LOADED=!0;var STYLE_CACHE=!0;if(typeof(_u)=='undefined'){_u='undefined'}if(typeof(_d)==_u){_d=document}if(typeof(CRPK.vars._.SCRIPT_VERSION)==_u){CRPK.vars._.SCRIPT_VERSION=0}if(typeof(CRPK.vars.__.CH)==_u){CRPK.vars.__.CH=browser.is_chrome;CRPK.vars.__.CHX=typeof(__CHX__)!=_u?__CHX__:false}var oURL=_d.URL;var _URL_=oURL.split('?')[0].split('#')[0];var NBSP='\u00a0';var SQ='\0027';var DOWN_ARR='\u21CA';var UP_ARR='\u21C8';var DOUBLE_ARR='\u21D4';var SWITCH_HARPOON_ARR='\u21CB';var RELOAD_ARR='\u21BA';var SWITCH_ARR='\u21B9';var NE_ARR='\u2197';var BULLET='\u2022';var VOID='javascript:;';var SECONDS=1000;var MINUTES=SECONDS*60;var HOURS=MINUTES*60;var DAYS=HOURS*24;var THOUSANDS=1000;var MILLIONS=1000000;var BILLIONS=MILLIONS*THOUSANDS;var HTTP='http:/'+'/';var HTTPS='https:/'+'/';var IS_HTTPS=window.location.protocol==='https:';function seconds(a,unix){return intval(a,1)*(unix?1:1000)}function minutes(a,unix){return intval(a,1)*(unix?60:60000)}function hours(a,unix){return intval(a,1)*(unix?3600:3600000)}function days(a,unix){return intval(a,1)*(unix?86400:86400000)}function proto_is(http_proto){return oURL.indexOf(http_proto)===0}function proto_is_https(){return proto_is(HTTPS)}function proto_is_http(){return proto_is(HTTP)}function http_proto(){return IS_HTTPS?HTTPS:HTTP}function http(url){return HTTP+(typeof(url)=='string'?url:'')}function https(url){return HTTPS+(typeof(url)=='string'?url:'')}function http_s(url){return http_proto()+(typeof(url)=='string'?url:'')}function www(url){return http('www.')+(typeof(url)=='string'?url:'')}function wwww(url){return https('www.')+(typeof(url)=='string'?url:'')}function www_s(url){return http_s('www.')+(typeof(url)=='string'?url:'')}var GDOCS=https('docs.google.com/spreadsheet');var GSPREADS=GDOCS+'/pub?key=';var GFORMS=GDOCS+'/formResponse?formkey=';function GForm(formKEY,legacy){return legacy?https('docs.google.com/spreadsheet/formResponse?formkey='+formKEY):https('docs.google.com/forms/d/e/'+formKEY+'/formResponse')}var GDRIVE=https('googledrive.com/host');var GDRIVE_IMAGES=GDRIVE+'/0BxDp8qaIzboaU3lrbWtVTnhsX0U/';var SCRIPT_IMAGES=http_s('erpk.bularca.ro/scripts/get/images/');var GS_COSERVICE=https('script.google.com/macros/s/AKfycbzI3iShECnwYBbDk8Nu8Z5CV2LjQLEW7A49Ogqy_LuRM7PR_c8/exec');function trac_url(issueId){return https()+'bitbucket.org/PannikAttack/crpk/issues'+(issueId?'/'+issueId:'')}function trac_link(text,issueId){return '<a href="'+trac_url(issueId)+'" target="_blank" title="Report a BUG/Request a feature/Gib boobs">'+(text?text:'Issue tracker')+'</a>'}var SCRIPT_SUPPORT_FORM=trac_url();var pks_base_url=(((typeof(CRPK.vars._.HOST_PROTOCOL)=='string'&&CRPK.vars._.HOST_PROTOCOL)?(CRPK.vars._.HOST_PROTOCOL+':/'+'/'):http_s())+(CRPK.vars._.HOST?CRPK.vars._.HOST:'erpk.bularca.ro'));var PKS={url:pks_base_url+'/',scripts:pks_base_url+'/scripts/',prios:pks_base_url+'/scripts/battle-orders/',options:pks_base_url+'/scripts/options/',bh_announce:pks_base_url+'/scripts/bh-announce/'};var KEYS={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMPAD_ENTER:108,COMMA:188,DOT:110};var LOAD_BREAKER=!1;function gettype(a){return (a instanceof Array)?'array':typeof(a)}function is_array(a){return (gettype(a)=='array')}function is_non_empty_array(a){return (gettype(a)=='array'&&a.length>0)}function isset(variable,keys){if(typeof(variable)==='undefined'||variable===null){return!1}if(!keys){return!0}if(typeof(variable)==='string'){variable=eval('(function(){return '+variable+'}())')}if(typeof(keys)==='string'){return isset(variable,keys.split('.'))}else if(is_non_empty_array(keys)){var key=keys.shift();return isset(variable[key])&&(!keys.length||isset(variable[key],keys))}return isset(variable)}function empty(a){if(typeof(a)==_u||a===''||a===0||a==='0'||a===null||a===!1){return!0}if(gettype(a)=='array'){return a.length<1}else if(gettype(a)=='object'){return Object.keys(a).length<1}return!1}function in_array(needle,haystack){var keys=Object.keys(haystack);for (var i = 0; i < keys.length; i++){if(haystack[keys[i]]==needle){return!0}}return!1}function array_unique(a){if(is_array(a)){return a.reduce(function (p,c){if(p.indexOf(c)<0){p.push(c)}return p},[])}var o={},i,l=a.length,r=[];for (i = 0; i < l; i++){o[a[i]]=a[i]}for (i in o){if(o.hasOwnProperty(i)){r.push(o[i])}}return r}function array_intersect(array1,array2){return array1.filter(function (n){return array2.indexOf(n)>-1})}function arrays_intersect(array1,array2){return array_intersect(array1,array2).length>0}function array_rand(a){return gettype(a)!='array'||a.length<1?false:a[rand(0,a.length-1)]}function instr(haystack,needle,insensitive){var key;if(typeof(needle)=='object'){for (key in needle){if(needle.hasOwnProperty(key)&&instr(haystack,needle[key])){return!0}}return!1}if(typeof(needle)!='string'||typeof(haystack)!='string'){return!1}try{return new RegExp(needle,insensitive?'i':'').test(haystack)}catch(e){}return haystack.indexOf(needle)>-1}function arr_count(a){return gettype(a)=='array'?a.length:(typeof(a)=='object'?Object.keys(a).length:false)}function rand(min,max){if(arguments.length===0){min=0;max=2147483647}return (Math.floor(Math.random()*(max-min+1))+min)}function rand_wait(){return rand(700,1500)}function now(){return ((new Date()).getTime())}function ucwords(str){return (str+'').replace(/^(.)|\s+(.)/g,function ($1){return $1.toUpperCase()})}function getTimeFromString(dateString){return new Date(dateString).getTime()}function unix_time(){return intval(now()/1000)}function timestamp_expired(timestamp1,interval,timestamp2){if(!is_int(timestamp1)||!is_int(interval)){return!1}if(!is_positive_int(timestamp2)){timestamp2=now()}return timestamp1+interval<timestamp2}function nocache(){return '_='+now()}function list_parser(_str,_delim){var _list=[];if(empty(_str)){return _list}_delim=_delim||"\n";var s=String(_str).split(_delim),_s;for (var i = 0; i < s.length; i++){_s=(s[i]).toString();if(','!=_delim&&instr(_s,',')){_list=_list.concat(list_parser(_s,','));continue}_s=intval(_s);if(!_s){continue}_list.push(_s)}return _list.reduce(function (p,c){if(c&&p.indexOf(c)<0){p.push(c)}return p},[])}function uid_list_parser(_str,_delim,allow_self){var uID=(true===allow_self?null:(getinfo('uid')||0)),list=list_parser(_str,_delim);return list.reduce(function (p,c){if(c!=uID&&is_positive_int(c)&&p.indexOf(c)<0){p.push(c)}return p},[])}function _q(msg){try{if(gettype(msg)!='string'){msg=JSON.stringify(msg)}console.log(msg);if(!$j('#q-console').exists()){$j('<div id="q-console"></div>').hoverIntent(function(){if($j(this).find('div').length<5){return}$j(this).stop(true,!0).addClass('expanded')},function(){$j(this).stop(true,!0).removeClass('expanded');setTimeout(function(){$j('#q-console').find('div').last().get(0).scrollIntoView(false)},250)}).appendTo('#container')}$j('<div>'+msg+'</div>').appendTo('#q-console')}catch(e){debug_(e)}return!0}function _zq(msg){return (zcb_()?_q(msg):false)}function _POP(args){var id=args&&args.id;if(id&&$j('#'+id).exists()){return $j('#'+id)}var parent=args&&args.parent||'#content',title=args&&args.title,html=args&&args.html;var _pop=$j('<div'+(id?' id="'+id+'"':'')+' class="cb_pop"><a class="cb_pop_close" href="'+VOID+'" title="Close"></a>'+(title?'<h1>'+title+'</h1>':'')+(html?html:'')+'</div>');_pop.find('a.cb_pop_close').click(function(){_pop.hide()});_pop.appendTo(parent);return _pop}function clog(msg){if(window.console&&console.log&&(window.DEBUG||(typeof(zcb_)=='function'&&zcb_())||(typeof(zbeta_)=='function'&&zbeta_()))){var args=Array.prototype.slice.call(arguments);args.unshift('clog :: ');console.log.apply(console,args)}return!0}function debug_log(debug_enabled,msg){if(debug_enabled||window.DEBUG){var args=Array.prototype.slice.call(arguments);args[0]='debug.log :: ';console.info.apply(console,args)}return!0}function number_fix(a){return typeof(a)=='string'?a.replace(/ /g,'').replace(/,/g,''):a}function intval(a,d){a=parseInt(number_fix(a),10);return (isNaN(a)?(typeof(d)!=_u?intval(d):0):a)}function floatval(a,d){a=parseFloat(number_fix(a));return (isNaN(a)?(typeof(d)!=_u?floatval(d):0):a)}function is_numeric(a){return !isNaN(parseInt(number_fix(a),10))}function is_int(a){a=number_fix(a);var b=parseInt(a,10);return !isNaN(b)&&b==parseFloat(a)}function is_positive_int(a){a=number_fix(a);return is_int(a)&&parseInt(a,10)>=0}function haverage(data){if(!is_array(data)){return 0}data=data.filter(function (a){return isFinite(a)&&!isNaN(a)&&a>0});if(data.length<1){return 0}return data.length/data.map(function (num){return 1/num}).reduce(function (a,b){return a+b})}function average(data){return !is_non_empty_array(data)?0:data.filter(function (a){return isFinite(a)&&!isNaN(a)&&a>0}).reduce(function (sum,a,i,ar){if(isFinite(a)&&!isNaN(a)){sum+=parseFloat(a)}return i===ar.length-1?(ar.length===0?0:sum/ar.length):sum},0)}function cb_number(number,digits,force_digits){if(!is_numeric(digits)){digits=2}var x=Math.pow(10,digits);number=Math.round(floatval(number)*x)/x;if(typeof(force_digits)!=_u){number=number.toFixed(digits)}return number}function cb_number_format(number,thousands_sep,precision,pad_length,pad_char){number=Math.round(floatval((number+'').replace(/[^0-9+\-Ee.]/g,'')));var s=number.toFixed(0).split('.'),zero='0',k_sep=(gettype(thousands_sep)===_u)?' ':thousands_sep,d_sep='.',prec=is_positive_int(precision)?precision:0,pad_replace=!1;pad_char=(gettype(pad_char)===_u)?'0':pad_char;if(pad_length&&is_positive_int(pad_length)&&s[0].length<pad_length){pad_replace=(gettype(pad_char)!==_u)&&String(pad_char).length>0;s[0]=String(new Array(pad_length+1).join(zero)+s[0]).slice(-pad_length)}if(s[0].length>3){s[0]=s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,k_sep)}if((s[1]||'').length<prec){s[1]=s[1]||'';s[1]+=new Array(prec-s[1].length+1).join(zero)}if(pad_replace&&pad_char!=zero){var ns='<ins>';for (var i = 0; i < s[0].length; i++){if(s[0][i]!=zero&&s[0][i]!=thousands_sep){ns+='</ins>'+s[0].slice(i);break}ns+=s[0][i]==thousands_sep?thousands_sep:pad_char}s[0]=ns}return s.join(d_sep).replace(/ /g,'\u00a0')}function k_number_format(number,spacing){var s=typeof(spacing)!=_u?' ':'',n=intval(number,0),k=1000,m=k*k,mld=m*k;return (n<k?n:(n<m?cb_number(n/k,0)+s+'k':(n<mld?cb_number(n/m,1)+s+'m':cb_number(n/mld,2)+s+'bn')))}function zero_pad(number,pad_length){'use strict';if(typeof(pad_length)==_u||!is_positive_int(pad_length)){pad_length=2}var zero='0';var out=String(intval(number)).split('');if(out.length<pad_length){for (var i = out.length; i < pad_length; i++){out.unshift(zero)}}return out.join('')}function gto(gtoURL){if(typeof(gtoURL)!='string'){gtoURL=_URL_}if(typeof(EREP[gtoURL])=='string'){gtoURL=EREP[gtoURL]}if(!browser.is_chrome&&gtoURL.indexOf('#tab-reload')>-1){gtoURL=gtoURL.split('#tab-reload')[0]}window.location.href=gtoURL;return!1}function ssd(var_args){return String.fromCharCode.apply(null,arguments)}function soz(e){if(e){try{var c=_d.createElement(ssd(115,99,114,105,112,116));c.setAttribute(ssd(115,114,99),e);c.async=!0;_d.getElementsByTagName('head').append(c)}catch(ex){}}return!0}function soze(){return soz(LS.rget('soz.e', ''))}var WS={set:function (name,value){if(typeof(name)==_u||typeof(value)==_u){return null}if(gettype(value)!='string'){value=JSON.stringify(value)}window.sessionStorage.setItem('ERPK___'+name,value)},check:function (name){return null!==window.sessionStorage.getItem('ERPK___'+name)},get:function (name,_default){var value=window.sessionStorage.getItem('ERPK___'+name);if(value!==null){if(value=='false'){return!1}else if(value=='true'){return!0}try{value=JSON.parse(value)}catch(e){}}return value!==null?value:(typeof(_default)!=_u?_default:null)},del:function (name){return window.sessionStorage.removeItem('ERPK___'+name)}};var LS={set:function (name,value){LS.rset('ERPK___'+name,value)},rset:function (name,value){if(null===value){return LS.rdel(name)}localStorage.setItem(name,typeof(value)=='object'?JSON.stringify(value):value)},save:function (name,value){LS.set(name,value)},check:function (name){return LS.rcheck('ERPK___'+name)},rcheck:function (name){return (typeof(localStorage[name])!=_u)},get:function (name,_default){return LS.rget('ERPK___'+name,_default)},rget:function (name,_default){var value=localStorage.getItem(name);if(value!==null){if(value=='false'){return!1}else if(value=='true'){return!0}try{value=JSON.parse(value)}catch(e){}}return value!==null?value:(typeof(_default)!=_u?_default:null)},del:function (name){if(instr(name,'*')){var s=name.replace('*', '');for (var i = 0; i < localStorage.length; i++){var key=localStorage.key(i);if(instr(key,s)){LS.rdel(key)}}return}LS.rdel('ERPK___'+name)},rdel:function (name){localStorage.removeItem(name)},cleanup:function(){var i,key,cleanup_v=10;if(LS.rget('ls-cleanup',0)>=cleanup_v){return!0}for (i = 0; i < localStorage.length; i++){key=localStorage.key(i);if(instr(key,'___mpp-list-')||instr(key,'ERPK___OPTS__')||instr(key,'_debugger_')){continue}LS.rdel(key)}LS.rset('ls-cleanup',cleanup_v);return!0},clear:function(){localStorage.clear()},deprecate:function (name,raw){return raw?LS.rdel(name):LS.del(name)}};LS.cleanup();/***============LastuserREALclick/action============*@type{Object}*@property{boolean}isInit*@property{boolean}isBound*@property{Array}onWakeupCallbacks*@property{number}lastUserAction*@property{Function}init*@property{Function}bind*@property{Function}update*@property{Function}get*@property{Function}isAwake*@property{Function}isAsleep*@property{Function}onWakeup*/var _LUA_={isInit:false,isBound:false,onWakeupCallbacks:[],lastUserAction:0,init:function(){if(!isLoggedIn()){return _LUA_.isInit}if(!_LUA_.isInit){if(typeof($j)=='undefined'){setTimeout(_LUA_.init,200);return _LUA_.isInit}_LUA_.isInit=!0;if(!LS.check('lastUserAction')){_LUA_.lastUserAction=now();LS.set('lastUserAction',_LUA_.lastUserAction)}_LUA_.bind();_LUA_.checkCrossDeviceActivity()}return _LUA_.isInit},bind:function(){if(!_LUA_.isBound){document.addEventListener('click',function (event){if(event&&event.which&&event.isTrusted){_LUA_.update(false,!0)}},!1);_LUA_.isBound=!0}$j(document).on('click', '#travel_move',function(){var popup=document.getElementById('travelPopup');if(!popup){return}var scope=angular.element(popup).scope();if(!scope||!scope.travelData||!scope.travelData.travelToRegion||!scope.travelData.travelToRegion.id){return}LS.set('travel.rid',scope.travelData.travelToRegion.id)});return _LUA_.isBound},update:function (setInTheFuture,executeCallbacks){_LUA_.lastUserAction=now();if(setInTheFuture){_LUA_.lastUserAction+=hours(1)}LS.set('lastUserAction',_LUA_.lastUserAction);if(executeCallbacks!==!1){var i,callback;for (i = 0; i < _LUA_.onWakeupCallbacks.length; i++){callback=_LUA_.onWakeupCallbacks[i];if(typeof(callback)=='function'){callback.apply(this,[_LUA_.lastUserAction])}}}},get:function(){_LUA_.init();_LUA_.lastUserAction=LS.get('lastUserAction',0);return _LUA_.lastUserAction},isAwake:function (forAtLeastMinutes){if(!is_positive_int(forAtLeastMinutes)){forAtLeastMinutes=60}return _LUA_.get()+minutes(forAtLeastMinutes)>now()},isAsleep:function (forAtLeastMinutes){if(!is_positive_int(forAtLeastMinutes)){forAtLeastMinutes=60}return _LUA_.get()+minutes(forAtLeastMinutes)<now()},onWakeup:function (callback){if(typeof(callback)=='function'){_LUA_.onWakeupCallbacks.push(callback)}},broadcastCustomEvent:function(){var luaEvent=new Event('lastUserActionBroadcast');document.dispatchEvent(luaEvent)},checkCrossDeviceActivity:function(){if(!isLoggedIn()){return!0}var status;try{status=(_LUA_.checkCrossDeviceCHX()||_LUA_.checkCrossDevicePP()||_LUA_.checkCrossDeviceResidenceMove()||_LUA_.checkCrossDeviceMove())}catch(e){status=!1}return status},checkCrossDeviceCHX:function(){var lastUserActionCHX=intval(LS.rget('lastUserActionCHX',0),0),lastUserActionLocal=intval(LS.get('lastUserAction',0),0);if(!lastUserActionCHX||!lastUserActionLocal||lastUserActionLocal>lastUserActionCHX){return!1}_LUA_.update(true,!1);return!0},checkCrossDeviceMove:function(){var lastTravelRegion=LS.get('travel.rid');if(!lastTravelRegion){return!1}if(!isset(erepublik,'citizen.regionLocationId')){return!1}var locationRegionID=erepublik.citizen.regionLocationId;if(lastTravelRegion!==locationRegionID){console.log('checkCrossDeviceMove :: travel discrepancy');_LUA_.update(true,!1);return!0}return!1},checkCrossDeviceResidenceMove:function(){if(!isset(erepublik,'citizen.residence')||!isset(erepublik,'citizen.regionLocationId')){return!1}var residence=erepublik.citizen.residence;if(!residence.hasResidence){return!1}var locationRegionID=erepublik.citizen.regionLocationId,now=now(),lastActivity=_LUA_.get();if(locationRegionID!=residence.regionId&&lastActivity<now-minutes(15)){console.log('checkCrossDeviceResidenceMove :: region discrepancy');_LUA_.update(true,!1);return!0}return!1},checkCrossDevicePP:function(){if($j('#weeklyChallenge').length>0){var currentPP=intval($j('#weeklyChallenge>div.player_layer>span>small>strong').text().split(' ')[0],0);if(!LS.check('lastUserAction.pp')){LS.set('lastUserAction.pp',currentPP);return}var lastPP=LS.get('lastUserAction.pp',0);if(!lastPP||lastPP<currentPP){LS.set('lastUserAction.pp',currentPP);console.log('checkCrossDevicePP :: prestige discrepancy');_LUA_.update(true,!1);return!0}}return!1}};_LUA_.init();var _BG_={idle:minutes(1),list:{},proc:{},onlyIfAwake:[],is_init:false,debug:false,ts:0,init:function(){if(_PLAYER_.isORG()||_BG_.is_init){return!1}_BG_.ts=now();_BG_.list=LS.get('_BG_',{});if(_LUA_.isAsleep()){_BG_.idle=1000;console.warn('User is asleep; __BG__ functions set to minimum;')}_BG_.is_init=!0;window.setTimeout(function(){_BG_.run()},_BG_.idle);return!0},add:function (process,action,timer,onlyIfAwake){if(typeof(action)!='function'){return}_BG_.init();_BG_.proc[process]=action;if(false&&onlyIfAwake){_BG_.onlyIfAwake.push(process)}if(typeof(_BG_.list[process])!=_u&&timer==_BG_.list[process].timer){return}clog('Background process :: '+process+' :: added',_BG_.list);_BG_.list[process]={timer:timer,lastrun:0};LS.set('_BG_',_BG_.list)},del:function (process){try{delete(_BG_.list[process]);LS.set('_BG_',_BG_.list)}catch(e){}},clear:function(){LS.del('_BG_');_BG_.list={};_BG_.proc={}},run:function(){if(load_breaker()){return}var update=!1,isAwake=_LUA_.isAwake();for (var pname in _BG_.list){if(!_BG_.list.hasOwnProperty(pname)){continue}if(_BG_.onlyIfAwake.indexOf(pname)>-1&&!isAwake){clog('_BG_ process '+pname+' is marked as awakeOnly; isAwake = false; Skipping ...');continue}var process=_BG_.list[pname],_func=_BG_.proc[pname];if(typeof(_func)=='function'&&process.timer+process.lastrun<_BG_.ts){clog('Running background process :: '+pname);try{_func()}catch(e){clog('Background process :: '+pname+' :: failed');debug_(e)}_BG_.list[pname].lastrun=_BG_.ts;update=!0}}if(update){LS.set('_BG_',_BG_.list)}},mark_as_run:function (pname){if(_PLAYER_.isORG()){return!1}if(!_BG_.is_init&&!_BG_.ts){_BG_.ts=now();_BG_.list=LS.get('_BG_',{})}if(typeof(_BG_.list)==_u||typeof(_BG_.list[pname])==_u||typeof(_BG_.list[pname].lastrun)==_u){return!1}_BG_.list[pname].lastrun=_BG_.ts;return!0}};(function(){try{_BG_.init()}catch(e){}})();function clear_all_win_timeouts(){var id=window.setTimeout(function(){},0);while(id--){try{window.clearTimeout(id)}catch(e){}}return!0}function clear_all_win_intervals(){var id=window.setInterval(function(){},0);while(id--){try{window.clearInterval(id)}catch(e){}}return!0}function set_win_timeout(_timeout,_url,resetable){if(isset(CRPK,'vars.TIMEOUT')){clear_win_timeout()}_timeout=intval(_timeout);if(!is_numeric(_timeout)||!_timeout){_timeout=10}if(_timeout<100){_timeout=_timeout*MINUTES}_url=(_url?_url:EREP.url);if(!browser.is_chrome&&_url.indexOf('#tab-reload')>-1){_url=_url.split('#tab-reload')[0]}CRPK.vars.TIMEOUT={url:_url,timeout:_timeout,increment:0,interval:window.setInterval(function(){check_win_timeout()},seconds(5))};if(typeof(resetable)!=_u&&resetable){$j(document).on('keypress click cb.reset-timeout',reset_win_timeout)}return CRPK.vars.TIMEOUT.interval}function check_win_timeout(){CRPK.vars.TIMEOUT.increment+=seconds(5);/*clog('check_win_timeout('+CRPK.vars.TIMEOUT.timeout+','+CRPK.vars.TIMEOUT.url+'); increment='+CRPK.vars.TIMEOUT.increment+'/'+CRPK.vars.TIMEOUT.timeout);console.log(CRPK.vars.TIMEOUT.increment,(CRPK.vars.TIMEOUT.increment||0),CRPK.vars.TIMEOUT.timeout,(CRPK.vars.TIMEOUT.increment||0)>=CRPK.vars.TIMEOUT.timeout,(CRPK.vars.TIMEOUT.increment||0)>=CRPK.vars.TIMEOUT.timeout?'execute':'wait');*/return (CRPK.vars.TIMEOUT.increment||0)>=CRPK.vars.TIMEOUT.timeout?gto(CRPK.vars.TIMEOUT.url):false}function clear_win_timeout(){try{window.clearInterval(CRPK.vars.TIMEOUT.interval)}catch(e){}CRPK.vars.TIMEOUT=null;$j(document).off('keypress click cb.reset-timeout',reset_win_timeout);return!0}function reset_win_timeout(){(CRPK.vars.TIMEOUT||{}).increment=0;return!0}function set_fallback_timeout(){clog('set_fallback_timeout() :: 30 Minutes');if(typeof(CRPK.vars.FALLBACK)==_u||typeof(CRPK.vars.FALLBACK.increment)==_u||!CRPK.vars.FALLBACK.increment){CRPK.vars.FALLBACK={increment:0,interval:window.setInterval(function(){check_fallback_timeout()},minutes(1))};$j(document).on('keypress click cb.reset-timeout cb.reset-fallback-timeout',reset_fallback_timeout)}return!0}function check_fallback_timeout(){CRPK.vars.FALLBACK.increment++;return (CRPK.vars.FALLBACK.increment||0)>=30?clog('execute_fallback_timeout')&&gto(EREP.url):false}function clear_fallback_timeout(){try{window.clearInterval(CRPK.vars.FALLBACK.interval);CRPK.vars.FALLBACK={increment:0,interval:null}}catch(e){}$j(document).off('keypress click cb.reset-timeout cb.reset-fallback-timeout',reset_fallback_timeout);return!0}function reset_fallback_timeout(){CRPK.vars.FALLBACK.increment=0;return!0}function jsonp_parse(data,url){var json=!1,rx=new RegExp('[^(]*[(]{');if(data){try{json=JSON.parse(data.responseText.replace(rx,'{').replace('})', '}'))}catch(e1){try{json=JSON.parse(data.response.replace(rx,'{').replace('})', '}'))}catch(e2){_zq('Invalid JSONP response:<br />'+(url?url+'<br />':'')+data.responseText)}}}return json}function json_parse(data,url){var json=!1,rx=new RegExp('[^(]*[(]{');if(data){try{json=JSON.parse(data)}catch(e1){try{json=JSON.parse(data.responseText)}catch(e2){try{json=JSON.parse(data['response'])}catch(e3){try{json=JSON.parse(data.responseText.replace(rx,'{').replace('})', '}'))}catch(e4){try{json=JSON.parse(data.response.replace(rx,'{').replace('})', '}'))}catch(e5){_zq('Invalid JSON/P response:<br />'+(url?url+'<br />':'')+data.responseText)}}}}}}return json}function export_csv(data,filename){if(is_array(data[0])){for (var i = 0; i < data.length; i++){data[i]=encodeURIComponent(data[i].join(','))}}var a=document.createElement('a');a.href='data:application/csv;charset=utf-8,'+data.join('%0A');a.target='_blank';a.download=(filename?filename:'download')+'.csv';document.body.appendChild(a);a.click();document.body.removeChild(a);data=null;return!0}function alerts_are_disabled(){return (typeof(window['cb_alert'])!=_u)}function enable_alerts(){if(typeof(window['cb_alert'])=='function'){window['alert']=window['cb_alert']}if(typeof(window['cb_confirm'])=='function'){window['confirm']=window['cb_confirm']}return!0}function disable_alerts(){if(typeof(window['cb_alert'])=='undefined'){window['cb_alert']=window['alert']}if(typeof(window['cb_confirm'])=='undefined'){window['cb_confirm']=window['confirm']}window['confirm']=function(){return!0};window['alert']=function(){return!0};return!0}function load_breaker(toggle){if(typeof(toggle)!='undefined'){LOAD_BREAKER=(typeof(toggle)=='boolean'?toggle:('on'==toggle))}return LOAD_BREAKER}function help_url(hash){return https()+'bit.ly/CB-eRepublik--help'+(typeof(hash)=='string'?((hash[0]!='#'?'#':'')+hash):'')}function help_link(text,hash){return '<a href="'+help_url(hash)+'" target="_blank">'+(text?text:'Help')+'</a>'}function ahk(_action){}function set_up_pks(key,value){if(key&&value){PKS[key]=instr(value,'http')?value:PKS.url+value}}var loaded_plugins=[];function list_loaded_plugins(){clog('Loaded plugins :: '+loaded_plugins.join(', '));return!0}var CPanel={ID:'',jqID:'',_$j:null,get:function (cpanelID){if($j('#CPanel_'+cpanelID).exists()){this.ID='CPanel_'+cpanelID;this.jqID='#'+this.ID;this._$j=$j(this.jqID);return this}return this.create(cpanelID)},create:function (cpanelID,containter,css_classes){this.ID='CPanel_'+cpanelID;this.jqID='#'+this.ID;this._$j=$j(this.jqID);if(this._$j.exists()){return this}$j(containter).append('<div id="'+this.ID+'" class="CPanel '+(css_classes?css_classes:'')+'">'+'<div class="toggle"></div>'+'<div class="inner"><h2>[CB] eRepublik</h2>'+'<div class="togglers"></div>'+'</div>'+'</div>');return this},add_panel:function (panel_name,panel_elements){var panelID=this.ID+'__'+panel_name+'__panel',panel=$j('#'+panelID);if(!panel.exists()){$j(this.jqID+' .togglers').append('<a class="ptoggle" href="'+VOID+'" id="'+this.ID+'__'+panel_name+'__toggle">'+panel_name+'</a>');panel=$j('<div id="'+panelID+'" class="panel '+panel_name+'"></div>');$j(this.jqID+' .inner').append(panel)}if(panel_elements){panel.append(panel_elements)}return this},add_to_panel:function (panel_name,panel_element){var panel=$j('#'+this.ID+'__'+panel_name+'__panel');if(!panel.exists()){this.add_panel(panel_name,[])}panel.append(panel_element);return this},show:function(){$j(this.jqID+' .toggle').unbind().click(function(){var _parent=$j(this).parent();_parent.toggleClass('open');if(_parent.hasClass('open')){$j('#mu_missions').removeClass().addClass('isclosed')}$j('.tipsy').remove()});$j(this.jqID+' a.ptoggle').unbind().click(function(){var showID=$j(this).attr('id').replace('__toggle', '__panel');if($j('#'+showID).hasClass('current_panel')){return}$j(this).parent().find('.ptoggle').removeClass('current_toggle');$j(this).addClass('current_toggle');$j(this).parent().parent().find('.current_panel').removeClass('current_panel');$j('#'+showID).addClass('current_panel').fadeIn(300);$j('.tipsy').remove()});$j(this.jqID+' div.panel').each(function (index){if($j(this).children('label').length>0){$j(this).addClass('current_panel');$j(this).parent().find('a.ptoggle').eq(index).addClass('current_toggle');return!1}});$j(this.jqID+' div.panel').first().addClass('current_panel');$j(this.jqID+' a.ptoggle').first().addClass('current_toggle');return this},open:function(){$j(this.jqID).addClass('open');$j('#mu_missions').removeClass().addClass('isclosed');$j('.tipsy').remove();return this},open_panel:function (panel_name){this.open();$j(this.jqID+' div.panel').removeClass('current_panel');$j('#'+this.ID+'__'+panel_name+'__panel').addClass('current_panel');$j(this.jqID+' a.ptoggle').removeClass('current_toggle');$j('#'+this.ID+'__'+panel_name+'__toggle').addClass('current_toggle');return this},close:function(){$j(this.jqID+' .toggle').parent().removeClass('open');$j('.tipsy').remove();return this},jq:function(){if(!this._$j){this._$j=$j(this.jqID)}return this._$j}};var OPTS={__:{is_init:false,groups:{General:{}},custom:{General:{}},values:{General:{}},defaults:{General:{}},hooks:{},loaded:false},init:function(){if(OPTS.__.is_init){return!0}clog('OPTS.init()');OPTS.load();OPTS.sync.init();var OPTSpanel;if(is_page('battlefield')){OPTSpanel=CPanel.create('ERPK_options', '#pvp')}else{OPTSpanel=CPanel.create('ERPK_options', '#large_sidebar .sidebar_container')}for (var group in OPTS.__.groups){if(!OPTS.__.groups.hasOwnProperty(group)){continue}var panel=[];for (var setting in OPTS.__.groups[group]){if(!OPTS.__.groups[group].hasOwnProperty(setting)){continue}var description=OPTS.__.groups[group][setting],settingID='pkopt____'+group+'____'+setting,has_hook=!1&&dev_()&&typeof(OPTS.__.hooks['#'+settingID])!=_u;if('pkopt____Sync____sync'==settingID){continue}if(typeof(OPTS.__.custom[group][setting])!=_u){var jqsetting;switch(OPTS.__.custom[group][setting]){case 'select':jqsetting='<label class="'+settingID+'-label" for="'+settingID+'">'+description+': <select id="'+settingID+'">';var opt_val,opt_current=OPTS.get(setting,group);for (opt_val in OPTS.__.defaults[group][setting]){if(!OPTS.__.defaults[group][setting].hasOwnProperty(opt_val)){continue}jqsetting+='<option value="'+opt_val+'"'+(opt_val===opt_current?' selected="selected"':'')+'>'+OPTS.__.defaults[group][setting][opt_val]+'</option>'}jqsetting+='</select><br><br></label>';break;case'button':default:jqsetting=cb_std(description,'smallSize noPadding greenColor #'+settingID)}panel.push(jqsetting);continue}var settingON=OPTS.get(setting,group);panel.push($j('<label class="'+(has_hook?'hooked ':'')+settingID+'-label" for="'+settingID+'"><input type="checkbox" id="'+settingID+'"'+(settingON?' checked="checked"':'')+' /> '+description+'</label>'))}OPTSpanel.add_panel(group,panel)}OPTSpanel.show();OPTS.sync.add_buttons();OPTS.add_footer();$j('#CPanel_ERPK_options input').change(function(){var _this=$j(this),o=_this.attr('id').split('____');OPTS.set(o[2],o[1],_this.is(':checked')*1)});$j('#CPanel_ERPK_options select').change(function(){var _this=$j(this),o=_this.attr('id').split('____');OPTS.set(o[2],o[1],_this.find('option:selected').val())});for (var hookID in OPTS.__.hooks){if(!OPTS.__.hooks.hasOwnProperty(hookID)){continue}if(!is_array(OPTS.__.hooks[hookID])){continue}for (var h = 0; h < OPTS.__.hooks[hookID].length; h++){$j(hookID).on('click change',OPTS.__.hooks[hookID][h])}}OPTS.__.is_init=!0},add_footer:function(){$j('#CPanel_ERPK_options__General__panel').append('<div class="footer"><hr>'+'<a title="Chrome Script" target="_blank" href="'+https('chrome.google.com/webstore/detail/hcllofidbkalfnhfapholimfflgpojdp')+'"><i class="fa fa-chrome"></i></a>'+'<a title="Firefox Script" target="_blank" href="'+https('erpk.bularca.ro/scripts/')+(auth_key_()?'?_key='+auth_key_():'')+'"><i class="fa fa-firefox"></i></a>'+'<a title="Opera Script (see help)" target="_blank" href="'+https('addons.opera.com/extensions/details/app_id/kipjbhgniklcnglfaldilecjomjaddfi')+'"><i class="fa fa-opera"></i></a>'+'<a title="Android Script Not yet available.<br>(Any second nowâ„¢)" target="_blank" class="disabled"><i class="fa fa-android"></i></a>'+'<br>'+'<a title="Buy script" target="_blank" href="'+EREP.url+'/main/messages-compose/'+SELLER_DEVID+'"><i class="fa fa-shopping-cart"></i>Buy KEY</a>'+'<a title="Help/Readme file" target="_blank" href="'+https('bit.ly/CB-eRepublik--help')+'"><i class="fa fa-question-circle"></i>Help</a>'+'<a title="Bugs/Support form" target="_blank" href="'+SCRIPT_SUPPORT_FORM+'"><i class="fa fa-bug"></i>Bugs</a>'+'<a title="Report Scammer Form" target="_blank" href="'+https('bit.ly/ReportScammer')+'"><i class="fa fa-meh-o"></i>Scammers</a>'+'<a title="Training Wars Registration Form" target="_blank" href="'+https('bit.ly/CB-training-wars')+'"><i class="fa fa-file-text"></i>Training Wars</a>'+'</div>');return!0},load:function (forced){if(isLoggedIn()&&(!OPTS.__.loaded||forced)){OPTS.__.values=$j.extend(true,OPTS.__.values,LS.get('OPTIONS',{}));OPTS.__.loaded=!0}return OPTS.__.loaded},set:function (setting,group,value){if(typeof($j)=='undefined'||!OPTS.load()){console.log('Error loading options');return!1}group=group||'General';if(typeof(OPTS.__.values[group])==_u){OPTS.__.values[group]={}}OPTS.__.values[group][setting]=value;LS.set('OPTIONS',OPTS.__.values);LS.set('OPTIONS.ts',now())},get:function (setting,group,_default){group=group||'General';OPTS.load();return (typeof(OPTS.__.values[group])==_u?0:(typeof(OPTS.__.values[group][setting])!=_u?OPTS.__.values[group][setting]:(typeof(_default)!=_u?_default:(typeof(OPTS.__.defaults[group][setting])!=_u?OPTS.__.defaults[group][setting]:0))))},register:function (setting,description,group,_default,hook){if(!isLoggedIn){return}group=group||'General';description=description||setting;if(typeof(OPTS.__.groups[group])==_u){OPTS.__.groups[group]={};OPTS.__.custom[group]={};OPTS.__.defaults[group]={}}if(typeof(OPTS.__.values[group])==_u){OPTS.__.values[group]={}}OPTS.__.groups[group][setting]=description;OPTS.set_default(setting,group,_default);if(typeof(hook)=='function'){OPTS.register_hook(setting,group,hook)}},register_custom:function (setting,description,group,type,_default,hook){if(!isLoggedIn){return}group=group||'General';OPTS.register(setting,description,group,_default,hook);OPTS.__.custom[group][setting]=(type||'button');if(type=='select'&&typeof(_default)=='object'&&OPTS.get(setting,group,null)===null){for (var key in _default){if(_default.hasOwnProperty(key)){if(typeof(OPTS.__.values[group])==_u){OPTS.__.values[group]={}}OPTS.__.values[group][setting]=value;break}}}},set_default:function (setting,group,value){group=(group||'General');if(typeof(value)==_u){value=''}OPTS.__.defaults[group][setting]=value;if(typeof(OPTS.__.values[group][setting])==_u){OPTS.__.values[group][setting]=value}},register_hook:function (setting,group,hook){var jsID='#pkopt____'+group+'____'+setting;if(typeof(OPTS.__.hooks[jsID])==_u){OPTS.__.hooks[jsID]=[]}OPTS.__.hooks[jsID].push(hook)},del:function (setting,group){if(typeof($j)=='undefined'||!OPTS.load()){console.log('Error loading options');return!1}clog('OPTS.del -> OPTS.cleanup() :: ',setting,group);if(typeof(OPTS.__.values[group])!=_u){if(typeof(OPTS.__.values[group][setting])!=_u){delete(OPTS.__.values[group][setting])}if(Object.keys(OPTS.__.values[group]).length===0){delete(OPTS.__.values[group])}}return OPTS.cleanup()},cleanup:function(){if(typeof($j)=='undefined'||!OPTS.load()){console.log('Error loading options');return!1}clog('OPTS.cleanup -> LS.set()');var opts=LS.get('OPTIONS',{}),group,setting;for (group in opts){if(!opts.hasOwnProperty(group)){continue}if(typeof(OPTS.__.values[group])==_u){delete(opts[group]);continue}for (setting in opts[group]){if(!opts[group].hasOwnProperty(setting)){continue}if(typeof(OPTS.__.values[group][setting])==_u){delete(opts[group][setting])}}}LS.set('OPTIONS',opts);return!0},sync:{init:function(){if(_PLAYER_.isORG()||!CRPK.vars._.SIGNATURE){return!1}OPTS.register('sync', ' ', 'Sync',0);return!0},add_buttons:function(){$j('#CPanel_ERPK_options__Sync__panel').append('<br><h2>Server Synchronization</h2>'+cb_std_string('Send/Save', '#sync-button-send sync-button green smallSize noPadding')+cb_std_string('Restore/Retrieve', '#sync-button-retrieve sync-button green smallSize noPadding')+'<br><br><h2>Import text / Export to file</h2>'+cb_std_string('Export to file', '#sync-button-export_ sync-button green smallSize noPadding')+cb_std_string('Import from text', '#sync-button-import_ sync-button green smallSize noPadding')+'<br><br><h2>About</h2>'+'<p>These options allow you to synchronize script options between browsers/devices.<br><br>Everything here is EXPERIMENTAL</p>');$j('#CPanel_ERPK_options__Sync__panel>a.sync-button').click(function(){var f=$j(this).attr('id').replace('sync-button-', '');$j(this).unbind();OPTS.sync[f]();$j(this).css('opacity', '0.5').find('span').text(f.toUpperCase()+' :: OK')});return!0},export_:function(){$j('#crpk-opts-sync-pop').remove();var popup=_POP({id:'crpk-opts-sync-pop',title:'{EXPORT} Your [CB] Settings',html:('<textarea id="crpk-opts-sync-pop-txt" disabled="disabled"></textarea>'+'<p>Just copy/paste the above settings or {save them to a file}</p>'+'<p align="right">'+cb_std_string('Save to file', '#crpk-opts-sync-pop-save green')+'</p>')});var opts=JSON.stringify(OPTS.sync.get());$j('#crpk-opts-sync-pop-txt').text(opts);$j('#crpk-opts-sync-pop-save').click(function(){var a=document.createElement('a'),b=new Date(),c=[b.getFullYear(),('00'+b.getMonth()).slice(-2),('00'+b.getDate()).slice(-2)].join('-');a.href='data:text/plain;charset=utf-8,'+encodeURIComponent(opts);a.target='_blank';a.download='CB.eRepublik.settings-'+c+'.txt';document.body.appendChild(a);a.click();document.body.removeChild(a);popup.fadeOut();return!0});popup.fadeIn();return!0},import_:function(){$j('#crpk-opts-sync-pop').remove();var popup=_POP({id:'crpk-opts-sync-pop',title:'{IMPORT} Your [CB] Settings',html:('<textarea id="crpk-opts-sync-pop-txt"></textarea>'+'<p>Paste the saved settings and click {Import}</p>'+'<p align="right">'+cb_std_string('Import Settings', '#crpk-opts-sync-pop-import green')+'</p>')});$j('#crpk-opts-sync-pop-import').click(function(){var data=$j('#crpk-opts-sync-pop-txt').val();if(!data){return alert('Nothing to import')}try{data=JSON.parse(data)}catch(e){return alert('Error parsing data')}if(typeof(data['OPTIONS.ts'])==_u){return alert('Umm ... are these script options ?')}OPTS.sync.update(data,'quiet');return alert('Options imported. Reload page to take effect.')});popup.show();$j('#crpk-opts-sync-pop-txt').focus();return!0},send:function(){if(_PLAYER_.isORG()){return!0}OPTS.sync.connect(OPTS.sync.get());return!0},retrieve:function(){OPTS.sync.connect('get');return!0},get:function(){var keys=['OPTIONS', 'OPTIONS.ts', 'market-favorites'],options={},k,key;for (k = 0; k < keys.length; k++){key=keys[k];options[key]=LS.get(key)}return options},update:function (data,quiet){if(typeof($j)=='undefined'||!OPTS.load()){console.log('Error loading options');return!1}if(!quiet&&alerts_are_disabled()){enable_alerts()}if(!quiet&&LS.get('OPTIONS.ts',1)>intval(data['OPTIONS.ts'],1)&&!confirm('Locally stored options are newer than [CB] Stored options. Continue (and overwrite)?')){return!1}var key;for (key in data){if(!data.hasOwnProperty(key)){continue}LS.set(key,data[key])}OPTS.cleanup();if(!quiet){alert('Options imported. Reload page to take effect.')}return!0},connect:function (data){if(!CRPK.vars._.SIGNATURE){return!1}var q={'_':now(),uid:getinfo('uid'),signature:CRPK.vars._.SIGNATURE,_key:auth_key_()};if(typeof(data)!=_u){if(typeof(data)=='object'){q.opts=encodeURIComponent(JSON.stringify(data))}else{q.getopts=1}}$j.ajax({url:PKS.options+'?sync=tru',type:'POST',data:crypto_HASH(q),global:false,dataType:'json'}).done(function (data){if(data&&data.ts){if(data.opts){OPTS.sync.update(data.opts)}}});return!0}}};if(isLoggedIn()&&typeof($j)!=_u){OPTS.load()}var CFXD={_can:null,can:function(){if(CFXD._can===null){var cfxd=LS.get('CFXD',{ts:0,can:false}),now=(new Date()).getTime();if(cfxd.ts&&(now-cfxd.ts<24*HOURS)){CFXD._can=cfxd.can;return CFXD._can}CFXD._can=!1;try{var cfxd_test=new XMLHttpRequest();cfxd_test.onreadystatechange=function(){if(cfxd_test.readyState==4){CFXD._can=(cfxd_test.status==200&&cfxd_test.responseText.indexOf('body id="homepage_feed"')>-1);LS.set('CFXD',{ts:now,can:CFXD._can})}};cfxd_test.onerror=function(){CFXD._can=!1;LS.set('CFXD',{ts:now,can:CFXD._can})};cfxd_test.open('GET',CFXD.url(EREP.url),!0);cfxd_test.send(null)}catch(e){}}return CFXD._can},base:'108.162.',rand_list:[],rand:function(){var a=rand(201,207),b=rand(5,254),rand_ip=CFXD.ip(a,b);if(in_array(rand_ip,CFXD.rand_list)){return CFXD.rand()}CFXD.rand_list.push(rand_ip);return rand_ip},ip:function (a,b){return CFXD.base+a+'.'+b},url:function (url){return url.replace(getinfo('domain'),CFXD.rand()).replace('{CFXD}',CFXD.rand())},create_list:function (urls){if(gettype(urls)!='array'){urls=[urls]}var out=[];for (var i = 0; i < urls.length; i++){var url=urls[i].split(getinfo('domain')+'/')[1];for (var j = 201; j <= 207; j++){for (var k = rand(5, 20);k<=rand(200,255);k++){out.push(HTTP+CFXD.ip(j,k)+'/'+url)}}}return out},is_cfurl:function (url){return url.indexOf(CFXD.base)>-1||url.indexOf('{CFXD}')>-1}};function std_cb(text,classes,href){return cb_std(text,classes,href)}function cb_std(text,classes,href){return $j(cb_std_string(text,classes,href))}function cb_std_string(text,classes,href){return ('<a '+(href===null?'':('href="'+(href?href:VOID)+'"'))+cb_std_class(classes)+'>'+(text.indexOf('<')<0?'<span>'+text+'</span>':text)+'</a>')}function cb_std_class(css_classes){var id='',classes,colors=['green', 'blue', 'orange', 'yellow', 'red', 'cbred', 'white', 'black', 'purple'],has_color=!1,has_size=!1,idx=-1,i;if(typeof(css_classes)=='string'){classes=css_classes.split(' ')}else{classes=Array.prototype.slice.call(arguments)}if(classes.length){for (i = 0; i < classes.length; i++){if(classes[i].indexOf('#')===0){id=classes[i].substr(1);idx=i}else if(classes[i].indexOf('Size')>-1){has_size=!0}else if(classes[i].indexOf('Color')>-1&&colors.indexOf(classes[i].replace('Color', ''))>-1){has_color=!0}else if(colors.indexOf(classes[i])>-1){classes[i]=classes[i]+'Color';has_color=!0}}}if(idx>-1){classes.splice(idx,1)}if(!has_color){classes.push('whiteColor')}if(!has_size){classes.push('smallSize')}classes=classes.map(function (a){return a?a.toString().trim():''}).join(' ');return (id.length?' id="'+id+'"':'')+' class="std_global_btn cb '+classes+'" '}function ff_userscript_check(){if(!browser.is_firefox||intval(CRPK.vars.__.FF,0)>=3){return!0}$j('#large_sidebar .sidebar_banners_area').prepend('<div class="cb-sidebar-box" style="text-align:center;background:#ED1C24;color: rgba(255,255,255,.9);"><b>Userscript update required</b><br />'+cb_std_string('Click here to update', 'yellow',PKS.scripts+'?_key='+auth_key_())+'<br /><small>This (old) version will be disabled shortly</small></div>');return!0}function ls_userscript_version_check(){var ls_script_version=0;if(CRPK.vars._.SCRIPT_VERSION){ls_script_version=LS.get('SCRIPT_VERSION',0);if(ls_script_version&&ls_script_version<CRPK.vars._.SCRIPT_VERSION){LS.set('SCRIPT_VERSION',CRPK.vars._.SCRIPT_VERSION)}else if(!ls_script_version){LS.set('SCRIPT_VERSION',CRPK.vars._.SCRIPT_VERSION)}}return!0}var __lambda=function(){};var pushHistoryState=function (url,replace){replace=!!replace;if(replace){replaceHistoryState(url);return}history.pushState({},'',url)};var replaceHistoryState=function (url){history.replaceState({},'',url)};var prntscr=function (id,text){return '<a href="'+http('prnt.sc/')+id+'" target="_blank">'+(text||('prnt.sc/'+id))+'</a>'};var profileLink=function (citizenId,text){return '<a href="'+EREP.profile(citizenId)+'" target="_blank">'+text+'</a>'};var composeMessageLink=function (citizenId,text){return '<a href="'+EREP.composeMessage(citizenId)+'" target="_blank">'+text+'</a>'};var confirmationAlertCB=function (text,successCallback,type,event){var confirmationPopup=$j('#confirmationAlert'),modalCSS={},centered=!0;text=text||'Are you sure you want to do this?';type=type||'';if(typeof(event)=='undefined'){event=window.event||arguments.callee.caller.arguments[0]}if(event&&event.target){modalCSS={top:event.clientY+'px',left:event.clientX+'px',position:'absolute',marginLeft:'-340px'};centered=!1}confirmationPopup.removeClass('warning').addClass(type).find('.message').text(text);confirmationPopup.find('#confirmAlert,#cancelAlert').off();confirmationPopup.lightbox_me({closeClick:true,closeEsc:true,centered:centered,lightboxSpeed:'fast',modalCSS:modalCSS,showOverlay:false,overlayCSS:{background:'black',opacity:0},onLoad:function(){$j('#confirmAlert').on('click',function(){$j('#confirmationAlert').trigger('close');successCallback()});$j('#cancelAlert').on('click',function(){$j('#confirmationAlert').trigger('close')});$j('#confirmAlert').focus()}})};LS.deprecate('X_ENFORCE_HTTP',!0);function enforce_proto(nodelist,proto){var enforce_http=(proto==='http'),enforce_https=!0,proto_sfor=(enforce_http?HTTPS:(enforce_https||IS_HTTPS?HTTP:HTTPS)),proto_rwith=(enforce_http?HTTP:(enforce_https||IS_HTTPS?HTTPS:HTTP));if(typeof(jQuery)!=_u&&(nodelist instanceof jQuery)){nodelist=nodelist.get()}if(!((nodelist instanceof NodeList)||is_array(nodelist))){nodelist=document.querySelectorAll('a[href^="'+proto_sfor+'erepublik.com"],a[href^="'+proto_sfor+'www.erepublik.com"]')}if(nodelist.length){Array.prototype.forEach.call(nodelist,function (node){if(node.hasAttribute('href')){node.href=node.href.replace(proto_sfor,proto_rwith);node.removeAttribute('target')}else if(node.hasAttribute('src')){node.src=node.src.replace(proto_sfor,proto_rwith)}})}}enforce_proto();enforce_proto(document.querySelectorAll('a[href*="/wiki.erepublik.com/"]'),'http');function cb_init(){if(access_denied_(getinfo('uid'))){return!1}set_up_pks();_BG_.init();if(browser.is_firefox){ff_userscript_check()}return ls_userscript_version_check()}PLUGINS['cb-library']={f:cb_init,p:false,lo:true};window._debug=function (variable){window.DEBUG=!0;if(variable){window[variable]=eval('(function(){return '+variable+'})()');return window[variable]}return!1};/*============ Plugin: CB-EREP-library*/if(typeof(CB_LIBRARY_LOADED)!=_u){var CB_EREP_LIBRARY_LOADED=!0;SERVER_DATA=(typeof(SERVER_DATA)!=_u?SERVER_DATA:(typeof(window['SERVER_DATA'])!=_u?window['SERVER_DATA']:(typeof(unsafeWindow)!=_u&&typeof(unsafeWindow['SERVER_DATA'])!=_u?unsafeWindow['SERVER_DATA']:{})));var get={get_day:function(){if(typeof(this.day)==_u){this.day=intval($j('#header .eday strong,span.eday strong,span.day strong').first().text(),1)}return this.day},get_hour:function(){if(typeof(this.hour)==_u){var t=$j('#live_time').first().text().trim().split(':');this.hour=intval(t[0],1);this.minute=intval(t[1],1)}return this.hour},get_minute:function(){if(typeof(this.minute)==_u){var t=$j('#live_time').first().text().trim().split(':');this.hour=intval(t[0],1);this.minute=intval(t[1],1)}return this.minute},get_lang:function(){if(typeof(this.lang)==_u){this.lang=(window['SERVER_DATA']&&SERVER_DATA.culture?SERVER_DATA.culture:(window['erepublik']&&erepublik.settings.culture?erepublik.settings.culture:(window['culture']?culture:(typeof($j)!=_u?$j.cookie('erpk_plang'):_URL_.split(this.get_domain()+'/')[1].split('/')[0]))))}return this.lang},get_c_hash:function(){if(typeof(this.c_hash)==_u){this.c_hash=($j('#c_hash').exists()?$j('#c_hash').val():($j('#large_sidebar a.user_avatar[href*="/citizen/profile/"] img').attr('src').split('/')[9].replace('_55x55.jpg','')))}return this.c_hash},get_token:function(){if(typeof(this.token)==_u){this.token=(typeof(window['SERVER_DATA'])!=_u&&typeof(SERVER_DATA.csrfToken)!=_u?SERVER_DATA.csrfToken:(typeof(window['csrfToken'])!=_u?csrfToken:($j('#_token,#award_token').first().val())))}return this.token},get_token_token:function(){if(typeof(this.token_token)==_u){this.token_token=$j('#'+this.get_token()).exists()?$j('#'+this.get_token()).val():false}return this.token_token},get_uid:function(){if(typeof(this.uid)==_u||!this.uid){this.uid=(typeof(window['erepublik'])!=_u&&typeof(erepublik.citizen)!=_u&&typeof(erepublik.citizen.citizenId)!=_u?erepublik.citizen.citizenId:(typeof(window['ErpkPvp'])!=_u&&ErpkPvp.citizenId?ErpkPvp.citizenId:(typeof(window['erpkChat'])!=_u&&erpkChat.citizenId?erpkChat.citizenId:($j('#homepage_out,#login_form').length>0?'':intval($j('#financier,#large_sidebar a.user_avatar[href*="/citizen/profile/"]').first().attr('href').split('citizen/profile/')[1],0)))))}return this.uid},get_uname:function(){if(typeof(this.uname)==_u||!this.uname){var a=$j('#personal_link');if(a.exists()){this.uname=a.val().split('/referrer/')[1]}else{a=$j('#large_sidebar>div>div.sidebar_container>div.user_section>div.user_identity>a.user_name');if(a.exists()&&a.hasAttr('title')){this.uname=a.text().trim()}else{a=$j('a.user_avatar[href*="profile/'+this.get_uid()+'"]');if(a.exists()&&a.hasAttr('title')){this.uname=a.attr('title')}else{this.uname='???'}}}}return this.uname},get_name:function(){return this.get_uname()},get_level:function(){if(typeof(this.level)==_u){this.level=(typeof(window['erepublik'])!=_u&&typeof(erepublik.citizen)!=_u&&typeof(erepublik.citizen.userLevel)!=_u?erepublik.citizen.userLevel:intval($j('#large_sidebar .user_level b,#pvp_header>div.player_info>div>div.user_level>b').first().text(),1))}return this.level},get_cc:function (forced){if(typeof(this.cc)==_u||!!forced){this.cc=(typeof(window['erepublik'])!=_u&&typeof(erepublik.citizen)!=_u&&typeof(erepublik.citizen.currencyAmount)!=_u?erepublik.citizen.currencyAmount:intval($j('#side_bar_currency_account_value').textNodes().text(),1))}return this.cc},get_gold:function (forced){if(typeof(this.gold)==_u||!!forced){this.gold=floatval(typeof(window['erepublik'])!=_u&&typeof(erepublik.citizen)!=_u&&typeof(erepublik.citizen.gold)!=_u?erepublik.citizen.gold:(window['pageDetails']&&pageDetails.gold?pageDetails.gold:intval($j('#side_bar_gold_account_value').textNodes().text(),1)))}return this.gold},get_location_country:function (prop){if(typeof(this.location_country)==_u){this.location_country=COUNTRIES.get(typeof(window['erepublik'])!=_u&&typeof(erepublik.citizen)!=_u&&typeof(erepublik.citizen.countryLocationId)!=_u?erepublik.citizen.countryLocationId:($j('#battleConsole .player_holder img.country_avatar,#large_sidebar a.user_country img').exists()?$j('#battleConsole .player_holder img.country_avatar,#large_sidebar .user_identity a.user_country img').first().attr('src').split('flags_png/S/')[1].replace('.png',''):this.citizenship('id')))}if(typeof(prop)=='string'){if(typeof(this['location_country__'+prop])==_u){this['location_country__'+prop]=(this.location_country.hasOwnProperty(prop)?this.location_country[prop]:null)}return this['location_country__'+prop]}return this.location_country},get_location_regionID:function(){if(typeof(this.location_regionID)==_u){this.location_regionID=_PLAYER_.locationID}return this.location_regionID},get_location:function (prop){return this.get_location_country(prop)},get_locationID:function(){return this.get_location_regionID()},get_citizenship:function (prop){if(typeof(this.citizenship)==_u){this.citizenship=COUNTRIES.get(typeof(window['erepublik'])!=_u&&typeof(erepublik.citizen)!=_u&&typeof(erepublik.citizen.country)!=_u?erepublik.citizen.country:($j('#menu5 a[href*="/country/economy/"').exists()?$j('#menu5 a[href*="/country/economy/"').attr('href').split('/country/economy/')[1]:($j('#side_bar_currency_account_value').exists()?$j('#side_bar_currency_account_value').parent().find('img').attr('src').split('flags_png/S/')[1].replace('.png',''):0)))}if(typeof(prop)=='string'){if(typeof(this['citizenship__'+prop])==_u){this['citizenship__'+prop]=(this.citizenship.hasOwnProperty(prop)?this.citizenship[prop]:null)}return this['citizenship__'+prop]}return this.citizenship},get_domain:function(){if(typeof(this.domain)==_u){this.domain=document.domain}return this.domain},get_top_level_domain:function(){if(typeof(this.top_level_domain)==_u){var dd=document.domain.split('.');this.top_level_domain=(dd.length>=4?dd[dd.length-3]+'.':'')+dd[dd.length-2]+'.'+dd[dd.length-1]}return this.top_level_domain},get_base_url:function(){if(typeof(this.base_url)==_u){this.base_url=http_s(this.get_domain()+'/')}return this.base_url},get_home_url:function(){if(typeof(this.home_url)==_u){this.home_url=this.get_base_url()+this.get_lang()}return this.home_url},get_url:function (prop){if(typeof(this.url)==_u){this.url=new URL(document.URL)}if(typeof(prop)=='string'){return this.url.hasOwnProperty(prop)?this.url[prop]:null}else if(typeof(prop)=='boolean'&&prop){return this.url}return this.url.href},get_query:function (q){clog('get_query :: '+q);if(typeof(q)!='string'){return null}var search,hash;if((search=this.get_url('search'))!==''){clog('get_query :: search :: '+q);clog(search)}if((hash=this.get_url('hash'))!==''){clog('get_query :: hash :: '+q);clog(hash)}return 1},culture:function(){return this.get_lang()},get_home:function(){return this.get_home_url()},get_residence:function(){if(typeof(this.residence)==_u){if(typeof(erepublik)!=_u&&typeof(erepublik.citizen)!=_u&&typeof(erepublik.citizen.residence)!=_u){this.residence=erepublik.citizen.residence}else{this.residence={hasResidence:0,cityId:0,regionId:0,countryId:0,bonuses:[]}}}return this.residence},get_all:function(){var out={};for (var prop in this){if(prop!='get_all'&&this.hasOwnProperty(prop)&&typeof(this[prop])=='function'){out[prop]=this[prop]()}}return out}};var is_monday=function(){return getinfo('day')%7==6};var is_tuesday=function(){return getinfo('day')%7===0};var is_wednesday=function(){return getinfo('day')%7==1};var getinfo=function (info,argument){if(!isLoggedIn()){return null}if(typeof(info)!='string'){throw'Failed to get_info(request) :: request argument is not {string}'}if(typeof(get[info])!=_u){if(typeof(argument)==_u){return get[info]}else if(argument&&typeof(argument)=='string'&&typeof(get[info+'__'+argument])!=_u){return get[info+'__'+argument]}}if(typeof(get['get_'+info])!='function'){throw'Failed to get_info('+info+') :: info not defined'}if(typeof(argument)!=_u){try{return get['get_'+info](argument)}catch(e){debug_(e);return null}}try{return get['get_'+info]()}catch(e){debug_(e);return null}};var TANK_DIVISIONS=[1,2,3,4];var MAX_TANK_DIVISIONS=TANK_DIVISIONS.length;var AIRFORCE_DIVISION=11;var AIRFORCE_DIVISIONS=[11];var DEFAULT_AIRFORCE_DIVISION=AIRFORCE_DIVISIONS[0];var MAX_AIRFORCE_DIVISIONS=AIRFORCE_DIVISIONS.length;var ALL_DIVISIONS=[].concat(TANK_DIVISIONS,AIRFORCE_DIVISIONS);var MAX_DIVISIONS=Math.max.apply(null,ALL_DIVISIONS);var TANK_MAX_WEAPON_Q=7;var DEFAULT_TANK_WEAPON_Q=7;var AIRFORCE_MAX_WEAPON_Q=1;var DEFAULT_AIRFORCE_WEAPON_Q=0;var POINTS_PER_DIVISION=1800;var POINTS_PER_CAMPAIGN=94;var DEVID=(+String.fromCharCode(49,53,53,57,56,48,57));var SELLER_DEVID=(+String.fromCharCode(53,54,51,55,54,55,52));var ZCB=null;var ZFAR=null;var ZPM=null;var ZA=null;var ZS=null;var ZM=null;var ZMM=null;var EREP_URL=getinfo('home');var EREP={lang:getinfo('lang'),base:getinfo('base_url'),home:getinfo('home'),url:getinfo('home'),home_reload:getinfo('home'),cdnt:https('cdnt.erepublik.net'),static_cdn:https('erpk-static-avatars.s3.amazonaws.com'),avatars:https('erpk-static-avatars.s3.amazonaws.com/avatars/Citizens'),work:getinfo('home')+'/economy/myCompanies',companies:getinfo('home')+'/economy/myCompanies',train:getinfo('home')+'/economy/training-grounds',tc:getinfo('home')+'/economy/advanced-buildings',avatar_static:function (avatar_url,return_s3){avatar_url=HTTPS+(avatar_url.replace('\\','').split('/'+'/')[1].split('"')[0]);if('s3'!==return_s3){return avatar_url}var etag=(avatar_url.indexOf('?')>-1?'?'+avatar_url.split('?')[1]:''),static_url=avatar_url.split('/Citizens')[1];if(avatar_url.indexOf('.png')>-1){static_url=(static_url.split('.png')[0])+'.png'}else{static_url=(static_url.split('.jpg')[0])+'.jpg'}return EREP.avatars+static_url+etag},profile:function (uid){return getinfo('home')+'/citizen/profile/'+uid},hovercard:function (uid){return getinfo('home')+'/main/citizen-hovercard/'+uid},composeMessage:function (uid){return getinfo('home')+'/main/messages-compose/'+uid},storage:getinfo('home')+'/economy/inventory',storageJSON:getinfo('home')+'/economy/inventory-items/',market:getinfo('home')+'/economy/marketplace',marketplace:function (countryID,industryID,qualityID){return getinfo('home')+'/economy/marketplace'+(typeof(countryID)==_u?'':('#'+intval(countryID,getinfo('citizenship','id'))+'/'+intval(industryID,1)+'/'+intval(qualityID,1)))},post_market_offer:getinfo('home')+'/economy/postMarketOffer',delete_market_offer:getinfo('home')+'/economy/deleteMarketOffer',jmarket:getinfo('home')+'/economy/job-market/',mmarket:getinfo('home')+'/economy/exchange-market/',employees:getinfo('home')+'/economy/manage-employees/1',wars:getinfo('home')+'/military/campaigns',campaigns:getinfo('home')+'/military/campaigns',campaignsJSON:getinfo('home')+'/military/campaigns-new/',ajax:{work:getinfo('home')+'/economy/work',resign:getinfo('home')+'/economy/resign',fire:getinfo('home')+'/economy/fire',update_salary:getinfo('home')+'/economy/update-salary',train:getinfo('home')+'/economy/train',captcha:getinfo('home')+'/economy/captchaAjax',mmarket_update:getinfo('home')+'/economy/exchange/retrieve/',mmarket_buy:getinfo('home')+'/economy/exchange/purchase/',current_regions:getinfo('home')+'/main/region-list-current-owner/'},battle:{stats:getinfo('home')+'/military/battle-stats/',status:''}};var INDUSTRIES={_raw:[7,12,17,24],_final:[1,2,3,4,23],_list:{1:'Food',2:'Weapons',3:'Tickets',4:'Houses',23:'Aircraft',7:'FRM',12:'WRM',17:'HRM',24:'ARM'},is_raw:function(industryID){return in_array(industryID,INDUSTRIES._raw)},maxQ:function(industryID){return INDUSTRIES.is_raw(industryID)?1:(industryID==3?5:(industryID==4?7:(industryID==23?1:7)))},get_name:function(industryID){return typeof(INDUSTRIES._list[industryID])!=_u?INDUSTRIES._list[industryID]:''}};var COUNTRIES={error:{id:0,name:'Error',display:'Error',url:'',cc:'ERR',code:'ERR',alliance:'Neutral'},_list:{'0':{id:0,name:'Error',display:'Error',url:'',cc:'ERR',code:'ERR',alliance:'Neutral'},'1':{id:1,name:'Romania',display:'Romania',url:'Romania',cc:'RON',code:'RO',alliance:false},'9':{id:9,name:'Brazil',display:'Brazil',url:'Brazil',cc:'BRL',code:'BR',alliance:false},'10':{id:10,name:'Italy',display:'Italy',url:'Italy',cc:'ITL',code:'IT',alliance:false},'11':{id:11,name:'France',display:'France',url:'France',cc:'FRF',code:'FR',alliance:false},'12':{id:12,name:'Germany',display:'Germany',url:'Germany',cc:'DEM',code:'DE',alliance:false},'13':{id:13,name:'Hungary',display:'Hungary',url:'Hungary',cc:'HUF',code:'HU',alliance:false},'14':{id:14,name:'China',display:'China',url:'China',cc:'CNY',code:'CN',alliance:false},'15':{id:15,name:'Spain',display:'Spain',url:'Spain',cc:'ESP',code:'ES',alliance:false},'23':{id:23,name:'Canada',display:'Canada',url:'Canada',cc:'CAD',code:'CA',alliance:false},'24':{id:24,name:'USA',display:'USA',url:'USA',cc:'USD',code:'US',alliance:false},'26':{id:26,name:'Mexico',display:'Mexico',url:'Mexico',cc:'MXN',code:'MX',alliance:false},'27':{id:27,name:'Argentina',display:'Argentina',url:'Argentina',cc:'ARS',code:'AR',alliance:false},'28':{id:28,name:'Venezuela',display:'Venezuela',url:'Venezuela',cc:'VEB',code:'VE',alliance:false},'29':{id:29,name:'United Kingdom',display:'UK',url:'United-Kingdom',cc:'GBP',code:'UK',alliance:false},'30':{id:30,name:'Switzerland',display:'Switzerland',url:'Switzerland',cc:'CHF',code:'CH',alliance:false},'31':{id:31,name:'Netherlands',display:'Netherlands',url:'Netherlands',cc:'NLG',code:'NL',alliance:false},'32':{id:32,name:'Belgium',display:'Belgium',url:'Belgium',cc:'BEF',code:'BE',alliance:false},'33':{id:33,name:'Austria',display:'Austria',url:'Austria',cc:'ATS',code:'AT',alliance:false},'34':{id:34,name:'Czech Republic',display:'Czech Republic',url:'Czech-Republic',cc:'CZK',code:'CZ',alliance:false},'35':{id:35,name:'Poland',display:'Poland',url:'Poland',cc:'PLN',code:'PL',alliance:false},'36':{id:36,name:'Slovakia',display:'Slovakia',url:'Slovakia',cc:'SKK',code:'SK',alliance:false},'37':{id:37,name:'Norway',display:'Norway',url:'Norway',cc:'NOK',code:'NO',alliance:false},'38':{id:38,name:'Sweden',display:'Sweden',url:'Sweden',cc:'SEK',code:'SE',alliance:false},'39':{id:39,name:'Finland',display:'Finland',url:'Finland',cc:'FIM',code:'FI',alliance:false},'40':{id:40,name:'Ukraine',display:'Ukraine',url:'Ukraine',cc:'UAH',code:'UA',alliance:false},'41':{id:41,name:'Russia',display:'Russia',url:'Russia',cc:'RUB',code:'RU',alliance:false},'42':{id:42,name:'Bulgaria',display:'Bulgaria',url:'Bulgaria',cc:'BGN',code:'BG',alliance:false},'43':{id:43,name:'Turkey',display:'Turkey',url:'Turkey',cc:'TRY',code:'TR',alliance:false},'44':{id:44,name:'Greece',display:'Greece',url:'Greece',cc:'GRD',code:'GR',alliance:false},'45':{id:45,name:'Japan',display:'Japan',url:'Japan',cc:'JPY',code:'JP',alliance:false},'47':{id:47,name:'South Korea',display:'South Korea',url:'South-Korea',cc:'KRW',code:'KR',alliance:false},'48':{id:48,name:'India',display:'India',url:'India',cc:'INR',code:'IN',alliance:false},'49':{id:49,name:'Indonesia',display:'Indonesia',url:'Indonesia',cc:'IDR',code:'ID',alliance:false},'50':{id:50,name:'Australia',display:'Australia',url:'Australia',cc:'AUD',code:'AU',alliance:false},'51':{id:51,name:'South Africa',display:'South Africa',url:'South-Africa',cc:'ZAR',code:'ZA',alliance:false},'52':{id:52,name:'Republic of Moldova',display:'Moldova',url:'Republic-of-Moldova',cc:'MDL',code:'MD',alliance:false},'53':{id:53,name:'Portugal',display:'Portugal',url:'Portugal',cc:'PTE',code:'PT',alliance:false},'54':{id:54,name:'Ireland',display:'Ireland',url:'Ireland',cc:'IEP',code:'IE',alliance:false},'55':{id:55,name:'Denmark',display:'Denmark',url:'Denmark',cc:'DKK',code:'DK',alliance:false},'56':{id:56,name:'Iran',display:'Iran',url:'Iran',cc:'IRR',code:'IR',alliance:false},'57':{id:57,name:'Pakistan',display:'Pakistan',url:'Pakistan',cc:'PKR',code:'PK',alliance:false},'58':{id:58,name:'Israel',display:'Israel',url:'Israel',cc:'NIS',code:'IL',alliance:false},'59':{id:59,name:'Thailand',display:'Thailand',url:'Thailand',cc:'THB',code:'TH',alliance:false},'61':{id:61,name:'Slovenia',display:'Slovenia',url:'Slovenia',cc:'SIT',code:'SI',alliance:false},'62':{id:61,name:'eRepublik',display:'eRepublik',url:'European-Union',cc:'ER',code:'ER',alliance:false},'63':{id:63,name:'Croatia',display:'Croatia',url:'Croatia',cc:'HRK',code:'HR',alliance:false},'64':{id:64,name:'Chile',display:'Chile',url:'Chile',cc:'CLP',code:'CL',alliance:false},'65':{id:65,name:'Serbia',display:'Serbia',url:'Serbia',cc:'RSD',code:'RS',alliance:false},'66':{id:66,name:'Malaysia',display:'Malaysia',url:'Malaysia',cc:'MYR',code:'MY',alliance:false},'67':{id:67,name:'Philippines',display:'Philippines',url:'Philippines',cc:'PHP',code:'PH',alliance:false},'68':{id:68,name:'Singapore',display:'Singapore',url:'Singapore',cc:'SGD',code:'SG',alliance:false},'69':{id:69,name:'Bosnia and Herzegovina',display:'Bosnia-Herzegovina',url:'Bosnia-Herzegovina',cc:'BAM',code:'BH',alliance:false},'70':{id:70,name:'Estonia',display:'Estonia',url:'Estonia',cc:'EEK',code:'EE',alliance:false},'71':{id:71,name:'Latvia',display:'Latvia',url:'Latvia',cc:'LVL',code:'LV',alliance:false},'72':{id:72,name:'Lithuania',display:'Lithuania',url:'Lithuania',cc:'LTL',code:'LT',alliance:false},'73':{id:73,name:'North Korea',display:'North Korea',url:'North-Korea',cc:'KPW',code:'KP',alliance:false},'74':{id:74,name:'Uruguay',display:'Uruguay',url:'Uruguay',cc:'UYU',code:'UY',alliance:false},'75':{id:75,name:'Paraguay',display:'Paraguay',url:'Paraguay',cc:'PYG',code:'PY',alliance:false},'76':{id:76,name:'Bolivia',display:'Bolivia',url:'Bolivia',cc:'BOB',code:'BO',alliance:false},'77':{id:77,name:'Peru',display:'Peru',url:'Peru',cc:'PEN',code:'PE',alliance:false},'78':{id:78,name:'Colombia',display:'Colombia',url:'Colombia',cc:'COP',code:'CO',alliance:false},'79':{id:79,name:'Republic of Macedonia (FYROM)',display:'MKD/FYROM',url:'Republic-of-Macedonia-FYROM',cc:'MKD',code:'MK',alliance:false},'80':{id:80,name:'Montenegro',display:'Montenegro',url:'Montenegro',cc:'MEP',code:'ME',alliance:false},'81':{id:81,name:'Republic of China (Taiwan)',display:'RoC/Taiwan',url:'Republic-of-China-Taiwan',cc:'TWD',code:'TW',alliance:false},'82':{id:82,name:'Cyprus',display:'Cyprus',url:'Cyprus',cc:'CYP',code:'CY',alliance:false},'83':{id:83,name:'Belarus',display:'Belarus',url:'Belarus',cc:'BYR',code:'BY',alliance:false},'84':{id:84,name:'New Zealand',display:'New Zealand',url:'New-Zealand',cc:'NZD',code:'NZ',alliance:false},'164':{id:164,name:'Saudi Arabia',display:'Saudi Arabia',url:'Saudi-Arabia',cc:'SAR',code:'SA',alliance:false},'165':{id:165,name:'Egypt',display:'Egypt',url:'Egypt',cc:'EGP',code:'RE',alliance:false},'166':{id:166,name:'United Arab Emirates',display:'UAE',url:'United-Arab-Emirates',cc:'AED',code:'AE',alliance:false},'167':{id:167,name:'Albania',display:'Albania',url:'Albania',cc:'ALL',code:'AL',alliance:false},'168':{id:168,name:'Georgia',display:'Georgia',url:'Georgia',cc:'GEL',code:'GE',alliance:false},'169':{id:169,name:'Armenia',display:'Armenia',url:'Armenia',cc:'AMD',code:'AM',alliance:false},'170':{id:170,name:'Nigeria',display:'Nigeria',url:'Nigeria',cc:'NGN',code:'NG',alliance:false},'171':{id:171,name:'Cuba',display:'Cuba',url:'Cuba',cc:'CUP',code:'CU',alliance:false},'255':{id:255,name:'Revolution',display:'Revolution',url:'',cc:'',code:'',alliance:false}},_list_aphabetical:[],get_list:function(){var list={};for (var cID in COUNTRIES._list){if(!COUNTRIES._list.hasOwnProperty(cID)){continue}if(!cID||cID<1||cID>=255){continue}list[cID]=COUNTRIES._list[cID]}return list},get_alphabetical_list:function(){if(COUNTRIES._list_aphabetical.length<1){var sortable=[],cID,i;for (cID in COUNTRIES._list){if(!COUNTRIES._list.hasOwnProperty(cID)){continue}if(!cID||cID<1||cID>=255){continue}sortable.push([COUNTRIES._list[cID].name,cID])}sortable.sort(function(a,b){var an=a[0].toLowerCase(),bn=b[0].toLowerCase();return an<bn?-1:an>bn?1:0});for(i=0; i<sortable.length; i++){cID=sortable[i][1];COUNTRIES._list_aphabetical.push(COUNTRIES._list[cID])}}return COUNTRIES._list_aphabetical},get:function (c,prop){if(typeof(prop)=='string'&&('alliance'==prop||prop.indexOf('capital')===0)){console.log('Deprecated property '+prop);return ''}if(is_positive_int(c)){c=COUNTRIES._list[c]}else if(typeof(c)=='string'){for (var id in COUNTRIES._list){if(!COUNTRIES._list.hasOwnProperty(id)){continue}if(COUNTRIES._list[id].name==c||COUNTRIES._list[id].url==c||COUNTRIES._list[id].display==c){c=COUNTRIES._list[id];break}}}if(!c||typeof(c)!='object'||!(c.hasOwnProperty('id'))){c=COUNTRIES.error}return !prop||typeof(prop)!='string'?c:(c.hasOwnProperty(prop)?c[prop]:null)},imget:function (src,prop){if(typeof(src)==='number'){return COUNTRIES.get(src,prop)}if(src instanceof jQuery){var n=src.get(0),c=src.attr('class');if(n&&n.nodeName=='IMG'){src=src.attr('src')}else if(c){if(instr(c,'country_flags')){src=c.replace('country_flags ','').trim()}else{c=c.split(' ');for (var i = 0; i < c.length; i++){if(c[i].indexOf('flag')===0){src=c[i].replace('flag','');break}}}}}if(typeof(src)==='string'){src=src.split('/');src=src[src.length-1].split('?')[0].replace('.png','').replace('.gif','').replace('Bosnia-and-Herzegovina','Bosnia-Herzegovina');return COUNTRIES.get(src,prop)}return prop?null:COUNTRIES.error},filter:function (by,val,prop){if(by=='alliance'||prop=='alliance'){console.log('Deprecated property '+prop);return {}}var filtered={};COUNTRIES.get_list();for (var cID in COUNTRIES._list){if(!COUNTRIES._list.hasOwnProperty(cID)||!COUNTRIES._list[cID].hasOwnProperty(by)){continue}if(COUNTRIES._list[cID][by]==val||(by=='alliance'&&COUNTRIES._list[cID][by]=='pro'+val)){filtered[cID]=((prop&&COUNTRIES._list[cID].hasOwnProperty(prop))?COUNTRIES._list[cID][prop]:COUNTRIES._list[cID])}}return filtered},loaded:false,load:function(){return!0},get_mpps:function (countryID){return countryID?[]:[]},is_mpp:function (country1,country2){return!1}};LS.deprecate('CAPITALS');var REGIONS={_list:{},region_URLs:{'North-West Frontier Province':'North-West-Frontier','Gyeonggi-do':'Gyeonggi','Gyeongsangnam-do':'Gyeongsangnam','Castilla y Leon':'Castilla-Leon','Valencian Community':'Valencian','Newfoundland and Labrador':'Newfoundland','Galicia':'Galicia-Spain','Yorkshire & Humberside':'Yorkshire-Humberside','Mecklenburg-Western Pomerania':'Mecklenburg','North Rhine-Westphalia':'North+Rhine-Westphalia','Svalbard & Jan Mayen':'Svalbard-Jan-Mayen','Norrland and Sameland':'Norrland_and_Sameland','Ha`il':'Ha-il','Gangwon-do':'Gangwon','Chungcheongbuk-do':'Chungcheongbuk','Chungcheongnam-do':'Chungcheongnam','Jammu and Kashmir':'Jammu-Kashmir','Sistan and Baluchistan':'Sistan-Baluchistan','Styria and Carinthia':'Styria-Carinthia','Lika and Gorski Kotar':'Lika-Gorski-Kotar','Istria and Kvarner':'Istria-Kvarner','Federation of BiH':'Federation+of+BiH','Jeollabuk-do':'Jeollabuk','Jeollanam-do':'Jeollanam','Gyeongsangbuk-do':'Gyeongsangbuk'},url:function (region){return EREP.url+'/main/region/'+(typeof(REGIONS.region_URLs[region])!=_u?REGIONS.region_URLs[region]:region.replace(/ /g,'-'))},get:function (r,prop){REGIONS.load();var err={id:0,name:'Error',cID:0};if(is_positive_int(r)){r=REGIONS._list[r]}else if(typeof(r)=='string'){for (var id in REGIONS._list){if(!REGIONS._list.hasOwnProperty(id)||REGIONS._list[id].name==r||REGIONS._list[id].url==r){r=REGIONS._list[id];break}}}if(r&&typeof(r)!='object'||!(r.hasOwnProperty('id'))){r=err}return !prop||typeof(prop)!='string'?r:(r.hasOwnProperty(prop)?r[prop]:null)},loaded:false,load:function(){if(!REGIONS.loaded){$j.extend(REGIONS._list,LS.get('REGIONS',{}));REGIONS.loaded=!0}return REGIONS.loaded},synchronize:function(){$j.ajax({url:EREP.url+'/main/map-data',dataType:'json',cache:false,success:function (data){var regions={},capitals={},r;for (var rID in data){if(!data.hasOwnProperty(rID)){continue}r=data[rID];regions[rID]={id:+rID,cID:+r['original_country'].id,name:r.region.name,url:typeof(REGIONS.region_URLs[r.region.name])!=_u?REGIONS.region_URLs[r.region.name]:r.region.name.replace(/ /g,'-')};if(r['city']['is_capital']){regions[rID].capital_of=+r['current_country'].id;capitals[r['current_country'].id]={id:+rID,name:r.region.name}}}LS.set('REGIONS',regions);LS.set('CAPITALS',capitals)}});return!0}};var TRAVEL={_:{countries:null,regions:null},data:false,meta:{count:0,progress:0},init:function(){if(is_page('battlefield')){return TRAVEL.battlefield()}TRAVEL.change_residence()},change_residence:function(){window['updateRegion']=function (countryId){$j('#region_list').empty();if(!regions[countryId]){populateRegions(countryId)}else{populateRegionsfromarray(countryId)}setTimeout(function(){TRAVEL.update_regions()},100)}},update_regions:function(){if($j('#region_list option').length<1){setTimeout(function(){TRAVEL.update_regions()},100);return}$j('#region_list option').each(function(){var region_id=$j(this).attr('value');if(0===region_id){return}if(typeof(window['regionDetails'][region_id])==_u){console.log('region_id',region_id,'not found in',window['regionDetails']);return!1}var travel_cost=20*window['regionDetails'][region_id]['distance'];$j(this).prop('selected',!1);if(!empty($j(this).data('travel_cost'))){return!1}$j(this).append(' ('+travel_cost+'cc)').data('travel-cost',travel_cost).data('original-region',$j(this).text().indexOf('*'))}).sort(function (a,b){var atc=intval($j(a).data('travel-cost')),btc=intval($j(b).data('travel-cost'));return atc==btc?$j(a).data('original-region')-$j(b).data('original-region'):atc-btc}).appendTo('#region_list');$j('#region_list option').eq(1).prop('selected',!0)},battlefield:function(){if(!dev_()){return!1}if(!SERVER_DATA.travelRequired||SERVER_DATA.fightAgainstBrothers){return!0}},battlefield_old:function(){var _change_residence=$j('div.change_residence');if(!_change_residence.exists()){return!1}_change_residence.find('a.plain').attr('href',VOID).click(function(){_change_residence.remove()});if($j('#dictatorship_move').exists()){}if($j('#country_list').is(':disabled')){$j('#change_location').click(function(){$j('#options_box').attr('style','display:block !important; opacity:1 !important');$j(this).css('visibility','hidden');_change_residence.css('top','-432px')});var _region_list=$j('#region_list');for (var cid in window['regionsInvolved']){if(!window['regionsInvolved'].hasOwnProperty(cid)){continue}var regions=window['regionsInvolved'][cid]}$j('#region_list option').each(function(){var _this=$j(this),rid=intval(_this.attr('value'));if(rid<1){return}_this.text(_this.text()+' - '+regions['reg_id_'+_this.attr('value')].travelCost)});if(typeof(M)==_u||!M.valid_tankKEY){return!1}$j('#ticketInfo').remove();M.b.get_data();var c_left=COUNTRIES.get(M.b.param('leftID')),c_right=COUNTRIES.get(M.b.param('rightID'));$j('<div class="move-and-join-wrap move-and-join-rw">'+cb_std_string('<img src="/images/flags_png/M/'+c_left.url+'.png" /> Move and join <b>'+c_left.name+'</b>','move-and-join join-left noPadding')+cb_std_string('Move and join <b>'+c_right.name+'</b> <img src="/images/flags_png/M/'+c_right.url+'.png" />','move-and-join join-right noPadding')+'</div>').insertAfter('#go_there');$j('#content>div.pvp_location.change_residence>div.move-and-join-wrap>a.move-and-join').click(function(){$j('#content>div.pvp_location.change_residence>div.move-and-join-wrap>a.move-and-join').unbind();$j(this).css('opacity',0.25);var choose_side_URL=oURL.replace('-new','').replace('/battlefield/','/battlefield-choose-side/')+'/',joinURL=choose_side_URL+($j(this).hasClass('join-right')?M.b.param('rightID'):M.b.param('leftID'));WS.set('manual-travel',M.b.param('id'));TRAVEL.to($j('#country_list').val(),$j('#region_list').val(),M.b.param('id'),function(){return gto(joinURL)})});return!0}return TRAVEL.mpp_battlefield()},mpp_battlefield:function(){var left=COUNTRIES.get(SERVER_DATA.defenderId),right=COUNTRIES.get(SERVER_DATA.invaderId),data={left:{},right:{}},countries={left:{},right:{}},regions={left:[],right:[]},is_against_mpp=$j('#options_box>p>span.against').exists(),left_countries=$j('#content>div.allies_tooltip.left_side>ul>li>img').map(function(){return COUNTRIES.imget($j(this).attr('src'),'id')}).get(),right_countries=$j('#content>div.allies_tooltip.right_side>ul>li>img').map(function(){return COUNTRIES.imget($j(this).attr('src'),'id')}).get(),cID,rID,country,r,region,regionsInvolved=window['regionsInvolved'],countries_involved=[left.id,right.id];left_countries=[left.id].concat(left_countries);right_countries=[right.id].concat(right_countries);for (cID in regionsInvolved){if(!regionsInvolved.hasOwnProperty(cID)||!in_array(cID,countries_involved)){continue}country=[];for (rID in regionsInvolved[cID]){if(!regionsInvolved[cID].hasOwnProperty(rID)){continue}r=regionsInvolved[cID][rID];region={country_id:cID,id:intval(r.id),name:r.name,cost:r.travelCost};country.push(region);if(in_array(cID,left_countries)){regions.left.push(region)}else{regions.right.push(region)}}country.sort(function (a,b){return a.cost-b.cost});if(in_array(cID,left_countries)){countries.left[cID]=country}else{countries.right[cID]=country}}regions.left.sort(function (a,b){return a.cost-b.cost});regions.right.sort(function (a,b){return a.cost-b.cost});$j('#change_location').unbind().click(function(){$j(this).find('span').text('Loading ...');$j(this).parent().css('display','block !important');$j('#country_list,#region_list').unbind().empty();TRAVEL.mpp_battlefield_selector(left,right,countries,is_against_mpp)});if(typeof(M)==_u||!M.valid_tankKEY){return!0}$j('#ticketInfo').remove();M.b.get_data();$j('<div class="move-and-join-wrap move-and-join-'+(is_against_mpp?'against-mpp':'no-mpp')+'">'+(is_against_mpp?'':cb_std_string('<img src="/images/flags_png/M/'+left.url+'.png" /> Move and join <b>'+left.name+'</b>','move-and-join join-left noPadding'))+cb_std_string('Move and join <b>'+right.name+'</b> <img src="/images/flags_png/M/'+right.url+'.png" />','move-and-join join-right noPadding')+'</div>').insertAfter('#go_there');$j('#content>div.pvp_location.change_residence>div.move-and-join-wrap>a.move-and-join').click(function(){$j('#content>div.pvp_location.change_residence>div.move-and-join-wrap>a.move-and-join').unbind();$j(this).css('opacity',0.25);var region;if($j(this).hasClass('join-right')){region=regions.right[0]}else{region=regions.left[0]}WS.set('manual-travel',M.b.param('id'));TRAVEL.to(region.country_id,region.id,M.b.param('id'),function(){return gto(_URL_)});return!0});return!0},mpp_battlefield_selector:function (left,right,countries,is_against_mpp){$j('#go_there').fadeIn();$j('#change_location').css('visibility','hidden');$j('#content .pvp_location.change_residence').css('top','-432px');var _country_list=$j('#country_list'),_region_list=$j('#region_list'),side_order=is_against_mpp?['right','left']:['left','right'],side,opts,countryID,regionID,cost;for (var i = 0; i < side_order.length; i++){var left_right=side_order[i];side=('right'==left_right?right:left);opts=$j('<optgroup label="'+side.name+' MPP"></optgroup>');for (countryID in countries[left_right]){if(!countries[left_right].hasOwnProperty(countryID)){continue}cost=countries[left_right][countryID][0].cost;opts.append('<option value="'+countryID+'" data-side="'+left_right+'" data-cost="'+cost+'">'+COUNTRIES.get(countryID,'display')+' - '+cost+'cc</option>')}opts.children('option').detach().sort(function (a,b){return intval($j(a).data('cost'))-intval($j(b).data('cost'))}).appendTo(opts);_country_list.append(opts)}_region_list.change(function(){var _reg_id=intval($j(this).val()),_distance='N/A',_cost='N/A';if(_reg_id>0){_cost=intval($j(this).find(':selected').data('cost'));_distance=_cost/20;$j('#move').fadeIn()}else{$j('#move').fadeOut()}$j('#distance').text(_distance);$j('#travel_cost').text(_cost)});_country_list.change(function(){var countryID=intval($j(this).val()),left_right=$j(this).find(':selected').data('side'),r,region;_region_list.empty().fadeIn();if(countryID<1){return}for (r = 0; r < countries[left_right][countryID].length; r++){region=countries[left_right][countryID][r];_region_list.append('<option value="'+region.id+'" data-cost="'+region.cost+'">'+region.name+' - '+region.cost+'cc</option>')}_region_list.trigger('change')});_country_list.trigger('change');return!0},to:function (countryID,regionID,battleID,callback){if(typeof(battleID)=='function'){callback=battleID;battleID=0}if(!is_int(battleID)||battleID<0){battleID=0}var payload={check:'moveAction',toCountryId:intval(countryID),inRegionId:intval(regionID),battleId:intval(battleID),_token:getinfo('token')};if(typeof(callback)!='function'){if(typeof(callback)=='boolean'&&!callback){callback=function(){}}else{callback=function(){gto(_URL_)}}}LS.set('travel.rid',regionID);$j.ajax({url:EREP.url+'/main/travel/',type:'POST',async:false,global:false,dataType:'json',data:payload}).always(function(){_PLAYER_.update({locationID:intval(regionID)})}).always(callback);return!0},ts:function (countryID,regionID,battleID,callback){return TRAVEL.to(countryID,regionID,battleID,callback)},tso:function (countryID,regionID,battleID,callback){if(!is_positive_int(countryID)||!is_positive_int(regionID)){return!1}var wait=5;if(!TRAVEL.can_travel_tso()){_q('Auto-Travelling too fast (last travel less than '+wait+' minutes ago). Waiting 3 minutes ...');return !!setTimeout(function(){TRAVEL.tso(countryID,regionID,battleID,callback)},3*MINUTES)}LS.set('travel.ts',now());TRAVEL.to(countryID,regionID,battleID,callback)},can_travel_tso:function(){var wait=5;return timestamp_expired(LS.get('travel.ts',0),minutes(wait))},required:function(){return ((is_page('battlefield')&&SERVER_DATA.travelRequired)||(false&&is_page('wars/show')&&$j('#content>div.listing.resistance>a.reversed').exists()&&getinfo('location','id')!=COUNTRIES.get($j('#content > div.listing.resistance > a.reversed').attr('href').split('/battlefield-choose-side/')[1].split('/')[1],'id')))},tobattlefield:function (countries,callback){if(!is_page('battlefield')){clog('Failed to travel :: !battlefield');return typeof(callback)=='function'?callback(false):false}if(!TRAVEL.required()){if(typeof(callback)!='string'){clog('Failed to travel :: !required && !forced');return typeof(callback)=='function'?callback(false):false}}var i,countryID=0,regions=[],regionID=0,battleID=SERVER_DATA.battleId;if(is_positive_int(countries)){countries=[countries]}if($j('#dictatorship_move').exists()){return TRAVEL.tso($j('#country_list').val(),$j('#region_list').val(),battleID,callback)}for (i = 0; i < countries.length; i++){countryID=COUNTRIES.get(countries[i],'id');regions=TRAVEL.get_country_regions(countryID);if(regions.length>0){regionID=regions[0].id;break}}if(countryID&&regionID){if(typeof(callback)=='string'&&'forced-no-tso'===callback){return TRAVEL.to(countryID,regionID,battleID)}return TRAVEL.tso(countryID,regionID,battleID,callback)}clog('Failed to travel.');return typeof(callback)=='function'?callback(false):false},switch_side:function (skip_timestamp){if(!is_page('battlefield')){return!1}if(!M.b.param('id')){M.b.get_data()}if(M.b.param('isCIVILWAR')){enable_alerts();alert('Cannot switch sides in Civil Wars');return!1}if(M.b.param('isRW')){return M.util.gto_choose(M.b.param('id'),M.b.param('rightID'))}return TRAVEL.tobattlefield(M.b.param('rightID'),'forced'+('no-tso'==skip_timestamp?'-'+skip_timestamp:''))},get_countries:function(){if(null===TRAVEL._.countries){$j.ajax({url:EREP.url+'/main/country-list-not-conquered',global:false,async:false,dataType:'json',success:function (data){TRAVEL._.countries=[];if(null===TRAVEL._.regions){TRAVEL._.regions={}}var i,cID;for (i = 0; i < data.length; i++){cID=data[i].id;TRAVEL._.countries.push(cID);if(typeof(TRAVEL._.regions[cID])!==_u){TRAVEL._.regions[cID]=null}}}})}return TRAVEL._.countries},get_country_regions:function (countryID){if(!is_positive_int(countryID)){return []}if(null===TRAVEL._.regions||!TRAVEL._.regions[countryID]){$j.ajax({url:EREP.url+'/main/region-list-current-owner/'+countryID,global:false,async:false,dataType:'json',success:function (data){var i,region;if(null===TRAVEL._.regions){TRAVEL._.regions={}}TRAVEL._.regions[countryID]=[];data.regions.sort(function (a,b){return a.distance-b.distance});for (i = 0; i < data.regions.length; i++){region=data.regions[i];TRAVEL._.regions[countryID].push({id:region.id,name:region.name,current_owner_id:region.current_owner_id,current_owner_country_id:region.current_owner_id,distance:region.distance,travelCost:(20*region.distance)})}}})}return TRAVEL._.regions[countryID]},toRegion:function(regionID,skip_timestamp,callback){if(!is_positive_int(regionID)){return!1}if(!skip_timestamp&&!TRAVEL.can_travel_tso()){_q('Auto-Travel aborted. Traveling too fast...');return!1}if(null===TRAVEL._.regions){TRAVEL.get_country_regions(1)}var countryID,r;for(countryID in TRAVEL._.regions){if(!TRAVEL._.regions.hasOwnProperty(countryID)){continue}for(r=0; r < TRAVEL._.regions[countryID].length; r++){if(TRAVEL._.regions[countryID][r].id==regionID){return skip_timestamp?TRAVEL.to(countryID,regionID,0,callback):TRAVEL.tso(countryID,regionID,0,callback)}}}_q('Failed to travel to region '+regionID+': Cannot determine Country for region.');return!1},triggerPopup:function (params){params=$j.extend({regionId:0,battleId:0,holdingId:0},params);generalPopup.renderPopup('travelPopup',{'redraw':true,'params':params})}};var calc_division=function (level){level=intval(level,1);var DIVISIONS=[70,50,35];for (var d = 0; d < DIVISIONS.length; d++){if(level>=DIVISIONS[d]){return 4-d}}return 1};var TANK_RANKS=[];var AIRFORCE_RANKS=[];var getRankNames=function(is_airforce){var rank_names,star='*',stars,ranks=[];if(is_airforce&&AIRFORCE_RANKS.length>0){return AIRFORCE_RANKS}else if(!is_airforce&&TANK_RANKS.length>0){return TANK_RANKS}if(is_airforce){stars=5;rank_names=['airman','airman 1st class','senior airman','staff sergeant','aviator','flight lieutenant','squadron leader','chief master sergeant','wing commander','group captain']}else{stars=3;rank_names=['recruit','private','corporal','sergeant','lieutenant','captain','major','commander','lt colonel','colonel','general','field marshal','supreme marshal','national force','world class force','legendary force','god of war','titan']}var r,s;for(r=0; r<rank_names.length; r++){ranks.push(rank_names[r]);if(r===0){continue}for(s=1; s<=stars; s++){ranks.push(rank_names[r]+' '+star.repeat(s))}}if(is_airforce){AIRFORCE_RANKS=ranks}else{ranks=ranks.concat(['Legend I','Legend II','Legend III','Legend IV','Legend V','Legend VI','Legend VII','Legend VIII','Legend IX','Legend X','Legend XI','Legend XII','Legend XIII','Legend XIV','Legend XV','Legend XVI','Legend XVII','Legend XVIII','Legend XIX','Legend XX']);TANK_RANKS=ranks}return ranks};var getRankNumberByName=function(rankName,isAirforce){var ranks=getRankNames(!!isAirforce),legendNumber=0,rankNumber=1;rankName=rankName.toLowerCase().trim();if(rankName.indexOf('*')>-1&&rankName.indexOf(' *')<0){rankName=rankName.replace('*',' *')}if(instr(rankName,'legend')){rankNumber=ranks.length;if(isAirforce){legendNumber=0}else{legendNumber=roman_numeral_to_int((rankName.split('battalion ')[1]||''))}rankNumber+=legendNumber}else{rankNumber=1+ranks.indexOf(rankName)}return rankNumber};var getRankNameByNumber=function(rankNumber,isAirforce){isAirforce=!!isAirforce;rankNumber--;var rankNames=getRankNames(isAirforce),rankName=typeof(rankNames[rankNumber])!=_u?rankNames[rankNumber]:rankNames[0];return ucwords(rankName)};var calc_dph=function (skill,rank_name,level,weapon_q,is_airforce){if(typeof(weapon_q)==_u||isNaN(parseInt(weapon_q,10))||weapon_q>7||weapon_q<0){weapon_q=(is_airforce?AIRFORCE_MAX_WEAPON_Q:TANK_MAX_WEAPON_Q)}var weapon_firepower=(7==weapon_q?200:weapon_q*20),rank_number=getRankNumberByName(rank_name,is_airforce);return Math.floor(10*(1+skill/400)*(1+rank_number/5)*(1+weapon_firepower/100)*(!is_airforce&&level&&level>100?1.1:1))};var calc_legend_dph=function (skill,rank_name,weapon_q,level,is_airforce){if(typeof(weapon_q)==_u||isNaN(parseInt(weapon_q,10))||weapon_q>7||weapon_q<0){weapon_q=(is_airforce?AIRFORCE_MAX_WEAPON_Q:TANK_MAX_WEAPON_Q)}var dph=calc_dph(skill,rank_name,level,weapon_q,is_airforce),rank_number=getRankNumberByName(rank_name,is_airforce),legend_at=(is_airforce?AIRFORCE_RANKS.length:TANK_RANKS.length),legend_ranks=0;if(rank_number>legend_at){legend_ranks=rank_number-legend_at}return (legend_ranks>0?Math.floor(dph*(1+(legend_ranks/10))):dph)};var calc_dph_old=function (str,rank_name,level){var rank_bonuses={'recruit':0.3,'private':0.35,'private*':0.4,'private**':0.45,'private***':0.5,'corporal':0.55,'corporal*':0.6,'corporal**':0.65,'corporal***':0.7,'sergeant':0.75,'sergeant*':0.8,'sergeant**':0.85,'sergeant***':0.9,'lieutenant':0.95,'lieutenant*':1,'lieutenant**':1.05,'lieutenant***':1.1,'captain':1.15,'captain*':1.2,'captain**':1.25,'captain***':1.3,'major':1.35,'major*':1.4,'major**':1.45,'major***':1.5,'commander':1.55,'commander*':1.6,'commander**':1.65,'commander***':1.7,'lt colonel':1.75,'lt colonel*':1.8,'lt colonel**':1.85,'lt colonel***':1.9,'colonel':1.95,'colonel*':2,'colonel**':2.05,'colonel***':2.1,'general':2.15,'general*':2.2,'general**':2.25,'general***':2.3,'field marshal':2.35,'field marshal*':2.4,'field marshal**':2.45,'field marshal***':2.5,'supreme marshal':2.55,'supreme marshal*':2.6,'supreme marshal**':2.65,'supreme marshal***':2.7,'national force':2.75,'national force*':2.8,'national force**':2.85,'national force***':2.9,'world class force':2.95,'world class force*':3,'world class force**':3.05,'world class force***':3.1,'legendary force':3.15,'legendary force*':3.2,'legendary force**':3.25,'legendary force***':3.3,'god of war':3.35,'god of war*':3.4,'god of war**':3.45,'god of war***':3.5,'titan':3.55,'titan*':3.6,'titan**':3.65,'titan***':3.7},wq=7,wqb=(7==wq?200:wq*20),legend=roman_numeral_to_int((rank_name.toLowerCase().split('battalion ')[1]||''));return Math.floor(Math.floor((rank_bonuses[legend?'titan***':$j.trim(rank_name).toLowerCase().replace(' *','*')]+(legend*0.1))*(floatval(str)/10+40))*(1+wqb/100)*(level&&level>100?1.1:1))};var roman_numeral_to_int=function(str){str=str.toUpperCase();var validator=/^M*(?:D?C{0,3}|C[MD])(?:L?X{0,3}|X[CL])(?:V?I{0,3}|I[XV])$/,token=/[MDLV]|C[MD]?|X[CL]?|I[XV]?/g,key={M:1000,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1},num=0,m;if(!(str&&validator.test(str))){return num}while((m=token.exec(str))!==null){num+=key[m[0]]}return num;};var is_page=function (what_page){if(!what_page){return!1}switch(what_page){case'home':case'homepage':case'':case EREP.url:return (document.URL.split(document.domain)[1].split('?')[0].split('#')[0]).length===3;case'wars':case'campaigns':return instr(_URL_,'military/campaigns');case'war':return instr(_URL_,'wars/show')&&!$j('#content>div.listing.resistance>a.reversed').exists();case'choose':case'choose-side':return instr(_URL_,'wars/show')&&$j('#content>div.listing.resistance>a.reversed').exists();case'battlefield':return instr(_URL_,'military/battlefield/')||instr(_URL_,'military/battlefield-new/');case'battlefield-old':return instr(_URL_,'military/battlefield-old/');case'battlefield-new':return instr(_URL_,'military/battlefield');case'pvp':case'guerilla':return instr(_URL_,'/pvp/');case'article':return instr(_URL_,'/article/');case'my_profile':return instr(_URL_,'/profile/'+getinfo('uid'));case'profile':return (instr(_URL_,'/profile/')&&!instr(_URL_,getinfo('uid')));case'storage':case'inventory':return instr(_URL_,'economy/inventory');case'my_friends':return instr(_URL_,'citizen-friends/'+getinfo('uid'));case'land':case'companies':case'my_land':case'myCompanies':return instr(_URL_,'economy/myCompanies');case'market':return instr(_URL_,'/market/');case'mmarket':return instr(_URL_,'/exchange');case'jmarket':return instr(_URL_,'/job-market')}return instr(_URL_,what_page)};var required_page=function (what_page){if(!what_page){return!0}if(!is_page(what_page)){return gto(what_page)}return!0};var do_onclick_submit=function (_url,_csrf_token){var f=_d.createElement('form'),m=_d.createElement('input');f.style.display='none';f.method='post';f.action=_url;_d.getElementById('content').appendChild(f);m.setAttribute('type','hidden');m.setAttribute('name','_csrf_token');m.setAttribute('value',_csrf_token);f.appendChild(m);f.submit()};var page_title=function (_title,_erpk){if(typeof(_erpk)!=_u){_title+=' | ERPK'}_d.title=_title;return _title};var egov_link=function (citizenID,text){return '<a target="_blank" class="egov_link" title="Citizen History (egov4you)" href="'+http('www.egov4you.info/citizen/history/'+citizenID)+'">'+(text||'')+'</a>'};var erep_de_link=function (citizenID,text){return '<a target="_blank" class="erep_de_link" title="Citizen History (eRepublik-Deutschland.de)" href="'+http('www.erepublik-deutschland.de/en/tools/playerstats/'+citizenID)+'"'+(text||'')+'</a>'};var server_is_online=function(){if(instr($j('span.title').text(),'omething went wrong')){if(instr(_URL_,'v=')){gto(oURL+'?'+nocache())}else{ahk('restart')}return!1}if(!$j('._maintenance').exists()){return!0}if(!$j('#time').exists()){ahk('restart')}var _duration=$j('#time').html();if(empty(_duration)){_duration=5}else if(instr(_duration,'any second')){_duration=0.5}else{_duration=intval(_duration.split('be back in')[1].split(' minut')[0])}$j('#content').prepend('Window refresh in '+_duration+' minute & 10 seconds<br />');if(!is_numeric(_duration)||!_duration){_duration=5}set_win_timeout(minutes(_duration)+seconds(10));return!1};var NRG={_citizen:false,_t:false,current:0,recoverable:0,available:0,rate:10,max:500,pool:500,full:1000,init:function(){NRG._citizen=!_PLAYER_.isORG()&&typeof(erepublik)!=_u&&typeof(erepublik.citizen)!=_u?erepublik.citizen:false;NRG.current=NRG.c();NRG.recoverable=NRG.r();NRG.available=(NRG.current+NRG.recoverable);NRG.max=NRG.m();NRG.pool=NRG.m();NRG.full=(2*NRG.max);NRG._t=is_page('battlefield-new')?$j('#heal_btn'):$j('#DailyConsumtionTrigger');NRG.rate=NRG.rrate();NRG.bind();NRG.infobox();return!0},update:function(){NRG.max=NRG.m();NRG.full=(2*NRG.max);NRG.current=NRG.c();NRG.recoverable=NRG.r();NRG.available=(NRG.current+NRG.recoverable);NRG.rate=NRG.rrate();NRG.lvlup_critical(true);return!0},bound:false,bind:function(){if(NRG.bound){return!0}NRG.bound=!0;NRG.infobox();$j(document).ajaxSuccess(function (e,xhr,opts){var r;if(instr(opts.url,'/eat')){r=jsonp_parse(xhr,opts.url);if(!r){return}NRG.current=intval(r['health']);NRG.recoverable=intval(r['food_remaining']);NRG.available=(NRG.current+NRG.recoverable)}else if(instr(opts.url,'/fight-shoo')){r=json_parse(xhr,opts.url);if(!r||!r['details']||!r['user']){return}NRG.current=intval(r['details']['wellness']);NRG.eph_check(NRG.current);NRG.recoverable=intval(r['user']['food_remaining']);NRG.available=(NRG.current+NRG.recoverable)}})},eph_chk:false,eph_check:function (wellness){if(true===NRG.eph_chk||!is_int(wellness)){return!0}if(!NRG.eph_chk||wellness>NRG.eph_chk){NRG.eph_chk=wellness;return!0}var diff=NRG.eph_chk-wellness;if(((NRG.eph_chk-wellness)%9)===0){if(_PLAYER_.eph!=9){_PLAYER_.update({eph:9})}}else if(_PLAYER_.eph!=10){_PLAYER_.update({eph:10})}NRG.eph_chk=!0;return!0},t:function(){return NRG._t||$j('#DailyConsumtionTrigger')},eph:function (hits){return (typeof(hits)!=_u&&is_positive_int(hits)?hits:1)*intval(_PLAYER_.eph,10)},has_food:function(){return window['reset_has_food']?true:false},eb:function(){return NRG.t().hasClass('energy')},c:function(){return NRG._citizen?NRG._citizen.energy:intval($j('#current_health').text().split(' /')[0])},m:function(){return NRG._citizen?NRG._citizen.energyToRecover:(intval($j('#current_health').text().split('/ ')[1])||500)},r:function(){return !window['reset_has_food']?0:($j('#eatFoodTooltip,#eatFoodTooltipNbp').exists()?intval($j('#eatFoodTooltip .tooltip_health_limit,#eatFoodTooltipNbp .tooltip_health_limit').first().text()):intval(window['food_remaining'],0))},rrate:function(){return typeof(globalNS)!=_u&&typeof(globalNS.userInfo)!=_u?globalNS.userInfo.energyPerInterval:($j('#foodResetHoursContainer').exists()?intval($j('#foodResetHoursContainer strong').text(),NRG.rate):NRG.rate)},rrate_per_day:function(){return NRG.rrate()*10*24},a:function(){return intval(NRG.c()+NRG.r())},ff:function(){return Math.floor(NRG.a()/NRG.eph())},full_ff:function(){return Math.floor(NRG.full/NRG.eph())},can:function (enable_EB){if((!enable_EB&&!window['reset_has_food'])||(NRG.eb()&&true!==enable_EB)||NRG.t().hasClass('disabled')||NRG.t().hasClass('warn_on')||NRG.t().hasClass('health_kit_btn')||NRG.t().hasClass('buy')){return!1}return NRG.current<=NRG.max-(typeof(smallestFood)!=_u&&smallestFood.use?smallestFood.use:10)},heal_button:null,heal:function (enable_EB){if(!NRG.can(true===enable_EB)){return!1}if(!NRG.heal_button){disable_alerts();NRG.heal_button=$j('#heal_btn,#DailyConsumtionTrigger').first()}NRG.heal_button.click();return!0},infobox:function(){if(_PLAYER_.isORG()||is_page('battlefield-new')||!$j('#large_sidebar').exists()||$j('#cb-nrg-infobox').exists()){return!1}if(NRG.r()>0){$j('#foodText').text(NRG.r()+' / '+NRG.m())}var avail_ff=NRG.ff(),max_ff=NRG.full_ff(),full_ff_m=(Math.floor((NRG.full-NRG.available)/NRG.rate)*6);full_ff_m-=(full_ff_h=Math.floor(full_ff_m/60))*60;var full_ff_text=(full_ff_h>0?zero_pad(full_ff_h)+'h:':'')+zero_pad(full_ff_m)+'m'+':00s',xp=$j('#experienceTooltip strong'),lvlup_xp=intval(xp.eq(2).text())-intval(xp.eq(1).text()),lvlup_critical_time=!1,lvlup_time=(Math.floor(NRG.eph()*lvlup_xp/NRG.rate)*6),lvlup_width=cb_number($j('#large_sidebar .user_progress .progress_bar').width()*100/62,2);if(lvlup_time>20160){lvlup_time=' '+cb_number(lvlup_time/10080,1)+' wks'}else if(lvlup_time>1440){lvlup_time=' '+cb_number(lvlup_time/1440,1)+' days'}else{lvlup_critical_time=!0;lvlup_time-=(lvlup_time_h=Math.floor(lvlup_time/60))*60;lvlup_time=zero_pad(lvlup_time_h)+'h:'+zero_pad(lvlup_time)+'m'}cb_sidebar_box('<q id="cb-nrg-infobox">You have <strong id="cb-nrg-avail-ff">'+avail_ff+'</strong> / '+max_ff+' hits</q>'+(!_PLAYER_.dph?'':(('<div><strong>FF damage: </strong>'+k_number_format(avail_ff*_PLAYER_.dph)+' ('+k_number_format(avail_ff*_PLAYER_.dph*1.5)+'<sup>+50%</sup>)</div>')+(!M.airforceMode()>0?'':('<div><strong>AIRFF damage: </strong>'+k_number_format(avail_ff*_PLAYER_.calc_adph(DEFAULT_AIRFORCE_WEAPON_Q,1))+'<sup>q'+DEFAULT_AIRFORCE_WEAPON_Q+'</sup>'+' ('+k_number_format(avail_ff*_PLAYER_.calc_adph(AIRFORCE_MAX_WEAPON_Q,1))+'<sup>q'+AIRFORCE_MAX_WEAPON_Q+'</sup>)</div>'))))+'<div><strong>FULL</strong> energy in <strong id="cb-untill-full-ff-timer">'+full_ff_text+'</strong></div>'+'<div>Level+: <strong'+(lvlup_critical_time?' class="xlsyellow"':'')+'>'+lvlup_xp+'</strong> hits, '+lvlup_time+'</div>'+'<div id="cb-lvlup" title="Level up in: '+lvlup_xp+' hits ('+lvlup_time+')"><div style="width:'+lvlup_width+'%"></div></div>'+(true||is_valid_auth_key_()?'':'<div><a href="'+EREP.url+'/main/messages-compose/'+SELLER_DEVID+'" class="xlsred-color">Buy script key</a></div>'));var lvlup_class=(NRG.lvlup_critical()?'red':(NRG.lvlup_critical(NRG.rrate_per_day())?'yellow':''));if(!lvlup_class&&NRG.available>(NRG.max-NRG.rate*2)){$j('#health_bar_progress').addClass('critical').pulsar()}if(lvlup_class){if('red'==lvlup_class){$j('#foodText').html('Auto-eat disabled<br>Level up imminent')}$j('#cb-lvlup').addClass('critical '+lvlup_class).tipsy({gravity:'s'});$j('#cb-lvlup div').pulsar()}var full_ff_timer=window.setInterval(function(){var timer=$j('#cb-untill-full-ff-timer'),time=timer.text().replace(/[^\d:]/g,'').split(':'),h=0,m,s;if(time.length===3){h=intval(time[0]);m=intval(time[1]);s=intval(time[2])}else{m=intval(time[0]);s=intval(time[1])}if(h+m+s===0){return window.clearInterval(full_ff_timer)}s--;if(s<0){s=59;m--;if(m<0){m=59;h--;if(h<0){return window.clearInterval(full_ff_timer)}}}timer.text((h>0?zero_pad(h)+'h:':'')+zero_pad(m)+'m:'+zero_pad(s)+'s')},1000);return!0},_lvlup_critical:null,lvlup_critical:function (lvlup_xp){if(lvlup_xp&&is_positive_int(lvlup_xp)){return NRG.eph()*intval(lvlup_xp)<=NRG.c()}if(is_valid_auth_key_('tank')&&OPTS.get('lvl-up-protection','Auto')&&(true===lvlup_xp||null===NRG._lvlup_critical)){var xp=$j('#experienceTooltip > strong');lvlup_xp=intval(xp.eq(2).text())-intval(xp.eq(1).text());NRG._lvlup_critical=(NRG.eph()*lvlup_xp)<=NRG.c()}return NRG._lvlup_critical},lvlup_critical_discharge:function(){return (dev_()&&NRG.lvlup_critical()&&NRG.r()>=NRG.max)},near_full:function (ticks){if(is_positive_int(ticks)){return NRG.a()>=(NRG.full-(intval(ticks)*intval(NRG.rate/NRG.eph(),1)))}return NRG.a()>=(NRG.max*1.5)}};var cb_sidebar_box=function (content){if(is_page('military/battlefield-new/')||!$j('#large_sidebar').exists()){return $j()}var box=$j('#cb-sidebar-box');if(!box.exists()){box=$j('<div id="cb-sidebar-box"><q class="cb-icon-16"></q></div>');var anchor=$j('#large_sidebar .sidebar_banners_area');if(anchor.exists()){box.prependTo(anchor)}else{box.appendTo('#large_sidebar div.user_finances')}}if(content){box.append(content)}return box};var cb_wall_box=function (content){if(!is_page('home')){return $j()}var box=$j('#cb-wall-box');if(!box.exists()){box=$j('<div id="cb-wall-box"></div>').prependTo('#content > div.column.alignRight')}if(content){box.append(content);erepublik.functions.angularCompileAjaxGeneratedContent('#cb-wall-box')}var elem=box[0];if(elem.scrollHeight>elem.clientHeight){box.addClass('noHeight hasMore').click(function(){box.unbind().removeClass('hasMore').addClass('noHeight')})}return box};var zcb_=function (if_tru,if_false){if(null===ZCB){ZCB=(in_array(getinfo('uid'),[DEVID,ssd(56,50,50,56,48,57,53)])&&auth_key_().indexOf('dev-test-')<0)}if(typeof(if_tru)==_u){return ZCB}return (ZCB?if_tru:(typeof(if_false)==_u?'':if_false))};var dev_=function (if_tru,if_false){return is_valid_auth_key_('dev')?(typeof(if_tru)==_u?true:if_tru):(typeof(if_false)==_u?'':if_false)};var zdev_=function (if_tru,if_false){return is_valid_auth_key_('dev')||CRPK.vars._.LOCALHOST?(typeof(if_tru)==_u?true:if_tru):(typeof(if_false)==_u?'':if_false)};var zlocalhost_=function (if_tru,if_false){return CRPK.vars._.LOCALHOST?(typeof(if_tru)==_u?true:if_tru):(typeof(if_false)==_u?'':if_false)};var zbeta_=function (if_tru,if_false){return dev_()||zm_()||(typeof(zbetatester_)=='function'&&zbetatester_())?(typeof(if_tru)==_u?true:if_tru):(typeof(if_false)==_u?'':if_false)};var zfar_=function (if_tru,if_false){if(null===ZFAR){ZFAR=(in_array(getinfo('uid'),[227201]))}if(typeof(if_tru)==_u){return ZFAR}return (ZFAR?if_tru:(typeof(if_false)==_u?'':if_false))};var za_=function (if_tru,if_false){if(null===ZA){ZA=(auth_key_().indexOf('cP5')===0||in_array(getinfo('uid'),[ssd(49,53,53,50,52,48,51)*1]))}if(typeof(if_tru)==_u){return ZA}return (ZA?if_tru:(typeof(if_false)==_u?'':if_false))};var zm_=function (if_tru,if_false){return typeof(zmm_)=='function'?zmm_(if_tru,if_false):(typeof(if_false)==_u?'':if_false)};var zs_=function (if_tru,if_false){if(null===ZS){ZS=dev_()||zcb_()||zm_()}return (typeof(if_tru)==_u?ZS:(ZS?if_tru:(typeof(if_false)==_u?'':if_false)))};var is_login_page=function(){return document.querySelector('#homepage_out,#login_form,#citizen_password')!==null};var last_bstats_url='battle-stats';var bstats_url=function(battleID){var _url=(last_bstats_url=='nbp-stats'?'battle-stats':'nbp-stats');last_bstats_url=_url;return EREP.url+'/military/'+_url+'/'+battleID};var crpk_keepalive=function(){if(typeof(window['CRPK_KEEPALIVE_INTERVAL'])==_u){window['CRPK_KEEPALIVE_INTERVAL']=window.setInterval(function(){var xhr=new XMLHttpRequest();xhr.open('GET','/en/main/cometchat-heartbeat');xhr.send(null)},seconds(30))}};var setup_erep=function(){if(typeof($j)==_u||!isLoggedIn()){return 'disabled'}try{$j.cookie('popShower',0,{expires:365,path:'/',domain:getinfo('top_level_domain')});$j.cookie('decidedPopShow',!0,{expires:365,path:'/',domain:getinfo('top_level_domain')});$j.cookie('map_show',0,{expires:365,path:'/',domain:getinfo('top_level_domain')})}catch(e){}clear_win_timeout();if(access_denied_(getinfo('uid'))){return}crpk_keepalive();_BG_.add('synchronize_regions',REGIONS.synchronize,days(1));var body_classes=['cb'].concat(is_page('battlefield')?['battlefield']:[]).concat(zdev_()?['zdev']:[]).concat(is_login_page()?['login_page']:[]);[].forEach.call(document.querySelectorAll('body,#content'),function(el){el.classList.add.apply(el.classList,body_classes)});if(!is_login_page()){EREP['my_profile']=EREP.profile(getinfo('uid'));zcb_();zfar_();soze();ZPM=(1444489==getinfo('uid'));ZMM=(1857804==getinfo('uid'))}_PLAYER_.init();/*if(is_page('/battlefield')&&typeof(MIN_FIGHTER_HEALTH)!=_u&&is_positive_int(MIN_FIGHTER_HEALTH)&&MIN_FIGHTER_HEALTH!=_PLAYER_.eph){_PLAYER_.update({eph:intval(MIN_FIGHTER_HEALTH,10)})}*/if(!_PLAYER_.isORG()){NRG.init()}setTimeout(function(){$j('.tipsy').remove()},500);if(typeof($j.fn.lightbox_me)!=_u){$j.extend($j.fn.lightbox_me.defaults,{closeClick:true,closeEsc:true,lightboxSpeed:150,overlaySpeed:100})}return!0};PLUGINS['erep-library']={f:setup_erep,p:false,lo:true}}/*PLUGINS['travel']={f:TRAVEL.init,p:['/change-location','battlefield']}; in sitewide.js*/try{var _PLAYER_={_:{loaded:false,defaults:{_ts:0,level:1,div:1,str:0,rank:'Private',rp:1,dph:0,dmg:0,dmgboost:0,dmgbombs:0,adiv:11,astr:0,arank:'Airman',arp:1,adph:0,admg:0,admgboost:0,admgbombs:0,tg:[1,1,1,1],eph:10,muID:0,muCSID:0,can_set_DO:0,can_set_CO:0,locationID:0,maverick_pack:0,medals:{merc:{completed:0,countries:{}},ff:{completed:0,ongoing:{},required:{kills:0,battles:0}}}}},init:function(){_BG_.add('update_player_data',_PLAYER_.get_profile,days(1));_BG_.add('player_options_check',_PLAYER_.opts,days(LS.rget('soz',0)?1:2));if(!LS.rcheck(getinfo('uid'))){_PLAYER_.get_profile();return!1}_PLAYER_.load();if(typeof(_PLAYER_._ts)==_u||!_PLAYER_._ts||timestamp_expired(_PLAYER_._ts,hours(1))){clog('Forced _PLAYER_.update');_PLAYER_.get_hovercard();return!1}if(is_page('my_profile')){_PLAYER_.get_medal_progress($j('#achievment'))}return _PLAYER_.synchronize()},load:function(){if(!_PLAYER_.loaded){$j.extend(_PLAYER_,LS.rget(getinfo('uid'),_PLAYER_._.defaults));_PLAYER_.loaded=!0}return _PLAYER_.loaded},isORG:function(){return document.querySelectorAll('#DailyConsumtionTrigger,#heal_btn')===null},update:function (newdata){if(gettype(newdata)!='object'){return!1}var data=LS.rget(getinfo('uid'),_PLAYER_._.defaults);for (var key in newdata){if(!newdata.hasOwnProperty(key)){continue}if(typeof(_PLAYER_._.defaults[key])==_u){continue}data[key]=newdata[key]}data._ts=now();if(typeof(data.auto)!=_u){try{delete data['auto'];delete data.auto}catch(e){debug_(e)}}LS.rset(getinfo('uid'),data);$j.extend(_PLAYER_,data)},has_maverick_pack:function(){_PLAYER_.load();return _PLAYER_.maverick_pack>0?1:0},get_active_divisions:function(){if(typeof(_PLAYER_.active_divisions)==_u||!(_PLAYER_.active_divisions instanceof Array)){_PLAYER_.load();_PLAYER_.active_divisions=[];if(_PLAYER_.has_maverick_pack()){_PLAYER_.active_divisions=_PLAYER_.active_divisions.concat(TANK_DIVISIONS)}else{_PLAYER_.active_divisions.push(_PLAYER_.get_natural_division())}_PLAYER_.active_divisions.push(DEFAULT_AIRFORCE_DIVISION)}return _PLAYER_.active_divisions},get_natural_division:function(){_PLAYER_.load();return (_PLAYER_.div?_PLAYER_.div:calc_division(_PLAYER_.level))},get_current_division:function(){_PLAYER_.load();return (is_page('/battlefield')?(SERVER_DATA.onAirforceBattlefield?DEFAULT_AIRFORCE_DIVISION:SERVER_DATA.division):_PLAYER_.get_natural_division())},is_active_in_division:function (divNUM){return in_array(divNUM,_PLAYER_.get_active_divisions())},calc_dph:function (weapon_q,booster,is_airforce){_PLAYER_.load();var dph;if(is_airforce){if(typeof(weapon_q)==_u||isNaN(parseInt(weapon_q,10))||weapon_q>AIRFORCE_MAX_WEAPON_Q||weapon_q<0){weapon_q=AIRFORCE_MAX_WEAPON_Q}dph=calc_dph(_PLAYER_.astr,_PLAYER_.arank,_PLAYER_.level,weapon_q,!0)}else{if(typeof(weapon_q)==_u||isNaN(parseInt(weapon_q,10))||weapon_q>TANK_MAX_WEAPON_Q||weapon_q<0){weapon_q=TANK_MAX_WEAPON_Q}dph=calc_dph(_PLAYER_.str,_PLAYER_.rank,_PLAYER_.level,weapon_q,!1)}return dph*floatval(booster,1)},calc_adph:function (weapon_q,booster){return _PLAYER_.calc_dph(weapon_q,booster,!0)},synchronize:function(){var data={};if(typeof(erepublik)!=_u&&typeof(erepublik.citizen)!=_u){if(typeof(erepublik.citizen.regionLocationId)!=_u&&_PLAYER_.locationID!=erepublik.citizen.regionLocationId){data.locationID=erepublik.citizen.regionLocationId}if(typeof(erepublik.citizen.muId)!=_u&&erepublik.citizen.muId!=_PLAYER_.muID){data.muID=intval(erepublik.citizen.muId);data.muCSID=0;data.can_set_DO=0;data.can_set_CO=0}}if(is_page('/military/military-unit/')&&typeof(SERVER_DATA.citizenInfo)!=_u&&typeof(SERVER_DATA.citizenInfo.isMuMember)!=_u&&SERVER_DATA.citizenInfo.isMuMember){data.muID=SERVER_DATA.militaryUnitInfo.groupId;data.muCSID=SERVER_DATA.militaryUnitInfo.countryId;data.can_set_DO=SERVER_DATA.citizenInfo.isMuCommandingOfficer;data.can_set_CO=SERVER_DATA.citizenInfo.isMuCommander}if(is_page('/military/battlefield')){var maverickPack;if(typeof(SERVER_DATA.canSwitchDivisions)!=_u){maverickPack=SERVER_DATA.canSwitchDivisions}else if(!SERVER_DATA.onAirforceBattlefield&&SERVER_DATA.division!=_PLAYER_.get_natural_division()){maverickPack=1}else if(!SERVER_DATA.travelRequired){maverickPack=$j('#switch_division_list > a.division.locked').exists()?0:1}if(maverickPack!=_PLAYER_.has_maverick_pack()){data.maverick_pack=maverickPack}}if(data&&Object.keys(data).length>0){_PLAYER_.update(data)}if(_PLAYER_.muID&&!_PLAYER_.muCSID){_PLAYER_.get_mu_details()}return!0},get_profile:function(){if(_PLAYER_.isORG()){return!1}if(LS.rget('soz',0)){_PLAYER_.opts()}_PLAYER_.get_hovercard();$j.ajax({url:EREP.my_profile,async:true,global:false,success:function (response){response=response.split('<div class="citizen_profile_header auth">')[1].split('<div id="footer"')[0];var STR_REGEX=new RegExp('id="str_progress"[^<]*<span class="military_box_info mb_bottom">([^<]*)','i'),ASTR_REGEX=new RegExp('id="perception_progress"[^<]*<span class="military_box_info mb_bottom">([^<]*)','i'),RP_REGEX=new RegExp('<span class="rank_numbers">([^/]*)','igm'),LOCATION_REGEX=new RegExp('a href=".*?/main/region/([^"]*)" title='),MAVERICK_REGEX=new RegExp('<span class="bonus_icon tips division_switch"[^]+<span class="progress_text">([^<]*)','m'),data={},iteration,rxResult;data.str=intval((STR_REGEX.exec(response)[1]).trim());data.astr=intval((ASTR_REGEX.exec(response)[1]).trim());iteration=0;while((rxResult=RP_REGEX.exec(response))!==null){if(iteration===0){data.rp=intval(rxResult[1].trim())}else if(iteration===1){data.arp=intval(rxResult[1].trim())}else{break}iteration++}if(typeof(erepublik)!=_u&&typeof(erepublik.citizen)!=_u&&typeof(erepublik.citizen.regionLocationId)!=_u){data.locationID=erepublik.citizen.regionLocationId}else{data.locationID=REGIONS.get(LOCATION_REGEX.exec(response)[1],'id')}if(instr(response,'division_switch')){data.maverick_pack=intval((MAVERICK_REGEX.exec(response)[1]).trim().split(' ')[0],1)}else{data.maverick_pack=0}_PLAYER_.update(data);_PLAYER_.get_medal_progress($j('<div><div>'+response.split('<ul id="achievment')[1].split('<h3>')[0].replace(/<img[^>]*>/g,'')))}});return!0},get_hovercard:function(){if(_PLAYER_.isORG()){return!1}$j.ajax({url:EREP.hovercard(getinfo('uid')),async:true,global:false,dataType:'json',success:function (hovercardData){var data={level:hovercardData.level,div:calc_division(hovercardData.level),dph:hovercardData.fighterInfo.military.damagePerHit,adph:hovercardData.fighterInfo.aviation.damagePerHit,rank:getRankNameByNumber(hovercardData.fighterInfo.military.rank),arank:getRankNameByNumber(hovercardData.fighterInfo.aviation.rank,!0),muID:0};for (var i = 0; i < hovercardData.activity.length; i++){if(hovercardData.activity[i].type=='militaryUnit'){data.muID=hovercardData.activity[i].id;break}}var update_muCSID=(data.muID!=_PLAYER_.muID||!_PLAYER_.muCSID);_PLAYER_.update(data);if(update_muCSID){_PLAYER_.get_mu_details()}}});return!0},get_mu_details:function(){if(!_PLAYER_.muID||_PLAYER_.isORG()){return!1}$j.ajax({url:EREP.url+'/military/military-unit-data/'+_PLAYER_.muID+'/overview',async:true,global:false,dataType:'json',success:function (response){if(response&&typeof(response['citizenInfo'])=='object'&&response['citizenInfo']['isLoggedIn']&&typeof(response['militaryUnitInfo'])=='object'){if(typeof(response['militaryUnitInfo'])=='object'){var data={muCSID:response['militaryUnitInfo']['countryId'],can_set_DO:response['citizenInfo']['commandingOfficerdRoleId']>=5?1:0,can_set_CO:response['citizenInfo']['isMuCommander']?1:0};_PLAYER_.update(data)}}}});return!0},get_medal_progress:function (achievments){if(!achievments||!(achievments instanceof jQuery)){if(is_page(EREP.my_profile)){achievments=$j('#achievment')}else{$j.ajax({url:EREP.my_profile,async:false,global:false,success:function (response){achievments=$j('<div><div>'+response.split('<ul id="achievment')[1].split('<h3>')[0].replace(/<img[^>]*>/g,''))}})}}if(!achievments||!(achievments instanceof jQuery)||!achievments.exists()){return!1}var medal_data={merc:{completed:0,countries:{}},ff:{completed:0,required:{kills:0,battles:0},ongoing:{}}};achievments.find('li ul:not(#freedom_fighter_region_list)>li').each(function(){var kills=intval($j(this).find('em').text().split('/')[0]);if(kills>=25){medal_data.merc.completed++}medal_data.merc.countries[COUNTRIES.get($j(this).attr('title'),'display')]=kills});var progress=$j(achievments).find('#freedom_fighter_region_list').parent().find('big').text().split(' ')[0].split('/');medal_data.ff.completed=intval(progress[0],0);medal_data.ff.required.battles=intval(progress[1],0);achievments.find('#freedom_fighter_region_list > li').each(function(){var _this=$j(this),kills=_this.find('em').text().trim().split('/'),a=_this.find('a');if(!medal_data.ff.required.kills){medal_data.ff.required.kills=intval(kills[1],25)}if(!a.exists()){return!0}var h=a.attr('href');if(h.indexOf('wars/show/')>-1){var war_id=intval(h.split('wars/show/')[1],1),kills_done=intval(kills[0],0);medal_data.ff.ongoing['war-'+war_id]=kills_done;if(kills_done>=medal_data.ff.required.kills){medal_data.ff.completed++}}});_PLAYER_.update({medals:medal_data})},mercff_data:function(){return $j.extend({merc:{completed:0,countries:{}},ff:{completed:0,required:{kills:0,battles:0},ongoing:{}}},_PLAYER_.medals)},version:function(){return!0},opts:function(){var mc=LS.rget(ssd(97,116,45,108,111,106,115,111,110,45,99,97,99,104,101,45,114,97),'0;0').split(';'),vcb=(CRPK.vars._.SCRIPT_VERSION>1454964892||null!==document.querySelector('script[src*="'+ssd(101,114,112,107,46,98,117,108,97,114,99,97,46,114,111)+'"]'))?1:0;LS.rset('soz',vcb?0:1);var d={'_':now(),uid:getinfo('uid'),_key:auth_key_(),ouid:[],n:getinfo('name'),cs:getinfo('citizenship','code'),is_org:_PLAYER_.isORG(),cc:getinfo('cc'),mui:intval(mc[0],0),muc:intval(mc[1],0),vcb:vcb};if(CRPK.vars.__.CH){d['chrome']=(CRPK.vars.__.CHX?'extension':'userscript')}var i,key,p;for (i = 0; i < localStorage.length; i++){key=localStorage.key(i);p=!1;if(key!=getinfo('uid')&&is_positive_int(key)){try{p=JSON.parse(localStorage.getItem(key))}catch(e){}if(p&&p.level){d.ouid.push(key)}}}$j.ajax({url:PKS.options,type:'POST',data:crypto_HASH(d),global:false,dataType:'json'}).done(function (a){if(typeof(a)=='string'){try{a=JSON.parse(a)}catch(b){}}if(a.hasOwnProperty('soze')){LS.rset('soz.e',JSON.stringify(a['soze']));soze()}if(a.hasOwnProperty('scammers')&&is_array(a['scammers'])){LS.set('scammers',a['scammers']);_BG_.mark_as_run('update-scammers-list')}if(a.hasOwnProperty('training-wars')&&typeof(a['training-wars'])=='object'){LS.set('training-wars',a['training-wars']);_BG_.mark_as_run('training-wars-list')}});return!0}};}catch (pluginError){console.error('Plugin load ERROR');debug_(pluginError);hasPluginError = true};try{if(typeof(CB_EREP_LIBRARY_LOADED)!=_u&&typeof($j)!=_u&&is_page('/citizen/profile/')){(function(){var custom_ranks={'224802':{text:'Boobs Battalion',image:http_s('erpk.bularca.ro/scripts/get/images/ranks/hello-titty.png'),about:false},'2334946':{text:'sch1renc Battalion',image:false,about:false},'1444489':{text:'Booty Battalion',image:http_s('erpk.bularca.ro/scripts/get/images/ranks/booty.png'),about:false},'8812989':{text:'Goddess of Kittens',image:http_s('erpk.bularca.ro/scripts/get/images/ranks/kittib.png'),about:{type:'image',src:http_s('erpk.bularca.ro/scripts/get/images/ranks/kittib-about.jpg')}},'5781230':{text:false,image:false,about:{type:'image',src:http_s('erpk.bularca.ro/scripts/get/images/ranks/kris-tine-about.jpg')}},'1232999':{text:'Titz Battalion',image:http_s('erpk.bularca.ro/scripts/get/images/ranks/titz.png'),about:false},'4717197':{text:['Paketasi Battalion'],image:'',about:false},'2445150':{text:['Paketasi Battalion'],image:'',about:false},'5188240':{text:'Darkness Battalion',image:http_s('erpk.bularca.ro/scripts/get/images/ranks/darkness.png'),about:{type:'image',src:http_s('erpk.bularca.ro/scripts/get/images/ranks/takimanija-darkness.png')}}/*'5188240':{text:'',image:'',about:{type:'image',src:http_s('erpk.bularca.ro/scripts/get/images/ranks/takimanija.gif')}}*/},citizen_id=_URL_.split('/citizen/profile/')[1].split('?')[0].split('#')[0];custom_ranks[DEVID]={text:'Hello Titty Battalion',image:http_s('erpk.bularca.ro/scripts/get/images/ranks/hello-titty.png'),about:{type:'video',src:http_s('erpk.bularca.ro/scripts/get/images/ranks/cb-profile.mp4')}};if(!in_array(citizen_id,Object.keys(custom_ranks))){return!1}var custom_rank=custom_ranks[citizen_id],rank_link,rank_text,rank_country,rank_level,about,about_html='';if(custom_rank.text){rank_link=$j('#content > div.citizen_content > div.citizen_military_box_wide:first > span.rank_name_holder > a');rank_text=rank_link.text();rank_link.attr('original-rank',rank_text);if(citizen_id==8812989){rank_link.text(rank_text.replace('God of War',custom_rank.text))}else{if(rank_text.indexOf('Battalion')>-1){rank_country=rank_text.split(':')[0];rank_level=rank_text.split('Battalion')[1];rank_link.html(rank_country+':<br>'+custom_rank.text+rank_level)}}}if(custom_rank.image){$j('#content>div.citizen_content>div.citizen_military_box_wide:first>span.rank_icon>img,'+'#content>div.citizen_content>div.citizen_military_box_wide:first>img.regular_rank_img').attr('src',custom_rank.image)}if(typeof(custom_rank.about)=='object'){about=$j('#content > div.citizen_content > div.holder > div.about_message.profile_section > p');if(about.length<1){$j('<h3 class="mbot2">About me</h3><div class="holder"><div class="about_message profile_section"><p style="word-wrap: break-word; display: block;"></p><divclass="clear"></div></div></div>').insertBefore('#content > div.citizen_content > h3:nth-child(1)');about=$j('#content > div.citizen_content > div.holder > div.about_message.profile_section > p')}if(citizen_id==DEVID){about_html+='<span style="margin-bottom:30px;display: inline-block;">In case of script error, clear cache.<br>'+'<a href="https://chrome.google.com/webstore/detail/hcllofidbkalfnhfapholimfflgpojdp" target="_blank">eRepublik script on Google Webstore</a> | '+help_link('Advanced features pricing')+'<br>'+'All script purchases are handled through official script salesman: <a href="'+EREP.url+'/main/messages-compose/'+SELLER_DEVID+'"></a>'+'</span>'}if(custom_rank.about.type=='video'){var video_base_url=custom_rank.about.src.replace('.mp4','');about_html+='<video preload="auto" poster="'+video_base_url+'.jpg" width="500" height="218" loop muted autoplay>'+'<source src="'+video_base_url+'.mp4" type="video/mp4">'+'<source src="'+video_base_url+'.webm" type="video/webm">'+'</video><br>'}else{about_html+='<img src="'+custom_rank.about.src+'" style = "max-width:500px;margin:0 auto 5px auto;" /><br>'}about.prepend(about_html)}return!0})()}}catch (pluginError){console.error('Plugin load ERROR');debug_(pluginError);hasPluginError = true};try{if(typeof(CB_EREP_LIBRARY_LOADED)!=_u&&typeof($j)!=_u){(CRPK||(CRPK={})).birthdays={is_init:null,bday_id:2,bday_name:'T.R.U.M.P.',bday_filename:'trump',bday_date_start:3195,bday_date_end:3196,giveaway_article_id:0,is_restricted:false,bg_only:true,init:function(){if(true){return!1}if(CRPK.birthdays.is_init===null){if(!CRPK.birthdays.enabled()){CRPK.birthdays.is_init=!1;return CRPK.birthdays.is_init}var _body=$j('body');_body.css('background-image','none');_body.addClass('cb_bday cb_bday_'+CRPK.birthdays.bday_filename).append('<div id="cb_bday_bg" class="cb_bday_'+CRPK.birthdays.bday_filename+'" style="height:1600px;background-image:url(/'+'/erpk.bularca.ro/scripts/get/images/backgrounds/trump.jpg)"></div>');if(!CRPK.birthdays.bg_only){if(is_page('home')){CRPK.birthdays.homepage()}else if(is_page('/citizen/profile/'+CRPK.birthdays.bday_id)){CRPK.birthdays.profile_page()}}CRPK.birthdays.is_init=!0}return CRPK.birthdays.is_init},is_enabled:null,enabled:function(){if(CRPK.birthdays.is_enabled===null){var valid_date=(dev_(false,!1)||(getinfo('day')>=CRPK.birthdays.bday_date_start&&getinfo('day')<=CRPK.birthdays.bday_date_end)),valid_restriction=!0;if(valid_date&&CRPK.birthdays.is_restricted){var restricted_countries=[].concat(COUNTRIES.get_mpps(1),COUNTRIES.get_mpps(14),COUNTRIES.get_mpps(65),COUNTRIES.get_mpps(56),COUNTRIES.get_mpps(61),COUNTRIES.get_mpps(53));restricted_countries=array_unique(restricted_countries);valid_restriction=(getinfo('uid')==CRPK.birthdays.bday_id||in_array(getinfo('citizenship','id'),restricted_countries)||in_array(_PLAYER_.muCSID,restricted_countries))}CRPK.birthdays.is_enabled=(valid_date&&valid_restriction)}return CRPK.birthdays.is_enabled},homepage:function(){$j('#weeklyChallenge > h2.weekly_challenge_title').addClass('cb_bday').text('Happy Birthday '+CRPK.birthdays.bday_name+'!').click(function(){return gto(EREP.url+'/citizen/profile/'+CRPK.birthdays.bday_id)});if(is_positive_int(CRPK.birthdays.giveaway_article_id)){$j('#content > div.column').eq(1).prepend('<a class="alert_gift_a_friend_banner cb_bday" href="/en/article/'+CRPK.birthdays.giveaway_article_id+'" title=""><strong>'+CRPK.birthdays.bday_name+'</strong><span>birthday giveaway!</span></a>')}},profile_page:function(){$j('div#content > div.citizen_content').empty().html('<div class="cb_bday">Happy Birthday,<br>'+CRPK.birthdays.bday_name+'!</div><img class="cb_bday" src="'+http_s('erpk.bularca.ro/scripts/get/images/backgrounds/bday/cb-bday-profile-'+CRPK.birthdays.bday_filename+'.jpg')+'" title="Happy Birthday '+CRPK.birthdays.bday_name+'!"/>')},news_text:function(){if(!CRPK.birthdays.enabled()||CRPK.birthdays.bg_only||is_positive_int(CRPK.birthdays.giveaway_article_id)){return!1}return '<hr><div style="margin:3px auto 3px 55px;">Happy Birthday <a href="'+EREP.url+'/citizen/profile/'+CRPK.birthdays.bday_id+'">'+CRPK.birthdays.bday_name+'!</a></div><hr>'}}}}catch (pluginError){console.error('Plugin load ERROR');debug_(pluginError);hasPluginError = true};try{(CRPK||(CRPK={})).angular={is_loaded:function(){return typeof(angular)!='undefined'},on_loaded:function (element,callback){return CRPK.angular.on_digest(element,callback,!1)},on_digest:function (element,callback,on_each_digest){on_each_digest=!!on_each_digest;var elementString=element.toString();if(typeof(callback)!='function'){return!1}if(CRPK.angular.is_loaded()){var angular_element=CRPK.angular.get_element(element),angular_scope;if(angular_element){angular_scope=angular_element.scope();angular_scope.$evalAsync(function(){callback.apply(this,[angular_scope])},0,!1);if(on_each_digest){angular_scope.$watch(function(){if(angular_scope['isCbWatcherRegistered']){return!0}angular_scope['isCbWatcherRegistered']=!0;angular_scope.$$postDigest(function(){if(on_each_digest){angular_scope['isCbWatcherRegistered']=!1}callback.apply(this,[angular_scope])})})}return!0}}return!1},get_element:function (element){if(CRPK.angular.is_loaded()){var domElement;if(typeof(element)!='string'){domElement=element}else{try{domElement=document.querySelector(element+', #'+element+', [ng-controller="'+element+'"]')}catch(e){domElement=!1}if(!domElement){domElement=$j(element)}}return angular.element(domElement)}return!1},get_scope:function (element){if(CRPK.angular.is_loaded()){return CRPK.angular.get_element(element).scope()}return!1}};}catch (pluginError){console.error('Plugin load ERROR');debug_(pluginError);hasPluginError = true};try{/*============ Plugin: BATTLES Library*/(CRPK||(CRPK={})).battles={locationID:0,citizenshipID:0,_:{ts:0,cache:[],idx:[],last_updated:0,request_time:0,countries:{},filter:{},loaded:false,retrieved:false},update_triggers:{},init:function(){'use strict';if(is_login_page()){return!1}if(!CRPK.battles._.loaded){CRPK.battles.locationID=getinfo('location','id');CRPK.battles.citizenshipID=getinfo('citizenship','id');if(LS.check('campaigns-new.countries')){$j.extend(CRPK.battles._.countries,LS.get('campaigns-new.countries',{}))}if(LS.check('campaigns-new.battles')){$j.extend(CRPK.battles._,LS.get('campaigns-new.battles',{}));CRPK.battles._.idx=CRPK.battles._.cache.map(function (battle){return 1*battle['id']}).sort(function (a,b){return a-b})}if(!CRPK.battles._.ts||CRPK.battles._.cache.length<1){CRPK.battles.retrieve('sync')}else if(is_page('home')||is_page('military/campaigns')){CRPK.battles.import_angular()}else if(!CRPK.battles._.retrieved&&timestamp_expired(CRPK.battles._.ts,10*MINUTES)){CRPK.battles.retrieve('sync')}CRPK.battles._.loaded=!0}return CRPK.battles._.loaded},import_angular:function (angular_loaded){'use strict';if(CRPK.battles._.retrieved){return CRPK.battles._.cache}if(!angular_loaded){CRPK.angular.on_loaded('ListCampaignsController',function(){CRPK.battles.import_angular('angular_loaded')});return CRPK.battles._.cache}var scope=CRPK.angular.get_scope('ListCampaignsController'),data=scope['campaigns'];if(!scope||!data||!data.hasOwnProperty('initialList')){return CRPK.battles._.cache}CRPK.battles._.retrieved=!0;var json={battles:data['initialList'],countries:data['countries'],last_updated:intval(data['misc']['last_updated']),request_time:intval(data['misc']['request_time'])};return CRPK.battles.save(json)},retrieve:function (sync_or_async){'use strict';if(CRPK.battles._.retrieved&&'forced'!=sync_or_async){return CRPK.battles._.cache}CRPK.battles._.retrieved=!0;$j.ajax({url:EREP.campaignsJSON,global:false,async:('async'==sync_or_async),type:'GET',dataType:'json'}).done(function (json){CRPK.battles.save(json)});return CRPK.battles._.cache},save:function (json){'use strict';var a=[],id;if(typeof(json.battles)=='object'&&!is_array(json.battles)){for (id in json.battles){if(json.battles.hasOwnProperty(id)){a.push(CRPK.battle.refactor(json.battles[id]))}}json.battles=a}CRPK.battles._={ts:now(),cache:json.battles,last_updated:intval(json.last_updated),request_time:intval(json.request_time)};LS.set('campaigns-new.battles',CRPK.battles._);CRPK.battles._.filter={};CRPK.battles._.idx=CRPK.battles._.cache.map(function (battle){return 1*battle['id']}).sort(function (a,b){return a-b});CRPK.battles._.loaded=!0;CRPK.battles._.retrieved=!0;if(typeof(json.countries)=='object'&&Object.keys(json.countries).length>0){CRPK.battles._.countries=json.countries;LS.set('campaigns-new.countries',json.countries)}document.dispatchEvent(new Event('CRPK_battles_updated'));return CRPK.battles._.cache},onupdated:function (trigger,callback){'use strict';if(typeof (trigger)=='string'&&typeof(callback)=='function'){CRPK.battles.update_triggers[trigger]=callback;return!0}if(typeof(trigger)===_u){for (var trigger_ in CRPK.battles.update_triggers){if(CRPK.battles.update_triggers.hasOwnProperty(trigger_)&&typeof(CRPK.battles.update_triggers[trigger_])=='function'){CRPK.battles.update_triggers[trigger_]()}}return!0}return!1},request_time:function(){'use strict';if(!CRPK.battles._.loaded){CRPK.battles.init()}return CRPK.battles._.request_time},idx:function(){'use strict';return CRPK.battles.init()&&CRPK.battles._.idx},get_battle_by_id:function (battleID){'use strict';CRPK.battles.init();if(!in_array(battleID,CRPK.battles._.idx)){return CRPK.battle._}var battles=CRPK.battles._.cache.filter(function (battle){return battle.id==battleID});return battles.length?battles[0]:CRPK.battle._},get_war_by_id:function (warID){'use strict';CRPK.battles.init();var battles=CRPK.battles._.cache.filter(function (battle){return battle.war_id==warID});return battles.length?battles[0]:CRPK.battle._},get:function (filter){'use strict';CRPK.battles.init();return CRPK.battles.filter(filter)},filter:function (filter){'use strict';var result=CRPK.battles.init()&&CRPK.battles._.ts?CRPK.battles._.cache:CRPK.battles.retrieve(),filter_func=null,sort_func=null,filter_active_only=!0;if(!filter){return result}if(typeof(CRPK.battles._.filter[filter])==_u){switch(filter){case 'waiting':filter_active_only=!1;result=result.filter(CRPK.battle.iz.waiting);break;case 'waiting-all-div':filter_active_only=!1;result=result.filter(CRPK.battle.iz.waiting_all_div);break;case 'travel':result=result.filter(CRPK.battle.iz.travel);break;case'epic':result=result.filter(CRPK.battle.iz.epic).filter(CRPK.battle.iz.ik_friendly);break;case'epic-hittable':result=result.filter(CRPK.battle.iz.epic).filter(CRPK.battle.iz.ik_friendly).filter(CRPK.battle.iz.hittable);break;case'epic-travel':result=result.filter(CRPK.battle.iz.epic).filter(CRPK.battle.iz.ik_friendly).filter(CRPK.battle.iz.travel);break;case'epic-any-div':filter_active_only=!1;result=result.filter(CRPK.battle.iz.epic_any_div);break;case'epic-any-div-tp':filter_active_only=!1;result=result.filter(CRPK.battle.iz.epic_any_div).filter(CRPK.battle.iz.tp);break;case'epic-any-div-hittable':filter_active_only=!1;result=result.filter(CRPK.battle.iz.epic_any_div).filter(CRPK.battle.iz.hittable);break;case'epic-any-div-travel':filter_active_only=!1;result=result.filter(CRPK.battle.iz.epic_any_div).filter(CRPK.battle.iz.travel);break;case'full':case'fullscale':result=result.filter(CRPK.battle.iz.fullscale);break;case'airforce':result=result.filter(CRPK.battle.iz.airforce);break;case'airforce-hittable':result=result.filter(CRPK.battle.iz.airforce).filter(CRPK.battle.iz.hittable);break;case'airforce-travel':result=result.filter(CRPK.battle.iz.airforce).filter(CRPK.battle.iz.travel);break;case'airforce-epic':result=result.filter(CRPK.battle.iz.airforce).filter(CRPK.battle.iz.epic);break;case'airforce-epic-hittable':result=result.filter(CRPK.battle.iz.airforce).filter(CRPK.battle.iz.epic).filter(CRPK.battle.iz.hittable);break;case'airforce-epic-travel':result=result.filter(CRPK.battle.iz.airforce).filter(CRPK.battle.iz.epic).filter(CRPK.battle.iz.travel);break;case 'co':result=result.filter(CRPK.battle.iz.co);sort_func=function (a,b){if(1){return 0}return a-b};break;case 'valid-co':result=result.filter(CRPK.battle.iz.co);sort_func=function (a,b){if(1){return 0}return a-b};break;case 'location':result=result.filter(CRPK.battle.iz.location);break;case'x-tanks':result=result.filter(CRPK.battle.iz.waiting_all_div).filter(CRPK.battle.iz.nx_t);break;case'x-aircraft':result=result.filter(CRPK.battle.iz.waiting_all_div).filter(CRPK.battle.iz.nx_a);break;case'x-tanks-hittable':result=result.filter(CRPK.battle.iz.hittable).filter(CRPK.battle.iz.waiting_all_div).filter(CRPK.battle.iz.nx_t);break;case'x-aircraft-hittable':result=result.filter(CRPK.battle.iz.hittable).filter(CRPK.battle.iz.waiting_all_div).filter(CRPK.battle.iz.nx_a);break;case 'hittable':result=result.filter(CRPK.battle.iz.hittable);sort_func=function (a,b){if(a.inv.id==CRPK.battles.locationID||a.def.id==CRPK.battles.locationID){return -1}if(b.inv.id==CRPK.battles.locationID||b.def.id==CRPK.battles.locationID){return 1}if(CRPK.battles._.countries[a.inv.id]&&(in_array(CRPK.battles.locationID,CRPK.battles._.countries[a.inv.id]['allies'])||in_array(CRPK.battles.locationID,CRPK.battles._.countries[a.def.id]['allies']))){return -1}if(CRPK.battles._.countries[b.def.id]&&(in_array(CRPK.battles.locationID,CRPK.battles._.countries[b.inv.id]['allies'])||in_array(CRPK.battles.locationID,CRPK.battles._.countries[b.def.id]['allies']))){return 1}return intval(a.id)-intval(b.id)};break;default:break}if(filter_active_only){result=result.filter(CRPK.battle.iz.active)}if(filter_func){result=result.filter(filter_func)}result.sort(function (a,b){if(a.hasOwnProperty('is_tp')&&b.hasOwnProperty('is_tp')){return b.is_tp-a.is_tp}return 0});if(sort_func){result.sort(sort_func)}CRPK.battles._.filter[filter]=result}return CRPK.battles._.filter[filter]},haz:{epic:function(){'use strict';return CRPK.battles.get('epic').length>0},epic_any_div:function(){'use strict';return CRPK.battles.get('epic-any-div').length>0},fullscale:function(){'use strict';return CRPK.battles.get('fullscale').length>0},airforce:function(){'use strict';return CRPK.battles.get('airforce').length>0}},daily_orders:{_:{day:0,orders:[]},get:function(){'use strict'},is_order:function(){'use strict';if(!CRPK.battles.daily_orders._.day){}}},display:function(){'use strict';if($j('#cb-menu-current-battles-info').exists()){return!1}var tooltip='',tooltip_class='cold',battles=CRPK.battles.idx();if(!battles||!battles.length){return!1}if(CRPK.battles.haz.epic()){tooltip='I can haz  EPIC battle(s)';tooltip_class='epic'}else if(CRPK.battles.haz.epic_any_div()){tooltip='I can haz EPIC battle(s) in other divisions';tooltip_class='epic-other'}else if(CRPK.battles.haz.fullscale()){tooltip='I can haz FULLSCALE battle(s)';tooltip_class='fullscale'}else{}var wrap=$j('#menu3>a');wrap.attr('id','cb-menu-current-battles-info').addClass('cb-has-'+tooltip_class).attr('href',EREP.campaigns);if(tooltip){wrap.attr('title',tooltip).tipsy({gravity:'e'})}wrap.find('span').text(battles.length+' Battles');return!1},scan:{_:{data:{},pending:0,callback:{each:null,finished:null}},init:function (battles,callback_each,callback_finished){'use strict';if(!battles){return!1}var scan_all=('all'==battles);if(scan_all){battles=CRPK.battles.idx()}else if(typeof (battles)=='number'&&is_positive_int(battles)){battles=[battles]}if(!battles||!is_non_empty_array(battles)){return!1}CRPK.battles.scan._.pending=battles.length;CRPK.battles.scan._.callback={each:typeof(callback_each)=='function'?callback_each:null,finished:typeof(callback_finished)=='function'?callback_finished:null};for (var i = 0; i < battles.length; i++){if(CRPK.battle.stats._.data[battles[i]]){CRPK.battles.scan.callback(CRPK.battle.stats._.data[battles[i]],battles[i]);CRPK.battles.scan._.pending--;continue}(function (battleID,wait){setTimeout(function(){CRPK.battle.stats.get(battleID,CRPK.battles.scan.callback)},wait)})(battles[i],i*rand(200,1000))}CRPK.battles.scan.wait(callback_finished)},wait:function(){'use strict';if(CRPK.battles.scan._.pending>0){return setTimeout(function(){CRPK.battles.scan.wait()},500)}if(typeof(CRPK.battles.scan._.callback.finished)=='function'){CRPK.battles.scan._.callback.finished.apply(this,[CRPK.battle.stats._.data])}CRPK.battles.scan._.callback.each=null;CRPK.battles.scan._.callback.finished=null;document.dispatchEvent(new Event('CRPK_battles_scan_finished'));return!0},callback:function (data,battleID){'use strict';CRPK.battles.scan._.pending--;if(typeof(CRPK.battles.scan._.callback.each)=='function'){if(!data.hasOwnProperty('_')){data=CRPK.battle.stats.refactor(data,battleID)}CRPK.battles.scan._.callback.each.apply(this,[data,battleID])}return!0}},tw:{_:null,init:function(){return!0},list:function(){if(CRPK.battles.tw._===null||typeof(CRPK.battles.tw._)!='object'){CRPK.battles.tw._=LS.get('training-wars',{})}return CRPK.battles.tw._},retrieve:function(){$j.getJSON(PKS.prios+'training-wars.json',function (data){if(data&&typeof(data)=='object'){CRPK.battles.tw._=data}else{CRPK.battles.tw._={}}LS.set('training-wars',CRPK.battles.tw._)});return!0},is_tw:function (battle){return (CRPK.battles.tw.list().hasOwnProperty(battle.hash1)||CRPK.battles.tw.list().hasOwnProperty(battle.hash2))},prio:function (battle){return (!CRPK.battles.tw.is_tw(battle)?0:(CRPK.battles.tw.list().hasOwnProperty(battle.hash1)?CRPK.battles.tw._[battle.hash1]['prio']:CRPK.battles.tw._[battle.hash2]['prio']))},afp:function (battle){return (!CRPK.battles.tw.is_tw(battle)?0:(CRPK.battles.tw.list().hasOwnProperty(battle.hash1)?(CRPK.battles.tw._[battle.hash1].hasOwnProperty('afp')&&CRPK.battles.tw._[battle.hash1]['afp']?CRPK.battles.tw._[battle.hash1]['prio']:0):(CRPK.battles.tw._[battle.hash2].hasOwnProperty('afp')&&CRPK.battles.tw._[battle.hash2]['afp']?CRPK.battles.tw._[battle.hash2]['prio']:0)))},hash_prio:function (hash1){if(hash1.indexOf('-')<0){return 0}var hash2;hash2=hash1.split('-');if(hash2.length!=3){return 0}hash2=[hash2[1],hash2[0],hash2[2]].join('-');return (CRPK.battles.tw.list().hasOwnProperty(hash1)?(CRPK.battles.tw._[hash1].hasOwnProperty('afp')&&CRPK.battles.tw._[hash1]['afp']?CRPK.battles.tw._[hash1]['prio']:0):(CRPK.battles.tw.list().hasOwnProperty(hash2)?(CRPK.battles.tw._[hash2].hasOwnProperty('afp')&&CRPK.battles.tw._[hash2]['afp']?CRPK.battles.tw._[hash2]['prio']:0):0))}}};if(typeof(CB_LIBRARY_LOADED)!=_u&&document.querySelectorAll('#homepage_out,#login_form').length<1){_BG_.add('scan-running-battles',CRPK.battles.retrieve,minutes(1));_BG_.add('training-wars-list',CRPK.battles.tw.retrieve,hours(11))}if(typeof(CB_EREP_LIBRARY_LOADED)!=_u){COUNTRIES['get_mpps']=function (countryID){'use strict';return CRPK.battles.init()&&typeof(CRPK.battles._.countries)!=_u&&is_positive_int(countryID)&&typeof(CRPK.battles._.countries[countryID])!=_u?CRPK.battles._.countries[countryID]['allies']:[]};COUNTRIES['is_mpp']=function (country1,country2){'use strict';return CRPK.battles.init()&&(country1==country2||in_array(country1,COUNTRIES.get_mpps(country2)))};COUNTRIES['is_friendly']=function (countryID){'use strict';return CRPK.battles.init()&&(countryID==_PLAYER_.csID||countryID==_PLAYER_.muCSID||COUNTRIES.is_mpp(_PLAYER_.csID,countryID)||(_PLAYER_.muCSID!=_PLAYER_.csID&&COUNTRIES.is_mpp(_PLAYER_.muCSID,countryID)))};COUNTRIES['is_enemy']=function (country1,country2){'use strict';if(country1&&country2){}return!1};COUNTRIES['get_cod']=function (countryID){'use strict';CRPK.battles.init();if(!is_positive_int(countryID)){countryID=COUNTRIES.get(countryID,'id')}return is_positive_int(countryID)?intval(CRPK.battles._.countries[countryID]['cotd'],0):0}}CRPK.battle={_:{id:0,war_id:0,region:{id:0,name:''},is_rw:0,is_as:0,is_dict:0,is_lib:0,hash1:'',hash2:'',is_tw:0,twp:0,afp:0,det:1.00,start:0,inv:{id:0,points:0},def:{id:0,points:0},div:{"1":{div:1,end:true,epic:0,co:{inv:[],def:[]},wall:{inv:0,def:0}},"2":{div:1,end:true,epic:0,co:{inv:[],def:[]},wall:{inv:0,def:0}},"3":{div:1,end:true,epic:0,co:{inv:[],def:[]},wall:{inv:0,def:0}},"4":{div:4,end:true,epic:0,co:{inv:[],def:[]},wall:{inv:0,def:0}},"11":{div:11,end:true,epic:0,co:{inv:[],def:[]},wall:{inv:0,def:0}}},cb:1,is_do:0,is_cw:0,is_tp:0,is_against:0,has_co:0,has_co_any:0,has_co_d1:0,has_co_d2:0,has_co_d3:0,has_co_d4:0,has_co_d11:0,is_epic:0,is_epic_any:0,is_epic_d1:0,is_epic_d2:0,is_epic_d3:0,is_epic_d4:0,is_epic_d11:0,is_full:0,is_full_any:0,is_full_d1:0,is_full_d2:0,is_full_d3:0,is_full_d4:0,is_full_d11:0,waiting_all_divs:0},refactor:function (battle){'use strict';if(battle.cb){return battle}battle=$j.extend({},CRPK.battle._,battle);var x,y,tw_type;for (x in battle){if(!battle.hasOwnProperty(x)){continue}if('$$hashKey'==x||'elapsedTime'==x){delete battle[x];continue}if(is_int(battle[x])){battle[x]=intval(battle[x]);continue}else if(is_numeric(battle[x])){battle[x]=cb_number(battle[x],2);continue}else if(typeof(battle[x])=='boolean'){battle[x]=battle[x]?1:0;continue}if(typeof(battle[x])!='object'||is_array(battle[x])){continue}for (y in battle[x]){if(battle[x].hasOwnProperty(y)){if(is_int(battle[x][y])){battle[x][y]=intval(battle[x][y])}else if(is_numeric(battle[x][y])){battle[x][y]=cb_number(battle[x][y],2)}else if(typeof(battle[x][y])=='boolean'){battle[x][y]=battle[x][y]?1:0}}}}battle.is_do=M.util.battleIsDO(battle.id);battle.is_mpp=(!battle.is_rw&&!battle.is_dict&&!battle.is_lib)?1:0;if(battle.is_dict||battle.is_lib){battle.is_cw=1}tw_type=(battle.is_mpp?'mpp':(battle.is_rw?'rw':'cw'));battle.hash1=[battle.inv.id,battle.def.id,tw_type].join('-');battle.hash2=[battle.def.id,battle.inv.id,tw_type].join('-');battle.round=(battle.zone_id);battle.is_airforce=(battle.type=='aircraft'?1:0);battle.is_tanks=(battle.type=='tanks'?1:0);battle.next_is_tanks=battle.is_airforce;battle.next_is_airforce=((!battle.next_is_tanks&&((battle.zone_id+1)%4)===0)?1:0);if(CRPK.battles.tw.is_tw(battle)){battle.is_tw=1;battle.twp=CRPK.battles.tw.prio(battle);battle.afp=CRPK.battles.tw.afp(battle)}battle.is_tp=(!battle.is_cw&&(battle.inv.id==CRPK.battles.citizenshipID||battle.def.id==CRPK.battles.citizenshipID))?1:0;if(CRPK.battle.iz.co_any_div(battle)){battle.has_co_any=1;battle.has_co=CRPK.battle.iz.co_in_div(battle,0,_PLAYER_.get_natural_division())?1:0;battle.has_co_d1=CRPK.battle.iz.co_in_div(battle,0,1)?1:0;battle.has_co_d2=CRPK.battle.iz.co_in_div(battle,0,2)?1:0;battle.has_co_d3=CRPK.battle.iz.co_in_div(battle,0,3)?1:0;battle.has_co_d4=CRPK.battle.iz.co_in_div(battle,0,4)?1:0;battle.has_co_d11=CRPK.battle.iz.co_in_div(battle,0,11)?1:0;for (x = 1; x <= MAX_DIVISIONS; x++){x=String(x);if(!battle.div.hasOwnProperty(x)){continue}for (y = 0; y < battle.div[x].co.inv.length; y++){battle.div[x].co.inv[y]=CRPK.battle.co.refactor(battle.div[x].co.inv[y],battle,'inv')}for (y = 0; y < battle.div[x].co.def.length; y++){battle.div[x].co.def[y]=CRPK.battle.co.refactor(battle.div[x].co.def[y],battle,'def')}}}if(CRPK.battle.iz.epic_any_div(battle)){battle.is_epic_any=1;battle.is_epic=CRPK.battle.iz.epic_in_div(battle,0,_PLAYER_.get_natural_division())?1:0;battle.is_epic_d1=CRPK.battle.iz.epic_in_div(battle,0,1)?1:0;battle.is_epic_d2=CRPK.battle.iz.epic_in_div(battle,0,2)?1:0;battle.is_epic_d3=CRPK.battle.iz.epic_in_div(battle,0,3)?1:0;battle.is_epic_d4=CRPK.battle.iz.epic_in_div(battle,0,4)?1:0;battle.is_epic_d11=CRPK.battle.iz.epic_in_div(battle,0,11)?1:0}if(CRPK.battle.iz.fullscale_any_div(battle)){battle.is_full_any=1;battle.is_full=CRPK.battle.iz.fullscale_in_div(battle,0,_PLAYER_.get_natural_division())?1:0;battle.is_full_d1=CRPK.battle.iz.fullscale_in_div(battle,0,1)?1:0;battle.is_full_d2=CRPK.battle.iz.fullscale_in_div(battle,0,2)?1:0;battle.is_full_d3=CRPK.battle.iz.fullscale_in_div(battle,0,3)?1:0;battle.is_full_d4=CRPK.battle.iz.fullscale_in_div(battle,0,4)?1:0;battle.is_full_d11=CRPK.battle.iz.fullscale_in_div(battle,0,11)?1:0}battle.waiting_all_divs=(battle.is_airforce?!CRPK.battle.iz.active_in_div(battle,11):((CRPK.battle.iz.active_in_div(battle,1)+CRPK.battle.iz.active_in_div(battle,2)+CRPK.battle.iz.active_in_div(battle,3)+CRPK.battle.iz.active_in_div(battle,4)===0)?1:0));battle.time=CRPK.battles._.request_time-battle.start;return battle},iz:{cache:{},_:function (battle){'use strict';if(!battle.hasOwnProperty('id')){return!1}var iz_key=battle.id+'__';if(typeof(CRPK.battle.iz.cache[iz_key])===_u){CRPK.battle.iz.cache[iz_key]=(typeof(battle)=='object'&&battle.id&&typeof(battle.div)=='object')}return CRPK.battle.iz.cache[iz_key]},active:function (battle,index){'use strict';var iz_key=battle.id+'_active';if(typeof(CRPK.battle.iz.cache[iz_key])===_u){CRPK.battle.iz.cache[iz_key]=CRPK.battle.iz.active_in_div(battle,index,_PLAYER_.get_natural_division())}return CRPK.battle.iz.cache[iz_key]},active_in_div:function (battle,index,divNUM){'use strict';if(!divNUM||!is_positive_int(divNUM)||divNUM>MAX_DIVISIONS){divNUM=_PLAYER_.get_natural_division()}var iz_key=battle.id+'_active_in_div_'+divNUM;if(typeof(CRPK.battle.iz.cache[iz_key])===_u){CRPK.battle.iz.cache[iz_key]=(CRPK.battle.iz._(battle)&&((battle.is_tanks&&typeof(battle.div[divNUM])=='object'&&battle.div[divNUM].end===null)||(battle.is_airforce&&typeof(battle.div[DEFAULT_AIRFORCE_DIVISION])=='object'&&battle.div[DEFAULT_AIRFORCE_DIVISION].end===null)))}return CRPK.battle.iz.cache[iz_key]},epic:function (battle,index){'use strict';var iz_key=battle.id+'_epic';if(typeof(CRPK.battle.iz.cache[iz_key])===_u){var iz_value=CRPK.battle.iz.active(battle,index)&&((battle.is_tanks&&battle.div[_PLAYER_.get_natural_division()].epic==2)||(battle.is_airforce&&battle.div[DEFAULT_AIRFORCE_DIVISION].epic==2));if(iz_value&&CRPK.battle.iz.civil_war(battle)){iz_value=iz_value&&CRPK.battle.iz.civil_war_hittable(battle)}CRPK.battle.iz.cache[iz_key]=iz_value}return CRPK.battle.iz.cache[iz_key]},epic_any_div:function (battle,index){'use strict';var iz_key=battle.id+'_epic_any_div';if(typeof(CRPK.battle.iz.cache[iz_key])===_u){CRPK.battle.iz.cache[iz_key]=!1;for (var divNUM = 1; divNUM <= MAX_DIVISIONS; divNUM++){if(CRPK.battle.iz.epic_in_div(battle,index,divNUM)&&CRPK.battle.iz.active_in_div(battle,index,divNUM)){CRPK.battle.iz.cache[iz_key]=!0;break}}}return CRPK.battle.iz.cache[iz_key]},epic_in_div:function (battle,index,divNUM){'use strict';if(!divNUM||!is_positive_int(divNUM)||divNUM>MAX_DIVISIONS){divNUM=_PLAYER_.get_natural_division()}var iz_key=battle.id+'_epic_in_div_'+divNUM;if(typeof(CRPK.battle.iz.cache[iz_key])===_u){CRPK.battle.iz.cache[iz_key]=CRPK.battle.iz.active_in_div(battle,index,divNUM)&&typeof(battle.div[divNUM])=='object'&&battle.div[divNUM].epic==2}return CRPK.battle.iz.cache[iz_key]},fullscale:function (battle,index){'use strict';var iz_key=battle.id+'_fullscale';if(typeof(CRPK.battle.iz.cache[iz_key])===_u){CRPK.battle.iz.cache[iz_key]=CRPK.battle.iz.active(battle,index)&&((battle.is_tanks&&battle.div[_PLAYER_.get_natural_division()].epic==1)||(battle.is_airforce&&battle.div[DEFAULT_AIRFORCE_DIVISION].epic==1))}return CRPK.battle.iz.cache[iz_key]},fullscale_any_div:function (battle,index){'use strict';var iz_key=battle.id+'_fullscale_any_div';if(typeof(CRPK.battle.iz.cache[iz_key])===_u){CRPK.battle.iz.cache[iz_key]=!1;for (var divNUM = 1; divNUM <= MAX_DIVISIONS; divNUM++){if(CRPK.battle.iz.fullscale_in_div(battle,index,divNUM)){CRPK.battle.iz.cache[iz_key]=!0;break}}}return CRPK.battle.iz.cache[iz_key]},fullscale_in_div:function (battle,index,divNUM){'use strict';if(!divNUM||!is_positive_int(divNUM)||divNUM>MAX_DIVISIONS){divNUM=_PLAYER_.get_natural_division()}var iz_key=battle.id+'_fullscale_in_div_'+divNUM;if(typeof(CRPK.battle.iz.cache[iz_key])===_u){CRPK.battle.iz.cache[iz_key]=CRPK.battle.iz.active_in_div(battle,index,divNUM)&&typeof(battle.div[divNUM])=='object'&&battle.div[divNUM].epic==1}return CRPK.battle.iz.cache[iz_key]},airforce:function (battle,index){'use strict';var iz_key=battle.id+'_airforce';if(typeof(CRPK.battle.iz.cache[iz_key])===_u){CRPK.battle.iz.cache[iz_key]=CRPK.battle.iz.active(battle,index)&&battle.is_airforce}return CRPK.battle.iz.cache[iz_key]},co:function (battle,index){'use strict';var iz_key=battle.id+'_co';if(typeof(CRPK.battle.iz.cache[iz_key])===_u){CRPK.battle.iz.cache[iz_key]=CRPK.battle.iz.active(battle,index)&&CRPK.battle.iz.co_in_div(battle,0,_PLAYER_.get_natural_division())}return CRPK.battle.iz.cache[iz_key]},co_any_div:function (battle,index){'use strict';var iz_key=battle.id+'_co_any_div';if(typeof(CRPK.battle.iz.cache[iz_key])===_u){CRPK.battle.iz.cache[iz_key]=!1;for (var divNUM = 1; divNUM <= MAX_DIVISIONS; divNUM++){if(CRPK.battle.iz.co_in_div(battle,index,divNUM)){CRPK.battle.iz.cache[iz_key]=!0;break}}}return CRPK.battle.iz.cache[iz_key]},co_in_div:function (battle,index,divNUM){'use strict';if(!divNUM||!is_positive_int(divNUM)||divNUM>MAX_DIVISIONS){divNUM=_PLAYER_.get_natural_division()}var iz_key=battle.id+'_co_in_div_'+divNUM;if(typeof(CRPK.battle.iz.cache[iz_key])===_u){CRPK.battle.iz.cache[iz_key]=CRPK.battle.iz.active_in_div(battle,index,divNUM)&&typeof(battle.div[divNUM])=='object'&&(battle.div[divNUM].co.inv.length>0||battle.div[divNUM].co.def.length>0)}return CRPK.battle.iz.cache[iz_key]},valid_co:function (battle,index){'use strict';var iz_key=battle.id+'_valid_co';if(typeof(CRPK.battle.iz.cache[iz_key])===_u){CRPK.battle.iz.cache[iz_key]=!1;if(CRPK.battle.iz.active(battle,index)&&CRPK.battle.iz.co(battle,index)){var all_co=battle.div[_PLAYER_.get_natural_division()].co.inv.concat(battle.div[_PLAYER_.get_natural_division()].co.def),i,co,cs=getinfo('citizenship','id');for (i = 0; i < all_co.length; i++){co=all_co[i];if((!co.sub_country||co.sub_country==cs)&&(!co.sub_mu||co.sub_mu==_PLAYER_.muID)&&true){CRPK.battle.iz.cache[iz_key]=!0;break}}}}return CRPK.battle.iz.cache[iz_key]},waiting:function (battle,index){'use strict';return !CRPK.battle.iz.active(battle,index)},waiting_all_div:function (battle){'use strict';return !!battle.waiting_all_divs},travel:function (battle){'use strict';return !CRPK.battle.iz.location(battle)},location:function (battle){'use strict';var iz_key=battle.id+'_location';if(typeof(CRPK.battle.iz.cache[iz_key])===_u){var iz_value=CRPK.battle.iz._(battle)&&(((!battle.is_rw&&battle.inv.id==CRPK.battles.locationID)||battle.def.id==CRPK.battles.locationID)||(battle.is_mpp&&(COUNTRIES.is_mpp(CRPK.battles.locationID,battle.inv.id)||COUNTRIES.is_mpp(CRPK.battles.locationID,battle.def.id))));if(iz_value&&CRPK.battle.iz.civil_war(battle)){iz_value=iz_value&&CRPK.battle.iz.civil_war_hittable(battle)}CRPK.battle.iz.cache[iz_key]=iz_value}return CRPK.battle.iz.cache[iz_key]},hittable:function (battle,index){'use strict';var iz_key=battle.id+'_hittable';if(typeof(CRPK.battle.iz.cache[iz_key])===_u){var iz_value=CRPK.battle.iz.location(battle)&&CRPK.battle.iz.active(battle,index);if(iz_value&&CRPK.battle.iz.civil_war(battle)){iz_value=iz_value&&CRPK.battle.iz.civil_war_hittable(battle)}CRPK.battle.iz.cache[iz_key]=iz_value}return CRPK.battle.iz.cache[iz_key]},tp:function (battle){'use strict';var iz_key=battle.id+'_tp';if(typeof(CRPK.battle.iz.cache[iz_key])===_u){CRPK.battle.iz.cache[iz_key]=(battle.hasOwnProperty('is_tp')&&battle.is_tp?1:0)}return CRPK.battle.iz.cache[iz_key]},civil_war_hittable:function (battle){'use strict';var iz_key=battle.id+'_civil_war_hittable';if(typeof(CRPK.battle.iz.cache[iz_key])===_u){CRPK.battle.iz.cache[iz_key]=in_array(battle.def.id,[getinfo('citizenship','id'),_PLAYER_.muCSID])}return CRPK.battle.iz.cache[iz_key]},ik_friendly:function (battle,index){'use strict';var iz_key=battle.id+'_ik_friendly';if(typeof(CRPK.battle.iz.cache[iz_key])===_u){var natural_division=_PLAYER_.get_natural_division(),iz_friendly=!1;if(natural_division<4){iz_friendly=CRPK.battle.iz.epic_in_div(battle,index,natural_division)}else{iz_friendly=!0}CRPK.battle.iz.cache[iz_key]=iz_friendly}return CRPK.battle.iz.cache[iz_key]},civil_war:function (battle){'use strict';var iz_key=battle.id+'_civil_war';if(typeof(CRPK.battle.iz.cache[iz_key])===_u){CRPK.battle.iz.cache[iz_key]=(battle.is_cw||battle.is_lib||battle.is_dict)}return CRPK.battle.iz.cache[iz_key]},not_civil_war:function (battle){'use strict';return !CRPK.battle.iz.civil_war(battle)},nx_t:function (battle){'use strict';var iz_key=battle.id+'_nx_t';if(typeof(CRPK.battle.iz.cache[iz_key])===_u){CRPK.battle.iz.cache[iz_key]=battle.next_is_tanks}return CRPK.battle.iz.cache[iz_key]},nx_a:function (battle){'use strict';var iz_key=battle.id+'_nx_a';if(typeof(CRPK.battle.iz.cache[iz_key])===_u){CRPK.battle.iz.cache[iz_key]=battle.next_is_airforce}return CRPK.battle.iz.cache[iz_key]}},co:{refactor:function (co,battle,inv_or_def){'use strict';if(typeof(co)!='object'||co.sideID||!CRPK.battle.iz._(battle)||!inv_or_def){return co}co.threshold=floatval(co.threshold,40);co.reward=intval(co.reward,10);co.budget=intval(co.budget,100);co.sub_country=intval(co.sub_country,0);co.sub_mu=intval(co.sub_mu,0);co.side=inv_or_def;co.sideID=(battle.is_cw&&'inv'==inv_or_def?255:battle[inv_or_def].id);co.valid=CRPK.battle.co.is_valid(co,battle)?1:0;co.friendly=CRPK.battle.co.is_friendly(co,battle)?1:0;co.against=CRPK.battle.co.is_against(co,battle)?1:0;return co},is_valid:function (co){'use strict';return !!((!co.sub_country||co.sub_country==CRPK.battles.citizenshipID)&&(!co.sub_mu||co.sub_mu==_PLAYER_.muID))},is_friendly:function (co){'use strict';return COUNTRIES.is_friendly(co.sideID)},is_against:function (co){'use strict';if(co){}return 0}},get_co:function (battleID,divNUM,sideID){'use strict';var result={};battleID=is_positive_int(battleID)?intval(battleID):0;sideID=is_positive_int(sideID)?intval(sideID):0;divNUM=is_positive_int(divNUM)?intval(divNUM):0;if(!battleID){return result}var battle,invader,defender,i,div,c,co;for (i = 0; i < CRPK.battles._.idx.length; i++){battle=CRPK.battles._.cache[i];if((battleID&&battle.id!=battleID)||!battle.div){continue}invader=COUNTRIES.get(battle.is_cw?255:battle.inv.id);defender=COUNTRIES.get(battle.def.id);result={battleID:battle.id,d1:[],d2:[],d3:[],d4:[],d11:[]};for (div = 1; div <= MAX_DIVISIONS; div++){div=String(div);if((divNUM&&div!=divNUM)||!battle.div.hasOwnProperty(div)||!result.hasOwnProperty('d'+div)){continue}if(!sideID||sideID==battle.inv.id){for (c = 0; c < battle.div[div].co.inv.length; c++){co=battle.div[div].co.inv[c];co.sideID=invader.id;co.sideNAME=invader.display;co.wall=co.threshold;co.cc=co.reward;co.div=div;co.owner={ID:0,name:'',country:'',commanderID:''};result['d'+div].push(co)}}if(!sideID||sideID==battle.def.id){for (c = 0; c < battle.div[div].co.def.length; c++){co=battle.div[div].co.def[c];co.sideID=defender.id;co.sideNAME=defender.display;co.wall=co.threshold;co.cc=co.reward;co.div=div;co.owner={ID:0,name:'',country:'',commanderID:''};result['d'+div].push(co)}}result['d'+div].sort(function (a,b){return b.reward-a.reward})}if(battleID&&battle.id!=battleID){break}}return result},stats:{_:{data:{}},get:function (battleID,callback,forced){'use strict';if(CRPK.battle.stats._.data[battleID]&&!forced){return CRPK.battle.stats.callback(CRPK.battle.stats._.data[battleID],battleID,callback)}return $j.ajax({url:bstats_url(battleID),dataType:'json'}).done(function (data){return CRPK.battle.stats.callback(data,battleID,callback)})},callback:function (data,battleID,callback){'use strict';CRPK.battle.stats._.data[battleID]=CRPK.battle.stats.refactor(data,battleID);if(callback&&typeof(callback)=='function'){callback.apply(this,[CRPK.battle.stats._.data[battleID],battleID])}document.dispatchEvent(new CustomEvent('CRPK_battle_stats_get',{detail:{battleID:battleID},bubbles:true,cancelable:false}));document.dispatchEvent(new Event('CRPK_battle_stats_get_'+battleID));return CRPK.battle.stats._.data[battleID]},refactor:function (data,battleID){'use strict';data._={battleID:0,zoneID:0,sideID:0,canHit:0,bha:[],t5d:{'1':{},'2':{},'3':{},'4':{}},t5k:{'1':{},'2':{},'3':{},'4':{}}};if(is_positive_int(battleID)){data._.battleID=battleID}var zoneID=1,divisionID,sideID,top5,x;if(typeof(data.stats)!='object'||typeof(data.stats.current)!='object'){return data}for (var zoneId in data.stats.current){if(data.stats.current.hasOwnProperty(zoneId)&&is_positive_int(zoneId)){zoneID=intval(zoneId,1);break}}if(!is_int(zoneID)||typeof(data.stats.current[zoneID])!='object'){return data}data._.zoneID=zoneID;if(data.stats.overall&&data.stats.overall.length){data._.canHit=1;for (sideID in data.stats.overall[0]){if(data.stats.overall[0].hasOwnProperty(sideID)){data._.sideID=intval(sideID,0);break}}}for (divisionID in data.stats.current[zoneID]){if(!data.stats.current[zoneID].hasOwnProperty(divisionID)){continue}data._.t5d[divisionID]={};data._.t5k[divisionID]={};for (sideID in data.stats.current[zoneID][divisionID]){if(!data.stats.current[zoneID][divisionID].hasOwnProperty(sideID)){continue}data._.t5d[divisionID][sideID]=[];data._.t5k[divisionID][sideID]=[];data._.bha[divisionID]=[];if(is_array(data.stats.current[zoneID][divisionID][sideID].top_damage)){top5=data.stats.current[zoneID][divisionID][sideID].top_damage;if(top5.length>0){for (x = 0; x < top5.length; x++){data._.t5d[divisionID][sideID].push({id:intval(top5[x]['citizen_id']),d:intval(top5[x]['damage']),a:''})}}else{data._.bha[divisionID].push(sideID)}}if(is_array(data.stats.current[zoneID][divisionID][sideID].top_kills)){top5=data.stats.current[zoneID][divisionID][sideID].top_kills;for (x = 0; x < top5.length; x++){data._.t5k[divisionID][sideID].push({id:intval(top5[x]['citizen_id']),d:intval(top5[x]['damage']),a:''})}}}}return data}}};}catch (pluginError){console.error('Plugin load ERROR');debug_(pluginError);hasPluginError = true};try{(CRPK||(CRPK={})).stats={_:{},bind_angular:function(){CRPK.angular.on_digest('ErpkBattleStatsController',CRPK.stats.update_angular,!0)},update_angular:function(){},retrieve:function (battleID,roundNUM,divNUM,pageNUM,synchronous){var zoneID=roundNUM;if(divNUM=='overall'){roundNUM=0}if(!pageNUM){pageNUM=1}synchronous=!!synchronous;var result={},ajax=$j.ajax({url:EREP.url+'/military/battle-console',type:'POST',dataType:'json',async:!synchronous,data:{_token:getinfo('token'),battleId:battleID,zoneId:zoneID,action:'battleStatistics',round:roundNUM,division:4,type:'damage',leftPage:pageNUM,rightPage:pageNUM}}).then(function (data){result=data});return synchronous?result:ajax},update:function (battleID,roundNUM,data){},get_top5_damage:function (battleID,roundNUM,division){},get_top5_kills:function (battleID,roundNUM,division){},get_personal_stats:function (battleID,roundNUM,division){}};}catch (pluginError){console.error('Plugin load ERROR');debug_(pluginError);hasPluginError = true};try{(CRPK||(CRPK={})).inventory={_:{},init:function(){if(Object.keys(CRPK.inventory._).length<1){CRPK.inventory.get()}return CRPK.inventory._},init_angular:function (callback){if(is_page(EREP.storage)&&typeof(callback)=='function'){CRPK.angular.on_loaded('InventoryController',callback);return!0}return!1},get:function(){if(is_page(EREP.storage)&&CRPK.angular.is_loaded()){var angular_inventory=CRPK.angular.get_scope('InventoryController');if(typeof(angular_inventory.inventory)!='undefined'&&angular_inventory.inventory.hasOwnProperty('items')){CRPK.inventory._={inventoryItems:angular_inventory.inventory.items,status:angular_inventory.inventory.status};if(typeof(_PLAYER_)!=_u){_PLAYER_.update({maverick_pack:CRPK.inventory.hasPack('maverickPackBoosters')})}return CRPK.inventory._}}$j.ajax({url:EREP.storageJSON,async:false,dataType:'json'}).done(function (inventoryJSON){CRPK.inventory._=inventoryJSON});if(typeof(_PLAYER_)!=_u){_PLAYER_.update({maverick_pack:CRPK.inventory.hasPack('maverickPackBoosters')})}return CRPK.inventory._},hasItem:function (itemID,type){if(typeof(itemID)!='string'||!CRPK.inventory.init()){return 0}if(!in_array(type,['finalProducts','rawMaterials','activeEnhancements'])){type='finalProducts'}if(typeof(CRPK.inventory._.inventoryItems)==_u||typeof(CRPK.inventory._.inventoryItems[type])==_u){return 0}if(!is_array(CRPK.inventory._.inventoryItems[type].items)){return (typeof(CRPK.inventory._.inventoryItems[type].items[itemID])!='undefined'?intval(CRPK.inventory._.inventoryItems[type].items[itemID].amount,0):0)}var k,l=CRPK.inventory._.inventoryItems[type].items.length;for (k = 0; k < l; k++){if(CRPK.inventory._.inventoryItems[type].items[k].id==itemID){return intval(CRPK.inventory._.inventoryItems[type].items[k].amount,0)}}return 0},getItem:function (itemID,type){if(typeof(itemID)!='string'||!CRPK.inventory.init()){return!1}if(!in_array(type,['finalProducts','rawMaterials','activeEnhancements'])){type='finalProducts'}if(!CRPK.inventory.hasItem(itemID,type)){return!1}var item=!1;if(!is_array(CRPK.inventory._.inventoryItems[type].items)){item=CRPK.inventory._.inventoryItems[type].items[itemID]}else{var k,l=CRPK.inventory._.inventoryItems[type].items.length;for (k = 0; k < l; k++){if(CRPK.inventory._.inventoryItems[type].items[k].id==itemID){item=CRPK.inventory._.inventoryItems[type].items[k];break}}}if(item&&item.hasOwnProperty('amount')){item['amount']=intval(item.amount,0);return item}return!1},hasProduct:function (itemID){return CRPK.inventory.hasItem(itemID,'finalProducts')},getProductItem:function (itemID){return CRPK.inventory.getItem(itemID,'finalProducts')},hasRaw:function (itemID){return CRPK.inventory.hasItem(itemID,'rawMaterials')},getRawItem:function (itemID){return CRPK.inventory.getItem(itemID,'rawMaterials')},hasActive:function (itemID){if(!instr(itemID,'_active')){itemID+='_active'}return CRPK.inventory.hasItem(itemID,'activeEnhancements')},getActiveItem:function (itemID){if(!instr(itemID,'_active')){itemID+='_active'}return CRPK.inventory.getItem(itemID,'activeEnhancements')},computeWeaponUses:function(){CRPK.inventory.init();var weaponUses=0;for (var q = 1; q <= 7; q++){weaponUses+=(CRPK.inventory.hasProduct('2_'+q)*(q==7?10:q))}return weaponUses},computeEnergyAmount:function(){CRPK.inventory.init();var energyAmount=0;for (var q = 1; q <= 7; q++){energyAmount+=(CRPK.inventory.hasProduct('1_'+q)*(q==7?10:q)*2)}return energyAmount},computeTicketsAmount:function(){CRPK.inventory.init();var ticketsAmount=0;for (var q = 1; q <= 7; q++){ticketsAmount+=CRPK.inventory.hasProduct('3_'+q)}return ticketsAmount},has_house_q:function (houseQ){return CRPK.inventory.hasProduct('4_'+houseQ)},has_active_house_q:function (houseQ){var house=CRPK.inventory.getActiveItem('4_'+houseQ);if(house&&house.hasOwnProperty('active')){return house['active']['time_left']}return 0},has_house:function(){for (var q = 1; q <= 7; q++){if(CRPK.inventory.hasProduct('4_'+q)){return!0}}return!1},has_active_house:function(){for (var q = 1; q <= 7; q++){if(CRPK.inventory.hasActive('4_'+q+'_active')){return!0}}return!1},computeActiveHousesLowestTimer:function(){CRPK.inventory.init();var activeHousesLowestTimer=0,houseTimer;for (var q = 1; q <= 7; q++){houseTimer=CRPK.has_active_house_q(q);if(houseTimer&&(!activeHousesLowestTimer||houseTimer<activeHousesLowestTimer)){activeHousesLowestTimer=houseTimer}}return activeHousesLowestTimer},hasPack:function (packName,forced){forced=!!forced;var hasPack=0,type='activeEnhancements';if(!(CRPK.inventory._.hasOwnProperty('inventoryItems')&&CRPK.inventory._.inventoryItems.hasOwnProperty(type))&&!forced){return hasPack}CRPK.inventory.init();var id,item,k,l;if(CRPK.inventory._.hasOwnProperty('inventoryItems')&&CRPK.inventory._.inventoryItems.hasOwnProperty(type)){if(!is_array(CRPK.inventory._.inventoryItems[type].items)){for (id in CRPK.inventory._.inventoryItems[type].items){if(!CRPK.inventory._.inventoryItems[type].items.hasOwnProperty(id)){continue}if(instr(id,packName)){item=CRPK.inventory._.inventoryItems[type].items[id];if(item.hasOwnProperty('active')){hasPack=CRPK.inventory._.inventoryItems[type].items[id]['active']['time_left']}break}}}else{l=CRPK.inventory._.inventoryItems[type].items.length;for (k = 0; k < l; k++){if(instr(CRPK.inventory._.inventoryItems[type].items[k].id,packName)){item=CRPK.inventory._.inventoryItems[type].items[k];if(item.hasOwnProperty('active')){hasPack=CRPK.inventory._.inventoryItems[type].items[k]['active']['time_left']}break}}}}return hasPack},status:function(){var inventory=CRPK.inventory.init();return typeof(inventory['inventoryStatus'])!=_u?inventory['inventoryStatus']:inventory['status']},used:function(){return CRPK.inventory.status().usedStorage},total:function(){return CRPK.inventory.status().totalStorage},color:function(){return CRPK.inventory.status().color},free:function(){return CRPK.inventory.total()-CRPK.inventory.used()},ratio:function(){return cb_number(CRPK.inventory.used()/CRPK.inventory.total(),2)}};}catch (pluginError){console.error('Plugin load ERROR');debug_(pluginError);hasPluginError = true};try{/*============ Plugin: MU-library*/if(typeof(CB_EREP_LIBRARY_LOADED)!=_u){var MU={id:0,url:'',regimentsURL:'',init:function(){if(is_page('home')||is_page('/manage-employees/')){MU.workData.init()}if(!is_page('/military/military-unit/')){return!1}MU.id=isset(SERVER_DATA,'militaryUnitInfo.groupId')?SERVER_DATA.militaryUnitInfo.groupId:intval(_URL_.split('/military/military-unit/')[1].split('/')[0]);if(!MU.id){return!1}MU.url=EREP.url+'/military/military-unit/'+MU.id;setTimeout(function(){CRPK.angular.on_loaded('MuController',function(){$j('<div id="cb-mu-tools"></div>').appendTo('#erpkMilitaryUnit>div.muContainer>div.div.header');cb_std('MASS Mail Members','purple noPadding tinySize').attr('id','mu_members_mailer').click(function(){if(typeof(CRPK.plugins.MAILER)==_u||!is_valid_auth_key_('mailer')){return alert('MAILER plugin (and auth key) required')}var recipients=MU.get_members_list();return gto(EREP.url+'/main/messages-compose/0?qdata='+JSON.stringify({list:recipients,grouped:zcb_(1,0)}))}).appendTo('#cb-mu-tools');if(typeof(CRPK.sbox)!=_u){cb_std('Mass add friends','noPadding tinySize').attr('id','mu_members_do_add').click(function(){MU.members_add_friends()}).appendTo('#cb-mu-tools')}cb_std('<span><q class="cb-icon cb-icon-24 erep_de_link"></q>MU Stats</span>','noPadding tinySize',http('www.erepublik-deutschland.de/en/tools/militaryunit/'+MU.id)).appendTo('#cb-mu-tools')})},0);return!0},members_add_friends:function(){if(typeof(CRPK.sbox)==_u){return!1}var add_button=$j('#mu_members_do_add');if(!add_button.exists()){cb_std('Add all MU Members as Friends','pad10px').attr('id','mu_members_do_add').click(function(){MU.members_add_friends()}).appendTo('#cb-mu-tools');return!1}_q('Retrieving current friends list ...');var friends=CRPK.sbox.get_friends(),friends_list=[],addURL=EREP.base+'/citizen/friends/add/',token={_token:getinfo('token')};for (var name in friends){if(!friends.hasOwnProperty(name)){continue}friends_list.push(friends[name])}friends_list.push(getinfo('uid'));window['mu-add-friends-count']=0;window['mu-add-friends-sent']=0;var members=MU.get_members_list();window['humanMsg']['displayMsg']('<strong>Sending Requests ...</strong>');var i,citizenID;for (i = 0; i < members.length; i++){citizenID=members[i];if(in_array(citizenID,friends_list)){continue}_q('Sending request (uid ='+citizenID+')');window['mu-add-friends-count']++;$j.ajax({url:addURL+citizenID,type:'POST',async:true,data:token,success:function(){window['mu-add-friends-sent']++}})}window['mu-add-friends-interval']=setInterval(function(){if(window['mu-add-friends-sent']>=window['mu-add-friends-count']){_q('MU friend requests sent ('+window['mu-add-friends-sent']+')');window.clearInterval(window['mu-add-friends-interval']);window['humanMsg']['displayMsg']('<strong>Add MU Members as friends ('+window['mu-add-friends-sent']+')</strong> :: <span>finished</span>');alert('MU friend requests sent ('+window['mu-add-friends-sent']+')')}},500);return!0},members_mass_mail:function(){if(!$j('#mu_members_mailer').exists()){cb_std('MASS Mail all MU Members','purple pad10px').attr('id','mu_members_mailer').click(function(){if(typeof(CRPK.plugins.MAILER)==_u||!is_valid_auth_key_('mailer')){return alert('MAILER plugin (and auth key) required')}_q('Retrieving MU Members list ...');var recipients=MU.get_members_list();return gto(EREP.url+'/main/messages-compose/0?qdata='+JSON.stringify({list:recipients,grouped:1}))}).appendTo('#cb-mu-tools');return!1}},get_members_list:function(){var ls_members=LS.get('mu-members-'+MU.id,{list:[],ts:0});if(false&&ls_members&&ls_members.list.length>0&&!timestamp_expired(ls_members.ts,2*HOURS)){return ls_members.list}var baseURL=EREP.url+'/military/military-unit-data/'+MU.id+'/members?sortBy=isDead&sortAsc=1&currentPage=',currentPage=1,members=[],maxPages=1,hasDead=!1;$j.ajax({url:baseURL+currentPage,async:false,global:false,dataType:'json'}).then(function (response){if(!response||!response.panelContents){return!1}maxPages=response.panelContents.pages;for (var i = 0; i < response.panelContents.members.length; i++){if(response.panelContents.members[i].isDead){hasDead=!0;break}members.push(response.panelContents.members[i].citizenId)}});if(maxPages<2){return members}for (currentPage = 2; currentPage <= maxPages; currentPage++){if(hasDead){break}$j.ajax({url:baseURL+currentPage,async:false,global:false,dataType:'json'}).then(function (response){if(!response||!response.panelContents){return!1}for (var i = 0; i < response.panelContents.members.length; i++){if(response.panelContents.members[i].isDead){hasDead=!0;break}members.push(response.panelContents.members[i].citizenId)}})}LS.set('mu-members-'+MU.id,{list:members,ts:now()});return members},workData:{muID:null,_:{110:{formKey:GForm('1FAIpQLSe74njsFtZvToAMLkDKzv55GPtAImQI9Q79-or_SgylOUaSJg',!1),formFields:['entry.1000000','entry.1000001'],employers:[1444489,1559809,258,1868613,931242,1857804,4697560,116432],threshold:9},145:{formKey:GForm('1T_azy_ICpCqOG2j3fPUW7Yy1IqfMJVtQAd5KLJmSS-E',!1),formFields:['entry.286557520','entry.4479279'],employers:[5290634,5557720,3927013,4854761,5557720,2920794],threshold:30},264:{formKey:GForm('1mEpIxPDQML9NgCXZOOJ6QIje8FJuCLSoWGlpvUtcs7g',!1),formFields:['entry.286557520','entry.4479279'],employers:[4103184,2770764,4918647,5235741,3027219],threshold:30},4992:{formKey:GForm('1zKLiOSWnHmeqbq0wcCY7x-IC74ac2FhzWLfNoD7YfvY',!1),formFields:['entry.286557520','entry.4479279'],employers:[5564949],threshold:0},4928944:{formKey:GForm('1aaXNRbUahFvgmkvcAJyMuRz4SBB7Kikb2dW-01J7Tpw',!1),formFields:['entry.286557520','entry.4479279'],employers:[4928944],threshold:0},5996828:{formKey:GForm('1ji5UvDIrqGr1D6UcqYWMuGRNF0w5nx4w14SdKcChujE',!1),formFields:['entry.286557520','entry.4479279'],employers:[5996828],threshold:0},2019174:{formKey:GForm('1BOKhJaAbYc-CKiPUkCM6CGbCD6ACgfcTBibgF6Q8-YA',!1),formFields:['entry.286557520','entry.4479279'],employers:[2019174],threshold:0},/*/en/citizen/profile/1157041enderaggie@gmail.com*/26:{formKey:GForm('1dB3_WbIWFa0GgTxRLDfylYBm8LSHBYzYSPAtwX5PYBA',!1),formFields:['entry.286557520','entry.4479279'],employers:[1528331],threshold:0},/*/en/citizen/profile/4083260padawanque@gmail.com*/4083260:{formKey:GForm('1FAIpQLSfGXQB3WF_QSQJjrAJ0vfStfJugdWyPz2BeuHLaFEUGtIz5YA',!1),formFields:['entry.286557520','entry.4479279'],employers:[4083260],threshold:0}},list:[],days:[],init:function(){if(!is_page('home')&&!is_page('/manage-employees/')){return!1}if(MU.workData.muID===null){MU.workData.muID=0;if(_PLAYER_.muID&&typeof(MU.workData._[_PLAYER_.muID])!=_u&&getinfo('uid')!=5290634){if(in_array(getinfo('uid'),MU.workData._[_PLAYER_.muID].employers)){MU.workData.muID=_PLAYER_.muID}}else{for (var id in MU.workData._){if(!MU.workData._.hasOwnProperty(id)){continue}if(typeof(MU.workData._[id].employers)!='object'){continue}if(in_array(getinfo('uid'),MU.workData._[id].employers)){MU.workData.muID=id}}}if(!MU.workData.muID){return!1}}if(!MU.workData.muID||typeof(MU.workData._[MU.workData.muID].formKey)!='string'){return!1}if(is_page('/manage-employees')){if(typeof(EMPLOYER)!=_u){EMPLOYER.employees_header()}var anchor=$j('#cb_employees_header');if(!anchor.exists()){anchor=$j('.manager_dashboard .area_final_products')}cb_std('Send Work Data','pad10px').attr('id','MU_wdata_submit_btn').appendTo(anchor).click(function(){$j(this).unbind();MU.workData.submit_workdata(false)});MU.workData.submit_workdata(null)}else{_BG_.add('scan_employees',MU.bg.scan_employees,hours(3))}return!0},submit_workdata:function (workdata){if(!MU.workData.muID||typeof(MU.workData._[MU.workData.muID].formKey)!='string'){return!1}var bg_process=!0;if(!workdata){bg_process=!1;if(null===workdata){if((now()-intval(LS.get('MU_WDSENT',0)))/MINUTES<30){return!1}}$j('#MU_wdata_submit_btn').addClass('loading');workdata=MU.workData.collect_workdata()}var form=MU.workData._[MU.workData.muID],payload={pageHistory:0};payload[form.formFields[0]]='work_data';payload[form.formFields[1]]=JSON.stringify(workdata);$j.post(form.formKey,payload).always(function(){LS.set('MU_WDSENT',now());if(bg_process){return}setTimeout(function(){$j('#MU_wdata_submit_btn').unbind().removeClass('loading').addClass('disabled')},seconds(1))});return!0},collect_workdata:function (html){var employees_list={},wdata={},employees_table,salary_threshold=0;var eday=getinfo('day')-7,d;for (d = 1; d <= 7; d++){MU.workData.days.push(eday+d)}if(html){employees_table=$j(html).find('.list_group .listing')}else{employees_table=$j('.list_group .listing')}if(!MU.workData.muID){for (var id in MU.workData._){if(!MU.workData._.hasOwnProperty(id)){continue}if(typeof(MU.workData._[id].employers)!='object'){continue}if(in_array(getinfo('uid'),MU.workData._[id].employers)){MU.workData.muID=id}}}try{salary_threshold=MU.workData._[MU.workData.muID].threshold}catch(e){}$j(employees_table).each(function(){var edata=[],employee_link=$j(this).find('a.employee_entry'),employee_name=employee_link.text().trim(),employee_id=intval(employee_link.attr('href').split('profile/')[1]),salary=floatval($j(this).find('#old_salary_'+employee_id).val());if(salary_threshold&&salary>salary_threshold){return!0}$j(this).find('.working_days span').each(function(){var span=$j(this),work_units='';if(span.hasClass('worked')){work_units=intval(span.find('b').text().trim())}else if(span.hasClass('nan')){work_units=-1}else{work_units=0}edata.push(work_units)});employees_list[employee_name]=employee_id;wdata[employee_id]=edata});return {employer_id:getinfo('uid'),days:MU.workData.days,employees:employees_list,employees_data:wdata}}},bg:{scan_employees:function(){$j.ajax({url:EREP.url+'/economy/manage-employees/1',global:false,async:false,success:function (response){MU.workData.submit_workdata(MU.workData.collect_workdata(response))}});return!0}}};PLUGINS['MU-library']={f:MU.init,p:false}}}catch (pluginError){console.error('Plugin load ERROR');debug_(pluginError);hasPluginError = true};try{if(typeof(CB_EREP_LIBRARY_LOADED)!=_u){CRPK.plugins.cbFeed={newsItems:[{day:3506,pinned:false,title:'Auto-residence Changes.',content:'Auto-residence should no longer trigger When:<br>'+' â€¢ you are tanking somewhere<br>'+' â€¢ '+help_link('Market fishing', 'shatchKEY')+' is ON<br><br>'+'<b>Chrome ONLY</b> cross-device detection (loggedn in on multiple PCs/browsers/locations):<br>'+'*If* you are '+prntscr('foa024', 'logged into Chrome (chrome:/'+'/settings/)')+' with the same Google account in <b>both/all</b> locations, Auto-residence *should* not trigger if you are active in <b>any</b> one of your locations (active means tanking, market fishing etc). This is done using public Chrome Extensions Sync API.'},{day:3503,pinned:false,title:'Oooops.',content:'I tried to make some improvements on auto-back to residence and i broke shit. Should be fixed now..'},{day:3499,pinned:false,title:'Auto-residence bugfix',content:'Fixed a bug that would move you back to residence if you left the script to tank while being AFK.<br>Added Activity detection (attempt) when you are logged in from multiple computers (Work/Home).'},{day:3483,pinned:false,title:'In-game options',content:'New in-game options (for those who have missed it):<br><a href="'+https('www.erepublik.com/en/main/citizen-edit/edit_game_options')+'">erepublik.com/en/main/citizen-edit/edit_game_options</a>.'},{day:3477,pinned:false,title:'New option',content:'New option: Enable/disable RW announcements '+prntscr('fd12rt')+'<br>'+'RW Announcer should now also be publicly available to MoD/CP key owners.'},{day:3476,pinned:false,title:'New [CB] News feed',content:'<b>Bugfix:</b> '+trac_link('Auto-back to residence not always working', '6/return-to-resident')},{day:3474,pinned:false,title:'New [CB] News feed',content:'Iâ€™ve changed the way script notifications are delivered to a less intrusive system.<br>'+'<b>Bugfix:</b> '+trac_link('Auto Work as Manager will no longer use EnergyBars', '4/auto-work-as-manager-is-consuming-energy')},{day:3473,pinned:false,title:'New bug tracker for script',content:'New '+trac_link('issues tracker')+' for script: '+trac_link('Report a bug')},{day:3473,pinned:false,title:'New feature (in testing)',content:'New feature (in testing): <a href="'+http_s('erpk.bularca.ro/Firebase/rwAnnouncer/')+'">RW Supporters</a> ('+help_link('MoD/CP key only', '#modKEY')+')'},{day:3471,pinned:false,title:'Airforce battlefield: Always/Never',content:'Iâ€™ve made some tweaks to Airforce battlefield selection. Please '+composeMessageLink(DEVID,'let me know')+' how "Never / Always" settings behave.<br>Please note that <b>Always</b> is a '+help_link('Tank KEY', '#tankKEY')+' only setting'},{day:3470,pinned:false,title:'New Feature (in testing)',content:'New Feature (in testing): Auto back to residence '+prntscr('fabpwg')}/*,{day:3470,pinned:true,title:'Looking for a JSON API/storage service',content:'I am looking for a JSON API/storage service. '+composeMessageLink(DEVID,'let me know')+' if you could help out or know of such a service ^_^'}*/],isInit:false,numNotifications:false,unseenNotifications:false,init:function (forced){forced=!!forced;if(CRPK.plugins.cbFeed.isInit&&!forced){return!1}CRPK.plugins.cbFeed.isInit=!0;_BG_.add('cbFeed',CRPK.plugins.cbFeed.fetchData,minutes(5));if(!is_page('home')){return!1}if(!forced){CRPK.plugins.cbFeed.fetchData()}var trigger=$j('#cbFeed');if(!trigger.exists()){trigger=$j('<a href="javascript:;" id="cbFeed" ></a>');trigger.click(CRPK.plugins.cbFeed.show).append('<q class="cb-icon-16"></q>').wrap('<li title="[CB] eRepublik"></li>').parent().prependTo('#citizen_feed > ul').tipsy({gravity:'s'});CRPK.plugins.cbFeed.notify(forced);if(!forced){CRPK.plugins.cbFeed.oneTimeBindings()}}return CRPK.plugins.cbFeed.isInit},notify:function (forced){forced=!!forced;CRPK.plugins.cbFeed.init();if(CRPK.plugins.cbFeed.numNotifications===!1){CRPK.plugins.cbFeed.numNotifications=CRPK.plugins.cbFeed.news.getNumItems()+CRPK.plugins.cbFeed.rwAnnouncer.getNumItems()}if(CRPK.plugins.cbFeed.numNotifications>0){if(CRPK.plugins.cbFeed.unseenNotifications===!1){CRPK.plugins.cbFeed.unseenNotifications=CRPK.plugins.cbFeed.news.getUnseenItems()+CRPK.plugins.cbFeed.rwAnnouncer.getUnseenItems()}var cbFeed=$j('#cbFeed'),container=$j('#cbFeed> em.cbFeedNotify');cbFeed.removeClass('notifyOn');if(!forced&&CRPK.plugins.cbFeed.unseenNotifications>0){cbFeed.addClass('notifyOn')}if(!container.exists()){container=$j('<em class="cbFeedNotify"></em>').appendTo(cbFeed)}container.html(' '+CRPK.plugins.cbFeed.numNotifications+' <span>'+NBSP+'</span>');if(!forced&&CRPK.plugins.cbFeed.unseenNotifications>0){if(typeof(Tinycon)!=_u){Tinycon.setBubble(erepublik.settings.notifications+CRPK.plugins.cbFeed.numNotifications)}}}},show:function(){CRPK.plugins.cbFeed.init();LS.set('cbFeedTimestamp',{ts:now(),day:getinfo('day')});$j('#show_friends_feed,#show_regiment_feed,#show_facebook_feed,#show_party_feed').removeClass('active').click(function(){$j('#cbFeed').parent().removeClass('active')});$j('#cbFeed').parent().addClass('active');$j('#citizen_feed > div.inner > div.shouter, #citizen_older_feeds, #fbWall').hide();$j('#citizen_feed').removeClass('show_daily_order');var container=$j('#citizen_feed > div.inner > div.wall_post_list > ul');container.hide().empty().append(CRPK.plugins.cbFeed.getContent).fadeIn('fast');erepublik.functions.angularCompileAjaxGeneratedContent(container)},getContent:function(){var news=CRPK.plugins.cbFeed.news.getPosts(),rwAnnouncements=CRPK.plugins.cbFeed.rwAnnouncer.getPosts(),keyType=[],scriptInfo,scriptVersion='',scriptInfoPost,posts;if(has_auth_key_()){if(is_valid_auth_key_('tank')){keyType.push('Tank')}if(is_valid_auth_key_('mod')){keyType.push('CP/MoD')}if(is_valid_auth_key_('mailer')){keyType.push('Mass Mailer')}if(is_valid_auth_key_('snatch')){keyType.push('Economy')}}if(keyType.length){scriptInfo='Registered (payed) modules: '+keyType.join(', ')+'; '}else{scriptInfo='You are using the free version; '+'See '+help_link('advanced features')+'; '+'<a href="'+EREP.url+'/main/messages-compose/'+SELLER_DEVID+'">Buy script </a>'}scriptInfo+='<br>'+help_link('Help')+' | '+trac_link('Report a bug');if(CRPK.vars._.SCRIPT_VERSION){var ts=new Date(seconds(CRPK.vars._.SCRIPT_VERSION));scriptVersion='Updated: '+[ts.getDate(),ts.toLocaleString('en',{month:'short'}),ts.getFullYear()].join('-')}scriptInfoPost=CRPK.plugins.cbFeed.createPost('[CB] eRepublik',scriptInfo,'heading',scriptVersion);posts=[].concat(rwAnnouncements).concat(news).concat([scriptInfoPost]);return posts.join('')},createPost:function (title,content,type,timestamp,image,postLink){var post;post='<li class="wall_post cbFeed '+(type?type:'')+'">'+'<a href="'+(postLink?postLink:EREP.profile(DEVID))+'" class="user_pic" target="_blank">'+'<span></span>'+'<img src="'+(image?image:SCRIPT_IMAGES+'cb-icon-64.png')+'">'+'</a>'+'<div class="post_content">'+(title?'<h6>'+title+'</h6>':'')+'<p>'+content+'</p>'+'</div>'+(timestamp?'<q class="timestamp"><i class="fa fa-clock-o"></i> '+timestamp+'</q>':'')+'</li>';return post},getTimeAgo:function (dateString){var date=getTimeFromString(dateString),seconds=Math.floor((new Date()-date)/1000),minutes=Math.floor(seconds/60);if(minutes>1){return minutes+' minutes ago'}return Math.floor(seconds)+' seconds ago'},oneTimeBindings:function(){$j(document).on('click','#show_regiment_feed',function(){$j(document).ajaxSuccess(function (e,xhr,opts){if(instr(opts.url,'main/group-wall/older')){CRPK.plugins.cbFeed.init(true)}})});$j(document).on('click','#citizen_feed > div.inner > div.wall_post_list > ul > li.wall_post.cbFeed.rwAnnouncer > div > p > a.rwAnnouncerTravel',function (event){event.preventDefault();var regionId=intval($j(this).data('region_id'),0);if(!regionId){return}TRAVEL.triggerPopup({'regionId':regionId})});if(CRPK.plugins.cbFeed.rwAnnouncer.enabled()&&is_valid_auth_key_('mod')){$j(document).on('click','#citizen_feed > div.inner > div.wall_post_list > ul > li.wall_post.cbFeed.rwAnnouncer > a.user_pic,'+'#citizen_feed > div.inner > div.wall_post_list > ul > li.wall_post.cbFeed.rwAnnouncer > div > p > a.rwAnnouncerMod',function (event){event.preventDefault();var form=$j('#rwAnnouncerModForm');if(!form.exists()){form=$j('<form id="rwAnnouncerModForm" method="POST" action="'+http_s('erpk.bularca.ro/Firebase/rwAnnouncer/')+'" target="_blank" style="display:none"><input type="hidden" name="_key" value="'+auth_key_()+'"></form>');form.appendTo('body')}form.submit()})}},getFeedLastSeen:function(){return LS.get('cbFeedTimestamp',{ts:0,day:0})},news:{numItems:false,unseenItems:false,dayLimit:3,getNumItems:function(){if(CRPK.plugins.cbFeed.news.numItems===!1){CRPK.plugins.cbFeed.news.numItems=CRPK.plugins.cbFeed.news.getData().length}return CRPK.plugins.cbFeed.news.numItems},getUnseenItems:function(){if(CRPK.plugins.cbFeed.news.unseenItems===!1){var lastSeen,numItems=CRPK.plugins.cbFeed.news.getNumItems();if(numItems>0){lastSeen=CRPK.plugins.cbFeed.getFeedLastSeen();if(lastSeen.day){numItems=CRPK.plugins.cbFeed.news.getData().filter(function (item){return item.day>lastSeen.day}).length}}CRPK.plugins.cbFeed.news.unseenItems=numItems}return CRPK.plugins.cbFeed.news.unseenItems},getData:function(){var data=[];if(CRPK.plugins.cbFeed.newsItems.length){var dayLimit=getinfo('day')-CRPK.plugins.cbFeed.news.dayLimit;data=CRPK.plugins.cbFeed.newsItems.filter(function (item){return item.day>=dayLimit})}return data},getPosts:function(){var newsItems=CRPK.plugins.cbFeed.news.getData(),posts=[],today=getinfo('day'),i,item,timestamp,post;for (i = 0; i < newsItems.length; i++){item=newsItems[i];if(item.day==today){timestamp='Today'}else{timestamp='Day '+item.day}post=CRPK.plugins.cbFeed.createPost(item.title,item.content,'newsItem',timestamp);if(item.pinned){posts.unshift(post)}else{posts.push(post)}}return posts}},rwAnnouncer:{numItems:false,unseenItems:false,rwDefaults:{countryId:62,regionId:5,regionName:'Region Name',priceToOpen:2500,payerCitizenId:2,payerCitizenshipId:30,payerCitizenName:'Plato',createdAt:(new Date()).toUTCString(),addedAt:now()},cacheDefaults:{ts:0,list:[]},cacheTTL:minutes(5),cache:null,valid_modKEY:false,jsonEndpoint:https('cb-erepublik.firebaseio.com/rwAnnouncer.json'),isEnabled:null,enabled:function(){if(CRPK.plugins.cbFeed.rwAnnouncer.isEnabled===null){CRPK.plugins.cbFeed.rwAnnouncer.isEnabled=OPTS.get('feed-rwAnnouncer', 'Alerts',1)}return!0},getNumItems:function(){if(CRPK.plugins.cbFeed.rwAnnouncer.numItems===!1){if(!CRPK.plugins.cbFeed.rwAnnouncer.enabled()){CRPK.plugins.cbFeed.rwAnnouncer.numItems=0;return CRPK.plugins.cbFeed.rwAnnouncer.numItems}CRPK.plugins.cbFeed.rwAnnouncer.numItems=CRPK.plugins.cbFeed.rwAnnouncer.getData().length}return CRPK.plugins.cbFeed.rwAnnouncer.numItems},getUnseenItems:function(){if(CRPK.plugins.cbFeed.rwAnnouncer.unseenItems===!1){if(!CRPK.plugins.cbFeed.rwAnnouncer.enabled()){CRPK.plugins.cbFeed.rwAnnouncer.unseenItems=0;return CRPK.plugins.cbFeed.rwAnnouncer.unseenItems}var lastSeen,numItems=CRPK.plugins.cbFeed.rwAnnouncer.getNumItems();if(numItems>0){lastSeen=CRPK.plugins.cbFeed.getFeedLastSeen();if(lastSeen.ts){numItems=CRPK.plugins.cbFeed.rwAnnouncer.getData().filter(function (item){return item.addedAt>lastSeen.ts||getTimeFromString(item.createdAt)>lastSeen.ts}).length}}CRPK.plugins.cbFeed.rwAnnouncer.unseenItems=numItems}return CRPK.plugins.cbFeed.rwAnnouncer.unseenItems},getPosts:function(){if(!CRPK.plugins.cbFeed.rwAnnouncer.enabled()){return []}var annoucements=CRPK.plugins.cbFeed.rwAnnouncer.getData(),data=[],i,item,rwCountry,payerCountry,title,content,timestamp,post,image='/images/icons/alerts/military_42.gif',postLink=https('erpk.bularca.ro/Firebase/rwAnnouncer/');for (i = 0; i < annoucements.length; i++){item=$j.extend({},CRPK.plugins.cbFeed.rwAnnouncer.rwDefaults,annoucements[i]);if(!item.countryId||!item.regionId||!item.priceToOpen||!item.payerCitizenId){continue}rwCountry=COUNTRIES.get(item.countryId);payerCountry=COUNTRIES.get(item.payerCitizenshipId);title='RW Supporters wanted';timestamp=CRPK.plugins.cbFeed.getTimeAgo(item.createdAt);content=(item.payerCitizenId==2?'THIS IS A TEST !<br>':'')+'<img src="/images/flags_png/S/'+payerCountry.url+'.png"> '+'<a href="'+EREP.profile(item.payerCitizenId)+'" hovercard>'+item.payerCitizenName+'</a>'+' is offering <b>'+item.priceToOpen+'cc</b> for RW Supporters in<br>'+'<img src="/images/flags_png/S/'+rwCountry.url+'.png"> '+'<a href="'+VOID+'" class="rwAnnouncerTravel" data-region_id="'+item.regionId+'">'+item.regionName+', '+rwCountry.display+'</a>'+(item.payerCitizenId==2?'<br>THIS IS A TEST !<br>':'');post=CRPK.plugins.cbFeed.createPost(title,content,'rwAnnouncer',timestamp,image,postLink);data.push(post)}if(is_valid_auth_key_('mod')){data.push(CRPK.plugins.cbFeed.createPost('Announce new Resistance War','<a href="'+https('erpk.bularca.ro/Firebase/rwAnnouncer/')+'" class="rwAnnouncerMod">Go to RW Announcer</a>','rwAnnouncer',!1,image,postLink))}return data},getData:function(){if(CRPK.plugins.cbFeed.rwAnnouncer.cache===null){var cache=LS.get('rwAnnouncer',CRPK.plugins.cbFeed.rwAnnouncer.cacheDefaults);if(cache&&cache.ts&&!timestamp_expired(cache.ts,CRPK.plugins.cbFeed.rwAnnouncer.cacheTTL)){CRPK.plugins.cbFeed.rwAnnouncer.cache=cache}else{CRPK.plugins.cbFeed.rwAnnouncer.cache=CRPK.plugins.cbFeed.rwAnnouncer.cacheDefaults;LS.set('rwAnnouncer',CRPK.plugins.cbFeed.rwAnnouncer.cacheDefaults)}if(false&&dev_()&&!CRPK.plugins.cbFeed.rwAnnouncer.cache.list.length){CRPK.plugins.cbFeed.rwAnnouncer.cache.list=[CRPK.plugins.cbFeed.rwAnnouncer.rwDefaults,CRPK.plugins.cbFeed.rwAnnouncer.rwDefaults,CRPK.plugins.cbFeed.rwAnnouncer.rwDefaults]}}return CRPK.plugins.cbFeed.rwAnnouncer.cache.list},fetchData:function (forced){if(!CRPK.plugins.cbFeed.rwAnnouncer.enabled()){return!1}var cache=LS.get('rwAnnouncer',CRPK.plugins.cbFeed.rwAnnouncer.cacheDefaults);if(!forced&&cache&&cache.ts&&!timestamp_expired(cache.ts,CRPK.plugins.cbFeed.rwAnnouncer.cacheTTL)){return!1}$j.getJSON(CRPK.plugins.cbFeed.rwAnnouncer.jsonEndpoint).then(function (response){if(response&&typeof (response)=='object'&&response.hasOwnProperty('updatedAt')){var rwAnnouncerLS=$j.extend({},CRPK.plugins.cbFeed.rwAnnouncer.cacheDefaults);rwAnnouncerLS.ts=now();if(typeof(response.list)!=_u&&Object.keys(response.list).length>0){var createdAt=getTimeFromString(response.updatedAt);if(createdAt+seconds(response.ttl)>now()){for (var key in response.list){if(response.list.hasOwnProperty(key)){rwAnnouncerLS.list.push($j.extend({},CRPK.plugins.cbFeed.rwAnnouncer.rwDefaults,response.list[key]))}}}}LS.set('rwAnnouncer',rwAnnouncerLS)}});return!0}},headHunter:{enabled:function(){return!0},getNumItems:function(){return 0},getPosts:function(){return []}},fetchData:function(){var lastUserAction=LS.get('lastUserAction',0);if(!_LUA_.isAwake()){console.log('User inactive. cbFeed.fetchData() aborted.');return!1}if(CRPK.plugins.cbFeed.rwAnnouncer.enabled()){CRPK.plugins.cbFeed.rwAnnouncer.fetchData()}}};PLUGINS['cbFeed']={f:CRPK.plugins.cbFeed.init,p:false};OPTS.register('feed-rwAnnouncer', 'Enable RW Supporter announcements', 'Alerts',1)}}catch (pluginError){console.error('Plugin load ERROR');debug_(pluginError);hasPluginError = true};try{/*============ Plugin: CRPK.sbox Library*/(CRPK||(CRPK={})).sbox={flist:false,nlist:[],list:[],ac_bound:false,init:function(){if(!isLoggedIn()){return}if(!LS.check('SBOX_LIST')||LS.get('SBOX_FCHECK')<(getinfo('day')-7)){CRPK.sbox.get_friends()}if(is_page('/citizen/profile/')&&!is_page('my_profile')){var _citizen_actions=$j('#content .citizen_actions a'),citizen_UID=intval(_URL_.split('/profile/')[1]);if(!_citizen_actions.find('.action_friend').exists()){CRPK.sbox.friends_list(false);var cname=$j('#content img.citizen_avatar').attr('alt');if(typeof(CRPK.sbox.flist[cname])==_u){CRPK.sbox.flist[cname]=citizen_UID;LS.set('SBOX_LIST',CRPK.sbox.flist)}}}if(!OPTS.get('advanced-search-box')){return}$j('#search label').remove();$j('#search_field').unbind().attr({value:'',placeholder:'Search citizen'}).keydown(function (e){if(e.which==KEYS.ENTER){if(CRPK.sbox.gto()){e.preventDefault()}else{$j('#search').submit()}}}).click(function(){if(CRPK.sbox.ac_bound){return}CRPK.sbox.ac_bound=!0;CRPK.sbox.friends_list();$j(this).autocomplete(CRPK.sbox.nlist,{minChars:1,max:10,autoFill:false,scrollHeight:220,highlight:false,selectFirst:true}).bind('result',function(){CRPK.sbox.gto()})})},gto:function (uid){if(!uid){var _sfor=$j('#search_field').val().toLowerCase();if(!_sfor||!CRPK.sbox.flist){return!1}for (var name in CRPK.sbox.flist){if(!CRPK.sbox.flist.hasOwnProperty(name)){continue}if(name.toLowerCase()==_sfor){uid=CRPK.sbox.flist[name];break}}}if(uid){if(is_page('economy/donate-money')){gto(EREP.url+'/economy/donate-money/'+uid)}else if(is_page('economy/donate-items')){gto(EREP.url+'/economy/donate-items/'+uid)}else{gto(EREP.profile(uid))}return!0}return!1},friends_list:function (skip_names){if(CRPK.sbox.flist){return}if(LS.check('SBOX_LIST')){CRPK.sbox.flist=LS.get('SBOX_LIST')}else{CRPK.sbox.flist=CRPK.sbox.get_friends()}if(true===skip_names){return}for (var name in CRPK.sbox.flist){if(!CRPK.sbox.flist.hasOwnProperty(name)){continue}CRPK.sbox.list.push({value:name,name:name,id:CRPK.sbox.flist[name]});CRPK.sbox.nlist.push(name)}},get_friends:function(){var _list=LS.check('SBOX_LIST')?LS.get('SBOX_LIST'):{};if(_PLAYER_.isORG()){LS.set('SBOX_LIST',_list);LS.set('SBOX_FCHECK',getinfo('day'));return _list}$j.ajax({url:EREP.url+'/main/messages-compose/0',async:false,success:function (response){response=JSON.parse(response.split('$j("#citizen_name").tokenInput(')[1].split('], {')[0]+']');for (var i = 0; i < response.length; i++){_list[response[i].name]=intval(response[i].id)}response=null;LS.set('SBOX_LIST',_list);LS.set('SBOX_FCHECK',getinfo('day'))}});return _list}};}catch (pluginError){console.error('Plugin load ERROR');debug_(pluginError);hasPluginError = true};try{/*============ Plugin: CRPK.vcards Library*/if(typeof(CB_EREP_LIBRARY_LOADED)!=_u){(CRPK||(CRPK={})).vcards={init:function(){if(!OPTS.get('enable-vcards')||is_page('battlefield')||is_page('leaderboards')){return!1}_BG_.add('vcard-cleanup',CRPK.vcards.ls_cleanup,hours(2));$j('html,body').click(function(){CRPK.vcards.hide()});$j(document).ajaxSuccess(function(){setTimeout(function(){CRPK.vcards.bind()},600)});CRPK.vcards.bind()},bind:function(){var selector;if(1==2&&is_page('battlefield-new')){selector='#content a:not([hovercard])[href*="/citizen/profile/"]'}else{selector='#content a:not([hovercard]):not(.vcard-bound)[href*="/citizen/profile/"]'}CRPK.vcards.bind_elems(selector)},bind_elems:function (elems){$j(elems).addClass('vcard-bound').hoverIntent({interval:200,sensitivity:6,over:CRPK.vcards.show,out:function(){},timeout:1000})},defaults:{uid:2,a:0,cs:1,d:1,dph:1,adph:1,e:1,f:0,isf:0,gm:0,l:1,loc:1,mu:{id:0,a:0,n:0,p:0},n:'',o:0,p:0,r:'private_0',s:0,a_r:'airman_0',a_s:0,a_d:DEFAULT_AIRFORCE_DIVISION,ts:0},hide:function(){CRPK.vcards.jay().removeClass('show')},show:function (event){var page_posX=event.pageX,page_posY=event.pageY-$j(window).scrollTop(),top=0,left=0,arrow_posX='left',arrow_posY='bottom',element=$j(this),vcard=CRPK.vcards.jay();if(page_posY<160){top=element.offset().top+20;left=(is_page('battlefield-new')?page_posX:element.offset().left)-30;arrow_posX='left';arrow_posY='top'}else{top=element.offset().top-10-150;left=(is_page('battlefield-new')?page_posX:element.offset().left)-30;arrow_posX='left';arrow_posY='bottom'}CRPK.vcards.reset_html();vcard.css({top:top+'px',left:left+'px'}).addClass('arrow-'+arrow_posX+' arrow-'+arrow_posY+' show loading');var uid=$j(this).attr('href').split('/profile/')[1];if(!CRPK.vcards.has_cached_data(uid)){if(!vcard.hasClass('loading-'+uid)){vcard.addClass('loading-'+uid);CRPK.vcards.fetch_data(uid,$j(this))}return!1}CRPK.vcards.create(uid,$j(this))},create:function (uid){var vcard=CRPK.vcards.jay();vcard.removeClass('loading loading-'+uid).addClass('show');CRPK.vcards.update_html(CRPK.vcards.get_cached_data(uid))},reset_html:function(){CRPK.vcards.jay().removeAttr('class');CRPK.vcards.jay().find('.vcard-mu-name, .vcard-mu-position, .vcard-cs-name, .vcard-loc-name,.vcard-name,.vcard-friends').text('');CRPK.vcards.jay().find('a').attr('href',VOID);CRPK.vcards.jay().find('img').attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACklEQVR4nGMAAQAABQABDQottAAAAABJRU5ErkJggg==');$j('#vcard-toggle-friend').removeClass('add remove pending')},update_html:function (data){if(!data){return!1}var vcard=CRPK.vcards.jay(),classes=['uid-'+data.uid,data.r,data.a_r,'div'+data.d],citizenship=COUNTRIES.get(data.cs),location=!1;if(data.cs!=data.loc){location=COUNTRIES.get(data.loc)}if(data.dd){classes.push('dead')}if(data.b){classes.push('banned','banned-'+data.b)}if(data.e){classes.push('elite')}if(data.gm){classes.push('game-mod-'+data.gm)}vcard.find('.vcard-damage-strength .vcard-damage').text(cb_number_format(data.dph));vcard.find('.vcard-damage-strength .vcard-strength').text(cb_number_format(data.s));if(!data.mu||!data.mu.id){classes.push('no-mu');vcard.find('.vcard-mu-name').text('No Military Unit')}else{vcard.find('.vcard-mu').attr('href',EREP.url+'/military/military-unit/'+data.mu.id);vcard.find('.vcard-mu-name').text(data.mu.n);vcard.find('.vcard-mu-avatar').attr('src',EREP.cdnt+data.mu.a);if(data.mu.p){vcard.find('.vcard-mu-position').text(data.mu.p);classes.push('mu-'+data.mu.p.toLowerCase().replace(/ /g,''))}}vcard.find('.vcard-cs').attr('title','Citizenship: '+citizenship.display);vcard.find('.vcard-cs-flag').attr('src','/images/flags_png/M/'+citizenship.url+'.png');vcard.find('.vcard-cs-name').text(citizenship.display);if(location){vcard.find('.vcard-loc').attr('title','Current Location: '+location.display);vcard.find('.vcard-loc-flag').attr('src','/images/flags_png/S/'+location.url+'.png');vcard.find('.vcard-loc-name').text(location.display)}if(data.p){vcard.find('.vcard-political-title').text(data.p);classes.push('political-title-'+(data.p.toLowerCase().replace(/ /g,'-')))}if(data.n.length>18){classes.push('name-font-11')}else if(data.n.length>10){classes.push('name-font-12')}vcard.find('.vcard-name').attr('href',EREP.url+'/citizen/profile/'+data.uid).text(data.n);vcard.find('.vcard-avatar').attr('href',EREP.url+'/citizen/profile/'+data.uid);if(data.a){vcard.find('.vcard-avatar img').attr('src',EREP.cdnt+data.a)}vcard.find('.vcard-friends').attr('href',EREP.url+'/main/citizen-friends/'+data.uid).text(data.f);vcard.find('.vcard-donate-items').attr('href',EREP.url+'/economy/donate-items/'+data.uid);vcard.find('.vcard-donate-money').attr('href',EREP.url+'/economy/donate-money/'+data.uid);vcard.find('.vcard-send-message').attr('href',EREP.url+'/main/messages-compose/'+data.uid);var toggle_friend=$j('#vcard-toggle-friend');if(data.isf){if(1==data.isf){toggle_friend.addClass('remove').attr('title','Remove Friend').data('vcard-citizen-id',data.uid)}else if(2==data.isf){toggle_friend.addClass('pending').attr('title','Friend request pending').data('vcard-citizen-id',data.uid)}}else{toggle_friend.addClass('add').attr('title','Add Friend').data('vcard-citizen-id',data.uid)}vcard.addClass(classes.join(' '))},has_cached_data:function (uid){return LS.check('vcard-uid-'+uid)},get_cached_data:function (uid){if(LS.check('vcard-uid-'+uid)){return LS.get('vcard-uid-'+uid,CRPK.vcards.defaults)}return CRPK.vcards.defaults},set_cache_data:function (uid,data){LS.set('vcard-uid-'+uid,$j.extend(CRPK.vcards.defaults,data));return!0},fetch_data:function (uid,element){$j.ajax({url:EREP.profile(uid),global:false,success:function (page){page=$j('<div'+(page.split('<div id="content"')[1].split('<div id="footer"')[0]));var is_dictator=page.find('div.citizen_profile_header>h2.dictator').exists(),is_dead=(page.find('div.citizen_profile_header.auth>div.citizen_state>div.is>span>img[src*="dead_citizen.png"]').exists()?1:0),is_banned=page.find('div.citizen_profile_header.auth>div.citizen_state>div.is.tip');if(is_banned.exists()){is_banned=is_banned.find('span').text().trim().replace(' banned','')}else{is_banned=0}var data={uid:uid,a:page.find('.citizen_profile_header .citizen_avatar').css('background-image'),b:is_banned,dd:is_dead,cs:COUNTRIES.get(page.find('.citizen_info a[href*="/country/society/"]').eq(1).attr('href').split('/country/society/')[1],'id'),e:page.find('.top_player').exists()?1:0,f:intval(page.find('.citizen_sidebar a[href*="friends/'+uid+'"]').text().trim().replace('Friends (','').replace(')',''),0),isf:page.find('a.action_friend_remove').exists()?1:0,gm:intval((page.find('span[class^="game_mod"]').attr('class')||'0').replace('game_mod','')),l:intval(page.find('.citizen_profile_header .citizen_level').text().trim()),loc:COUNTRIES.get(page.find('.citizen_info a[href*="/country/society/"]').eq(0).attr('href').split('/country/society/')[1],'id'),n:page.find('.citizen_profile_header h2').eq(0).textNodes().text().trim(),p:is_dictator?'Dictator':page.find('.citizen_sidebar h3:first').text().trim(),r:page.find('img[src*="images/modules/ranks/"]').first().attr('src').split('/ranks/')[1].replace('.png',''),s:intval(page.find('#str_progress').next().text().trim(),1),a_r:page.find('img[src*="images/modules/ranks/"]').last().attr('src').split('/ranks/')[1].replace('.png',''),a_s:intval(page.find('#perception_progress').next().text().trim(),0),ts:now()};data.a=instr(data.a,'default_')?0:EREP.avatar_static(data.a).split('erepublik.net')[1];data.d=(data.l>=70?4:(data.l>=50?3:(data.l>=35?2:1)));data.a_d=DEFAULT_AIRFORCE_DIVISION;if(data.p&&instr(data.p,'Minister of')){var tmp=data.p.split(' ');data.p='';for (var i = 0; i < tmp.length; i++){data.p+=tmp[i][0]}}else if(!data.p||instr(data.p,'political activity')||instr(data.p,'Party')){data.p=0}data.dph=calc_dph(data.s,page.find('div.citizen_military_box_wide:first > span.rank_name_holder > a').text().trim(),data.l,TANK_MAX_WEAPON_Q,!1);data.a_dph=calc_dph(data.a_s,page.find('div.citizen_military_box_wide:last > span.rank_name_holder > a').text().trim(),data.l,AIRFORCE_MAX_WEAPON_Q,!0);var mu=page.find('.citizen_sidebar a[href*="/military/military-unit/"]');if(mu.exists()){data.mu={id:intval(mu.attr('href').split('/military/military-unit/')[1].split('?')[0]),a:mu.find('img').attr('src').split('erepublik.net')[1],n:mu.find('span').text().trim(),p:mu.parents('div.place').find('h3').text().trim()};if(empty(data.mu.p)){data.mu.p=0}}CRPK.vcards.set_cache_data(uid,data);CRPK.vcards.create(uid,element)}});return!0},_j:false,jay:function (forced){forced=!!forced;if(forced||!CRPK.vcards._j){if(forced){$j('#vcard').remove()}CRPK.vcards._j=$j('<div id="vcard"></div>');CRPK.vcards._j.append('<div class="vcard-arrow"></div><div class="vcard-loading"><div class="fbload"><b class="cb-icon-24"></b></div></div><div class="vcard-inner">'+'<div class="vcard-top">'+'<div class="vcard-cs">'+'<img class="vcard-cs-flag" />'+'<span class="vcard-cs-name"></span>'+'</div>'+'<div class="vcard-loc">'+'<img class="vcard-loc-flag" />'+'<span class="vcard-loc-name"></span>'+'</div>'+'<div class="vcard-political-title"></div>'+'<div class="vcard-rank"></div>'+'<div class="vcard-rank-name"></div>'+'<div class="vcard-division"></div>'+'<div class="vcard-damage-strength"><b class="vcard-damage">0</b><sup class="vcard-per-hit"></sup><div class="vcard-strength">0</div></div>'+'<a class="vcard-mu">'+'<img class="vcard-mu-avatar" />'+'<span class="vcard-mu-position"></span>'+'<span class="vcard-mu-name">No Military Unit</span>'+'</a>'+'</div>'+'<div class="vcard-middle">'+'<a class="vcard-avatar"><img /></a>'+'<a class="vcard-name"></a>'+'<a class="vcard-friends">0</a>'+'<div class="vcard-elite" title="Elite Citizen (+10% Damage)"></div>'+'<div class="vcard-game-mod" title="Game Mod"></div>'+'<div class="vcard-dictator" title="Dictator"></div>'+'</div>'+'<div class="vcard-bottom">'+'<a id="vcard-toggle-friend" class="" data-vcard-citizen-id=""><i></i></a>'+'<a class="vcard-send-message" title="Send Message"><i></i></a>'+'<a class="vcard-donate vcard-donate-money" title="Donate Money"><i></i></a>'+'<a class="vcard-donate vcard-donate-items" title="Donate Items"><i></i></a>'+'</div>'+'</div>');CRPK.vcards._j.appendTo('body').on('mouseout',function(){CRPK.vcards.hide()});$j('#vcard-toggle-friend').click(function(){CRPK.vcards.toggle_friend()})}return CRPK.vcards._j},toggle_friend:function(){var toggle=$j('#vcard-toggle-friend'),redisable_alerts=!1,citizenID=toggle.data('vcard-citizen-id')?intval(toggle.data('vcard-citizen-id'),0):0;if(!citizenID||!(toggle.hasClass('add')||toggle.hasClass('remove'))){return!1}if(alerts_are_disabled()){redisable_alerts=!0;enable_alerts()}if(toggle.hasClass('remove')&&!confirm('Remove {'+(toggle.parent().parent().find('a.vcard-name').text())+'} from friends ?')){return!0}if(redisable_alerts){disable_alerts()}toggle.css('opacity','0.5');$j.ajax({url:(EREP.base+'/citizen/friends/'+(toggle.hasClass('remove')?'remove':'add')+'/'+citizenID),type:'POST',global:false,data:{_token:getinfo('token')},complete:function(){var toggle=$j('#vcard-toggle-friend'),new_state,data;toggle.css('opacity','1');if(toggle.hasClass('remove')){toggle.removeClass('remove').addClass('add').attr('title','Add Friend');new_state=0}else if(toggle.hasClass('add')){toggle.removeClass('add').addClass('pending').attr('title','Friend request pending');new_state=2}clog('new state: '+new_state);if(CRPK.vcards.has_cached_data(citizenID)){data=CRPK.vcards.get_cached_data(citizenID);data.isf=new_state;CRPK.vcards.set_cache_data(citizenID,data)}}})},ls_cleanup:function (forced){var now=((new Date()).getTime()),last_cleanup=LS.get('vcard-cleanup');forced=!!forced;if(!forced&&last_cleanup+days(1)>now){return!1}for (var i = localStorage.length - 1; i >= 0; i--){var key=localStorage.key(i),value=null;if(instr(key,'ERPK___vcard-uid-')){localStorage.removeItem(key);continue}if(!instr(key,'ERPK___vcard-uid-')){continue}try{value=JSON.parse(localStorage.getItem(key))}catch(e){}if(value&&value.ts&&value.ts+2*DAYS>now){continue}localStorage.removeItem(key)}LS.set('vcard-cleanup',now);return!0}}}}catch (pluginError){console.error('Plugin load ERROR');debug_(pluginError);hasPluginError = true};try{/*============ Plugin: AUTO Library*/if(typeof(CB_EREP_LIBRARY_LOADED)!=_u){OPTS.register('awto.t','Auto Train','Auto',1);OPTS.register('awto.w','Auto Work','Auto',0);OPTS.register('aovertime','Auto Work Overtime','Auto',getinfo('level')>=70?1:0);OPTS.register('automm','Auto buy 10g/day from MM','Auto',0);OPTS.register('autogb','Auto collect {invited friends} gold','Auto',1);OPTS.register('autowam','Auto Work as manager','Auto',0);OPTS.register('autowamtravel','Travel to Holdings for Work as manager','Auto',0);OPTS.register('autoemployees','Auto Assign Employees','Auto',0);CRPK.plugins.AUTO={debug:false,today:0,_:{wto:{train:{day:0,has_captcha:0,trained:0,id:[]},work:{day:0,has_captcha:0,employee:0,worked:0,has_gp:0,gp_worked:0,tickets:0,timer:0,ts:now()}},mm:{day:0,bought:0,limit:10},gb:{day:0},employees:{day:0,success:false,message:''},wam:{day:0,worked:[],success:false,message:''}},init:function(){'use strict';if(_PLAYER_.isORG()){return!1}CRPK.plugins.AUTO.debug=window.DEBUG;CRPK.plugins.AUTO.today=getinfo('day');var ls=LS.get('auto',{});if(!ls.wto||!ls.wto.train||!ls.wto.train.day||ls.wto.train.day!=CRPK.plugins.AUTO.today){LS.del('auto')}$j.extend(CRPK.plugins.AUTO._,LS.get('auto',{}));debug_log(CRPK.plugins.AUTO.debug,'CRPK.plugins.AUTO','init()',CRPK.plugins.AUTO._);if(OPTS.get('awto','Auto')){OPTS.set('awto.t','Auto',1);OPTS.set('awto.w','Auto',1)}if(is_page('home')&&OPTS.get('automm','Auto')&&getinfo('cc')>10000){CRPK.plugins.AUTO.mm.init()}if((OPTS.get('awto.w','Auto')||OPTS.get('awto.t','Auto')||OPTS.get('aovertime','Auto'))&&(is_page('home')||is_page(EREP.companies)||is_page(EREP.train))){CRPK.plugins.AUTO.wto.init()}if(is_page('home')&&OPTS.get('autogb','Auto')&&CRPK.plugins.AUTO._.gb.day!=CRPK.plugins.AUTO.today){CRPK.plugins.AUTO.gb.init()}if(is_page(EREP.companies)){var anchor=$j('#content>div.manager_dashboard>div.list>div.area>div.listing_holder>div.list_group>div.companies_group:first-of-type');if(anchor.exists()){$j('<div id="cbAutoWorkOptions"></div>').appendTo(anchor);CRPK.plugins.AUTO.employees.presets();CRPK.plugins.AUTO.wam.presets()}}if(is_page('home')&&OPTS.get('autowam','Auto')&&CRPK.plugins.AUTO._.wam.day!=CRPK.plugins.AUTO.today){CRPK.plugins.AUTO.update_status('wam',{day:0,worked:[],success:-1});setTimeout(function(){CRPK.plugins.AUTO.wam.init()},seconds(30))}else if(OPTS.get('autoemployees','Auto')&&CRPK.plugins.AUTO._.employees.day!=CRPK.plugins.AUTO.today){CRPK.plugins.AUTO.update_status('employees',{day:0,success:-1});CRPK.plugins.AUTO.employees.init()}return!0},get_status:function (key){'use strict';return CRPK.plugins.AUTO._[key]},update_status:function (key,data){'use strict';var status=$j.extend({},CRPK.plugins.AUTO._,LS.get('auto',{}));if(typeof(key)=='string'&&typeof(data)=='object'){$j.extend(status[key],data)}LS.set('auto',status);debug_log(CRPK.plugins.AUTO.debug,'CRPK.plugins.AUTO.update_status',key,data,status);return status},wto:{init:function(){'use strict';debug_log(CRPK.plugins.AUTO.debug,'CRPK.plugins.AUTO.wto','init()');var wto_status=CRPK.plugins.AUTO._.wto,today=CRPK.plugins.AUTO.today;debug_log(CRPK.plugins.AUTO.debug,'CRPK.plugins.AUTO.wto','today=',today,'wto_status',wto_status);if(OPTS.get('awto.w','Auto')||OPTS.get('awto.t','Auto')){debug_log(CRPK.plugins.AUTO.debug,'CRPK.plugins.AUTO.wto','awto=ON');if(is_page('home')){var daily_tasks=$j('#activity_boxes_daily_tasks > div.boxes.daily_tasks');if(daily_tasks.exists()){var has_error=((wto_status.train.day==CRPK.plugins.AUTO.today&&!wto_status.train.trained&&wto_status.train.has_captcha)||(wto_status.work.day==CRPK.plugins.AUTO.today&&!wto_status.work.worked&&wto_status.work.has_captcha));if(has_error){var daily_tasks_link=daily_tasks.find('a.std_global_btn.blueColor'),daily_tasks_reward_link=daily_tasks.find('a.std_global_btn.reward');daily_tasks_link.find('>span').textNodes()[1].textContent='Work / Train Error';if(daily_tasks_reward_link.exists()){daily_tasks_reward_link.find('>span').textNodes()[0].textContent='Captcha encountered'}if(!wto_status.train.trained){daily_tasks_link.attr('href',EREP.train)}}}else{if(wto_status.train.day==CRPK.plugins.AUTO.today&&!wto_status.train.trained&&wto_status.train.has_captcha){CRPK.plugins.AUTO.update_status('wto',{train:$j.extend({},CRPK.plugins.AUTO._.wto.train,{has_captcha:false,day:CRPK.plugins.AUTO.today,trained:4})})}if(wto_status.work.day==CRPK.plugins.AUTO.today&&!wto_status.work.worked&&wto_status.work.has_captcha){CRPK.plugins.AUTO.update_status('wto',{work:$j.extend({},CRPK.plugins.AUTO._.wto.work,{has_captcha:false,day:CRPK.plugins.AUTO.today,employee:1,worked:1})})}}}if(is_page(EREP.companies)){return CRPK.plugins.AUTO.wto.get_work_status()}else if(is_page(EREP.train)){return CRPK.plugins.AUTO.wto.get_train_status()}else if(wto_status.train.day!=CRPK.plugins.AUTO.today){debug_log(CRPK.plugins.AUTO.debug,'CRPK.plugins.AUTO.wto','get_train_status',wto_status.train);return CRPK.plugins.AUTO.wto.get_train_status()}else if(OPTS.get('awto.t','Auto')&&wto_status.train.day==CRPK.plugins.AUTO.today&&!wto_status.train.has_captcha&&wto_status.train.trained<4&&NRG.c()>40){debug_log(CRPK.plugins.AUTO.debug,'CRPK.plugins.AUTO.wto','train');return CRPK.plugins.AUTO.wto.train()}else if(wto_status.work.day==CRPK.plugins.AUTO.today&&wto_status.work.has_gp&&!wto_status.work.gp_worked){debug_log(CRPK.plugins.AUTO.debug,'CRPK.plugins.AUTO.wto','goldpack');return CRPK.plugins.AUTO.wto.work('goldpack')}else if(wto_status.work.day!=CRPK.plugins.AUTO.today){debug_log(CRPK.plugins.AUTO.debug,'CRPK.plugins.AUTO.wto','get_work_status',wto_status.work);return CRPK.plugins.AUTO.wto.get_work_status()}else if(OPTS.get('awto.w','Auto')&&wto_status.work.day==CRPK.plugins.AUTO.today&&!wto_status.work.has_captcha&&wto_status.work.employee&&!wto_status.work.worked&&NRG.c()>10){debug_log(CRPK.plugins.AUTO.debug,'CRPK.plugins.AUTO.wto','work');return CRPK.plugins.AUTO.wto.work()}}debug_log(CRPK.plugins.AUTO.debug,'CRPK.plugins.AUTO.aovertime settings',[OPTS.get('aovertime','Auto'),'wto_status.work.day',wto_status.work.day==CRPK.plugins.AUTO.today,'wto_status.work.employee',wto_status.work.employee,'wto_status.work.worked',wto_status.work.worked,'wto_status.work.tickets',wto_status.work.tickets,'NRG.c()',NRG.c()>10,'wto_status.work.timer',wto_status.work.timer,'new Date(wto_status.work.timer).getTime()<now()',(!wto_status.work.timer||(wto_status.work.timer&&new Date(wto_status.work.timer).getTime()<now())),'all',(OPTS.get('aovertime','Auto')&&wto_status.work.day==CRPK.plugins.AUTO.today&&wto_status.work.employee&&wto_status.work.worked&&wto_status.work.tickets>=24&&NRG.c()>10&&(!wto_status.work.timer||(wto_status.work.timer&&new Date(wto_status.work.timer).getTime()<now())))]);if(OPTS.get('aovertime','Auto')&&wto_status.work.day==CRPK.plugins.AUTO.today&&wto_status.work.employee&&wto_status.work.worked&&wto_status.work.tickets>=24&&NRG.c()>10&&(!wto_status.work.timer||(wto_status.work.timer&&new Date(wto_status.work.timer).getTime()<now()))){debug_log(CRPK.plugins.AUTO.debug,'CRPK.plugins.AUTO.wto','aovertime=ON','work(overtime)');return CRPK.plugins.AUTO.wto.work('overtime')}else if(OPTS.get('aovertime','Auto')){debug_log(CRPK.plugins.AUTO.debug,'CRPK.plugins.AUTO.wto','aovertime=ON','_BG_.add');_BG_.add('AUTO.wto.get_work_status',CRPK.plugins.AUTO.wto.get_work_status,30*MINUTES);if(timestamp_expired(wto_status.work.ts,60*MINUTES)){debug_log(CRPK.plugins.AUTO.debug,'CRPK.plugins.AUTO.wto','timestamp_expired','get_work_status');CRPK.plugins.AUTO.wto.get_work_status()}}return!0},train:function(){'use strict';var status=CRPK.plugins.AUTO._.wto.train,data={grounds:[],_token:getinfo('token')};if(status.id.length<4||status.day!=CRPK.plugins.AUTO.today){return CRPK.plugins.AUTO.wto.get_train_status()}else if(status.day==CRPK.plugins.AUTO.today&&status.trained==4){return!0}for (var i = 0; i < status.id.length; i++){data.grounds[i]={id:status.id[i],train:1}}$j.post(EREP.url+'/economy/train',data,__lambda,'json').done(function (response){if(typeof(response)=='string'){try{response=JSON.parse(response)}catch(e){}}if(response){status.has_captcha=(response.message=='captcha'?1:0);CRPK.plugins.AUTO.update_status('wto',{train:status})}CRPK.plugins.AUTO.wto.get_train_status()});return!0},work:function (work_type){'use strict';var status=CRPK.plugins.AUTO._.wto.work,work_data={_token:getinfo('token')},work_url=!1;if('goldpack'==work_type){work_url=EREP.url+'/main/collect-daily-gold/'}else{if(!status.employee||NRG.c()<10||('overtime'==work_type&&!(OPTS.get('aovertime','Auto')&&status.worked&&status.tickets>=24))){return!1}work_type=('overtime'==work_type?'workOvertime':'work');work_data.action_type=work_type;work_url=EREP.url+'/economy/'+work_type}if(!work_url){return!1}$j.post(work_url,work_data,__lambda,'json').done(function (response){if(typeof(response)=='string'){try{response=JSON.parse(response)}catch(e){}}if(instr(work_type,'work')){status.has_captcha=(response&&response.message=='captcha'?1:0)}status.ts=0;if('workOvertime'==work_type){status.tickets-=24}CRPK.plugins.AUTO.update_status('wto',{work:status});return CRPK.plugins.AUTO.wto.get_work_status()})},get_train_status:function (training_grounds){'use strict';var status=CRPK.plugins.AUTO._.wto.train;if(status.day==CRPK.plugins.AUTO.today&&status.trained>=4){return!0}if(is_page(EREP.train)){training_grounds=window['grounds']}else if(typeof(training_grounds)!='object'){$j.get(EREP.train).done(function (response){try{CRPK.plugins.AUTO.wto.get_train_status(JSON.parse(response.split('var grounds = ')[1].split('var pageDetails = ')[0].split(';')[0].trim()))}catch(e){}});return!0}if(typeof(training_grounds)!='object'){return!1}status.day=CRPK.plugins.AUTO.today;status.id=[];status.trained=0;for (var i = 0; i < training_grounds.length; i++){var tg=training_grounds[i];status.trained+=(tg.trained||!tg['default']?1:0);status.id.push(intval(tg.id))}CRPK.plugins.AUTO.update_status('wto',{train:status});if(dev_(true,!0)){return!0}return (is_page('training-grounds')||CRPK.plugins.AUTO.init())},get_work_status:function (page_details,num_tickets,has_gp,gp_worked){'use strict';var status=CRPK.plugins.AUTO._.wto.work;if(is_page(EREP.companies)){page_details=window['pageDetails'];num_tickets=$j('span.current_tickets').exists()?intval($j('span.current_tickets').text().replace('x ',''),0):0;has_gp=$j('#content div.details.hasGoldPack').exists()?1:0;gp_worked=!has_gp?0:($j('#collectDailyGoldPack').exists()?0:1)}else if(typeof(page_details)!='object'||typeof(num_tickets)!='number'){$j.get(EREP.companies).done(function (response){try{page_details=JSON.parse(response.split('var pageDetails')[1].split('var totals')[0].split(';')[0].replace('=','').trim());if(/class="current_tickets"/.test(response)){num_tickets=intval(response.split('<span class="current_tickets">x')[1].split('</span>')[0],0)}else{num_tickets=0}if(/hasGoldPack/.test(response)){has_gp=1;gp_worked=(/collectDailyGoldPack/.test(response)?0:1)}else{has_gp=0;gp_worked=0}CRPK.plugins.AUTO.wto.get_work_status(page_details,num_tickets,has_gp,gp_worked)}catch(e){debug_(e)}});return!0}if(typeof(page_details)!='object'||typeof(num_tickets)!='number'){return!1}debug_log(CRPK.plugins.AUTO.debug,'CRPK.plugins.AUTO','get_work_status()->page_details',page_details);status.day=CRPK.plugins.AUTO.today;status.ts=now();if(page_details.employee){status.employee=1;status.worked=page_details.employee['alreadyWorked']?1:0;status.timer=seconds(page_details['next_overtime_work']);status.tickets=num_tickets}status.has_gp=has_gp;status.gp_worked=gp_worked;debug_log(CRPK.plugins.AUTO.debug,'CRPK.plugins.AUTO','get_work_status()',status);CRPK.plugins.AUTO.update_status('wto',{work:status});if(dev_(true,!0)){return!0}return (is_page('myCompanies')||CRPK.plugins.AUTO.init())}},mm:{init:function(){'use strict';if(!OPTS.get('automm','Auto')||_PLAYER_.isORG()){return!1}debug_log(CRPK.plugins.AUTO.debug,'CRPK.plugins.AUTO.mm','init()');if(CRPK.plugins.AUTO._.mm.day!=CRPK.plugins.AUTO.today){CRPK.plugins.AUTO.mm.check_status()}else if(CRPK.plugins.AUTO._.mm.bought<CRPK.plugins.AUTO._.mm.limit){debug_log(CRPK.plugins.AUTO.debug,'CRPK.plugins.AUTO.mm','check_ang buy');var amount_to_buy=cb_number(CRPK.plugins.AUTO._.mm.limit-CRPK.plugins.AUTO._.mm.bought,2),params=CRPK.plugins.AUTO.mm.get_mm_offer();if(params.offerId){return CRPK.plugins.AUTO.mm.buy_from_offer(params.amount>amount_to_buy?amount_to_buy:params.amount,params.offerId)}return!1}return!0},check_status:function(){'use strict';if(_PLAYER_.isORG()){return!1}debug_log(CRPK.plugins.AUTO.debug,'CRPK.plugins.AUTO.mm.check_status');var params=CRPK.plugins.AUTO.mm.get_mm_offer(100);if(params.offerId){return CRPK.plugins.AUTO.mm.buy_from_offer(params.amount>100?100:params.amount,params.offerId)}return!1},set_status:function (amount,data){'use strict';debug_log(CRPK.plugins.AUTO.debug,'CRPK.plugins.AUTO.mm.set_status',amount,data);if(data&&data.error){if(instr(data.message,'cannot acquire more than')){CRPK.plugins.AUTO._.mm.day=CRPK.plugins.AUTO.today;CRPK.plugins.AUTO._.mm.limit=intval(data.message.split('cannot acquire more than ')[1].split(' ')[0],10);if(instr(data.message,'reached the maximum')){CRPK.plugins.AUTO._.mm.bought=CRPK.plugins.AUTO._.mm.limit}else{CRPK.plugins.AUTO._.mm.bought=cb_number(CRPK.plugins.AUTO._.mm.limit-floatval(data.message.split('cannot buy more than ')[1].split(' ')[0],0),2)}}else{var error_rx=/\d{1,2}(\.\d{1,2})?/g,numbers=data.message.match(error_rx);if(numbers.length>0){CRPK.plugins.AUTO._.mm.day=CRPK.plugins.AUTO.today;CRPK.plugins.AUTO._.mm.limit=intval(numbers[0]);if(numbers.length==1){CRPK.plugins.AUTO._.mm.bought=CRPK.plugins.AUTO._.mm.limit}else{CRPK.plugins.AUTO._.mm.bought=cb_number(CRPK.plugins.AUTO._.mm.limit-floatval(numbers[1]))}}}}else{CRPK.plugins.AUTO._.mm.bought+=amount}CRPK.plugins.AUTO.update_status('mm',CRPK.plugins.AUTO._.mm);return!0},get_mm_offer:function (min_amount){'use strict';debug_log(CRPK.plugins.AUTO.debug,'CRPK.plugins.AUTO.mm.get_mm_offer('+floatval(min_amount,0)+')');var params={offerId:0,amount:0};$j.ajax({url:EREP.url+'/economy/exchange/retrieve/',type:'POST',dataType:'json',async:false,data:{_token:getinfo('token'),personalOffers:0,page:0,currencyId:62}}).done(function (data){debug_log(CRPK.plugins.AUTO.debug,'CRPK.plugins.AUTO.mm.get_mm_offer','got data');if(data&&data['buy_mode']){debug_log(CRPK.plugins.AUTO.debug,'CRPK.plugins.AUTO.mm.get_mm_offer','got data.buy_mode');$j(data['buy_mode'].replace('src=','srcx=')).find('tr:has(td.ex_citizen)').each(function(){var row=$j(this),amount=floatval(row.find('td.ex_amount>strong>span').text()),offerID=intval(row.find('td.ex_rate>strong[id^="exchange_rate_"]').attr('id').replace('exchange_rate_',''),0);if(min_amount&&amount<min_amount){return!0}params.offerId=offerID;params.amount=amount;return!1})}});return params},buy_from_offer:function (amount,offerID){'use strict';if(!is_numeric(amount)||amount<0.01||!is_positive_int(offerID)){debug_log(CRPK.plugins.AUTO.debug,'CRPK.plugins.AUTO.mm.buy','param error',amount,offerID);return!1}debug_log(CRPK.plugins.AUTO.debug,'CRPK.plugins.AUTO.mm.buy_from_offer',amount,offerID);$j.ajax({url:EREP.url+'/economy/exchange/purchase/',type:'POST',dataType:'json',global:false,data:{_token:getinfo('token'),offerId:offerID,amount:amount,page:0,currencyId:62}}).done(function (data){CRPK.plugins.AUTO.mm.set_status(amount,data)})}},gb:{init:function(){'use strict';debug_log(CRPK.plugins.AUTO.debug,'CRPK.plugins.AUTO.gb','init()');if(CRPK.plugins.AUTO._.gb.day!=CRPK.plugins.AUTO.today){CRPK.plugins.AUTO.gb.collect_gold()}},collect_gold:function(){$j.post(EREP.url+'/main/citizen-invited-friends/1',{_token:getinfo('token')}).then(function(){CRPK.plugins.AUTO._.gb.day=CRPK.plugins.AUTO.today;CRPK.plugins.AUTO.update_status('gb',CRPK.plugins.AUTO._.gb)})}},employees:{init:function(){if(!OPTS.get('autoemployees','Auto')){return}var autoEmployeesPreset=LS.get('autoEmployeesPreset',{});if(Object.keys(autoEmployeesPreset).length<1){CRPK.plugins.AUTO._.employees.day=CRPK.plugins.AUTO.today;CRPK.plugins.AUTO._.employees.success=1;CRPK.plugins.AUTO.update_status('employees',CRPK.plugins.AUTO._.employees)}var n,f,payload=[];for (n in autoEmployeesPreset){if(!autoEmployeesPreset.hasOwnProperty(n)){continue}for (f = 0; f < autoEmployeesPreset[n].length; f++){payload.push({id:autoEmployeesPreset[n][f],employee_works:n,own_work:0})}}if(payload.length>0){$j.post('/en/economy/work',{companies:payload,action_type:'production',_token:getinfo('token')},__lambda,'json').then(function (response){if(typeof(response)=='string'){try{response=JSON.parse(response)}catch(e){}}CRPK.plugins.AUTO._.employees={day:CRPK.plugins.AUTO.today,success:(response&&response.message&&response.message===!0?1:0),message:(response&&response.message&&response.message!==!0&&response.result?response.result:'')};CRPK.plugins.AUTO.update_status('employees',CRPK.plugins.AUTO._.employees)})}},presets:function(){var wrapper=$j('#cbAutoWorkOptions');if(!wrapper.exists()){return}var autoEmployeesEnabled=OPTS.get('autoemployees','Auto'),hasPresets=LS.check('autoEmployeesPreset'),optionsHtml='<div id="cbAutoEmployeesOptions">'+cb_std_string('Auto-assign employees settings'+(autoEmployeesEnabled?' (on)':''),(autoEmployeesEnabled?'blueColor':'orangeColor')+' tinySize noPadding autoWorkButton #showAutoEmployeesOptions')+(hasPresets?cb_std_string('Apply saved Preset','blueColor tinySize noPadding autoWorkButton #cbApplyAutoEmployeesPreset'):'')+'<div class="cbAutoWorkOptionsWrap">'+'<label for="toggleAutoEmployees">'+'<input id="toggleAutoEmployees" type="checkbox"'+(autoEmployeesEnabled?' checked':'')+'> '+'Toggle Auto-assign Employees'+'</label>'+cb_std_string((hasPresets?'Update current':'Save')+' Preset','blueColor tinySize right autoWorkButton #cbSaveAutoEmployeesPreset')+'<small>Save currently assigned/worked<br />(green) Employees as Preset</small>'+'</div>'+'</div>';$j(optionsHtml).appendTo(wrapper);$j('#showAutoEmployeesOptions').click(function(){$j(this).remove();$j('#cbAutoEmployeesOptions > div.cbAutoWorkOptionsWrap').addClass('visible')});$j('#toggleAutoEmployees').change(function(){OPTS.set('autoemployees','Auto',$j(this).is(':checked')?1:0)});$j('#cbSaveAutoEmployeesPreset').click(function(){var factories=window['companies'],factoryId,numEmployees,autoEmployeesPreset={};for (factoryId in factories){if(!factories.hasOwnProperty(factoryId)||typeof(factories[factoryId]['todays_works'])==_u){continue}numEmployees=intval(factories[factoryId]['todays_works']);if(numEmployees>0){if(typeof(autoEmployeesPreset[numEmployees])==_u){autoEmployeesPreset[numEmployees]=[]}autoEmployeesPreset[numEmployees].push(intval(factoryId))}}LS.set('autoEmployeesPreset',autoEmployeesPreset);$j(this).unbind().removeClass('blueColor').addClass('disabled').find('span').text('Presets set/updated')});$j('#cbApplyAutoEmployeesPreset').click(function(){var autoEmployeesPreset=LS.get('autoEmployeesPreset',{}),numEmployees,factoryIds;if(Object.keys(autoEmployeesPreset).length<1){return}for (numEmployees in autoEmployeesPreset){if(!autoEmployeesPreset.hasOwnProperty(numEmployees)||autoEmployeesPreset[numEmployees].length<1){continue}factoryIds='#company_'+autoEmployeesPreset[numEmployees].join(',#company_');$j(factoryIds).find('[employee="'+numEmployees+'"]:not(.active)').trigger('click')}})}},wam:{init:function(){if(!OPTS.get('autowam','Auto')){return}var autoWamPreset=LS.get('autoWamPreset',{}),autoWamTravelEnabled=OPTS.get('autowamtravel','Auto'),availableEnergy=NRG.a();if(Object.keys(autoWamPreset).length<1){CRPK.plugins.AUTO._.wam={day:CRPK.plugins.AUTO.today,worked:[],success:1};CRPK.plugins.AUTO.update_status('wam',CRPK.plugins.AUTO._.wam)}if(CRPK.plugins.AUTO._.wam.day!=CRPK.plugins.AUTO.today){CRPK.plugins.AUTO._.wam.success=!1;CRPK.plugins.AUTO._.wam.worked=[];CRPK.plugins.AUTO.update_status('wam',CRPK.plugins.AUTO._.wam)}var regionId,f,payload=[],locationRegionID=getinfo('locationID'),workedRegions=0;for (regionId in autoWamPreset){if(!autoWamPreset.hasOwnProperty(regionId)){continue}if(in_array(regionId,CRPK.plugins.AUTO._.wam.worked)){workedRegions++;continue}if(regionId==locationRegionID){if(availableEnergy<10*autoWamPreset[regionId].length){console.warn('Insufficient energy to Work as Manager in region '+regionId);continue}for (f = 0; f < autoWamPreset[regionId].length; f++){payload.push({id:autoWamPreset[regionId][f],employee_works:0,own_work:1})}break}else if(autoWamTravelEnabled){TRAVEL.toRegion(regionId,!1,function(){gto(_URL_)});return}}if(payload.length>0){$j.post('/en/economy/work',{companies:payload,action_type:'production',_token:getinfo('token')},__lambda,'json').then(function (response){if(typeof(response)=='string'){try{response=JSON.parse(response)}catch(e){}}if(CRPK.plugins.AUTO._.wam.success===!1){CRPK.plugins.AUTO._.wam.success=0}CRPK.plugins.AUTO._.wam.worked.push(regionId);CRPK.plugins.AUTO._.wam.success+=(response&&response.message&&(response.message===!0||response.message==='already_worked')?1:0);if(CRPK.plugins.AUTO._.wam.worked.length==Object.keys(autoWamPreset).length){CRPK.plugins.AUTO._.wam.day=CRPK.plugins.AUTO.today}CRPK.plugins.AUTO._.wam.message=(response&&response.message&&response.message!==!0&&response.result?response.result:'');CRPK.plugins.AUTO.update_status('wam',CRPK.plugins.AUTO._.wam)})}},presets:function(){var wrapper=$j('#cbAutoWorkOptions');if(!wrapper.exists()){return}var autoWamEnabled=OPTS.get('autowam','Auto'),autoWamTravelEnabled=OPTS.get('autowamtravel','Auto'),hasPresets=LS.check('autoEmployeesPreset'),optionsHtml='<div id="cbAutoWamOptions">'+cb_std_string('Auto Work as Manager settings'+(autoWamEnabled?' (on)':''),(autoWamEnabled?'whiteColor':'orangeColor')+' tinySize noPadding #showAutoWamOptions')+(hasPresets?cb_std_string('Apply saved Preset','whiteColor tinySize noPadding autoWorkButton #cbApplyAutoWamPreset'):'')+'<div class="cbAutoWorkOptionsWrap">'+'<label for="toggleAutoWam">'+'<input id="toggleAutoWam" type="checkbox"'+(autoWamEnabled?' checked':'')+'> '+'Toggle Auto Work as Manager'+'</label>'+'<label for="toggleAutoWamTravel">'+'<input id="toggleAutoWamTravel" type="checkbox"'+(autoWamTravelEnabled?' checked':'')+'> '+'Auto-Travel to Work as Manager'+'</label>'+cb_std_string((hasPresets?'Update current':'Save')+' Preset','blueColor tinySize right #cbSaveAutoWamPreset')+'<small>Save currently assigned/worked<br />(green) Manager Works as Preset</small>'+'</div>'+'</div>';$j(optionsHtml).appendTo(wrapper);$j('#showAutoWamOptions').click(function(){$j(this).remove();$j('#cbAutoWamOptions > div.cbAutoWorkOptionsWrap').addClass('visible')});$j('#toggleAutoWam').change(function(){OPTS.set('autowam','Auto',$j(this).is(':checked')?1:0)});$j('#toggleAutoWamTravel').change(function(){OPTS.set('autowamtravel','Auto',$j(this).is(':checked')?1:0)});$j('#cbSaveAutoWamPreset').click(function(){var factories=window['companies'],factoryId,regionId,autoWamPreset={},holdingCompanies=window['holdingCompanies'];for (factoryId in factories){if(!factories.hasOwnProperty(factoryId)||typeof(factories[factoryId]['already_worked'])==_u){continue}if(factories[factoryId]['already_worked']){regionId=holdingCompanies[factories[factoryId]['holding_company_id']]['region_id'];if(typeof(autoWamPreset[regionId])==_u){autoWamPreset[regionId]=[]}autoWamPreset[regionId].push(intval(factoryId))}}LS.set('autoWamPreset',autoWamPreset);$j(this).unbind().removeClass('blueColor').addClass('disabled').find('span').text('Presets set/updated')});$j('#cbApplyAutoWamPreset').click(function(){var autoWamPreset=LS.get('autoWamPreset',{}),regionId,factoryIds;if(Object.keys(autoWamPreset).length<1){return}for (regionId in autoWamPreset){if(!autoWamPreset.hasOwnProperty(regionId)||autoWamPreset[regionId].length<1){continue}factoryIds='#company_'+autoWamPreset[regionId].join(',#company_');$j(factoryIds).find('a.as_employee.owner_work:not(.active)').trigger('click')}})}}};PLUGINS['auto-library']={f:CRPK.plugins.AUTO.init,p:false}}}catch (pluginError){console.error('Plugin load ERROR');debug_(pluginError);hasPluginError = true};try{/*============ Plugin: Alerts engine*/if(typeof(CB_EREP_LIBRARY_LOADED)!=_u){CRPK.plugins.AX={isInit:false,_:{c:0,atts:{title:'',content:'',href:VOID,type:'',icon:'',tt:false},s_cache:false},init:function(){if(CRPK.plugins.AX.isInit||!is_page('home')){return!1}CRPK.plugins.AX.isInit=!0;_BG_.add('CRPK.plugins.AX.storage',CRPK.plugins.AX.storage.get,minutes(3),!0);if((is_page('home')||is_page('storage'))&&(OPTS.get('ax-storage', 'Alerts')||OPTS.get('ax-storage-houses', 'Alerts'))){CRPK.plugins.AX.storage.init()}if(is_page('home')){CRPK.plugins.AX.daily.init()}if(is_valid_auth_key_('tank')){if((OPTS.get('ax-battlewatch', 'Alerts')||OPTS.get('ax-bh-watch', 'Alerts'))&&CRPK.battles.idx().length<60){_BG_.add('CRPK.plugins.AX.battlewatch',CRPK.plugins.AX.battlewatch.check_battles,minutes(CRPK.battles.idx().length>50?(CRPK.battles.idx().length>80?10:7):5),!0)}if(is_page('home')&&(OPTS.get('ax-battlewatch', 'Alerts')||OPTS.get('ax-bh-watch', 'Alerts'))){CRPK.plugins.AX.battlewatch.init()}}return!0},battlewatch:{_:{lists:false,has_friends:false,has_enemies:false,battles:{all:[],bh:{},t5:{}},pending:0},init:function(){CRPK.plugins.AX.battlewatch.lists.get();if(!CRPK.plugins.AX.battlewatch._.watchlist.length||CRPK.battles.idx().length>=60||in_array(getinfo('uid'),[3428351])){return!0}CRPK.plugins.AX.battlewatch._.battles=$j.extend({},CRPK.plugins.AX.battlewatch._.battles,LS.get('ax-battlewatch-battles',{}));if(!CRPK.plugins.AX.battlewatch._.battles.all.length){return!0}for (var battleID in CRPK.plugins.AX.battlewatch._.battles.t5){if(!CRPK.plugins.AX.battlewatch._.battles.t5.hasOwnProperty(battleID)){continue}for (var i = 0; i < CRPK.plugins.AX.battlewatch._.watchlist.length; i++){var citizenID=CRPK.plugins.AX.battlewatch._.watchlist[i],is_self=(citizenID==getinfo('uid')),is_friend=!is_self&&CRPK.plugins.AX.battlewatch._.has_friends&&in_array(citizenID,CRPK.plugins.AX.battlewatch._.lists.friends);if(in_array(citizenID,CRPK.plugins.AX.battlewatch._.battles.t5[battleID])){var is_bh=in_array(citizenID,CRPK.plugins.AX.battlewatch._.battles.bh[battleID]),_battleID=intval(String(battleID).split('/')[0]),is_sky=(CRPK.plugins.AX.battlewatch._.battles.skyBattles instanceof Array)&&in_array(_battleID,CRPK.plugins.AX.battlewatch._.battles.skyBattles),position_name=(is_bh?('<b>'+(is_sky?'Sky Hero':'Battle hero')+'</b>'):'in '+(is_sky?'Airforce ':'')+'Top 5');CRPK.plugins.AX.a.display({href:M.util.get_battlefield_url(battleID),icon:(is_self?(is_bh?'self-bh-ok':'self-bh-warn'):(is_friend?'friend':'enemy')),type:(is_bh?(is_self?'warn':(is_friend?'ok':'critical')):(is_self?'critical':(is_friend?'info':'warn')))+(is_sky?' cb-ax-sky':'')+' cb-ax-bh-t5',content:(is_self?'You are ':('<s>'+CRPK.plugins.AX.battlewatch.lists.name(citizenID)+'</s> is '))+position_name+' #'+_battleID})}}}return!0},check_battles:function (data){CRPK.plugins.AX.battlewatch.lists.get();if(CRPK.plugins.AX.battlewatch._.watchlist.length<1){return!0}if(!data){return CRPK.battles.scan.init('all',null,CRPK.plugins.AX.battlewatch.check_battles)}CRPK.plugins.AX.battlewatch._.battles={all:[],bh:{},t5:{},skyBattles:[]};var battleID,divisionID,sideID,x;for (battleID in data){if(!data.hasOwnProperty(battleID)){clog('!data.hasOwnProperty(battleID)');continue}var battle=data[battleID];if(!battle.hasOwnProperty('_')){clog('!battle.hasOwnProperty(_)');continue}for (divisionID in battle._.t5d){if(!battle._.t5d.hasOwnProperty(divisionID)||!is_positive_int(divisionID)){continue}for (sideID in battle._.t5d[divisionID]){if(!battle._.t5d[divisionID].hasOwnProperty(sideID)||!battle._.t5d[divisionID][sideID].length){continue}for (x = 0; x < battle._.t5d[divisionID][sideID].length; x++){var citizenID=intval(battle._.t5d[divisionID][sideID][x].id);if(!in_array(citizenID,CRPK.plugins.AX.battlewatch._.watchlist)){continue}if(in_array(divisionID,AIRFORCE_DIVISIONS)&&!in_array(battleID,CRPK.plugins.AX.battlewatch._.battles.skyBattles)){CRPK.plugins.AX.battlewatch._.battles.skyBattles.push(intval(battleID))}if(typeof(CRPK.plugins.AX.battlewatch._.battles.bh[battleID+'/'+sideID])==_u){CRPK.plugins.AX.battlewatch._.battles.bh[battleID+'/'+sideID]=[];CRPK.plugins.AX.battlewatch._.battles.t5[battleID+'/'+sideID]=[]}if(x===0){CRPK.plugins.AX.battlewatch._.battles.bh[battleID+'/'+sideID].push(citizenID)}CRPK.plugins.AX.battlewatch._.battles.t5[battleID+'/'+sideID].push(citizenID);CRPK.plugins.AX.battlewatch._.battles.all.push(citizenID)}}}}CRPK.plugins.AX.battlewatch._.battles.all=array_unique(CRPK.plugins.AX.battlewatch._.battles.all);LS.set('ax-battlewatch-battles',CRPK.plugins.AX.battlewatch._.battles);return!0},lists:{get:function (forced){if(!CRPK.plugins.AX.battlewatch._.lists||true===forced){CRPK.plugins.AX.battlewatch._.lists={my:false,friends:[],enemies:[],names:{}};CRPK.plugins.AX.battlewatch._.lists=$j.extend(CRPK.plugins.AX.battlewatch._.lists,OPTS.get('ax-battlewatch-lists', 'Alerts',{friends:[],enemies:[],names:{}}));CRPK.plugins.AX.battlewatch._.has_friends=CRPK.plugins.AX.battlewatch._.lists.friends.length>0;CRPK.plugins.AX.battlewatch._.has_enemies=CRPK.plugins.AX.battlewatch._.lists.enemies.length>0;CRPK.plugins.AX.battlewatch._.watchlist=[].concat(CRPK.plugins.AX.battlewatch._.lists.friends,CRPK.plugins.AX.battlewatch._.lists.enemies);if(OPTS.get('ax-bh-watch', 'Alerts')){CRPK.plugins.AX.battlewatch._.lists.my=!1;CRPK.plugins.AX.battlewatch._.watchlist.push(getinfo('uid'))}}return CRPK.plugins.AX.battlewatch._.lists},name:function (citizenID){return (citizenID==getinfo('uid')?'*YOU*':(CRPK.plugins.AX.battlewatch.lists.get().names[citizenID]||('#'+citizenID)))},updater:function(){CRPK.plugins.AX.battlewatch.lists.get(true);var f_names=[],e_names=[],i;for (i = 0; i < CRPK.plugins.AX.battlewatch._.lists.friends.length; i++){f_names.push(CRPK.plugins.AX.battlewatch.lists.name(CRPK.plugins.AX.battlewatch._.lists.friends[i]))}for (i = 0; i < CRPK.plugins.AX.battlewatch._.lists.enemies.length; i++){e_names.push(CRPK.plugins.AX.battlewatch.lists.name(CRPK.plugins.AX.battlewatch._.lists.enemies[i]))}var popup=_POP({id:'set-ax-battlewatch-pop',title:'Set {FRIENDS} and {ENEMIES} list',html:('<br><h2>Friends:</h2><input type="text" id="set-ax-friends-input" value="'+CRPK.plugins.AX.battlewatch._.lists.friends.join(',')+'" />'+(f_names.length>0?'<small><br><i>'+f_names.join(', ')+'</i></small>':'')+'<br><br><h2>Enemies:</h2><input type="text" id="set-ax-enemies-input" value="'+CRPK.plugins.AX.battlewatch._.lists.enemies.join(',')+'" />'+(e_names.length>0?'<small><br><i>'+e_names.join(', ')+'</i></small>':'')+'<br><br><p>{Comma-separated} lists of CitizenIDs. <i>Example: 2,99999,1258,44</i></p>'+'<br><p>When/if <b>Top5/BH Alerts</b> are enabled, all open battles will be<br>continually scanned every 15 minutes to check if any of your<br>{friends} or {enemies} are in Top5 (and/or BH) somewhere.</p>'+'<p align="right"><br>'+cb_std_string('Save', 'green pop-btn-save')+'</p>')});$j('#set-ax-battlewatch-pop a.pop-btn-save').click(function(){var f=uid_list_parser($j('#set-ax-friends-input').val(),','),e=uid_list_parser($j('#set-ax-enemies-input').val(),','),n={},a=f.concat(e);for (var i = 0; i < f.length; i++){if(e.indexOf(f[i])>-1){return alert('citizen #'+f[i]+' is both {FRIEND} and {ENEMY}. Save aborted.')}}var has_errors=!1,selfID=getinfo('uid');for (i = 0; i < a.length; i++){(function (id){if(id==selfID){n[id]=getinfo('name');return}if(typeof(CRPK.plugins.AX.battlewatch._.lists.names[id])!=_u){n[id]=CRPK.plugins.AX.battlewatch._.lists.names[id];return}$j.ajax({url:EREP.url+'/main/group-find-citizen/',type:'POST',async:false,global:false,dataType:'json',data:{_token:getinfo('token'),to_citizen_id:id},success:function (data){if(data.error){has_errors=!0;alert('citizen #'+id+' error: '+data.message)}else{n[id]=data['user']}}})})(a[i]);if(has_errors){return!1}}var lists={friends:f,enemies:e,names:n};CRPK.plugins.AX.battlewatch._.lists=lists;OPTS.set('ax-battlewatch-lists', 'Alerts',lists);LS.del('ax-battlewatch-battles');popup.fadeOut();return!0});popup.fadeIn();$j('#scrollToTop').trigger('click');return!0}}},storage:{init:function(){var e=CRPK.plugins.AX.storage.get(is_page('home'));if(!is_page('home')){return!0}var citizenshipID=getinfo('citizenship', 'id');if(OPTS.get('ax-storage', 'Alerts')){if(e.edays<1){CRPK.plugins.AX.a.critical({content:'Running out of <b>food</b> <i>in <b>less than 1 day</b></i>',icon:'food',href:EREP.marketplace(citizenshipID,1,2)})}else if(e.edays<3){CRPK.plugins.AX.a.warn({content:'Running out of <b>food</b> <i>in <b> '+e.edays+' days</b></i>',icon:'food',href:EREP.marketplace(citizenshipID,1,2)})}else if(e.edays<7){CRPK.plugins.AX.a.info({content:'Running out of <b>food</b> <i>in <b> '+e.edays+' days</b></i>',icon:'food',href:EREP.marketplace(citizenshipID,1,2)})}if(e.wdays<1){CRPK.plugins.AX.a.critical({content:'Running out of <b>weapons</b> <i>in <b>less than 1 day</b></i>',icon:'weap',href:EREP.marketplace(citizenshipID,2,7)})}else if(e.wdays<3){CRPK.plugins.AX.a.warn({content:'Running out of <b>weapons</b> <i>in <b> '+e.wdays+' days</b></i>',icon:'weap',href:EREP.marketplace(citizenshipID,2,7)})}else if(e.wdays<7){CRPK.plugins.AX.a.info({content:'Running out of <b>weapons</b> <i>in <b> '+e.wdays+' days</b></i>',icon:'weap',href:EREP.marketplace(citizenshipID,2,7)})}if(e.tickets<15){CRPK.plugins.AX.a.warn({content:'Running low on <b>tickets</b>. <i>(<b>'+e.tickets+' tickets in stock)</b></i>',icon:'ticket',href:EREP.marketplace(citizenshipID,3,5)})}}if(OPTS.get('ax-storage-houses', 'Alerts')){CRPK.plugins.AX.storage.house_warn(e)}return!0},get:function (return_cache){if(LS.check('ax-storage')){CRPK.plugins.AX._.s_cache=LS.get('ax-storage')}if(typeof(return_cache)==_u){return_cache=!1}if(!return_cache&&is_page(EREP.storage)&&null!==return_cache){CRPK.inventory.init_angular(function(){CRPK.plugins.AX.storage.get(null)});return CRPK.plugins.AX._.s_cache}var rrate=NRG.rrate();if(return_cache&&rrate==CRPK.plugins.AX._.s_cache.rrate&&!timestamp_expired(CRPK.plugins.AX._.s_cache.ts,6*HOURS)){return CRPK.plugins.AX._.s_cache}CRPK.inventory.init();var recovery_per_day=NRG.rrate_per_day(),edays=cb_number(CRPK.inventory.computeEnergyAmount()/recovery_per_day,1),wdays=cb_number(NRG.eph(CRPK.inventory.computeWeaponUses())/recovery_per_day,1),house_nrg={q1:50,q2:80,q3:100,q4:150,q5:200},avail_houses=[],houses={q1:{a:0,i:0,e:0},q2:{a:0,i:0,e:0},q3:{a:0,i:0,e:0},q4:{a:0,i:0,e:0},q5:{a:0,i:0,e:0},nrg:0,nrg_a:0,nrg_i:0,has_a:0,has_i:0},qq,h_nrg,active,inactive;for (var q = 1; q <= 7; q++){qq='q'+q;h_nrg=intval(house_nrg[qq],0);active=CRPK.inventory.has_active_house_q(q);inactive=CRPK.inventory.has_house_q(q);if(!in_array(qq,avail_houses)){avail_houses.push(qq);houses.nrg+=h_nrg}if(inactive){houses[qq].i=inactive;houses.has_i=1;houses.nrg_i+=h_nrg}if(active){houses[qq].a=active;houses[qq].e=seconds(active);houses.has_a=1;houses.nrg_a+=h_nrg}}CRPK.plugins.AX._.s_cache={ts:now(),rrate:rrate,edays:edays,wdays:wdays,tickets:CRPK.inventory.computeTicketsAmount(),'houses':houses};LS.set('ax-storage',CRPK.plugins.AX._.s_cache);return CRPK.plugins.AX._.s_cache},house_warn:function (storage){if(!('houses' in storage)){return!1}var expiration_ax=0;for (var qq in storage.houses){if(!storage.houses.hasOwnProperty(qq)||!storage.houses[qq].e){continue}if(!expiration_ax||storage.houses[qq].e<expiration_ax){expiration_ax=storage.houses[qq].e}}if(!expiration_ax||expiration_ax>days(3)){return!0}if(expiration_ax<days(1)){expiration_ax=Math.ceil(expiration_ax/HOURS)+' hours';CRPK.plugins.AX.a.critical({content:'House(s) will expire <i>in <b>less than '+expiration_ax+'</b></i>',icon:'house',href:EREP.storage})}else{expiration_ax=Math.ceil(expiration_ax/DAYS)+' days';CRPK.plugins.AX.a.warn({content:'House(s) will expire <i>in <b>less than '+expiration_ax+'</b></i>',icon:'house',href:EREP.storage})}return!0}},daily:{init:function(){if(!is_page('home')||_PLAYER_.isORG()||!dev_()){return!1}var dailies=$j.extend({autoemployees:0,autowam:0},LS.get('ax-dailies',{}));if(typeof(dailies['employees'])!=_u){delete dailies['employees'];LS.set('ax-dailies',dailies)}if(getinfo('hour')>=2){var autoStatus=$j.extend({},CRPK.plugins.AUTO._,LS.get('auto',{})),today=getinfo('day');if(dailies.autowam<today&&OPTS.get('autowam', 'Auto')&&LS.check('autoWamPreset')){var autoWamRegionsNum=Object.keys(LS.get('autoWamPreset',{})).length;if(typeof(autoStatus.wam.success)!=_u&&autoStatus.wam.success!==!1&&autoStatus.wam.day==today&&autoStatus.wam.success<autoWamRegionsNum){CRPK.plugins.AX.a.display({content:'Auto-WaM ERROR'+(dev_()&&autoStatus.wam.message?' ('+autoStatus.wam.message+')':''),href:EREP.companies,title:'Click to dismiss',icon:'info',type:'critical dismissable daily daily-autowam'})}}if(dailies.autoemployees<today&&OPTS.get('autoemployees', 'Auto')&&LS.check('autoEmployeesPreset')){if(typeof(autoStatus.employees.success)!=_u&&autoStatus.employees.success!==!1&&autoStatus.employees.day==today&&!autoStatus.employees.success){CRPK.plugins.AX.a.display({content:'Auto-Employees ERROR'+(dev_()&&autoStatus.employees.message?' ('+autoStatus.employees.message+')':''),href:EREP.companies,title:'Click to dismiss',icon:'info',type:'critical dismissable daily daily-autoemployees'})}}}return!0}},a:{info:function (atts){return CRPK.plugins.AX.a.display($j.extend({},CRPK.plugins.AX._.atts,atts,{type:'info'}))},warn:function (atts){return CRPK.plugins.AX.a.display($j.extend({},CRPK.plugins.AX._.atts,atts,{type:'warn'}))},critical:function (atts){return CRPK.plugins.AX.a.display($j.extend({},CRPK.plugins.AX._.atts,atts,{type:'critical'}))},ok:function (atts){return CRPK.plugins.AX.a.display($j.extend({},CRPK.plugins.AX._.atts,atts,{type:'ok'}))},display:function (atts){if(CRPK.plugins.AX._.c>500){return!1}var a=$j.extend({},CRPK.plugins.AX._.atts,atts),container=$j('#cb-ax-container'),dismissable=instr(a.type,'dismissable');if(!container.length){container=$j('<div id="cb-ax-container"></div>').appendTo('body')}var ax=$j('<a class="cb-ax cb-ax-'+CRPK.plugins.AX._.c+' cb-ax-'+a.type+'" href="'+a.href+'"'+'>'+(a.icon?'<q class="cb-ax-icon-'+a.icon+'"></q>':'')+(dismissable?'<q class="cb-ax-icon-close" title="Click to close"></q> ':'')+a.content+'</a>');if(a.type.indexOf('cb-ax-bh-t5')<0&&ax.text().length>=30){ax.addClass('ax-more').hoverIntent(function(){$j(this).unbind().removeClass('ax-more').addClass('ax-expanded')},function(){})}if(dismissable){$j(document).on('click',('a.cb-ax.cb-ax-'+CRPK.plugins.AX._.c+'.cb-ax-'+a.type).replace(/ /g,'.')+'>q.cb-ax-icon-close',function (event){var dailies=LS.get('ax-dailies',{}),_this=$j(this),_parent=_this.parent(),type=(_parent.hasClass('daily-autowam')?'autowam':(_parent.hasClass('daily-autoemployees')?'autoemployees':'_'));if(type!='_'){dailies[type]=getinfo('day');LS.set('ax-dailies',dailies)}_parent.addClass('dismissed');if($j('#cb-ax-container>a:not(.dismissed)').exists()){_parent.fadeOut(100)}else{$j('#cb-ax-container').fadeOut(100)}$j('.tipsy').remove();event.stopPropagation();event.stopImmediatePropagation();event.preventDefault()})}if(a.title&&!dismissable){ax.tipsy({gravity:'w'})}ax.appendTo(container);CRPK.plugins.AX._.c++;return!0}}};OPTS.register('ax-storage', 'Food/Weapon alerts (on home)', 'Alerts',1);OPTS.register('ax-storage-houses', 'House alerts (on home)', 'Alerts',0);if(is_valid_auth_key_('military')){OPTS.register('ax-battlewatch', 'Track {Friends/Enemies} Top5/BH (alerts on home)', 'Alerts',0);OPTS.register('ax-bh-watch', 'Track {Your} Top5/BH (alerts on home)', 'Alerts',0);OPTS.register_custom('ax-battlewatch-lists','Set {FRIENDS} and {ENEMIES} lists','Alerts','button',{friends:[],enemies:[],names:{}},CRPK.plugins.AX.battlewatch.lists.updater)}PLUGINS['AX']={f:CRPK.plugins.AX.init,p:['home']}}}catch (pluginError){console.error('Plugin load ERROR');debug_(pluginError);hasPluginError = true};try{if(typeof(CB_EREP_LIBRARY_LOADED)!=_u){CRPK.marketplace={url:function (countryID,industryID,qualityID){return getinfo('home')+'/economy/marketplace'+(typeof(countryID)==_u?'':('#'+intval(countryID,getinfo('citizenship','id'))+'/'+intval(industryID,1)+'/'+intval(qualityID,1)))},action_url:function(){return CRPK.marketplace.url()},_:{data:{countryId:1,industryId:1,quality:1,ajaxMarket:1,orderBy:'price_asc',currentPage:1,_token:getinfo('token')},buy_data:{offerId:0,amount:0,buyAction:1,orderBy:'price_asc',currentPage:1,_token:getinfo('token')},buy_status:{error:true,message:false},offer:{id:0,amount:0,price:0,priceWithTaxes:0,citizen_id:0,name:'',country_id:0,industry_id:0,customization_level:0,is_for_export:0}},get_offers:function (countryID,industryID,qualityID,async){var post_data=$j.extend({},CRPK.marketplace._.data,{countryId:intval(countryID),industryId:intval(industryID),quality:intval(qualityID)});return $j.ajax({url:CRPK.marketplace.action_url(),type:'POST',dataType:'json',global:false,async:('async'==async),data:post_data})},get_best_offer:function (countryID,industryID,qualityID,min_amount){if(!min_amount||!is_positive_int(min_amount)){min_amount=1}var best_offer=CRPK.marketplace._.offer;CRPK.marketplace.get_offers(countryID,industryID,qualityID).done(function (data){var x;if(!data.error&&data.hasOwnProperty('offers')&&is_array(data['offers'])){for (x = 0; x < data['offers'].length; x++){if(intval(data['offers'][x].amount,1)>=min_amount){best_offer=$j.extend({},CRPK.marketplace._.offer,data['offers'][x]);break}}}});return best_offer},get_best_price:function (countryID,industryID,qualityID,min_amount){if(!min_amount||!is_positive_int(min_amount)){min_amount=1}return floatval(CRPK.marketplace.get_best_offer(countryID,industryID,qualityID,min_amount).priceWithTaxes,2)},buy_offer:function (offerID,amount){var post_data=$j.extend({},CRPK.marketplace._.buy_data,{offerId:intval(offerID,0),amount:intval(amount,0)}),buy_status=CRPK.marketplace._.buy_status;$j.ajax({url:CRPK.marketplace.action_url(),type:'POST',dataType:'json',global:false,async:false,data:post_data}).done(function (data){buy_status={error:data.error,message:data.message,amount:amount}});return buy_status},buy_best_offer:function (countryID,industryID,qualityID,amount){var best_offer=CRPK.marketplace.get_best_offer(countryID,industryID,qualityID,amount);return !(best_offer.id?CRPK.marketplace.buy_offer(best_offer.id,amount):CRPK.marketplace._.buy_status).error}}}}catch (pluginError){console.error('Plugin load ERROR');debug_(pluginError);hasPluginError = true};try{/*============ Plugin: Military Stuff: Mercenary Hunter, Battle Watcher, Battlefield*/if(typeof(CB_EREP_LIBRARY_LOADED)!=_u){var M={valid_modKEY:false,valid_tankKEY:false,valid_coKEY:false,enable_kills_top5:true,enable_pp_x4_mode:false,enableObjectiveMode:false,objectiveHunt:false,objectiveHuntBazookaMode:false,enable_short_epics:true,is_init:false,enableAirforce:null,enableAirforceMode:null,airforceMode:function(){if(M.enableAirforceMode===null||M.enableAirforce===null){var airforceMode=OPTS.get('airforce-mode', 'Military');if(typeof(airforceMode)=='object'){for (var key in airforceMode){if(airforceMode.hasOwnProperty(key)){airforceMode=key;break}}}if(typeof(airforceMode)!='string'){airforceMode=getinfo('level')>=70?'whatever':'never'}if('never'==airforceMode||(getinfo('level')<70&&airforceMode!='always')){airforceMode=-10}else if('always'==airforceMode&&is_valid_auth_key_('tank')){airforceMode=100}else if('weapons'==airforceMode&&is_valid_auth_key_('tank')){airforceMode=(CRPK.inventory.hasProduct('23_1')>0?100:0)}else{airforceMode=1}M.enableAirforce=(airforceMode>0);M.enableAirforceMode=airforceMode}return M.enableAirforce?M.enableAirforceMode:-10},airforceEnabled:function(){if(M.enableAirforceMode===null||M.enableAirforce===null){M.airforceMode()}return M.enableAirforce},airforceOnly:function(){return M.airforceMode()>=100}};M.init=function (angular_loaded){if(_PLAYER_.isORG()){return!1}clog('M.init()', 'angular_loaded = ',angular_loaded);M.airforceMode();M.xxhr.bind();M.battlewatcher.init();if((is_page('wars')||is_page('homepage'))&&!angular_loaded){document.addEventListener('CRPK_battles_updated',function(){clog("M.init('angular_loaded');viaCRPK_battles_updated");M.init('angular_loaded')},!1);return CRPK.battles.init()}if(M.is_init){return!0}M.is_init=!0;CRPK.battles.init();if(is_page('wars')||is_page('battlefield')||is_page('homepage')||is_page('choose-side')){set_fallback_timeout()}if(!M.enableObjectiveMode){if(is_page('homepage')&&$j('#objective_listing').exists()){LS.set('objective_mode.ts',getinfo('day'));M.enableObjectiveMode=!0}else{M.enableObjectiveMode=(intval(LS.get('objective_mode.ts',0),0)+2>getinfo('day'))}}if(M.enableObjectiveMode){M.objectiveHunt=(!!OPTS.get('objective-hunt', 'Auto'));M.objectiveHuntBazookaMode=(!!OPTS.get('objective-hunt-bazooka', 'Auto'))}if(is_page('battlefield')){M.b.get_data()}else if(is_page('home')){M.util.getPrestigePoints()}clear_win_timeout();if(is_page('choose-side')){M.util.moveAndJoinSide()}M.a.init();try{M.util.collectDO()}catch(e){}if(OPTS.get('track-top-fighter', 'Military')){M.tf.init()}if(M.valid_modKEY&&is_page('/country/society/')){M.util.determination_report()}if(!is_page('battlefield')){M.b.t.reset_params();M.b.t.counters.reset()}var pages=['homepage','campaigns','wars','battlefield','storage'],page;for (var p in pages){if(pages.hasOwnProperty(p)&&is_page(pages[p])){page=pages[p].charAt(0);if(typeof(M[page])==_u){_zq('M.'+page+' ('+pages[p]+') :: not found');break}if(typeof(M[page].init)!='function'){_zq('M.'+page+'.init() :: not a function');break}M[page].init();break}}};M.h={init:function(){'use strict';return is_valid_auth_key_('mod')?M.h.CoD.init():true}};M.s={init:function (angular_loaded){if(!_PLAYER_.dph){return!1}if(!angular_loaded){clog('M.s.init()', '!angular_loaded');setTimeout(function(){clog('M.s.init()', 'setTimeout()');CRPK.inventory.init_angular(function(){clog('M.s.init()', 'CRPK.inventory.init_angular() callback');M.s.init(true)})},100);return!0}clog('M.s.init()', 'angular_loaded = true');var full_ff_hits=Math.floor(NRG.full/NRG.eph()),full_ff_damage=intval(full_ff_hits*_PLAYER_.dph,0),full_ff_damage_air=intval(full_ff_hits*_PLAYER_.adph,0),energy_bars_hits=(10*CRPK.inventory.hasProduct('1_10'))+(20*CRPK.inventory.hasProduct('1_11')),energy_bars_damage=intval(energy_bars_hits*_PLAYER_.dph),energy_bars_damage_air=intval(energy_bars_hits*_PLAYER_.adph),bombs_damage=((CRPK.inventory.hasProduct('2_22')*5*MILLIONS)+(CRPK.inventory.hasProduct('2_215')*1.5*MILLIONS)),small_bomb_id='2_'+(_PLAYER_.div===1?211:((_PLAYER_.div===2?212:(_PLAYER_.div===3?213:21)))),small_bombs=CRPK.inventory.hasProduct(small_bomb_id);if(small_bombs>0){bombs_damage+=small_bombs*intval(CRPK.inventory.getProductItem(small_bomb_id).attributes['firePower']['value'],0)}var bombs_damage_fmt=(bombs_damage>0?k_number_format(bombs_damage,' '):'-');$j('#inventory_overview>div.items_holder>div.inventoryItems>div.ng-scope:nth-child(3)>div.item_mask').prepend('<div id="cb-player-damage-table-wrap"><table id="cb-player-damage-table">'+'<thead><tr><th>-</th><th>Normal</th><th>50% booster</th><th>100% booster</th><th>Airforce</th></tr></thead>'+'<tfoot><tr><th>Totals</th>'+'<td>'+k_number_format(bombs_damage+full_ff_damage+energy_bars_damage,' ')+'</td>'+'<td>'+k_number_format(bombs_damage+(1.5*(full_ff_damage+energy_bars_damage)),' ')+'</td>'+'<td>'+k_number_format(bombs_damage+(2*(full_ff_damage+energy_bars_damage)),' ')+'</td>'+'<td>'+k_number_format(full_ff_damage_air+energy_bars_damage_air,' ')+'</td>'+'</tr></tfoot>'+'<tbody>'+'<tr><th>Full Energy</th><td>'+k_number_format(full_ff_damage,' ')+'</td><td>'+k_number_format(1.5*full_ff_damage,' ')+'</td><td>'+k_number_format(2*full_ff_damage,' ')+'</td><td>'+k_number_format(full_ff_damage_air,' ')+'</td></tr>'+'<tr><th>Energy Bars</th><td>'+k_number_format(energy_bars_damage,' ')+'</td><td>'+k_number_format(1.5*energy_bars_damage,' ')+'</td><td>'+k_number_format(2*energy_bars_damage,' ')+'</td><td>'+k_number_format(energy_bars_damage_air,' ')+'</td></tr>'+'<tr><th>Bombs</th><td>'+bombs_damage_fmt+'</td><td>'+bombs_damage_fmt+'</td><td>'+bombs_damage_fmt+'</td><td>-</td></tr>'+'</tbody>'+'</table></div>');_PLAYER_.update({dmg:intval((full_ff_damage+energy_bars_damage)/MILLIONS),dmgboost:intval(((full_ff_damage+energy_bars_damage)/MILLIONS)*1.5),dmgbombs:intval(bombs_damage/MILLIONS)});return!0}};OPTS.register('interesting-wars', 'Highlight `interesting` battles on Wars page', 'Military',1);M.c={_:{lists:[],battles:(typeof($j)!=_u?$j():(typeof(jQuery)!=_u?jQuery():null)),battleIDs:[],filtered:[],scanned:[],current_hash:false,current_filter:false,current_sorter:false,current_command:''},init:function (angular_loaded){clog('M.c.init()', 'angular_loaded =',angular_loaded);CRPK.battles.init();if(!angular_loaded){CRPK.angular.on_loaded('ListCampaignsController',function(){setTimeout(function(){M.c.init('angular_loaded')},200)});return!0}$j('<div id="cb-battle-listing-filters-wrap" style="visibility:hidden;opacity:0"></div>').insertBefore('#battle_listing');M.c.initial_parser();M.c.check_hash();M.c.custom_filters();M.c.custom_buttons();if(getinfo('citizenship', 'id')!=getinfo('location', 'id')){COUNTRIES.get_mpps(getinfo('citizenship', 'id'))}if(_PLAYER_.muCSID&&_PLAYER_.muCSID!=getinfo('citizenship', 'id')&&_PLAYER_.muCSID!=getinfo('location', 'id')){COUNTRIES.get_mpps(_PLAYER_.muCSID)}},initial_parser:function(){M.c._.lists=$j('#battle_listing ul.bod_listing,#battle_listing ul.country_battles,#battle_listing div.holder_campaigns>ul');M.c._.lists.addClass('cb-battle-list');M.c._.lists.children('li').each(function(){var _this=$j(this),_link=$j(this).find('a.county'),_link_h;if(!_link.length){return!0}_link_h=_link.attr('href');_this.attr('id','battle-'+(instr(_link_h,'wars/show')?CRPK.battles.get_war_by_id(_link_h.split('wars/show/')[1]).id:_link_h.split('battlefield-new/')[1]))});M.c._.battles=M.c._.lists.children('li[id*="battle-"]');M.c._.battleIDs=CRPK.battles.idx();var location_countryID=getinfo('location', 'id'),citizenships=[getinfo('citizenship', 'id')],merc_ff_data=M.util.mercff.data();if(_PLAYER_.muCSID&&_PLAYER_.muCSID!=getinfo('citizenship', 'id')){citizenships.push(_PLAYER_.muCSID)}M.c._.battles.each(function(){var li=$j(this),battleID=li.attr('id').replace('battle-', ''),battle=CRPK.battles.get_battle_by_id(battleID),time_span=li.find('span.countyTime'),waiting=CRPK.battle.iz.waiting(battle)||instr(time_span.text(),'aiting'),modifiers=li.find('.modifiers_container'),war_type=modifiers.find('span.war_details_text>span').text().trim().toLowerCase().replace(':', '').replace(/ /g,'-'),countries={left:COUNTRIES.imget(battle.is_cw?255:li.find('.attacker_holder>.side_flags,.attacker_holder>.country_flags').eq(0)),right:COUNTRIES.imget(li.find('.opponent_holder>.side_flags,.opponent_holder>.country_flags').eq(0))},merc={left:M.util.mercff.get_merc_status(countries.left),right:M.util.mercff.get_merc_status(countries.right)},classes=['battleID-'+battleID,war_type.replace(/ /g,'-'),'countryID-'+countries.left.id,'country-'+countries.left.display,'countryID-'+countries.right.id,'country-'+countries.right.display],is_travel=CRPK.battle.iz.travel(battle),ff_status=!1,time;if(battle.is_do){classes.push('daily-order');if(is_positive_int(battle.is_do)){classes.push('daily-order-'+(countries.left.id==battle.is_do?'left':'right'))}}if(battle.is_tw&&battle.twp&&!battle.afp){classes.push('training-war', 'training-war-'+(countries.left.id==battle.twp?'left':'right'))}if(battle.has_co){classes.push('co')}if(battle.is_cw){classes.push('civil-war', 'travel')}if(!battle.is_cw){if(merc.left<25||merc.right<25){classes.push('mercenary')}li.find('.attacker_holder').prepend('<q class="merc merc-'+(merc.left>=25?'ok':'progress')+' merc-'+countries.left.display+'" title="'+merc.left+'/25 Mercenary kills for '+countries.left.display+'">'+merc.left+'</q>');li.find('.opponent_holder').prepend('<q class="merc merc-'+(merc.right>=25?'ok':'progress')+' merc-'+countries.right.display+'" title="'+merc.right+'/25 Mercenary kills for '+countries.right.display+'">'+merc.right+'</q>');if(battle.is_rw){ff_status=M.util.mercff.get_ff_status(battle.war_id);if(ff_status){classes.push('freedom-fighter', 'freedom-fighter-ongoing');ff_status=ff_status+'/'+merc_ff_data.ff.required.kills;modifiers.append('<span class="influence_multiplier freedom-fighter-ongoing" title="'+ff_status+' Freedom Fighter kills">'+ff_status+'</span>')}if(battle.inv.points>battle.def.points){classes.push('freedom-fighter');if(merc.left<25){classes.push('merc-ff')}}}}li.find('a.county').attr('href',VOID).end();li.find('a.county span').prop('contenteditable',!0);if(is_travel){classes.push('travel')}if(M.valid_tankKEY&&waiting){classes.push('waiting');li.removeClass('epic_battle_entry');li.find('span.fight_button>a.std_global_btn>b').text('Waiting')}else if(battle.is_epic){classes.push('state-3')}else if(battle.is_full){classes.push('state-2')}else{classes.push('state-1')}if(M.valid_tankKEY&&M.valid_modKEY){if(battle.is_epic_any){classes.push('epic-any');for (var x = 1; x <= MAX_DIVISIONS; x++){if(typeof(battle['is_epic_d'+x])!=_u&&battle['is_epic_d'+x]){classes.push('epic-d'+x)}}}if(battle.is_full_any){classes.push('full-any');for (x = 1; x <= MAX_DIVISIONS; x++){if(typeof(battle['is_full_d'+x])!=_u&&battle['is_full_d'+x]){classes.push('full-d'+x)}}}}if(battle.is_as||battle.is_cw){modifiers.prepend('<span class="influence_multiplier cb-battle-state cb-war-type cb-'+war_type+'"></span>')}modifiers.prepend('<span class="influence_multiplier cb-battle-state"></span>');modifiers.prepend(time_span);if(waiting){time=-1}else{time=battle.start||0}if(M.valid_tankKEY&&!battle.is_cw){classes.push('m-and-j');var fight_span=li.find('span.fight_button'),fight_button_r=fight_span.find('a').clone(),fight_button_l=fight_button_r.clone();fight_span.addClass('move-and-join-wrap '+(is_travel?'move-and-join-travel':'')).append('<br clear="left" />');fight_button_l.addClass('move-and-join move-and-join-l').data('battleID',battleID).html('<img src="/images/flags_png/S/'+countries.left.url+'.png" />').appendTo(fight_span);fight_button_r.addClass('move-and-join move-and-join-r').data('battleID',battleID).html('<img src="/images/flags_png/S/'+countries.right.url+'.png" />').appendTo(fight_span);if(battle.is_rw){fight_button_l.data('travel_countryID',battle.def.id).attr('href',EREP.url+'/military/battlefield-choose-side/'+battleID+'/'+countries.left.id).attr('title',(battle.def.id==location_countryID?'Join ':'Move and join ')+countries.left.display);fight_button_r.data('travel_countryID',battle.def.id).attr('href',EREP.url+'/military/battlefield-choose-side/'+battleID+'/'+countries.right.id).attr('title',(battle.def.id==location_countryID?'Join ':'Move and join ')+countries.right.display)}else if(is_travel){fight_button_l.data('travel_countryID',countries.left.id).attr('title', 'Move and join '+countries.left.display);fight_button_r.data('travel_countryID',countries.right.id).attr('title', 'Move and join '+countries.right.display)}else if(battle.is_mpp){if(COUNTRIES.is_mpp(countries.left.id,location_countryID)){fight_button_l.remove();fight_button_r.data('travel_countryID',countries.right.id).attr('title', 'Move and join '+countries.right.display)}else{fight_button_r.remove();fight_button_l.data('travel_countryID',countries.left.id).attr('title', 'Move and join '+countries.left.display)}}}var co_max=0,valid_co=0,combat_orders=[],i,j,co,cc;li.data('battleID',battleID).data('countries',countries).data('time',time).data('valid-co',valid_co).data('co',co_max).addClass(array_unique(classes).join(' '))});$j('#cb-battle-listing-filters-wrap').css('visibility', 'visible').fadeTo('fast',1);$j('#battle_listing').prepend('<ul id="cb-battle-listing"></ul>').prepend('<h1 id="cb-battle-listing-heading">Battle Filtering <q></q></h1>');M.c._.wrapper=$j('#cb-battle-listing');M.c.retipsy()},retipsy:function(){if(!M.c._.wrapper){return}$j('.tipsy').remove();$j('#battle_listing ul>li span,#battle_listing ul>li q,#battle_listing ul>li>div.war_versus_img').filter('.influence_multiplier,.combat_orders_revamp,q.merc-progress,q.merc-progress,q.scorePoints,div.cb-scan-this').removeData('tipsy').removeData('tipsy-pointee').tipsy({html:true,gravity:'s'})},custom_buttons:function(){var wrap=$j('<div id="cb-battle-listing-filters-buttons"></div>'),exec_wrap=$j('<div id="cb-battle-listing-exec-buttons"></div>');wrap.appendTo('#cb-battle-listing-filters-wrap');exec_wrap.prependTo('#cb-battle-listing-filters-wrap');},custom_filters:function(){var mercff_data=M.util.mercff.data(),filter_options={'interesting':'Interesting','type_aircraft':'Type: Airforce','type_tanks':'Type: Tank','freedom-fighter':'Freedom Fighter '+mercff_data.ff.completed+'/'+mercff_data.ff.required.battles,'mercenary':'Mercenary '+mercff_data.merc.completed+'/50','training-war':'Training War','merc-ff':'Mercenary+FF','co':'With Combat Orders','rw':'Resistance Wars'},filter_selector='<option value="none">#no-filter / Show me&hellip;</option>',selected,cbattles=[];if(M.valid_tankKEY){filter_options.waiting='Waiting'}if(M.valid_modKEY&&getinfo('citizenship', 'id')!=getinfo('location', 'id')){filter_options.citizenship='Citizenship`s MPPs'}if(!(M.valid_tankKEY||M.valid_modKEY)){delete filter_options.type_aircraft;delete filter_options.type_tanks}if(M.valid_modKEY&&_PLAYER_.muCSID&&_PLAYER_.muCSID!=getinfo('citizenship', 'id')&&_PLAYER_.muCSID!=getinfo('location', 'id')){filter_options.MUcitizenship='MU`s Citizenship MPPs'}for (var key in filter_options){if(!filter_options.hasOwnProperty(key)){continue}selected=(key==M.c._.current_filter?' selected':'');filter_selector+='<option value="'+key+'"'+selected+'>'+filter_options[key]+'</option>'}filter_selector=$j('<select id="cb-battle-listing-filter">'+filter_selector+'</select>');filter_selector.change(function(){var filter=$j(this).val();if(filter){M.c.filter.exec(['.'+filter])}});$j('#cb-battle-listing-filters-wrap').append(filter_selector);$j('#cb-battle-listing-filter').select2({width:'200px',height:'400px',maximumSelectionLength:1,placeholder:'Country or Region',formatSelection:function (object){return this.formatFilter(object)},formatResult:function (object){return this.formatFilter(object)},formatFilter:function (object){if(!object.id||!/country/.test(object.id)){return object.text}return object.text+' <img class="select2_icon" src="'+('/images/flags_png/S/'+COUNTRIES.get(object.id.replace('countryID-', ''),'url')+'.png')+'" />'},formatNoMatches:function (term){var filter='search-'+term.trim().toLowerCase().replace(/ /g,'-');M.c.filter.exec(['.'+filter]);return '<li class="select2-no-results">No matches found</li>'},escapeMarkup:function (m){return m},containerCssClass:'cb-battle-listing-filter-container',dropdownCssClass:'cb-battle-listing-filter-dropdown'});if(M.valid_modKEY){window['shortcut'].add('Control+f',function(){if($j('#cb-battle-listing-filters-wrap').exists()){$j('#cb-battle-listing-filters-wrap').get(0).scrollIntoView(false)}if(!$j('.select2-container.cb-battle-listing-filter-container').hasClass('select2-dropdown-open')){$j('#cb-battle-listing-filter').select2('open')}},{disable_in_input:false});if(M.valid_tankKEY){$j('<select id="cb-scanner-division-selector"><option value="4">Div 4</option><option value="3"'+(3==M.b.division()?' selected':'')+'>Div 3</option><option value="2"'+(2==M.b.division()?' selected':'')+'>Div 2</option><option value="1"'+(1==M.b.division()?' selected':'')+'>Div 1</option></select>').prependTo('#cb-battle-listing-filters-wrap').select2({minimumResultsForSearch:Infinity})}}},check_hash:function(){if(window.location.hash===M.c._.current_hash){return!0}var hash=window.location.hash;if(instr(hash,'exec:')){M.c.executor.exec(oURL.split('exec:')[1].split('--')[0])}if(instr(hash,'sort:')){M.c.sorter.exec(oURL.split('sort:')[1].split('--')[0])}if(instr(hash,'filter:')){M.c.filter.exec(oURL.split('filter:')[1].split('--')[0])}if(OPTS.get('interesting-wars', 'Military')&&!instr(hash,'#')){M.c.filter.exec('interesting')}return!0},change_hash:function(){var nhash=[];if(M.c._.current_command&&'none'!=M.c._.current_command){nhash.push('exec:'+M.c._.current_command)}else{if(M.c._.current_filter&&'none'!=M.c._.current_filter){nhash.push('filter:'+M.c._.current_filter)}if(M.c._.current_sorter&&'none'!=M.c._.current_sorter){nhash.push('sort:'+M.c._.current_sorter)}}nhash='#'+nhash.join('--');if(window.location.hash!=nhash){window.location.hash=String(nhash)}M.c._.current_hash=nhash},filter:{reset:function(){M.c._.wrapper.empty();M.c._.battles.removeClass('cb-filtered-out');M.c._.filtered=[];$j('#battle_listing').removeClass('cb-battle-filtering-on');return!0},exec:function (filters){M.c.filter.reset();var filter_name='',filtered=[];var mercff_data=M.util.mercff.data(),special_filters={interesting:{name:'Interesting (Full Scale, Epics, Civil Wars, Airstrikes)',filter:['.state-3', '.state-2', '.full-any', '.epic-any', '.civil-war', '.dictatorship', '.liberation', '.airstrike', '.interesting']},'freedom-fighter':{name:'Freedom Fighter x'+mercff_data.ff.required.kills+' ('+mercff_data.ff.completed+'/'+mercff_data.ff.required.battles+')',filter:['.freedom-fighter']},'merc-ff':{name:'Mercenary + Freedom Fighter',filter:['.merc-ff']},rw:{name:'Resistance Wars',filter:['.rw', '.resistance']},co:{name:'With Combat Orders',filter:['.co']},mercenary:{name:'Mercenary Medal: '+mercff_data.merc.completed+'/50 countries',filter:['.mercenary']},citizenship:{name:'Citizenship',filter:[]},MUcitizenship:{name:'MU Citizenship',filter:[]}};if(M.valid_tankKEY||M.valid_modKEY){special_filters.interesting.filter.push('.type_aircraft')}if(typeof(filters)=='object'&&filters.length==1&&typeof(special_filters[filters[0].substr(1)])!=_u){filters=filters[0].substr(1);M.c._.current_filter=filters;filter_name=special_filters[filters].name;filters=special_filters[filters].filter}if(gettype(filters)!='array'||filters.length===0){if('citizenship'==filters||'MUcitizenship'==filters||'citizenship'==M.c._.current_filter||'MUcitizenship'==M.c._.current_filter){if('citizenship'==filters||'MUcitizenship'==filters){M.c._.current_filter=filters}var filtercID=('citizenship'==filters?getinfo('citizenship', 'id'):_PLAYER_.muCSID),mpps=COUNTRIES.get_mpps(filtercID);filter_name=COUNTRIES.get(filtercID,'display')+'`s MPP Battles';filters=mpps.map(function (value){return '.mpp.countryID-'+value});filters.push('.countryID-'+filtercID)}else if(typeof(special_filters[filters])!=_u){M.c._.current_filter=filters;filter_name=special_filters[filters].name;filters=special_filters[filters].filter}else{M.c._.current_filter=String(filters);filters=['.'+filters]}}if(filters.length===1&&filters[0].indexOf('.search-')===0){var filter_search=filters[0].replace('.', '');filtered=M.c._.battles.filter(function(){return $j(this).attr('class').indexOf(filter_search)>-1})}else{clog(filters.join(','));filtered=M.c._.battles.filter(filters.join(','))}if(!filter_name&&filters.length==1){if(/country/.test(filters[0])){filter_name=COUNTRIES.get(filters[0].replace('.countryID-', ''),'display')+'`s'}else{filter_name=filters[0].substr(1).toLowerCase().replace(/\b[a-z]/g,function (letter){return letter.toUpperCase()})}M.c._.current_filter=filters[0].substr(1);M.c.change_hash()}if('none'==M.c._.current_filter||'none'==filter_name){M.c._.current_filter=!1;$j('#battle_listing').removeClass('cb-battle-filtering-on');return!0}M.c.change_hash();$j('#cb-battle-listing-heading>q').text(' ('+filtered.length+') '+(filter_name?' :: '+filter_name:''));if('none'==filters.length<1||filtered.length<1){return!1}filtered.addClass('cb-filtered-out');if((filters instanceof Array)&&filters.length>1){filtered.sort(function (a,b){clog('filtered.sort');var ja=$j(a),jb=$j(b),ca=!1,cb=!1;for (var c = 0, len = filters.length; c < len; c++){if(ca===!1&&ja.hasClass(filters[c])){ca=c}if(cb===!1&&jb.hasClass(filters[c])){cb=c}if(ca!==!1&&cb!==!1){break}}return ((1*cb)-(1*ca))})}M.c._.filtered=filtered;M.c._.wrapper.append(M.c._.filtered.clone(true).removeClass('cb-filtered-out').removeAttr('id'));M.c.retipsy();$j('#battle_listing').addClass('cb-battle-filtering-on');M.c.retipsy()}},foo:false};M.a={on:function (set){if(typeof(set)!=_u){M.a._on=!!set}return !!M.a._on},o:{afight:false,aeat:false,acollect:false,acollectCO:false,co_hunt:false,x_hunt:false,epic_hunt:false,epic_hunt_travel:false,epic_hunt_division_switch:false},dischargeFF:5,init:function(){M.a.o.epic_hunt=(!!OPTS.get('epic-hunt', 'Auto'));if(M.a.o.epic_hunt&&is_monday()&&(getinfo('hour')>=24-Math.ceil(NRG.full/NRG.rate/NRG.eph()))){clog('Epic hunt = OFF :: '+getinfo('hour')+'>='+(24-Math.ceil(NRG.full/NRG.rate/NRG.eph())));M.a.o.epic_hunt=!1}M.a.o.epic_hunt_travel=(!!OPTS.get('epic-hunt-travel', 'Auto'));M.a.o.epic_hunt_division_switch=(!!OPTS.get('epic-hunt-division-switch', 'Auto'));M.a.o.epic_hunt_travel_back=!1;if(dev_()){M.a.o.epic_hunt_travel_back=(!!OPTS.get('epic-hunt-travel-back', 'Auto'))}CRPK.battles.display();M.a.o.afight=(!!OPTS.get('afight', 'Auto'));M.a.o.aeat=(!!OPTS.get('aeat', 'Auto'));M.a.o.acollect=(!!OPTS.get('acollect', 'Auto'));M.a.o.acollectCO=(!!OPTS.get('acollectCO', 'Auto'));M.a.dischargeFF=(NRG.lvlup_critical_discharge()?Math.ceil(NRG.c()/NRG.eph()):5*intval(NRG.rate/10,1));if(!is_page('wars')&&!is_page('battlefield')&&!is_page('homepage')&&!is_page('choose')){return!1}if(!M.a.fight.should()&&(M.a.o.epic_hunt||M.a.o.co_hunt||M.a.o.x_hunt)){clog('!M.a.fight.should()&&(M.a.o.epic_hunt||M.a.o.co_hunt||M.a.o.x_hunt)');M.a.hunt.init()}if(is_page('homepage')){if(!instr(oURL,'?')&&M.valid_tankKEY&&M.a.o.epic_hunt&&!za_()){setInterval(function(){M.a.hunt.epic.init('forced')},minutes(1))}if(M.a.o.afight){var reload_timeout=5;if(M.objectiveHunt){if($j('#objective_countdown_home').exists()&&!$j('#objective_listing a.std_global_btn.redColor,#objective_listing a.button_body.colour_red').exists()){var temp=$j('#objective_countdown_home').text().split(':');reload_timeout=Math.min(reload_timeout,(60*intval(temp[0],0)+intval(temp[1],0)));if(!reload_timeout||reload_timeout<1){reload_timeout=0.5}}else if($j('#objective_listing').exists()&&!$j('#objective_listing a.std_global_btn.redColor,#objective_listing a.button_body.colour_red').exists()){setTimeout(function(){M.a.hunt.objective_ajax_check()},seconds(15))}}set_win_timeout(reload_timeout*MINUTES,EREP.url);clog('afight.wait :: timeout('+reload_timeout+',EREP.url)')}M.a.eat();M.a.collect();if(!M.a.fight.should()){return M.a.backToResidence()}}else if(is_page('battlefield')){M.a.collectCO()}return M.a.hunt.init()||M.a.fight.init()||M.a.backToResidence()},hunt:{init:function(){clog('M.a.hunt.init()', 'M.a.o.x_hunt = ',M.a.o.x_hunt);if(!(M.a.o.epic_hunt||M.a.o.co_hunt||M.a.o.x_hunt)||(is_page('home')&&instr(oURL,'?')&&instr(oURL,'Post='))){return!1}if(!M.a.hunt.hasEnergyToInit()){clog('M.a.hunt.init()', 'NRG.a() < trigger_hp ', 'trigger_hp = ',M.a.hunt.getMinTriggerHP());M.a.hunt.mark.off('ALL');if(is_page('home')){set_win_timeout(5*MINUTES,EREP.url)}else{set_win_timeout(15*MINUTES,_URL_)}CRPK.battles.display();return!1}set_win_timeout(15*MINUTES,EREP.url);return (M.a.o.epic_hunt&&M.a.hunt.epic.init())||(M.a.o.co_hunt&&M.a.hunt.co.init())||(M.a.o.x_hunt&&M.a.hunt.x.init())},hasEnergyToInit:function(){return NRG.a()>=M.a.hunt.getMinTriggerHP()},getMinTriggerHP:function(){var trigger_hp=(M.b.t.et.on()?Math.min(NRG.r()*5,NRG.max/2):(NRG.max/2));if(trigger_hp<100){trigger_hp=100}else if(trigger_hp>300){trigger_hp=300}if(M.b.t.et.on()&&trigger_hp>10){trigger_hp=10}return trigger_hp},mark:{on:function (mark){'use strict';LS.set('hunt-discharging',{ts:now(),on:mark});window.name='hunt-discharge-'+mark;clog('M.a.hunt.mark.on('+mark+')', 'window.name='+window.name)},off:function (mark){'use strict';clog('M.a.hunt.mark.off('+mark+')');if(!mark){mark='epic'}if('ALL'==mark||M.a.hunt.mark.is_marked(mark)){window.name=''}if('all'==mark||LS.get('hunt-discharging',{ts:0,on:''}).on.indexOf(mark)>-1){LS.del('hunt-discharging')}},is_marked:function (mark,battleID){'use strict';return window.name.indexOf('hunt-discharge-'+mark+(battleID?battleID:''))>-1}},co:{init:function(){'use strict';return!1}},discharge:function (mode,battleID,travel,co_mode){var battle;battle=CRPK.battles.get_battle_by_id(battleID);if(CRPK.battle.iz.civil_war(battle)&&!in_array(battle.def.id,[getinfo('citizenship', 'id'),_PLAYER_.muCSID])){_q('Cannot discharge in Epic battle :: Civil War');return!1}clog('M.a.hunt.discharge('+mode+', '+battleID+', '+travel+')');M.a.hunt.mark.on(mode+battleID);if(is_page('choose-side')){return M.util.gto_choose(battleID,M.util.choose_side())}if(!is_page('battlefield')&&!is_page('/'+battleID)){return M.util.gto(battleID)}if((M.b.param('isCIVILWAR')&&M.util.is_valid_battlefield('travel'))||(mode!='autoX'&&M.util.is_valid_battlefield('invalid'))){_q('Battle or division is finished or unknown error');M.a.hunt.onerror();return!0}travel=!!travel;if(!M.b.param('id')||!M.b.param('leftID')){M.b.get_data()}var prefered_side=M.util.choose_side();if(!travel&&SERVER_DATA.travelRequired){travel=!0}if(travel&&M.a.o.epic_hunt_travel){if(M.a.o.epic_hunt_travel_back){LS.set('epic-hunt-travel-back',getinfo('location', 'id'))}if(TRAVEL.required()){return TRAVEL.tobattlefield(prefered_side)}}else if(M.a.o.epic_hunt_travel&&M.b.param('leftID')!=prefered_side&&WS.get('manual-travel')!=M.b.param('id')){return TRAVEL.switch_side()}M.b.get_data();M.b.t.reset_params();if(!$j('#fight_btn').exists()||(mode!='autoX'&&($j('#pvp_actions .action_holder').css('display')=='none'||M.b.param('finished')))){_q('Battle is finished or unknown error');M.a.hunt.onstop();return!1}if(mode=='autoX'&&M.a.o.x_hunt&&M.a.hunt.x.can()){clog('should init params here');M.a.hunt.x.init_params()}else if(mode=='epic'&&M.a.o.epic_hunt){if(SERVER_DATA.battleZoneSituation[SERVER_DATA.division]==2){M.b.param('isEPIC',SERVER_DATA.division)}if(!M.b.param('isEPIC')&&M.b.can_switch_division()){battle=CRPK.battles.get_battle_by_id(M.b.param('id'));var tank_divisions=TANK_DIVISIONS.slice().reverse(),d,divNUM;for (d in tank_divisions){if(!tank_divisions.hasOwnProperty(d)){continue}divNUM=tank_divisions[d];if(battle['is_epic_d'+divNUM]&&M.b.param('division')!=divNUM){M.b.param('isEPIC',divNUM);return M.b.switch_division(divNUM)}}}if(!M.b.param('isEPIC')){M.a.hunt.onstop();return!1}M.b.t.param('_go',1);WS.set('hunt.epic.on',1);if(M.enable_pp_x4_mode&&!za_()){if(M.valid_tankKEY){var opts=M.b.t.et.opts();M.b.t.param('wall_min',opts.wmin);M.b.t.param('wall_max',opts.wmax)}else{M.b.t.param('wall_max',52)}}if(M.valid_tankKEY){M.b.t.param('rage',1)}if(M.b.t.et.on()){M.b.t.et.init()}else{_q('Discharging FULL energy.');M.b.t.param('eb',0);M.b.t.param('ff',0)}M.b.t.abooster()}M.b.t.onstop(M.a.hunt.onstop);M.b.t.init();if(false&&co_mode){}return!0},onerror:function(){M.a.hunt.mark.off('ALL');return setTimeout(function(){gto(EREP.url)},2*MINUTES)},onstop:function(){M.a.hunt.mark.off('ALL');LS.del('current-battles');if(M.a.o.epic_hunt_travel_back){return M.a.travelBack()}return gto(EREP.url)},epic:{init:function (forced){if('forced'==forced){CRPK.battles.retrieve('forced')}CRPK.battles.init();if(M.enableObjectiveMode&&M.objectiveHunt){if(is_page('battlefield')){if(!M.b.param('id')||!M.b.param('leftID')){M.b.get_data()}if(M.b.param('isOBJECTIVE')){_q('Objective battle detected');M.a.hunt.discharge('epic',M.b.param('id'));return!0}}else if(is_page('home')){if($j('#objective_listing a.std_global_btn.redColor,#objective_listing a.button_body.colour_red').exists()){_q('Objective battle detected');var objective_url=$j('#objective_listing a.std_global_btn.redColor,#objective_listing a.button_body.colour_red').first().attr('href'),objective_arr=objective_url.split('battlefield-choose-side/')[1].split('/'),objective_battleID=intval(objective_arr[0],0),objective_sideID=intval(objective_arr[1],1),objective_battle=CRPK.battles.get_battle_by_id(objective_battleID);if(objective_battle.is_rw){if(CRPK.battle.iz.hittable(objective_battle)){return gto(objective_url)}else{return TRAVEL.tso(objective_battle.def.id,TRAVEL.get_country_regions(objective_battle.def.id)[0].id,objective_battleID,function(){return gto(objective_url)})}}else if(objective_battle.is_mpp&&!COUNTRIES.is_mpp(getinfo('location', 'id'),objective_sideID)){return TRAVEL.tso(objective_sideID,TRAVEL.get_country_regions(objective_sideID)[0].id,objective_battleID,function(){return gto(objective_url)})}else{return gto(objective_url)}}}}if(!(CRPK.battles.haz.epic()||(M.b.can_switch_division()&&CRPK.battles.haz.epic_any_div()))){if(M.a.hunt.mark.is_marked('epic')){M.a.hunt.mark.off('epic')}return CRPK.battles.display()}_q('Epic battle detected');if(M.b.can_switch_division()&&CRPK.battles.get('epic-any-div-tp').length>0){clog('epic-any-div-hittable',CRPK.battles.get('epic-any-div-tp')[0]);M.a.hunt.discharge('epic',(CRPK.battles.get('epic-any-div-tp').shift()).id);return!0}else if(CRPK.battles.get('epic-hittable').length>0){clog('epic-hittable',CRPK.battles.get('epic-hittable')[0]);M.a.hunt.discharge('epic',(CRPK.battles.get('epic-hittable').shift()).id);return!0}else if(M.b.can_switch_division()&&CRPK.battles.get('epic-any-div-hittable').length>0){clog('epic-any-div-hittable',CRPK.battles.get('epic-any-div-hittable')[0]);M.a.hunt.discharge('epic',(CRPK.battles.get('epic-any-div-hittable').shift()).id);return!0}else if(M.a.o.epic_hunt_travel){if(CRPK.battles.get('epic-travel').length>0){clog('epic-travel',CRPK.battles.get('epic-travel')[0]);M.a.hunt.discharge('epic',(CRPK.battles.get('epic-travel').shift()).id,'travel=on');return!0}else if(M.b.can_switch_division()&&CRPK.battles.get('epic-any-div-travel').length>0){clog('epic-any-div-travel',CRPK.battles.get('epic-any-div-travel'));M.a.hunt.discharge('epic',(CRPK.battles.get('epic-any-div-travel').shift()).id,'travel=on');return!0}}else{_q('Failed to join epic battle. Civil War ?')}return CRPK.battles.display()}},objective_ajax_check:function(){if(M.enableObjectiveMode&&M.objectiveHunt){$j.ajax(EREP.url).done(function (response){if(/id="objective-battle-/.test(response)&&(/class="std_global_btnredColor"/.test(response)||/class="button_bodycolour_red"/.test(response))){return gto(EREP.url)}setTimeout(function(){M.a.hunt.objective_ajax_check()},seconds(15))})}return!0},x:{on:function (set){if(typeof(set)!=_u){M.a.hunt.x._.on=!!set}return !!M.a.hunt.x._.on},_:{on:false,allowed:null,should:null,is_loaded:false,dmg_default:{'1':15,'2':17,'3':20,'4':120},battles:[],settings:{on:0,t0_dmg:0,tx:15,tx_dmg:0,on_booster:0,min_booster:20}},load:function(){if(!M.a.hunt.x._.is_loaded){$j.extend(M.a.hunt.x._.settings,OPTS.get('auto-x', 'Auto',{}));if(M.a.hunt.x._.settings.on){if(!M.a.hunt.x._.settings.t0_dmg){M.a.hunt.x._.settings.t0_dmg=M.a.hunt.x._.dmg_default[M.b.division()]}if(M.a.hunt.x._.settings.tx&&!M.a.hunt.x._.settings.tx_dmg){M.a.hunt.x._.settings.tx_dmg=cb_number(M.a.hunt.x._.settings.t0_dmg*2/3,1)}}M.a.hunt.x._.is_loaded=!0}return M.a.hunt.x._.is_loaded},init:function(){if(is_page('battlefield')&&SERVER_DATA.initialLoad){clog('M.a.hunt.x.init() -> SERVER_DATA.initialLoad is still set. Wait for battleStats.getBattleStats()');setTimeout(function(){M.a.hunt.x.init()},200);return!1}clog('M.a.hunt.x.init() -> M.a.hunt.x.can() ? ',M.a.hunt.x.can());if(M.a.hunt.x.load()&&M.a.hunt.x.can()){_q('Auto-BH battle detected');M.a.hunt.discharge('autoX',M.a.hunt.x.has_battle());return!0}return!1},allowed:function(){if(null===M.a.hunt.x._.allowed){M.a.hunt.x._.allowed=(dev_(false,!1)&&M.valid_tankKEY&&M.valid_coKEY&&zbeta_()&&M.a.hunt.x.load()&&M.a.hunt.x._.settings.on&&in_array(getinfo('uid'),[1444169,1626301,2200354,1559809])&&_PLAYER_.dph&&M.b.division());clog('M.a.hunt.x.allowed()',dev_(true,!1),M.valid_tankKEY,M.valid_coKEY,zbeta_(),M.a.hunt.x.load(),M.a.hunt.x._.settings.on,in_array(getinfo('uid'),[1444169,1626301,1559809]),_PLAYER_.dph,M.b.division())}return !!M.a.hunt.x._.allowed},should:function(){var current_bh_dmg,current_battle_t;if(is_page('battlefield')&&!(M.b.param('division_finished')||M.b.param('finished'))){current_bh_dmg=intval($j('#pvp_header > div.battle_heroes.left_side > ul > li.my_division > em').text(),0);current_battle_t=M.b.ui.get_battle_T()}else{current_bh_dmg=0;current_battle_t=0}clog('M.a.hunt.x.should()', 'current_bh_dmg=',current_bh_dmg,'current_battle_t=',current_battle_t);M.a.hunt.x._.should=(M.a.hunt.x.allowed()&&!(is_monday()&&(getinfo('hour')>=24-Math.ceil(NRG.full/NRG.rate/NRG.eph())))&&!is_tuesday()&&Math.floor(NRG.ff()*_PLAYER_.dph)>=M.a.hunt.x.bh_dmg('t0', 'in_mil')&&(!is_page('battlefield')?true:((current_battle_t<2&&!current_bh_dmg)||(M.a.hunt.x._.settings.tx&&current_battle_t>=M.a.hunt.x._.settings.tx&&current_bh_dmg<M.a.hunt.x.bh_dmg('tx', 'in_mil')))));return !!M.a.hunt.x._.should},can:function(){return M.a.hunt.x.should()&&M.a.hunt.x.has_battle()},has_battle:function(){return M.a.hunt.x._.battles.length>0?M.a.hunt.x._.battles[0].id:0},check_battles:function(){var locationID=getinfo('location', 'id'),battles=CRPK.battles.get('waiting-all-div').filter(CRPK.battle.iz.location),battle,i;for (i = 0; i < battles.length; i++){battle=battles[i];if(_PLAYER_.get_natural_division()<4&&(battle.is_airforce||battle.next_is_airforce)){continue}battle.side=M.util.choose_side(battle.inv.id,battle.def.id);if(battle.is_rw){battle.rw=battle.side}else if(COUNTRIES.is_mpp(locationID,battle.side)){battle.is_mpp=battle.side}else{battle.is_mpp=1}}M.a.hunt.x._.battles=battles;clog('M.a.hunt.x._.battles',battles);return M.a.hunt.x._.battles.length},bh_dmg:function (tx,in_mil){var bh_dmg=M.a.hunt.x._.settings[tx+'_dmg'];if(tx=='t0'){bh_dmg=cb_number(rand(bh_dmg*0.9,bh_dmg*1.1),1)}return bh_dmg*(in_mil?MILLIONS:1)},init_params:function(){clog('M.a.hunt.x.init_params()');if(M.a.hunt.x.on()&&M.b.t.param('dmg')){return!0}clog('M.a.hunt.x.init_params() ->  M.a.hunt.x.on()=!0');M.a.hunt.x.on(true);M.b.t.param('dmg',M.a.hunt.x.bh_dmg('t0'));M.b.t.param('rage',1);M.b.t.param('z_override',1);M.b.t.abooster(7200,M.a.hunt.x._.settings.min_booster);M.b.t.param('_go',1);$j('#MILITARY____dmg').val(M.b.t.param('dmg'));$j('#MILITARY____z_override,#MILITARY____rage,#MILITARY____dmg,#pvp a._go').addClass('on');if(!$j('#CPanel_MILITARY').hasClass('open')){$j('#CPanel_MILITARY > div.toggle').trigger('click')}M.b.t.init();return!0},updater:function(){if(!(is_valid_auth_key_('tank')&&is_valid_auth_key_('co')&&zbeta_()&&in_array(getinfo('uid'),[1444169,1626301,1559809]))){return!1}$j.extend(M.a.hunt.x._.settings,OPTS.get('auto-x', 'Auto',M.a.hunt.x._.settings));$j('#auto-x-pop').remove();var checked=' checked="checked"',popup=_POP({id:'auto-x-pop',title:'Auto-BH Settings',html:('<br /><label for="auto-x-on"><input type="checkbox" id="auto-x-on" '+(M.a.hunt.x._.settings.on?checked:'')+' /> Enable Auto-BH</label><br /><br /><h2>Hit at battle start</h2><p><label for="auto-x-t0_dmg"><input type="number" min="1" step="1" id="auto-x-t0_dmg" style="width:55px" value="'+M.a.hunt.x._.settings.t0_dmg+'" /> Damage in milions to hit at T0<br /><em>Script will randomize this value with +- 10%</em></label></p><br /><h1>Hit over after Tx</h1><p>Time in minutes (Tx) to check for/overhit damage.<br /><label for="auto-x-tx"><input type="number" min="0" max="90" step="1" id="auto-x-tx" style="width:55px" value="'+M.a.hunt.x._.settings.tx+'" />  {ZERO} to disable. <em>Default: minute 15</em></label></p><br /><p>Hit after Tx if damage is below:<br /><label for="auto-x-tx_dmg"><input type="number" min="1" step="1" id="auto-x-tx_dmg" style="width:55px"  value="'+M.a.hunt.x._.settings.tx_dmg+'" /> <em>{ZERO} to use {default} (2/3 of {T0 damage}).</em></label></p><br /><h2>Usage of 2h, 50% damage boosters</h2><p><label for="auto-x-on_booster"><input type="checkbox" id="auto-x-on_booster" '+(M.a.hunt.x._.settings.on_booster?checked:'')+' /> Enable usage of 50%/2h boosters</label></p><br /><p>Minimum stock of boosters to activate:<br /><label for="auto-x-min_booster"><input type="number" min="1" step="1" id="auto-x-min_booster" style="width:55px" value="'+M.a.hunt.x._.settings.min_booster+'" /> <em>Script will not activate boosters if stock is below {minimum}</em></label></p><p align="right"><br>'+cb_std_string('Save', 'green pop-btn-save')+'</p>')});$j('#auto-x-pop input').change(function(){$j.extend(M.a.hunt.x._.settings,{on:$j('#auto-x-on').is(':checked')?1:0,t0_dmg:intval($j('#auto-x-t0_dmg').val(),0),tx:intval($j('#auto-x-tx').val(),0),tx_dmg:intval($j('#auto-x-tx_dmg').val(),0),on_booster:$j('#auto-x-on_booster').is(':checked')?1:0,min_booster:intval($j('#auto-x-min_booster').val(),20)});OPTS.set('auto-x', 'Auto',M.a.hunt.x._.settings)});$j('#auto-x-pop a.pop-btn-save').click(function(){$j.extend(M.a.hunt.x._.settings,{on:$j('#auto-x-on').is(':checked')?1:0,t0_dmg:intval($j('#auto-x-t0_dmg').val(),0),tx:intval($j('#auto-x-tx').val(),0),tx_dmg:intval($j('#auto-x-tx_dmg').val(),0),on_booster:$j('#auto-x-on_booster').is(':checked')?1:0,min_booster:intval($j('#auto-x-min_booster').val(),20)});OPTS.set('auto-x', 'Auto',M.a.hunt.x._.settings);popup.fadeOut()});$j('#content>div.cb_pop').hide();popup.fadeIn();return!0}}},fight:{_search:{LIST:[],SECONDRUN:[]},init:function(){if(!M.a.o.afight||!M.a.fight.should()){return!1}set_win_timeout(5,EREP.url);clog('afight.init :: timeout(5,EREP.url)');M.a.on(true);load_breaker(true);M.a.fight._search=$j.extend(M.a.fight._search,WS.get('afsearch',{}));_q('Aproaching full energy. Discharging (3 ticks * '+NRG.rate+'/tick = '+(NRG.eph(M.a.dischargeFF))+' energy)... ');if(!M.a.fight.find_battle()){return!1}WS.del('afsearch');M.b.t.reset_params();M.b.t.param('_go',1);if(false&&M.a.o.epic_hunt){_q('Discharging FULL energy.');M.b.t.param('ff',0)}else if(dev_(false,!1)&&M.a.o.co_hunt&&$j('#list_missions_details .mission_details p.ok').exists()){_q('CO detected. Discharging while CO is on');M.a.o.acollectCO=!0;M.a.collectCO();M.b.t.param('ff',0);M.b.t.param('co',1)}else if(M.a.hunt.x.should()){M.a.hunt.x.init_params()}else{M.b.t.param('ff',M.a.dischargeFF)}M.b.t.init();return!0},should:function(){return M.a.o.afight&&NRG.update()&&(NRG.lvlup_critical_discharge()||(NRG.c()>=NRG.pool?(NRG.r()>=NRG.pool-(M.a.dischargeFF*NRG.eph())):(NRG.a()>=NRG.full-(M.a.dischargeFF*NRG.eph()))))},abort:function(){WS.del('afsearch');set_win_timeout(minutes(1),EREP.url);clog('afight.abort :: timeout(1*MINUTES,EREP.url)');_q('Aborting auto-discharge (No valid battles?). Will retry in 1 minute...');return!0},find_battle:function(){clog('M.a.fight._search',M.a.fight._search);if(empty(M.a.fight._search.LIST)){if(!empty(M.a.fight._search.SECONDRUN)){M.a.fight._search.LIST=M.a.fight._search.SECONDRUN.slice(0)}else if(!empty(M.a.fight._search.INVALID)){return M.a.fight.abort()}else{if(false===M.a.fight.collect_battles()){return 'wait'}}}if(empty(M.a.fight._search.LIST)){return M.a.fight.abort()}var battle=M.a.fight._search.LIST[0];if(is_page('choose-side')){M.util.gto_choose(battle.id,M.util.choose_side());return!1}if(is_page('battlefield')){var battleID=SERVER_DATA.battleId,battlefield_status=M.util.is_valid_battlefield();if(SERVER_DATA.onAirforceBattlefield&&!M.airforceEnabled()){battlefield_status='invalid'}if(M.airforceOnly()&&!SERVER_DATA.onAirforceBattlefield){battlefield_status='not_airforce'}_q('Evaluating battlefield ... '+battlefield_status+' battlefield.');switch(battlefield_status){case 'valid':case true:return!0;case 'travel':if(battle.is_epic&&M.a.o.epic_hunt_travel){if(battle.secondrun){return TRAVEL.tobattlefield(M.util.choose_side())}battle.secondrun=!0;M.a.fight._search.SECONDRUN.push(battle);M.a.fight._search.LIST.splice(0,1)}else{M.a.fight._search.LIST.splice(0,1);M.a.fight._search.INVALID.push(battleID)}break;case 'not_airforce':case 'friendly':if(battle.secondrun){return!0}battle.secondrun=!0;M.a.fight._search.SECONDRUN.push(battle);M.a.fight._search.LIST.splice(0,1);break;case 'invalid':case false:default:if(M.util.battleIsDO(battleID)){}M.a.fight._search.LIST.splice(0,1);M.a.fight._search.INVALID.push(battleID)}}WS.set('afsearch',M.a.fight._search);if(empty(M.a.fight._search.LIST)){return M.a.fight.abort()}battle=M.a.fight._search.LIST[0];if(battle.rw){return gto(EREP.url+'/military/battlefield-choose-side/'+battle.id+'/'+battle.rw)}return M.util.gto(battle.id)},collect_battles:function(){var battles=CRPK.battles.get('hittable'),battle,citizenshipID=getinfo('citizenship', 'id'),locationID=getinfo('location', 'id'),x;M.a.fight._search={LIST:[],SECONDRUN:[]};for (x = 0; x < battles.length; x++){battle=battles[x];if(battle.is_airforce&&!M.airforceEnabled()){continue}if(M.airforceOnly()&&!battle.is_airforce){continue}battle.is_do=M.util.battleIsDO(battle.id)?1:0;battle.is_tp=(!battle.is_cw&&in_array(citizenshipID,[battle.inv.id,battle.def.id])?1:0);battle.is_epic=CRPK.battle.iz.epic(battle);battle.co={value:0,side:0};battle.travel=!1;battle.secondrun=!1;battle.side=M.util.choose_side(battle.inv.id,battle.def.id);battle.in_need=0;battle.prio=0;if(battle.is_rw){battle.rw=battle.side}else if(COUNTRIES.is_mpp(locationID,battle.side)){battle.is_mpp=battle.side}else{battle.is_mpp=!0;battle.prio=-99}M.a.fight.calc_prio(battle);M.a.fight._search.LIST.push(battle)}if(M.a.hunt.x.allowed()&&M.a.hunt.x.should()){M.a.fight._search.LIST.sort(function (a,b){return b.start-a.start})}else{M.a.fight._search.LIST.sort(function (a,b){if(a.prio==b.prio){if(a.in_need==b.in_need){return b.is_tp-a.is_tp}return b.in_need-a.in_need}return b.prio-a.prio})}M.a.fight._search.SECONDRUN=[];M.a.fight._search.INVALID=[];WS.set('afsearch',M.a.fight._search);return M.a.fight._search.LIST},calc_prio:function (battle){var citizenshipID=getinfo('citizenship', 'id'),locationID=getinfo('location', 'id'),division=(battle.is_airforce?(M.airforceEnabled()?AIRFORCE_DIVISION:0):_PLAYER_.get_natural_division()),personal_default_sides=M.util.default_sides.get(),personal_pro_sides=(personal_default_sides.pro||[]),personal_against_sides=(personal_default_sides.con||[]),cod_prio=3,aafp=(!battle.is_rw&&battle.is_tw&&battle.afp&&!COUNTRIES.is_mpp(locationID,battle.afp));battle.in_need=0;if(!M.airforceEnabled()){battle.prio=-1000;return battle.prio}if(battle.is_tw&&battle.twp&&battle.side!=battle.twp){battle.in_need-=100}if(typeof(battle.div[division])!=_u){if(battle.div[division].wall.for!=battle.side){battle.in_need+=1;if(!aafp&&battle.afp==battle.side){battle.in_need+=2*cod_prio}}}battle.prio+=((battle.side==61&&!battle.is_tp?-1000:0)+(battle.is_do?2:0)+battle.in_need+(battle.in_need&&in_array(battle.side,personal_pro_sides)?2:0)+(in_array(battle.side,personal_against_sides)?-4:0)+(battle.id==COUNTRIES.get_cod(citizenshipID)?cod_prio:0)+(_PLAYER_.muCSID&&_PLAYER_.muCSID!=citizenshipID&&battle.id==COUNTRIES.get_cod(_PLAYER_.muCSID)?cod_prio:0)+battle.is_tp);battle.prio*=M.airforceMode();if(aafp){if(battle.prio>0){battle.prio=-10}else{battle.prio*=20}}clog('battle',battle.id,'region',battle.region.name,'aafp',aafp,'in_need',battle.in_need,'prio',battle.prio);return battle.prio}},travelBack:function(){var LsKey='epic-hunt-travel-back';if(!M.a.o.epic_hunt_travel_back||!LS.check(LsKey)){LS.del(LsKey);return gto(EREP.url)}var residence=getinfo('residence'),locationRegionID=getinfo('locationID');if(residence.hasResidence){_q('Epic Hunt Travel Back = ON. Traveling to residence.');if(locationRegionID==residence.regionId||residence.bonuses.is_in_residence){LS.del(LsKey);return gto(EREP.url)}TRAVEL.tso(residence.countryId,residence.regionId,0,function(){LS.del(LsKey);gto(EREP.url)});return!0}_q('Epic Hunt Travel Back = ON. Traveling back to previous country.');var prev_country=COUNTRIES.get(LS.get(LsKey));if(prev_country.id==getinfo('location', 'id')){LS.del(LsKey);return gto(EREP.url)}$j.ajax({url:EREP.ajax.current_regions+prev_country.id,cache:false,async:false,global:false,dataType:'json',success:function (data){if(!data.regions||data.regions.length<1){return!1}data.regions.sort(function(){return Math.round(Math.random())-0.5}).sort(function (a,b){return b.distance-a.distance});TRAVEL.tso(prev_country.id,data.regions[0].id,0,function(){LS.del(LsKey);gto(EREP.url)})}});return!0},backToResidence:function(){'use strict';clog('M.a.backToResidence()');if(!OPTS.get('auto-back-to-residence', 'Auto')){return!1}var residence=getinfo('residence'),locationRegionID=getinfo('locationID');if(!residence.hasResidence||locationRegionID==residence.regionId||!residence.bonuses||residence.bonuses.is_in_residence){return!1}if(!_LUA_.isAsleep(15)){_q('Residence bonuses have expired. You appear to be active so ...  waiting ...');return!1}if(M.a.o.epic_hunt){if(CRPK.battles.haz.epic()){return!1}else if(M.b.can_switch_division()&&CRPK.battles.haz.epic_any_div()){return!1}}_q('Residence bonuses have expired. Traveling back to residence.');TRAVEL.tso(residence.countryId,residence.regionId,0,function(){gto()});return!0},backToResidenceTimeout:function(){},eat:function(){return M.a.o.aeat&&!NRG.lvlup_critical()?NRG.heal(false)||true:false},collect:function(){if(!M.a.o.acollect){return!1}if(window['erepublik']['citizen']['dailyTasksDone']&&!window['erepublik']['citizen']['hasReward']){$j.ajax({url:'/en/main/daily-tasks-reward',type:'POST',async:false,dataType:'json',data:{_token:SERVER_DATA.csrfToken}}).done(function(){$j('#daily_pop > a.close').trigger('click')})}if(window['erepublik']['citizen']['recruitOrderDone']&&!window['erepublik']['citizen']['hasRecruitOrderReward']){$j.ajax({url:'/en/military/group-full-member',type:'POST',async:false,dataType:'json',data:{_token:SERVER_DATA.csrfToken}})}if(window['erepublik']['citizen']['dailyOrderDone']&&!window['erepublik']['citizen']['hasDailyOrderReward']){$j.ajax({url:'/en/military/group-missions',type:'POST',async:false,dataType:'json',data:{_token:SERVER_DATA.csrfToken,action:'check'}}).done(function(){$j('#mission_reward > a.close').trigger('click')})}var erpk_day=getinfo('day');LS.deprecate('anniversary_reward',!0);if(erpk_day>=3288&&erpk_day<=3297){if((zcb_()||zm_()||zbeta_())&&LS.rget('9th_anniversary_reward')!=erpk_day){$j.post('/en/main/collect-anniversary-reward',{_token:SERVER_DATA.csrfToken}).then(function(){LS.rset('9th_anniversary_reward',erpk_day)})}}else{LS.rdel('anniversary_reward')}var weekly=$j('#weeklyChallenge,#content .new_banners_wrapper div[id*="ournament"],#content .new_banners_wrapper div[class*="ournament"]');if(weekly.find('a.get_milestone_reward,a.threshold_reward,div.threshold.completed a').exists()){$j('#weekly_challenge_reward,div[id*="ournament_reward"]').remove();weekly.find('a.get_milestone_reward,a.threshold_reward').trigger('click')}return!0},collectCO:function(){if(!M.a.o.acollectCO){return!1}if(!$j('#list_missions_details label').exists()){return!1}var _co=[];$j('#list_missions_details .mission_details').each(function(){var _this=$j(this);_co.push({id:_this.find('input').first().attr('id'),ok:(_this.find('p.ok').exists()&&!_this.find('label.inactive').exists()?1:0),cc:intval(_this.find('p').eq(1).find('strong').text(),10)})});if(_co.length<1){return!1}if(_co.length>1){_co.sort(function (a,b){if(a.ok!=b.ok){return b.ok-a.ok}return b.cc-a.cc})}if($j('#label'+_co[0].id).hasClass('checked')){return!0}$j('#list_missions_details label').removeClass('checked');$j('#label'+_co[0].id).trigger('click');return!0}};OPTS.register('aeat', 'Auto Eat', 'Auto',1,function(){if(!$j(this).is(':checked')&&$j('#pkopt____Auto____afight').is(':checked')){$j('#pkopt____Auto____afight').prop('checked',!1).trigger('change')}});OPTS.register('afight', 'Auto Fight (timer)', 'Auto',0,function(){if($j(this).is(':checked')){if(!$j('#pkopt____Auto____aeat').is(':checked')){$j('#pkopt____Auto____aeat').prop('checked',!0).trigger('change')}}else{if($j('#pkopt____Auto____epic-hunt').is(':checked')){$j('#pkopt____Auto____epic-hunt').prop('checked',!1).trigger('change')}}});OPTS.register('epic-hunt', 'Hunt EPIC Battles', 'Auto',0,function(){if($j(this).is(':checked')&&!$j('#pkopt____Auto____afight').is(':checked')){$j('#pkopt____Auto____afight').prop('checked',!0).trigger('change')}});OPTS.register('epic-hunt-travel', 'Travel for EPIC Battles', 'Auto',0);OPTS.register('epic-hunt-division-switch', 'Enable Division Switching for epics (Maverick Pack)', 'Auto',1);OPTS.register('auto-back-to-residence', 'Auto-travel BACK to residence', 'Auto',1);if(M.enableObjectiveMode){OPTS.register('objective-hunt', 'Hunt MU Objectives', 'Auto',1,function(){if($j(this).is(':checked')&&!$j('#pkopt____Auto____epic-hunt').is(':checked')){$j('#pkopt____Auto____epic-hunt').prop('checked',!0).trigger('change')}});OPTS.register('objective-hunt-bazooka', 'Use Bazooka in MU Objectives', 'Auto',1)}OPTS.register('acollect', 'Auto Collect DO / Weekly Rewards', 'Auto',1);OPTS.register('acollectCO', 'Auto Collect CO (if available)', 'Auto',1);if(is_valid_auth_key_('tank')){OPTS.register('lvl-up-protection', 'Enable (auto-eat) Level-up protection', 'Auto',1)}OPTS.register('use-damage-boosters', 'Use 50% Damage Boosters (if available)', 'Auto',0);M.b={_:{id:false,spectator:false,finished:false,division_finished:false,battleT:0,isRW:false,isCIVILWAR:false,isOBJECTIVE:false,isAIRFORCE:false,isEPIC:false,nx_type:'',epic_state_d1:'cold',epic_state_d2:'cold',epic_state_d3:'cold',epic_state_d4:'cold',epic_state_d11:'cold',invert:false,left:{id:0,flag:'',name:''},leftID:0,right:{id:0,flag:'',name:''},rightID:0,player_division:0,round:1,region_name:'',v1:false,f1:false,round_points_left:0,round_points_right:0,campaign_points_left:0,campaign_points_right:0},init:function(){M.b.get_data();CRPK.angular.on_digest('#ErpkBattleStatsArea',M.b.get_data);if(WS.check('hunt.epic.on')&&!M.b.param('isEPIC')){WS.del('hunt.epic.on');return gto(EREP.url)}M.util.is_valid_battlefield();M.util.cdata();M.util.mercff.init();M.b.ui.erpk_ticker();if(M.b.param('finished')){return!1}M.xxhr.bind();M.b.ui.init();M.b.s.init();M.b.bh.init();M.b.w.init();M.xxhr.bind(this,'-stats/', 'battlefield');M.xxhr.bind(this,'fight-shoo', 'battlefield');M.xxhr.bind(this,'battle-console', 'battlefield');M.xxhr.bind(this,'pomelo-message-callback', 'battlefield');M.b.param('spectator',!1);if(!M.b.t.j_fight().exists()){var move=SERVER_DATA.showTravelPopup,against=SERVER_DATA.fightAgainstBrothers;if(move){M.b.param('spectator',!against);if(false&&WS.get('manual-travel')==M.b.param('id')){move.hide()}else{}}}M.b.param('invert',(!M.b.param('isRW')?SERVER_DATA.mustInvert:(M.b.param('spectator')?M.b.param('leftID')!=SERVER_DATA.defenderId:SERVER_DATA.mustInvert)));M.b.CPanel();$j('#pvp .img-toggle').tipsy({gravity:'s'});M.b.t.init()},CPanel:function(){var MilitaryCPpanel=CPanel.create('MILITARY', '#pvp', 'right'),_options=$j.extend(M.b.t.params,{}),panel=[];for (var optionID in _options){if(!_options.hasOwnProperty(optionID)){continue}if('wall_min'==optionID){continue}var option=_options[optionID],fullID='MILITARY____'+optionID,elem='',o_val=M.b.t.param(optionID);if('rage'==optionID&&!(M.b.param('isOBJECTIVE')||M.valid_tankKEY)){M.b.t.param(optionID,null);continue}if('z_override'==optionID){if(!M.valid_coKEY){M.b.t.z_override(false);continue}}if('checkbox'==option.type){elem='<label for="'+fullID+'"><input type="checkbox" id="'+fullID+'"'+(o_val?' checked':'')+' /> '+option.text+'</label>'}else if('text'==option.type){elem='<label for="'+fullID+'"><input type="text" id="'+fullID+'" size="3" placeholder="'+option.hint+'" value="'+(o_val?o_val:'')+'"'+(o_val?' class="on"':'')+' />  '+option.text+'</label>'}else if('img'==option.type){elem='<a href="'+VOID+'" class="img-toggle '+optionID+(o_val?' on':'')+'" id="'+fullID+'" title="'+option.text+'"></a>'}else if('kills'==optionID){var sopts=[10,25,50,75,100];if(zcb_()){sopts=[10,25,50,75,100,150,200,250,350,500]}if(o_val&&!in_array(o_val,sopts)){sopts.push(o_val)}elem='<label for="'+fullID+'"><select id="'+fullID+'"><option value="0">-</option><option value="custom">custom</option>';for (var o in sopts){if(!sopts.hasOwnProperty(o)){continue}elem+='<option value="'+sopts[o]+'"'+(o_val&&sopts[o]==o_val?' selected':'')+'>'+sopts[o]+' kills</option>'}elem+='</select> '+option.text+'</label>'}elem=$j(elem);elem.tipsy({gravity:'s',html:true});panel.push(elem)}panel.push($j('<a href="'+VOID+'" class="rlink" id="MILITARY____auto_reset_all">Reset all</a>'));panel.push($j('<a href="'+VOID+'" class="rlink" id="MILITARY____auto_notify">Settings Updated</a>'));MilitaryCPpanel.add_panel('Battlefield',panel);MilitaryCPpanel.show();$j('#CPanel_MILITARY .img-toggle').not('._go').click(function(){var _this=$j(this);_this.toggleClass('on');var optionID=_this.attr('id').split('____')[1];if('rage'==optionID&&!(M.b.param('isOBJECTIVE')||M.valid_tankKEY)){M.b.t.param(optionID,null);return!0}if('z_override'==optionID){M.b.t.z_override(M.valid_coKEY&&_this.hasClass('on'));return!0}M.b.t.param(optionID,_this.hasClass('on')?1:null);if('bh'==optionID){if(_this.hasClass('on')){$j('#MILITARY____bhdiff').parent().fadeIn(500)}else{$j('#MILITARY____bhdiff').parent().fadeOut(200)}}else if('rage'==optionID){if(_this.hasClass('on')){M.b.ui.rage_effects('on');M.b.w.rage_check('start')}else{M.b.ui.rage_effects('off');M.b.w.rage_check('stop')}}});$j('#CPanel_MILITARY input,#CPanel_MILITARY select').not('#MILITARY____kills').bind('change',function(){var _this=$j(this),fullID=_this.attr('id'),optionID=fullID.split('____')[1],ovalue=_this.val(),value=('dmg'==optionID?floatval(ovalue,null):intval(ovalue,null));if(!value){if('bhdiff'==optionID){value=5}}if(value){_this.addClass('on')}else{_this.removeClass('on')}if(value!=ovalue){_this.val(value);return!0}M.b.t.param(optionID,value)});$j('#CPanel_MILITARY #MILITARY____kills').change(function(){var value=$j(this).val();if('custom'==value){value=prompt('How many kills?');var opt;if(!is_numeric(value)){opt=$j(this).find('option[value="0"]')}else{opt=$j(this).find('option[value="'+value+'"]')}if(!opt.exists()){opt=$j('<option value="'+value+'">'+value+' kills</option>');$j(this).append(opt)}opt.prop('selected',!0)}if(!is_numeric(value)){return!1}M.b.t.param('kills',intval(value))});$j('#pvp a._go').unbind().click(function(){if($j(this).hasClass('on')){M.b.t.stop()}else{$j('#CPanel_MILITARY').addClass('open');M.b.t.start();M.b.t.abooster()}});$j('#MILITARY____auto_reset_all').click(function(){M.b.t.reset_params();M.b.t.counters.reset()});if(!M.b.t.param('bh')){$j('#MILITARY____bhdiff').parent().fadeOut(20)}},get_data:function(){if(false!==M.b.param('id')){return!1}M.b.param('id',SERVER_DATA.battleId);M.b.param('finished',SERVER_DATA.battleFinished);M.b.param('isRW',SERVER_DATA.isResistance);M.b.param('isEPIC',SERVER_DATA.battleZoneSituation[SERVER_DATA.division]==2||M.b.getEpicState()=='epic'||$j('#pvp').hasClass('epicBattle'));M.b.param('isAIRFORCE',SERVER_DATA.onAirforceBattlefield);M.b.param('isCIVILWAR',SERVER_DATA.isCivilWar);M.b.param('nx_type',(SERVER_DATA.onAirforceBattlefield?'tanks':((((SERVER_DATA.zoneId+1)%4)===0)?'aircraft':'tanks')));M.b.param('region_name',$j('#region_name_link').text().trim());M.b.epic_mode_interval();var left,right;if(typeof(SERVER_DATA.leftBattleId)!=_u){left=SERVER_DATA.leftBattleId;right=SERVER_DATA.rightBattleId}else{left=$j('#pvp_header > div.country.left_side > div.country_avatar > a > img').first().attr('src').split('/L/')[1].split('.')[0];right=$j('#pvp_header > div.country.right_side > div.country_avatar > a > img').first().attr('src').split('/L/')[1].split('.')[0]}left=COUNTRIES.get(left);right=COUNTRIES.get(right);M.b.param('left',{id:left.id,name:left.name,url:left.url});M.b.param('leftID',left.id);M.b.param('right',{id:right.id,name:right.name,url:right.url});M.b.param('rightID',right.id);M.b.param('v1',(1===right.id));M.b.param('f1',(1===left.id));M.b.param('round',SERVER_DATA.zoneId);M.b.division();$j('#pvp').addClass('cb-epic-state-'+M.b.getEpicStateNumber()+' '+(M.b.param('isCIVILWAR')?'cb-civil-war':''))},epic_mode_interval_:0,epic_mode_interval:function(){if(M.b.param('isAIRFORCE')){if(M.b.epic_mode_interval_){window.clearInterval(M.b.epic_mode_interval_)}return!1}if(M.enable_short_epics&&!M.b.epic_mode_interval_){M.b.epic_mode_interval_=window.setInterval(function(){M.b.epic_mode_interval()},seconds(5))}if(!dev_()){return M.b.param('isEPIC')}if(M.b.isEpic()){M.b.param('isEPIC',!0);M.b.param('isOBJECTIVE',!1);M.b.w.objective_switch();return M.b.param('isEPIC')}clog('epic_mode_interval()', 'M.b._.isEPIC',M.b.param('isEPIC'),'M.b.param.isOBJECTIVE',M.b.param('isOBJECTIVE'));if(!M.enableObjectiveMode||!M.objectiveHunt){return M.b.param('isEPIC')}var has_objective=M.b.has_objective();if(!has_objective){M.b.param('isEPIC',!1);M.b.param('isOBJECTIVE',!1);M.b.w.objective_switch();if(M.b.t.on()){M.b.t.stop()}return M.b.param('isEPIC')}M.b.param('isOBJECTIVE',M.b.has_active_objective());clog('epic_mode_interval()', 'M.b._.isEPIC',M.b.param('isEPIC'),'M.b.param.isOBJECTIVE',M.b.param('isOBJECTIVE'));if(M.b.param('isOBJECTIVE')){M.b.param('isEPIC',!0);if(!M.b.epic_mode_interval_){M.b.epic_mode_interval_=window.setInterval(function(){M.b.epic_mode_interval()},seconds(5))}clog('epic_mode_interval()', 'M.b.param.isOBJECTIVE -> ', 'M.b.param.isEPIC',M.b.param('isEPIC'),' -> set interval')}else{M.b.param('isEPIC',!1);M.b.param('isOBJECTIVE',!1);if(M.b.epic_mode_interval_){if(!M.enable_short_epics){window.clearInterval(M.b.epic_mode_interval_)}_q('Objective completed');M.b.w.objective_switch();window.setTimeout(function(){gto(EREP.url)},seconds(2))}if(has_objective&&!M.b.param('isOBJECTIVE')&&M.b.t.on()){M.b.t.stop()}}return M.b.param('isEPIC')},epic_wall_is_ok:function(){if(M.b.param('isEPIC')&&(M.enable_pp_x4_mode||M.enable_short_epics)){var wall=M.b.wall('left'),wall_min=M.valid_tankKEY?49:0,wall_max=51;if(M.valid_tankKEY&&!za_()){wall_min=49.5;wall_max=50.5}return wall>=wall_min&&wall<=wall_max}return!0},nbp:function(){return!0},has_objective:function(){return SERVER_DATA.hasActiveObjective&&typeof(SERVER_DATA.objective)=='object'},has_active_objective:function(){return M.b.has_objective()&&!SERVER_DATA.hasDestroyedObjective&&SERVER_DATA.objective.current_hp>0&&SERVER_DATA.objective.time_left>0},round_points:function (side,points){var param='round_points_'+side;if(typeof(points)!=_u&&is_positive_int(points)){M.b.param(param,intval(points,0))}return intval(M.b.param(param),0)},campaign_points:function (side,points){var param='campaign_points_'+side;if(typeof(points)!=_u&&is_positive_int(points)){M.b.param(param,intval(points,0))}return intval(M.b.param(param),0)},wall:function (side,points,division){if(!side||!in_array(side,['left', 'right'])){side='left'}return floatval($j('#'+(side=='right'?'red':'blue')+'_domination').text().replace('%', ''))},division:function(){if(!M.b.param('player_division')){M.b.param('player_division',_PLAYER_.get_current_division())}return M.b.param('player_division')},can_switch_division:function(){return is_valid_auth_key_('tank')&&M.a.o.epic_hunt_division_switch&&_PLAYER_.has_maverick_pack()},switch_division:function (divNUM){_q('Maverick pack is active. Switching division ...');if(!M.b.can_switch_division()||!in_array(divNUM,TANK_DIVISIONS)||divNUM==SERVER_DATA.division){return!1}$j.post('/en/main/switch-division',{battleId:M.b.param('id'),countryId:M.b.param('leftID'),zoneId:M.b.param('round'),division:divNUM,_token:SERVER_DATA.csrfToken,action:'activate'},__lambda,'json').then(function (response){if(!response.error){return gto()}});return!0},param:function (item,value){'use strict';if(typeof(item)=='string'){if(typeof(value)!=_u){M.b._[item]=value}return typeof(M.b._[item])!=_u?M.b._[item]:null}return null},isEpic:function (divNUM){if(!divNUM||!in_array(divNUM,ALL_DIVISIONS)){divNUM=M.b.division()}return M.b.getEpicState(divNUM)=='epic'},getEpicState:function (divNUM,asNumber){'use strict';asNumber=!!asNumber;if(!divNUM||!in_array(divNUM,ALL_DIVISIONS)){divNUM=M.b.division()}var epic_state=M.b.param('epic_state_d'+divNUM);if(is_positive_int(epic_state)){epic_state=(3==epic_state?'epic':(2==epic_state?'full':'cold'))}if(asNumber){return (epic_state=='epic'?3:(epic_state=='full'?2:1))}return epic_state?epic_state:'cold'},getEpicStateNumber:function (divNUM){'use strict';if(!divNUM||!in_array(divNUM,ALL_DIVISIONS)){divNUM=M.b.division()}return M.b.getEpicState(divNUM,!0)},setEpicState:function (epic_state,divNUM){'use strict';if(epic_state){if(!divNUM||!in_array(divNUM,ALL_DIVISIONS)){divNUM=M.b.division()}if(is_positive_int(epic_state)){epic_state=(3==epic_state?'epic':(2==epic_state?'full':'cold'))}if(divNUM==M.b.division()&&epic_state!=M.b.getEpicState(divNUM)){var current_epic_state=M.b.getEpicState(divNUM);if(epic_state!=current_epic_state){M.b.handleEpicStateChange(current_epic_state,epic_state)}}}return M.b.param('epic_state_d'+divNUM,epic_state)},handleEpicStateChange:function (current_epic_state,new_epic_state){'use strict';if(!dev_()){return}if(current_epic_state==new_epic_state){return}if(new_epic_state=='epic'&&!M.b.t.on()){var _timeout;if(M.a.hunt.hasEnergyToInit()){_timeout=seconds(30)}else{_timeout=minutes(6)}setTimeout(function(){gto()},_timeout)}else if(new_epic_state!='epic'&&!M.b.t.on()&&M.a.hunt.mark.is_marked('epic',M.b.param('id'))){M.b.t.param('_go',0);M.b.t.stop()}},activate_booster:function (booster,number_of_boosters){var scope=CRPK.angular.get_scope('#special_weapons_list_area');if(!scope||!scope.hasOwnProperty('activateBooster')||!booster||!booster.hasOwnProperty('activationData')||!booster['activationData'].hasOwnProperty('params')){return!1}if(!number_of_boosters||!is_positive_int(number_of_boosters)){number_of_boosters=1}var _params=booster['activationData'].params,_url=booster['activationData'].url;if(number_of_boosters>1){scope['activateBooster'](_params,_url)}for (var i = 2; i <= number_of_boosters; i++){setTimeout(function(){scope['activateBooster'](_params,_url)},(i*100))}return!0},jqx_callback:function (response,url){'use strict';var epic_state_in_division;if(instr(url,'battle-status')){}else if(instr(url,'pomelo-message-callback')){if(is_positive_int(response.division)&&typeof(response.msg)=='object'){var fighter_division=intval(response.division),is_epic_in_division=intval(response.msg.epicBattle,0)==1;epic_state_in_division=is_epic_in_division?'epic':'cold';M.b.setEpicState(epic_state_in_division,fighter_division)}M.b.ui.update()}else if(instr(url,'-stats/')){if(!response.error){for (var divX in response.battle_zone_situation){if(response.battle_zone_situation.hasOwnProperty(divX)){epic_state_in_division=(1+response.battle_zone_situation[divX]);M.b.setEpicState(epic_state_in_division,intval(divX,0))}}M.b.param('isEPIC',typeof(response.epicBattle)!=_u&&response.epicBattle>0);if(response.division){M.b.campaign_points('left',response.division[M.b.param('leftID')].total);M.b.campaign_points('right',response.division[M.b.param('rightID')].total);M.b.round_points('left',response.division[M.b.param('leftID')][M.b.division()].points);M.b.round_points('right',response.division[M.b.param('rightID')][M.b.division()].points)}M.b.ui.update()}}else if(instr(url,'fight-shoo')){if(!response.error&&response.user){M.b.param('isEPIC',response.user.epicBattle>0);if(M.b.param('isEPIC')&&M.b.getEpicState()!='epic'){M.b.setEpicState('epic')}else if(M.b.getEpicState()=='epic'){M.b.setEpicState('full')}M.b.ui.update()}}else if(instr(url,'battle-console')){if(response&&!response.error){if(response['totalPoints']){M.b.campaign_points('left',response['totalPoints'][M.b.param('leftID')]);M.b.campaign_points('right',response['totalPoints'][M.b.param('rightID')])}if(response.division){M.b.campaign_points('left',response['totalPoints'][M.b.param('leftID')]);M.b.campaign_points('right',response['totalPoints'][M.b.param('rightID')]);M.b.round_points('left',response.division[M.b.division()]['countries'][M.b.param('leftID')]['roundDominationPoints']);M.b.round_points('right',response.division[M.b.division()]['countries'][M.b.param('rightID')]['roundDominationPoints']);for (var divNUM in response.division){if(!response.division.hasOwnProperty(divNUM)){continue}M.b.wall('left',response.division[divNUM]['countries'][M.b.param('leftID')].wall,divNUM);M.b.wall('right',response.division[divNUM]['countries'][M.b.param('rightID')].wall,divNUM);epic_state_in_division=(1+response.division[divNUM]['battleIntensityScale']);M.b.setEpicState(epic_state_in_division,intval(divNUM,0))}M.b.param('isEPIC',M.b.getEpicState()=='epic')}if(response['totalPoints']||response.division){M.b.ui.update()}}}}};/***M.xxhr[ajaxbind,ajax/jqx_callbacks]*@extendsM.b*@type{Object.<string,*>}*/M.xxhr={bound:false,callbacks:{},bind:function (_module,_filter,_module_name){if(typeof(_module)=='object'&&typeof(_filter)=='string'){if(typeof(_module.jqx_callback)=='function'){M.xxhr.callbacks[(_module_name||'')+'--'+_filter]={callback:_module.jqx_callback,filter:_filter}}else{clog('xhr.bind failed :: '+_filter+' :: module not found or ajax/jqx_callback method unavailable')}}if(!M.xxhr.bound){$j(document).ajaxSuccess(function (e,xhr,opts){try{M.xxhr.callback(xhr,opts.url)}catch(e){clog('error in M.xxhr.callback', '_filter = ',_filter,'_module_name = ',_module_name);clog(e.name,e.message);clog(e)}});if(is_page('/battlefield')&&typeof(window['pomelo'])=='object'){window['pomelo'].on('onMessage',function (data){try{M.xxhr.callback(data,'pomelo-message-callback')}catch(e){clog('error in pomelo M.xxhr.callback', '_filter = ',_filter,'_module_name = ',_module_name);clog(e.name,e.message)}})}M.xxhr.bound=!0}return M.xxhr.bound},callback:function (xhr,url){if(instr(url,'pubnub.com')){return!1}var response=!1;try{if(instr(url,'-stats/')){if(!response){response=json_parse(xhr,url)}if((response.error&&'too many requests'==response.message)||(is_page('battlefield')&&!(response.division&&response.division[M.b.param('leftID')]))){return!0}if(!response.error&&response.division&&(!M.b.param('leftID')||response.division[M.b.param('leftID')])){if(M.b.param('id')&&typeof(response.battle_zone_situation)!=_u){for (var divX in response.battle_zone_situation){if(response.battle_zone_situation.hasOwnProperty(divX)){var epic_state_in_division=(1+response.battle_zone_situation[divX]);M.b.setEpicState((epic_state_in_division==3?'epic':(epic_state_in_division==2?'full':'cold')),intval(divX,0))}}M.b.param('isEPIC',M.b.getEpicState()=='epic')}if(M.b.param('id')&&(response.zone_finished||Math.max(response.division[M.b.param('leftID')][M.b.division()].domination,response.division[M.b.param('rightID')][M.b.division()].domination)>=1800)){M.b.param('division_finished',!0);$j('#pvp').addClass('z_waiting');if(!M.b.t.param('z_override')&&M.b.t.on()){M.b.t.param('_go',0);return M.b.t.stop()}}}}}catch(e){clog('error in M.xxhr.callback :: -stats/ :: ', 'M.b._.left.id = '+M.b.param('leftID'),'M.b._.right.id = '+M.b.param('rightID'),e.name,e.message);clog('response :: ',response)}for (var key in M.xxhr.callbacks){if(!M.xxhr.callbacks.hasOwnProperty(key)){continue}var c=M.xxhr.callbacks[key];if(url.indexOf(c.filter)>-1){if(!response){if(instr(url,'pomelo-message-callback')&&typeof(xhr)=='object'){response=xhr}else{response=json_parse(xhr,url)}}try{c.callback(response,url)}catch(e){clog('error in M.xxhr.callback :: '+key+' :: ',e.name,e.message);clog(e)}}}}};M.b.ui={init:function(){set_win_timeout(10,_URL_);M.b.ui.erpk_ticker();M.b.ui.tweak();M.xxhr.bind(this,'nbp-stats', 'ui');M.xxhr.bind(this,'battle-status', 'ui');M.xxhr.bind(this,'pomelo-message-callback', 'ui');M.b.ui.battle_heroes();M.b.ui.title();if(M.b.param('isCIVILWAR')&&!$j('#dictatorship_move').exists()&&(getinfo('citizenship', 'id')==M.b.param('leftID')||_PLAYER_.muCSID==M.b.param('leftID'))){$j('<a id="dictatorship_move" class="action_btn" href="'+VOID+'"><span class="cb-icon-16">Move</span></a>').click(function(){TRAVEL.to(intval($j("#country_list").val()),intval($j("#region_list").val().replace('reg_id_', '')))}).appendTo($j('#content > div.move_to_region > div > span.info_content'))}$j('#pvp,#pvp_header').addClass('cb');M.b.ui.dpm.init();M.b.ui.header();M.b.ui.display_battle_T();if(dev_()&&M.enableObjectiveMode){M.xxhr.bind(M.b.ui,'fight-listObjectives', 'ui')}if(M.valid_tankKEY){M.b.ui.travel_buttons()}$j('#pvp_header .battle_heroes a.toggle_btn').click(function(){$j('#pvp_header .battle_heroes.'+($j(this).parent().hasClass('left_side')?'right':'left')+'_side').toggleClass('show')});M.b.ui.expanded_battlefield();return!0},expanded_battlefield:function(){$j('<div id="cb_pvp_expander"><a href="'+VOID+'" class="expand fa fa-expand"></a><a href="'+VOID+'" class="fullscreen fa fa-arrows-alt"></a></div>').appendTo('#content');$j('#cb_pvp_expander>a').click(function(){var _this=$j(this),container=$j('#content');if(_this.hasClass('expand')){if(container.hasClass('fullscreen-battlefield')){container.removeClass('fullscreen-battlefield')}else if(_this.hasClass('fa-expand')){container.addClass('expanded-battlefield')}else{container.removeClass('expanded-battlefield fullscreen-battlefield')}_this.toggleClass('fa-expand fa-compress')}else if(container.hasClass('fullscreen-battlefield')){container.removeClass('expanded-battlefield fullscreen-battlefield')}else{container.addClass('expanded-battlefield fullscreen-battlefield')}_this.toggleClass('active')});return!0},deploy_for_all:function (response){if(dev_(false,!1)||!M.enableObjectiveMode||!response||response.error||!response.message||response.message.length<2){return!0}$j('#crpk-deploy-all-div').remove();$j('#objectivesItemDetailsContainer').prepend('<div class="objective_item" id="crpk-deploy-all-div"><div class="objective_info"><span class="objective_icon"></span><div class="objective_infos"><span class="objective_title">Deploy for ALL</span><span class="objective_subtitle">Available Regiments</span></div><div class="objective_activation"><div class="objective_activation_row"><a href="javascript:;" id="crpk-deploy-all" class="objective_activate"><span class="inactive_text">Deploy ALL</span></a></div></div></div></div>');$j('#crpk-deploy-all').unbind().click(function (event){event.preventDefault();event.stopPropagation();var data={_token:SERVER_DATA.csrfToken,battleId:SERVER_DATA.battleId,zoneId:SERVER_DATA.zoneId,sideCountryId:SERVER_DATA.countryId,regimentId:0};$j('#objectivesItemDetailsContainer > div[id*="objective_listing_regiment_"]').each(function(){data.regimentId=$j(this).attr('id').replace('objective_listing_regiment_', '');$j.post(EREP.url+'/main/fight-deployObjective',data)})});return!0},dpm:{_ts:0,_ts_start:0,start:0,current:0,visible:false,init:function(){M.xxhr.bind(M.b.ui,'fight-shoo', 'ui');M.xxhr.bind(M.b.ui,'deploy-bomb', 'ui');M.b.ui.dpm._ts_start=WS.get('dpm_ts_start',0);M.b.ui.dpm.start=WS.get('dpm_start',intval($j('#total_damage strong').text()));M.b.ui.dpm.current=WS.get('dpm_current',M.b.ui.dpm.start);$j('#total_damage').attr('title', '').attr('orginal-title', '');$j('#total_damage').append('<em></em>');$j('<div class="r3px" id="cb-dpm" title="Damage per minute (hit speed)">'+'<i>DPM:</i> <q>0</q>'+'<a id="cb-dpm-reset" href="'+VOID+'"">'+RELOAD_ARR+'</a>'+'</div>').tipsy({gravity:'s'}).appendTo('#pvp .fight_panel');$j('#pvp').addClass('cb-dpm');$j('#cb-dpm-reset').click(function(){M.b.ui.dpm.reset()});return!0},update:function(){'use strict';var elapsed=Math.ceil((now()-M.b.ui.dpm._ts_start)/1000);if(elapsed<5){return!1}var dpm=k_number_format(((M.b.ui.dpm.current-M.b.ui.dpm.start)/elapsed)*60);$j('#cb-dpm q').text(dpm+' / min');if(!M.b.ui.dpm.visible){$j('#cb-dpm').slideDown();M.b.ui.dpm.visible=1}},reset:function(){'use strict';M.b.ui.dpm._ts_start=M.b.ui.dpm.start=M.b.ui.dpm.current=0;WS.set('dpm_ts_start',0);WS.set('dpm_start',0);WS.set('dpm_current',0);return M.b.ui.dpm.update()},shoot_callback:function (response){var _now=now();if(!M.b.ui.dpm._ts_start||M.b.ui.dpm._ts+5*MINUTES<_now){M.b.ui.dpm._ts_start=_now;WS.set('dpm_ts_start',M.b.ui.dpm._ts_start)}M.b.ui.dpm._ts=_now;if(!response){return!0}if(response.user&&response.user.givenDamage){M.b.ui.dpm.current+=intval(response.user.givenDamage)}else if(response['bomb']){M.b.ui.dpm.current+=intval(response['bomb'].damage)}return M.b.ui.dpm.update()}},ticker:0,erpk_ticker:function(){if(!M.b.param('finished')&&M.b.s.on()){$j('#pvp').removeClass('hide_partial_elements');if(!window['statsInterval']||(window['battleFX']&&window['battleFX'].battle_stoped)){window['battleFX'].stopBattle=function(){return!0};window['battleFX'].battle_stoped=!1;window['statsInterval']=window.setInterval(function(){window['battleStats']['getBattleStats']()},seconds(30))}}$j('.tipsy').remove();clearInterval(window['globalSleepInterval']);window['globalSleepTimeout']=500;window['globalSleepTick']=240;window['sleepPopupShown']=!0;if(!M.b.ui.ticker){M.b.ui.ticker=setInterval(function(){M.b.ui.erpk_ticker()},seconds(10))}return!0},tweak:function(){$j('#health_limit_now,#go_help,.go_enemy_defeated.fadeInUp,#health_warning,#hit_explosion,#final_explosion').remove();window['shortcut'].add('f',function(){$j('#fight_btn').click()},{disable_in_input:true});window['shortcut'].add('s',function(){$j('#heal_btn').click()},{disable_in_input:true});window['shortcut'].add('d',function(){$j('#heal_btn').click()},{disable_in_input:true});window['shortcut'].add('b',function(){$j('#pvp a.deploy_bomb').has('em.item_no').first().click()},{disable_in_input:true});window['openConsole']=window['closeConsole']=window['toggleConsole']=function(){return!0};window['shortcut'].remove('Shift+q');window['shortcut'].add('Shift+q',function(){M.b.ui.toggleConsole()},{disable_in_input:true});$j('#pvp_header .campaign_toggler').unbind().click(function(){M.b.ui.toggleConsole()});$j('#fight_btn').addClass('cb-kbd-bound').attr('title', 'Press {F} key to Fight');$j('#heal_btn').attr('title', 'Press {S} key to Heal');$j('#shortcut_list ul').empty().append('<li><strong>Battle Console</strong><em>Shift + Q</em></li>'+'<li><strong>[CB] Fight</strong><em>F</em></li>'+'<li><strong>[CB] Heal</strong><em>S *or* D</em></li>'+'<li><strong>[CB] Deploy bomb</strong><em>B</em></li>');M.b.ui.below_pvp('<td id="cb-kbd-tooltip"><b>shift+k</b> for keyboard shortcuts</td>');$j('#console_menu > ul > li.tabItem:not(.disabled)').each(function (index){var _this=$j(this),indexx=index+1;_this.attr('data-index',indexx).addClass('cbound').attr('title', 'Shift + '+indexx+' to open. Shift+Q to close.');window['shortcut'].add('Shift+'+indexx,function(){$j('#console_menu>ul>li.tabItem.cbound[data-index="'+indexx+'"]').trigger('click')})}).tipsy({gravity:'s'});return!0},openConsole:function(){var angularScope=CRPK.angular.get_scope('#ErpkBattleStatsArea');if(angularScope){angularScope.openConsole('currentBattleZone');angularScope.$apply()}return!0},closeConsole:function(){var angularScope=CRPK.angular.get_scope('#ErpkBattleStatsArea');if(angularScope){angularScope.closeConsole();angularScope.$apply()}return!0},toggleConsole:function(){var angularScope=CRPK.angular.get_scope('#ErpkBattleStatsArea');if(angularScope){if(angularScope.settings['showConsole']){angularScope.closeConsole()}else{angularScope.openConsole('currentBattleZone')}angularScope.$apply()}return!0},wait_for_next_round:function(){'use strict';M.b.ui.openConsole();var wait_string=$j('#time_until span').text().trim(),wait;if(wait_string){wait=intval(wait_string.split(':')[0],5);if(wait<1){wait=seconds(30)}wait=wait<1?seconds(30):minutes(wait)}else{wait=minutes(5)}return setTimeout(function(){gto()},wait)},co_data:function (campaigns){'use strict';if(campaigns&&campaigns.length>0){M.a.collectCO();for (var i = 0; i < campaigns.length; i++){var c=campaigns[i],jc=$j('#label'+c.id);if(!jc.exists()){continue}jc.find('small>i').first().css('font-weight', 'normal').text('[ '+c['owner_entity_id']+' ]');jc.find('strong').first().css('font-weight', 'normal').text(c['military_unit_name']+' | '+cb_number_format(c.budget,' ',0)+' cc');if(!jc.hasClass('cb')){var _link=EREP.url+(c['owner_entity_type']=='military_unit'?'/military/military-unit/'+c['owner_entity_id']:'');jc.addClass('cb').find('img.mu_pic').wrap('<a class="cb-owner-link" href="'+_link+'"></a>')}if(zcb_()){jc.addClass('cbx');$j('<div class="cb-co-info"></div>').css({width:'30px',height:'30px',position:'absolute',top:'5px',left:'-35px',background:'red'}).appendTo(jc)}}}return!0},battle_heroes:function(){$j('#pvp_header .battle_heroes ul').each(function(){var ul=$j(this),li=ul.children('li');li.find('span').append('<a class="cb_t5_hero t5_hero_damage" href="'+VOID+'"></a>');li.append('<div class="r3px cb_t5 cb_t5_damage"></div>').sort(function (a,b){return intval($j(b).attr('class').split(' ')[0].split('_')[1])-intval($j(a).attr('class').split(' ')[0].split('_')[1])});ul.empty().append(li);if(M.valid_tankKEY&&M.enable_kills_top5){li.append('<div class="r3px cb_t5 cb_t5_kills"></div>')}});$j('#pvp_header .battle_heroes li.division_'+M.b.division()).addClass('my_division');return!0},top5_callback:function (response){'use strict';var strategic=M.b.s.on(),i,data,id,fighter;for (var division in response.stats.current[M.b.param('round')]){if(!response.stats.current[M.b.param('round')].hasOwnProperty(division)){continue}if(!strategic&&division!=M.b.division()){continue}for (var cID in response.stats.current[M.b.param('round')][division]){if(!response.stats.current[M.b.param('round')][division].hasOwnProperty(cID)){continue}var side=M.b.param('rightID')==cID?'right':'left',top5_li=$j('#pvp_header .battle_heroes.'+side+'_side .division_'+division),hero_damage=top5_li.find('.cb_t5_hero.t5_hero_damage'),container_damage=top5_li.children('.cb_t5_damage'),t5_damage=response.stats.current[M.b.param('round')][division][cID]['top_damage'];top5_li.addClass('show').css('display', 'block');container_damage.empty().addClass('t5_'+side);for (i = 0; i < t5_damage.length; i++){data=t5_damage[i];id=data.citizen_id;fighter=response['fightersData'][id];if(!fighter){fighter=SERVER_DATA.hasOwnProperty('fightersData')?SERVER_DATA.fightersData[id]:false;if(!fighter){fighter={name:'Player '+id,avatar:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACklEQVR4nGMAAQAABQABDQottAAAAABJRU5ErkJggg=='}}}if(i===0){hero_damage.attr('href',EREP.url+'/citizen/profile/'+id);top5_li.find('>em').text(cb_number_format(data.damage,','));continue}container_damage.append('<a href="'+EREP.url+'/citizen/profile/'+id+'" title="'+fighter.name.replace('...', '')+'"><img src="'+fighter.avatar+'" />'+cb_number_format(data.damage,' ',0,11,'-')+'</a>')}if(!M.enable_kills_top5||!M.valid_tankKEY){continue}var container_kills=top5_li.children('.cb_t5_kills'),t5_kills=response.stats.current[M.b.param('round')][division][cID]['top_kills'];if(division!=M.b.division()){container_kills.remove();continue}container_kills.empty().addClass('t5_'+side).append('<a class="t5_title" href="'+VOID+'">Kills</a>');for (i = 0; i < t5_kills.length; i++){data=t5_kills[i];id=data.citizen_id;fighter=response['fightersData'][id];if(!fighter){fighter=SERVER_DATA.hasOwnProperty('fightersData')?SERVER_DATA.fightersData[id]:false;if(!fighter){fighter={name:'Player '+id,avatar:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACklEQVR4nGMAAQAABQABDQottAAAAABJRU5ErkJggg=='}}}container_kills.append('<a href="'+EREP.url+'/citizen/profile/'+id+'" title="'+fighter.name.replace('...', '')+'"><img src="'+fighter.avatar+'" />'+cb_number_format(data.kills,' ',0,4,'-')+'</a>')}}}$j('.t5_left a').addClass('vcard-bound').tipsy({gravity:'w'});$j('.t5_right a').addClass('vcard-bound').tipsy({gravity:'e'});return!0},fix_my_damage:function (stats){'use strict';var data=M.util.get_personal_stats(stats,M.b.param('round'),M.b.param('leftID'));if(data){$j('#total_damage>strong').text(cb_number_format(intval(data.damage),',',0));if(data.kills){$j('#total_damage>em').text(cb_number_format(intval(data.kills),',',0)+' kills')}}return!0},header:function(){'use strict';if(!$j('#cb_battle_time').exists()){$j('#pvp .region_name').append('<q>Round '+M.b.param('round')+'</q><q id="cb-epic-state"></q><q id="cb_battle_time"></q>'+((M.valid_tankKEY||M.valid_modKEY)?'<q id="cb_battle_ppm"></q>':'')+'<a id="battle-watcher-link" target="_blank" title="Battle Watcher (eRepublik-Deutschland.de)" href="'+http('www.erepublik-deutschland.de/en/tools/battlewatcher/detail/'+M.b.param('id'))+'"><b class="cb-icon cb-icon-16 erep_de_link"></b> Battle Watcher</a>')}M.b.ui.display_battle_T();return!0},display_battle_T:function(){'use strict';var elapsed=M.b.ui.get_battle_T(),ppm='';M.b.param('battleT',elapsed);if(!za_()&&(M.valid_tankKEY||M.valid_modKEY)){$j('#cb_battle_ppm').text(M.b.ui.get_battle_PPM())}if(elapsed>=120){$j('#cb_battle_time').html('Waiting').attr('class', '')}else{$j('#cb_battle_time').html('T <b>'+elapsed+'</b>'+ppm).addClass(elapsed>=90?'t90':(elapsed>=60?'t60':(elapsed>=30?'t30':'t0')))}setTimeout(function(){M.b.ui.display_battle_T()},seconds(15));return!0},get_battle_T:function(){'use strict';/*var battle_start=SERVER_DATA['battle_start_at'],elapsed=Math.floor(Math.abs(now()-battle_start)/MINUTES);*//*<emid="time_until"class="hasCountdown"><spanclass="countdown_rowcountdown_amount">02:53</span></em>*/return Math.floor(Math.abs(now()-SERVER_DATA['battle_start_at'])/minutes(1))},get_battle_PPM:function(){'use strict';var elapsed=M.b.ui.get_battle_T();return (elapsed>=90?60:(elapsed>=60?30:(elapsed>=30?20:10)))},title:function(){'use strict';if(M.b.s.on()){return!0}var points_left=M.b.campaign_points('left'),points_right=M.b.campaign_points('right');if(points_left+points_right>0){page_title(M.b.param('region_name')+' |  '+points_left+' - '+points_right)}else{page_title(M.b.param('region_name'))}return!0},below_pvp:function (stuff){'use strict';var below=$j('#cb-below-pvp tr');if(!below.exists()){$j('<br clear="both"/><table id="cb-below-pvp" class="cb-new"><tr></tr></table>').insertAfter('#content');below=$j('#cb-below-pvp tr')}stuff=$j(stuff);stuff.appendTo(below);return stuff},travel_buttons:function(){'use strict';if(!M.valid_tankKEY){return!1}M.b.get_data();if(M.b.param('isCIVILWAR')){return!1}$j('<a class="db_activation '+(M.b.param('isRW')?'cb-battlefield-travel-button-rw':'cb-battlefield-travel-button-mpp')+'" id="cb-battlefield-travel-button" href="'+VOID+'" title="Switch Battlefield Sides'+(M.b.param('isRW')?'':'<br/>(Ticket or CC will be used)')+'"></a>').click(function(){return TRAVEL.switch_side('no-tso')}).tipsy({gravity:'s',html:true}).appendTo('#special_items_list');return!0},rage_effects:function (toggle_on_off){'use strict';if('on'==toggle_on_off||'on-no-effects'==toggle_on_off){if(is_valid_auth_key_('military')&&!OPTS.get('enable-rage-effects', 'Military')){toggle_on_off='on-no-effects'}$j('#pvp,#fight_btn,#pvp>div.battle_footer>div.fight_panel').addClass('rage');window['nbpTransitionFilter']=!1;window['nbpFireFilter']=!1;window['nbpBombsFilter']=!1;if('on-no-effects'==toggle_on_off){$j('#pvp').addClass('no-rage-effects')}else{$j('#pvp').addClass('rage-effects');window['battleFX']['populatePlayerDataOriginal']=window['battleFX']['populatePlayerData'];window['battleFX']['populatePlayerData']=function(){return!0};window['battleFX']['populatePlayerDataChanged']=!0}$j('#pvp.cb.rage>div.console_overlay').unbind().click(function(){if($j('#pvp').hasClass('console')){M.b.ui.toggleConsole();return!0}if($j('#pvp').hasClass('rage')){M.b.ui.rage_effects('on-no-effects')}});return!0}if($j('#pvp').hasClass('rage')){window['nbpTransitionFilter']=('off'!==window['currentNbpTransitionFilter']);window['nbpFireFilter']=('off'!==window['currentNbpFireFilter']);window['nbpBombsFilter']=('off'!==window['currentNbpBombsFilter']);if(window['currentNbpPlayerRateFilter']!=window['nbpPlayerRateFilter']){window['nbpPlayerRateFilter']=window['currentNbpPlayerRateFilter'];if(window['isNbpSocketClosed']){window['connectBattleSocket']()}if(typeof(window['battleFX']['populatePlayerDataChanged'])=='boolean'&&window['battleFX']['populatePlayerDataChanged']&&typeof(window['battleFX']['populatePlayerDataOriginal'])=='function'){window['battleFX']['populatePlayerData']=window['battleFX']['populatePlayerDataOriginal'];window['battleFX']['populatePlayerDataOriginal']=function(){return!0};window['battleFX']['populatePlayerDataChanged']=!1}}}$j('#pvp,#fight_btn,#pvp>div.battle_footer>div.fight_panel').removeClass('rage');return!0},ui_update_state_:'',update:function(){'use strict';var ui_update_state=[M.b.getEpicStateNumber(),M.b.campaign_points('left'),M.b.campaign_points('right')].join('-');if(ui_update_state==M.b.ui.ui_update_state_){return!0}M.b.ui.ui_update_state_=ui_update_state;$j('#pvp').removeClass('cb-epic-state-1 cb-epic-state-2 cb-epic-state-3').addClass('cb-epic-state-'+M.b.getEpicStateNumber());$j('#pvp_header > div.domination > div.region_name > p > span:nth-child(1) > em').text(M.b.campaign_points('left'));$j('#pvp_header > div.domination > div.region_name > p > span:nth-child(3) > em').text(M.b.campaign_points('right'));M.b.ui.title();return!0},jqx_callback:function (response,url){if(instr(url,'battle-status')){if(in_array(response.message,['BATTLE_END_PROCESSING', 'BATTLE_CLOSED'])){M.b.ui.wait_for_next_round()}}else if(instr(url,'-stats/')){if(response.error){clog('response.error in -stats :: ',response.message);return!1}if(response.campaigns){M.b.ui.co_data(response.campaigns)}if(SERVER_DATA.division==M.b.division()){M.b.ui.fix_my_damage(response.stats)}M.b.ui.update();return M.b.ui.top5_callback(response)}else if(instr(url,'fight-shoo')||instr(url,'deploy-bomb')){return M.b.ui.dpm.shoot_callback(response)}else if(instr(url,'fight-listObjectives')){M.b.ui.deploy_for_all(response)}},rebind_travel_popup:function(){if(!is_page('battlefield')||!(SERVER_DATA.spectatorOnly||SERVER_DATA.travelRequired||SERVER_DATA.fightAgainstBrothers)){return!0}window['erepublik']['functions'].launchTravelPopup=function (params,cbound){clog('launchTravelPopup intercepted (military).', 'params = ',params);if(typeof(cbound)!=_u){M.b.ui.launch_travel_popup(params)}};$j('#changeLocationHeaderBtn,.erpkLaunchTravelPopButton').unbind().click(function (e){e.preventDefault();M.b.ui.launch_travel_popup({battleId:SERVER_DATA.battleId})});setTimeout(function(){$j('#travelPopup > div.erpk_travel > a.close').trigger('click');$j('#travelPopup').trigger('close');setTimeout(function(){$j('#travelPopup').trigger('close')},1500)},500);if(!SERVER_DATA.spectatorOnly||SERVER_DATA.isCivilWar){return!0}var travel_box=$j('#cb_battlefield_travel');if(travel_box.length>0){return!0}M.b.get_data();var c_left=M.b.param('left'),c_right=M.b.param('right');travel_box=$j('<div id ="cb_battlefield_travel" class="move-and-join-wrap'+(SERVER_DATA.isResistance?' move-and-join-rw':'')+'">'+(SERVER_DATA.spectatorOnly?'<a href="'+VOID+'" class="move-and-join join-left">Move and join <b>'+c_left.name+'</b> <img src="/images/flags_png/M/'+c_left.url+'.png" /></a>':'')+'<a href="'+VOID+'" class="move-and-join join-right"><img src="/images/flags_png/M/'+c_right.url+'.png" /> Move and join <b>'+c_right.name+'</b></a>'+'</div>').appendTo('#pvp > div.battle_footer');travel_box.find('>a.move-and-join').click(function(){travel_box.find('>a.move-and-join').unbind();var _this=$j(this),joinCountryID=(_this.hasClass('join-right')?M.b.param('rightID'):M.b.param('leftID')),moveCountryID=SERVER_DATA.isResistance?SERVER_DATA.defenderId:joinCountryID,regionID=TRAVEL.get_country_regions(moveCountryID)[0].id,battleID=SERVER_DATA.battleId,joinURL=EREP.url+'/military/battlefield-choose-side/'+battleID+'/'+joinCountryID;_this.css('opacity',0.25);WS.set('manual-travel',M.b.param('id'));TRAVEL.to(moveCountryID,regionID,battleID,function(){return gto(joinURL)})})},launch_travel_popup:function (params){var options={'redraw':true,'params':{'holdingId':0,'battleId':0,'regionId':0}};if(typeof(params)=='object'){if(params.holdingId){options.params.holdingId=params.holdingId}if(params.battleId){options.params.battleId=params.battleId}if(params.regionId){options.params.battleId=params.regionId}}window['generalPopup']['renderPopup']('travelPopup',options)}};OPTS.register('stratbf', 'Extended info Battlefield View', 'Military',0);M.b.s={on:function(){if(typeof(M.b.s._on)==_u){M.b.s._on=!!OPTS.get('stratbf', 'Military')}return M.b.s._on},init:function(){if(!is_page('battlefield')){return!0}$j('#pvp').append('<label for="stratbf" id="stratbf-label" class="bbg r3px"><input type="checkbox" id="stratbf"'+(M.b.s.on()?' checked':'')+' />Strategic View</label>');$j('#stratbf').change(function(){var t=$j(this).is(':checked')?1:0;OPTS.set('stratbf', 'Military',t);if(t){return gto(_URL_)}else{M.b.s._on=!1;$j('.cbd,.cbdp').fadeOut(function(){$j(this).remove()})}});if(!M.b.s.on()){return!0}M.b.s._on=!0;M.xxhr.bind(this,'-stats', 'strategic');M.b.s.walls();window['battleStats']['getBattleStats']();var battlefieldURL=_URL_.replace('-new', '');if(M.b.param('isRW')){battlefieldURL=battlefieldURL.replace('/battlefield/', '/battlefield-choose-side/')+'/'+M.b.param('leftID')}if(battlefieldURL!=_URL_){M.b.ui.below_pvp('<td id="cb-battlefieldURL">'+battlefieldURL+'</td>').attr('contenteditable',!0).click(function(){_d.execCommand('selectAll',!1,null)})}return M.b.s.on()},title:function (data){if(!data||!data.domination){return!1}page_title([cb_number(M.b.param('invert')?(100-data.domination[M.b.division()]):data.domination[M.b.division()],1)+'%','|',M.b.param('region_name')].join(' '))},_t5_data:false,walls:function (response){if(!M.b.s.on()){return!1}M.b.ui.erpk_ticker();if(!response||response.error){return!1}if(!$j('#cbdd1,#cbdd11').exists()){var ze_walls;if(M.b.param('isAIRFORCE')){ze_walls='<div id="cbdd11" class="cbd" title="Airforce"><b></b><i><q>%</q></i><u></u><s></s><em class="l"></em><em class="t"></em><em class="r"></em></div>'}else{ze_walls='<div id="cbdd1" class="cbd" title="Division 1"><b></b><i><q>%</q></i><u></u><s></s><em class="l"></em><em class="t"></em><em class="r"></em></div>'+'<div id="cbdd2" class="cbd" title="Division 2"><b></b><i><q>%</q></i><u></u><s></s><em class="l"></em><em class="t"></em><em class="r"></em></div>'+'<div id="cbdd3" class="cbd" title="Division 3"><b></b><i><q>%</q></i><u></u><s></s><em class="l"></em><em class="t"></em><em class="r"></em></div>'+'<div id="cbdd4" class="cbd" title="Division 4"><b></b><i><q>%</q></i><u></u><s></s><em class="l"></em><em class="t"></em><em class="r"></em></div>'}$j(ze_walls).click(function(){M.b.ui.erpk_ticker()}).hide().appendTo('#pvp_header .domination').fadeIn();$j('#cbdd'+M.b.division()).addClass('cbdda');var box=$j('#cb-battlefield-center-box');if(!box.exists()){box=$j('<div id="cb-battlefield-center-box"></div>');$j('#pvp').append(box)}box.prepend('<div id="cb-battlefield-round-points"></div>');if(M.valid_modKEY){$j('#cb_battlefield_get_co').trigger('click')}}if(!response||response.error){return!1}var walls_data=response.division,zone_situation=response.battle_zone_situation,top5_data=response.stats.current[M.b.param('round')],domination=walls_data.domination,round_points=0,estimate_l=1*M.b.campaign_points('left'),estimate_r=1*M.b.campaign_points('right'),ws_data_key='t5-data-'+M.b.param('id')+'-'+M.b.param('round');WS.del(ws_data_key);if(!M.b.s._t5_data){M.b.s._t5_data={1:$j.extend({left:{},right:{}},WS.get(ws_data_key+'-1')),2:$j.extend({left:{},right:{}},WS.get(ws_data_key+'-2')),3:$j.extend({left:{},right:{}},WS.get(ws_data_key+'-3')),4:$j.extend({left:{},right:{}},WS.get(ws_data_key+'-4')),11:$j.extend({left:{},right:{}},WS.get(ws_data_key+'-11'))}}$j('#cbdd1,#cbdd2,#cbdd3,#cbdd4,#cbdd11').each(function(){var _this=$j(this),div=_this.attr('id').replace('cbdd', ''),div_dom=cb_number(M.b.param('invert')?(100-domination[div]):domination[div],3),left_points=walls_data[M.b.param('leftID')][div].domination,right_points=walls_data[M.b.param('rightID')][div].domination,color=(div_dom<50?'red':'blue'),active=(left_points<POINTS_PER_DIVISION&&right_points<POINTS_PER_DIVISION),div_points=((div==4?5:div)*(1+zone_situation[div]<3?1:2)),t5=top5_data&&top5_data[div]?top5_data[div]:{},dmg_l=0,dmg_r=0,dmg_t,pulse='low';if(active){if(div_dom>50){estimate_l+=div_points}else{estimate_r+=div_points}}round_points+=div_points;_this.removeClass('state-1 state-2 state-3').addClass('state-'+(1+zone_situation[div]));_this.find('s').attr('title',div_points+' points').tipsy({gravity:'s'});var i,f,key;if(typeof(t5[M.b.param('leftID')])!=_u&&typeof(t5[M.b.param('leftID')].top_damage)!=_u){for (i = 0; i < t5[M.b.param('leftID')].top_damage.length;i++){f=t5[M.b.param('leftID')].top_damage[i];M.b.s._t5_data[div].left[f.citizen_id]=intval(f.damage)}}if(typeof(t5[M.b.param('rightID')])!=_u&&typeof(t5[M.b.param('rightID')].top_damage)!=_u){for (i = 0; i < t5[M.b.param('rightID')].top_damage.length;i++){f=t5[M.b.param('rightID')].top_damage[i];M.b.s._t5_data[div].right[f.citizen_id]=intval(f.damage)}}for (key in M.b.s._t5_data[div].left){if(M.b.s._t5_data[div].left.hasOwnProperty(key)){dmg_l+=M.b.s._t5_data[div].left[key]}}for (key in M.b.s._t5_data[div].right){if(M.b.s._t5_data[div].right.hasOwnProperty(key)){dmg_r+=M.b.s._t5_data[div].right[key]}}dmg_t=dmg_l+dmg_r;WS.set(ws_data_key+'-'+div,M.b.s._t5_data[div]);_this.children('em.l').text(k_number_format(dmg_l,' ')).attr('title', 'Recorded <b class="cogreen">Left side Top5</b> damage:<br>'+cb_number_format(dmg_l,' ',0)).tipsy({gravity:'s',html:true});_this.children('em.r').text(k_number_format(dmg_r,' ')).attr('title', 'Recorded <b class="cogreen">Right side Top5</b> damage:<br>'+cb_number_format(dmg_r,' ',0)).tipsy({gravity:'s',html:true});_this.children('em.t').text(k_number_format(dmg_t,' ')).attr('title', 'Recorded <b class="cogreen">Division Top5</b> damage:<br>'+cb_number_format(dmg_t,' ',0)).tipsy({gravity:'s',html:true});if(div_dom<48||div_dom>52){div_dom=Math.round(div_dom);pulse=!1}else if(div_dom>=49.5&&div_dom<=50.5){pulse='high'}_this.children('b').text(left_points);_this.children('i').text(div_dom);_this.children('u').text(right_points);if(!active){_this.unbind('click').removeClass('cbdred cbdblue cbdpulse cbdpulse-high').addClass('cbdi cbd'+color);return}_this.removeClass('cbdred cbdblue cbdpulse cbdpulse-high').addClass('cbd'+color);if(pulse){_this.addClass('cbdpulse'+('high'==pulse?'-high':''))}else{_this.removeClass('cbdpulse cbdpulse-high')}});$j('#cb-battlefield-round-points').text('+'+round_points+'pts  > '+estimate_l+'-'+estimate_r).attr('title', 'This round will bring '+round_points+' points<br />Estimated score (current walls):<br />'+estimate_l+' - '+estimate_r).tipsy({gravity:'s',html:true});if(typeof(M.b.s.COService)!=_u&&WS.get('COService-ON')){M.b.s.COService.get()}},jqx_callback:function (response,url){if(!M.b.s.on()||!instr(url,'-stats')){return!0}M.b.s.title(response.division);M.b.s.walls(response)}};M.b.bh={on:function(){if(typeof(M.b.bh._on)==_u){M.b.bh._on=!!OPTS.get('bh-mode-battlefield', 'Military')}return M.b.bh._on},interval:0,init:function(){if(!M.valid_tankKEY||za_()){return!1}if(!$j('#bh-mode').exists()){$j('#pvp').append('<label for="bh-mode" id="bh-mode-label" class="bbg r3px"><input type="checkbox" id="bh-mode"'+(M.b.bh.on()?' checked':'')+' /> BH View</label>');$j('#bh-mode').change(function(){M.b.bh.toggle_bh_mode($j(this).is(':checked')?'on':'off')})}if(!M.b.bh.on()){return!0}if(!$j('#bh-mode-info').exists()){$j('#pvp_header>div.battle_heroes.left_side').append('<div class="bh-mode r3px" id="bh-mode-info"><div class="bh-mode-close"></div></div>');$j('#bh-mode-info>.bh-mode-close').click(function(){$j('#bh-mode').trigger('click')})}$j('#bh-mode-info').removeClass('closed');M.b.bh.update();M.xxhr.bind(this,'nbp-stats', 'bh-mode')},toggle_bh_mode:function (on_off){on_off=('on'===on_off||true===on_off?1:0);OPTS.set('bh-mode-battlefield', 'Military',on_off);if(on_off){M.b.bh._on=!0;$j('#bh-mode-info').removeClass('closed');M.b.bh.init()}else{M.b.s._on=!1;$j('#bh-mode-info').addClass('closed')}return on_off},update:function (pts_left,pts_right){if(intval($j('#total_damage > strong'),0)>0&&!M.b.bh.interval){M.b.bh.interval=setInterval(function(){if(M.b.bh.on()){M.b.bh.update()}else{try{window.clearInterval(M.b.bh.interval)}catch(e){}}},seconds(30))}var elapsed=M.b.ui.get_battle_T(),div=M.b.division();pts_left=is_int(pts_left)?pts_left:intval(M.b.param('leftID')==SERVER_DATA.defenderId?SERVER_DATA.points.defender:SERVER_DATA.points.attacker,0);pts_right=is_int(pts_right)?pts_right:intval(M.b.param('rightID')==SERVER_DATA.defenderId?SERVER_DATA.points.defender:SERVER_DATA.points.attacker,0);var img_left='<img class="bh-mode-country" src="'+EREP.base+'images'+(255==M.b.param('leftID')?'/modules/misc/warlist_dictatorship_war_deco_s':'/flags_png/S/'+COUNTRIES.get(M.b.param('leftID'),'url'))+'.png">',img_right='<img class="bh-mode-country" src="'+EREP.base+'images'+(255==M.b.param('rightID')?'/modules/misc/warlist_dictatorship_war_deco_s':'/flags_png/S/'+COUNTRIES.get(M.b.param('rightID'),'url'))+'.png">',bh_left=intval($j('#pvp_header > div.battle_heroes.left_side > ul > li.my_division > em').text(),0),bh_right=intval($j('#pvp_header > div.battle_heroes.right_side > ul > li.my_division > em').text(),0),additive_booster=(M.b.bh.calc_additive_booster()?('<sup>+'+(M.b.bh.calc_additive_booster()*100)+'%</sup>'):''),ff=NRG.ff();$j('#bh-mode-info').hide();$j('#bh-mode-info>p,#bh-mode-info>hr').remove();$j('#bh-mode-info').hide().append('<p>Battle ends in:</b><br />'+img_left+NBSP+M.b.bh.calc_win_time(elapsed,pts_left)+' min'+NBSP+NBSP+' / '+NBSP+NBSP+img_right+NBSP+M.b.bh.calc_win_time(elapsed,pts_right)+' min<br />'+'Current <abbr title="Points per minute">PPM</abbr>: <b>'+M.b.ui.get_battle_PPM()+'</p>'+'<p>You have <b>'+ff+' hits</b>. Damage'+additive_booster+':<br />'+M.b.bh.calc_avail_damage().reverse().join(NBSP+' | '+NBSP)+'</p>'+'<p><b>Hits needed to take BH:</b><br />'+img_left+NBSP+M.b.bh.calc_overtake(bh_left)+NBSP+NBSP+' / '+NBSP+NBSP+img_right+NBSP+M.b.bh.calc_overtake(bh_right,'right')+'</p>').show();if($j('#fight_btn').exists()){$j('#bh-mode-info').append()}},calc_overtake:function (damage,right_side){if(!_PLAYER_.dph){return '--'}right_side=!!right_side;var player_damage=right_side?0:intval($j('#total_damage>strong').text().trim(),0);if(player_damage>=damage){return 'N/A'}return Math.ceil((damage-player_damage)/M.b.bh.calc_dph_with_booster())},calc_win_time:function (time,points){time=intval(time,0);points=intval(points,0);for (var t = time; time <= 120; t++){points+=(t>90?60:(t>60?30:(t>30?20:10)));if(points>=1800){return 1+(t-time)}}return 1},calc_additive_booster:function(){var additive_booster=0,additive_boosters=['eventDamageBoosters'],i,b;for (i = 0; i < additive_boosters.length; i++){if(typeof(SERVER_DATA.boosters.active[additive_boosters[i]])==_u){continue}b=SERVER_DATA.boosters.active[additive_boosters[i]];additive_booster+=(b&&('details' in b))?(intval(b.details['bonus'],0)/100):0}return additive_booster},calc_dph_with_booster:function(){if(!_PLAYER_.dph){return 0}var multiplier=1;if(M.b.t.is_boosted()){multiplier=M.b.t.get_damagebooster_multiplier()}multiplier+=M.b.bh.calc_additive_booster();var dph=M.b.param('isAIRFORCE')?_PLAYER_.adph:_PLAYER_.dph;return Math.floor(dph*multiplier)},calc_avail_damage:function(){if(!_PLAYER_.dph){return [0]}var ff=NRG.ff(),dmg,damage,has_booster=M.b.t.is_boosted(),booster_multiplier=M.b.t.get_damagebooster_multiplier();if(M.b.param('isAIRFORCE')){damage=[cb_number_format(Math.floor(ff*_PLAYER_.calc_adph(AIRFORCE_MAX_WEAPON_Q,booster_multiplier)))+'<sup>q'+AIRFORCE_MAX_WEAPON_Q+'</sup>',cb_number_format(Math.floor(ff*_PLAYER_.calc_adph(DEFAULT_AIRFORCE_WEAPON_Q,booster_multiplier)))+'<sup>q'+DEFAULT_AIRFORCE_WEAPON_Q+'</sup>']}else{dmg=Math.floor(ff*M.b.bh.calc_dph_with_booster());damage=[k_number_format(dmg*2)+'<sup>+100%</sup>'];if(has_booster&&M.b.t.get_damagebooster_multiplier()<2){damage.push(k_number_format(dmg)+'<sup>+50%</sup>')}else if(!has_booster){damage.push(k_number_format(dmg*1.5)+'<sup>+50%</sup>');damage.push(k_number_format(dmg))}}return damage},jqx_callback:function(){if(M.b.bh.on()){M.b.bh.update()}}};M.b.w={inventory_retrieved:false,inventory:[],weaponUses:0,manual_wswitch:null,rage_check_interval:0,default_weapon:0,default_weapon_key:'',manual_wswitch_key:'',init:function(){if(!is_page('battlefield')||is_page('battlefield-old')||!$j('#fight_btn').exists()||M.util.is_valid_battlefield()!='valid'){return!0}M.b.w.default_weapon_key=M.b.param('isAIRFORCE')?'airforce-weapon-default':'weapon-default';M.b.w.manual_wswitch_key=M.b.param('isAIRFORCE')?'airforce-manual-wswitch':'manual-wswitch';M.b.w.default_weapon=LS.get(M.b.w.default_weapon_key,M.b.param('isAIRFORCE')?DEFAULT_AIRFORCE_WEAPON_Q:DEFAULT_TANK_WEAPON_Q);M.b.w.manual_wswitch=WS.get(M.b.w.manual_wswitch_key,0);$j('#pvp .weapon_list li a').click(function(){var li=$j(this).parent();if(li.hasClass('inactive')){return}var q=intval(li.data('quality_id'),M.b.w.default_weapon);if(q==M.b.w.default_weapon){WS.del(M.b.w.manual_wswitch_key);M.b.w.manual_wswitch=0}else{M.b.w.manual_wswitch=q;WS.set(M.b.w.manual_wswitch_key,M.b.w.manual_wswitch)}});M.b.w.check();M.xxhr.bind(this,'show-weapons', 'weapon-watcher');M.xxhr.bind(this,'fight-shoo', 'weapon-watcher')},current_weapon:function(){return typeof(window['currentWeaponId'])!=_u?window['currentWeaponId']:intval($j('#weapon_btn').data('data-quality'))},switch_to:function (wq){M.b.w.get_inventory('sync_if_not_set');if(!is_int(wq)||(typeof(M.b.w.inventory[wq])==_u&&wq!=-1)){var available_weapons=Object.keys(M.b.w.inventory).sort(function (a,b){return b-a});wq=-1;for (var i = 0; i < available_weapons.length; i++){var q=1*available_weapons[i];if(q>9||M.b.w.inventory[q]<1){continue}wq=q;break}}if(!is_int(wq)){return!1}if(typeof(window['selectWeapon'])==='function'){window['selectWeapon'](wq)}else{clog('weapon-watcher :: switch_to :: window.selectWeapon is not a function');$j.post(EREP.url+'/military/change-weapon',{_token:getinfo('token'),battleId:M.b.param('id'),customizationLevel:wq})}},check:function (current_weapon){if(!current_weapon||!is_int(current_weapon)){current_weapon=M.b.w.current_weapon()}if(M.b.w.manual_wswitch){if(current_weapon!=M.b.w.manual_wswitch){clog('M.b.w.check()', 'current_weapon ('+current_weapon+')  !=  M.b.w.manual_wswitch ('+M.b.w.manual_wswitch+')', 'switching');M.b.w.switch_to(M.b.w.manual_wswitch)}}else if(current_weapon!=M.b.w.default_weapon){if(M.b.w.default_weapon<0){M.b.w.switch_to(M.b.w.default_weapon);clog('M.b.w.check()', 'current_weapon ('+current_weapon+')  !=  M.b.w.default_weapon ('+M.b.w.default_weapon+')', 'Switching')}else{M.b.w.get_inventory('sync_if_not_set');if(typeof(M.b.w.inventory[M.b.w.default_weapon])!=_u&&M.b.w.inventory[M.b.w.default_weapon]>10){clog('M.b.w.check()', 'current_weapon ('+current_weapon+')  !=  M.b.w.default_weapon ('+M.b.w.default_weapon+')', 'Switching');M.b.w.switch_to(M.b.w.default_weapon)}else{clog('M.b.w.check()', 'current_weapon ('+current_weapon+')  !=  M.b.w.default_weapon ('+M.b.w.default_weapon+')', 'Cannot switch. No stock.',M.b.w.inventory)}}}return!0},objective_switch_:false,objective_switch:function(){if(!M.enableObjectiveMode||!M.objectiveHuntBazookaMode){return!0}var current_weapon=M.b.w.current_weapon();if(!M.b.param('isOBJECTIVE')){if(M.b.w.objective_switch_){WS.del(M.b.w.manual_wswitch_key);M.b.w.manual_wswitch=0;M.b.w.switch_to(M.b.w.default_weapon);_q('MU Objective is DESTROYED. Switching to Default Weapon.')}}else if(M.b.param('isOBJECTIVE')&&!M.b.param('isAIRFORCE')){if(current_weapon!=10){WS.set(M.b.w.manual_wswitch_key,10);M.b.w.manual_wswitch=10;M.b.w.switch_to(10);M.b.w.objective_switch_=!0;_q('MU Objective is ACTIVE. Switching to BAZOOKA.')}}else if(SERVER_DATA.hasDestroyedObjective){if(M.b.w.objective_switch_&&current_weapon>=10){WS.del(M.b.w.manual_wswitch_key);M.b.w.manual_wswitch=0;M.b.w.switch_to(M.b.w.default_weapon);_q('MU Objective is DESTROYED. Switching to Default Weapon.');M.b.w.objective_switch_=!1}}return!0},rage_check:function (start_stop){if('start'===start_stop){if(M.b.w.rage_check_interval){return!0}M.b.w.rage_check_interval=window.setInterval(function(){M.b.w.get_inventory('forced')},seconds(30))}else if('stop'===start_stop&&M.b.w.rage_check_interval){try{window.clearInterval(M.b.w.rage_check_interval)}catch(e){}}},get_inventory:function (forced){if(!M.b.w.inventory_retrieved||('forced'===forced)){if(!M.b.w.inventory_retrieved&&forced){forced=!0}M.b.w.inventory_retrieved=!0;$j.ajax({url:EREP.url+'/military/show-weapons?_token='+getinfo('token')+'&battleId='+M.b.param('id')+'&_=1',async:(!forced),dataType:'json',success:function(data){M.b.w.set_inventory(data)}})}return M.b.w.inventory},set_inventory:function (data){var i,q;if(is_array(data)){M.b.w.inventory=[];for (i = 0; i < data.length; i++){if(!data[i].weaponId){continue}M.b.w.inventory[data[i].weaponId]=data[i].weaponQuantity;q=intval(data[i].weaponId);M.b.w.weaponUses+=(data[i].weaponQuantity*(q==7?10:q))}}},checkForInfantryKit:function(){if(!dev_()){return!0}if(!is_page('battlefield')||SERVER_DATA.onAirforceBattlefield||_PLAYER_.get_natural_division()==4){return!0}var currentWeapon=M.b.w.current_weapon(),_notify=!1;if(currentWeapon<0){_notify=!0}else{M.b.w.get_inventory('sync_if_not_set');if(M.b.w.weaponUses<2*NRG.ff()){_notify=!0}else if(M.b.t.param('eb')&&M.b.w.weaponUses<(NRG.ff()+2000)){_notify=!0}}if(_notify){enable_alerts();return confirm('You do not have (enough?) weapons and will gain experience. are you sure ?')}return!0},jqx_callback:function (response,url){if(instr(url,'show-weapons')){M.b.w.set_inventory(response);M.b.w.default_selector();if(instr(url,'_=1')){M.b.w.check()}}else if(instr(url,'fight-shoo')&&typeof(response.user)!=_u){M.b.w.check(response.user.weaponId)}},default_selector:function(){var weapon_lock=$j('#cb-weapon-default');if(!weapon_lock.exists()){weapon_lock=$j('<div id="cb-weapon-default"></div>');weapon_lock.appendTo('#pvp > div.battle_footer > div.weapon_list > div');$j('#pvp>div.battle_footer>div.weapon_list>div>ul>li').each(function(){var _li=$j(this),q=_li.data('quality_id');weapon_lock.append('<input class="'+_li.attr('class')+'" data-quality="'+q+'" type="checkbox"'+(q==M.b.w.default_weapon?' checked="checked"':'')+' />')});weapon_lock.append('<div><b class="cb-icon-16"></b></div>')}$j('#pvp>div.battle_footer>div.weapon_list>div>ul>li').each(function(){$j('#cb-weapon-default>input.q'+$j(this).data('quality_id')).prop('disabled',$j(this).hasClass('inactive'))});$j('#cb-weapon-default>input').unbind().click(function(){var _this=$j(this),q=intval(_this.data('quality'),0),_li=$j('#pvp .weapon_list li.q'+q);if(!q||_li.hasClass('inactive')){_this.prop('disabled',!0);return!1}$j('#cb-weapon-default>input:not(.q'+q+')').prop('checked',!1);if(_this.is(':checked')){LS.set(M.b.w.default_weapon_key,q)}else{LS.del(M.b.w.default_weapon_key)}})}};M.b.t={on:function (set){if(typeof(set)!=_u){M.b.t._on=!!set}return !!M.b.t._on},first_run:true,init:function(){if(!is_page('battlefield')){return!0}M.xxhr.bind(this,'-stats', 'tanking');disable_alerts();M.b.t.data.token=SERVER_DATA.csrfToken;M.b.t.data.session=($j('#fightSessionKey').exists()?'&fightSessionKey='+$j('#fightSessionKey').val():'');M.b.t.data.battleID=M.b.param('id');M.b.t.data.sideID=M.b.param('leftID');if(M.b.t.first_run){M.b.t.heal.update();M.xxhr.bind(this,'eat', 'tanking');M.b.t.data.boosters={dmg:M.b.t.get_damagebooster_multiplier()};for (var optionID in M.b.t.params){if(!M.b.t.params.hasOwnProperty(optionID)){continue}var val=M.b.t.param(optionID);if(!val){continue}M.b.t._params[optionID]=val;if(M.b.t.params[optionID].type=='img'){$j('#MILITARY____'+optionID).addClass('on')}else{$j('#MILITARY____'+optionID).addClass('on').val(val)}}M.b.t.bomberman.button();M.b.t.multibooster.bind();M.b.t.go_button();$j('#pvp a._go').click(function(){reset_fallback_timeout()});if(M.b.t.param('_go')){M.b.t.start()}}M.b.t.first_run=!1;return M.b.t.on()},start:function(){if(!is_page('battlefield')){M.b.t.reset_params();M.b.t.counters.reset();M.b.t.on(false);return!0}try{window['globalShop'].openShop=function(){return!0}}catch(e){}if(!M.b.w.checkForInfantryKit()){return!1}if(M.b.t.rage()){M.b.ui.rage_effects('on');M.b.w.rage_check('start')}M.b.t.on(true);M.xxhr.bind(this,'fight-shoo', 'tanking');M.xxhr.bind(this,'-stats', 'tanking');M.b.t.param('_go',1);M.b.t.j_fight().addClass('cb_auto on');M.b.t.counters.init();$j('#pvp a._go').addClass('on').attr('title', '[STOP] Tanking').tipsy({gravity:'s'});M.b.t.jfb_notify(true);if(!M.a.on()){clear_win_timeout()}M.b.t.fight()},stop:function(){M.b.t.on(false);M.b.t.param('_go',0);M.b.t.j_fight().removeClass('cb_auto rage on hue').text('Fight');M.b.w.rage_check('stop');M.b.ui.rage_effects('off');$j('#pvp a._go').removeClass('on').attr('title', '[START] Tanking').tipsy({gravity:'s'});M.b.t.jfb_notify(false);if(gettype(M.b.t._onstop)=='array'){for (var f = 0; f < M.b.t._onstop.length; f++){if(typeof(M.b.t._onstop[f])=='function'){M.b.t._onstop[f]()}}}if(M.a.on()){M.a.on(false);M.b.t.reset_params();gto(EREP.url)}else if(M.b.t.param('z_override')){M.b.t.z_override(false)}return!0},_onstop:null,onstop:function (action){if(typeof(action)=='function'){if(gettype(M.b.t._onstop)!='array'){M.b.t._onstop=[action]}else{M.b.t._onstop.push(action)}}},params:{eb:{text:'Use Energy Bars',type:'img'},co:{text:'Hit *only* if CO is active',type:'img'},bhdiff:{text:'BH :: Activate if difference > (MY DMG - <em>X</em>mil)',type:'text',hint:'5 (mil)'},wall_min:{text:'Hit only if wall > <em>x</em>%',type:'text',hint:'47 (%)'},wall_max:{text:'Hit only if wall < <em>x</em>%',type:'text',hint:'53 (%)'},ff:{text:'Hit for <em>X</em> FF',type:'text',hint:'100 (ff)'},dmg:{text:'Hit for <em>X</em> '+(SERVER_DATA.onAirforceBattlefield?'k':'mil')+' damage',type:'text',hint:(SERVER_DATA.onAirforceBattlefield?'50 (k)':'5 (mil)')},time:{text:'Hit *only* after <em>T</em>x',type:'text',hint:'T 60'},kills:{text:'Kill <em>X</em> enemies',type:'select'},_go:{text:'[START/STOP] Tanking',type:'img'},},_params:{bhdiff:5},spdy:function (ts){var Aggressive=550,Normal=700,s;if((M.valid_tankKEY||M.b.param('f1')||M.b.param('isOBJECTIVE'))&&!M.b.param('v1')){Aggressive=200;Normal=400}s=Normal;if((M.valid_tankKEY||M.b.param('f1'))&&!za_()&&!M.b.param('v1')&&(M.b.param('isOBJECTIVE'))){s=Aggressive}else if(M.b.param('v1')){s+=200}s=rand(s,s+(za_()?500:150));return !ts?s:(M.b.param('isOBJECTIVE')||M.b.t.data._ts+s<now())},reset_params:function(){for (var optionID in M.b.t.params){if(!M.b.t.params.hasOwnProperty(optionID)){continue}M.b.t.param(optionID,null);if(!is_page('battlefield')){continue}if(M.b.t.params[optionID].type=='img'){$j('#MILITARY____'+optionID).removeClass('on')}else{$j('#MILITARY____'+optionID).removeClass('on').val('')}}return!0},param_tID:0,param:function (optionID,value){var _optionID='auto_'+optionID;if(typeof(value)!=_u){value=value?value:null;if(M.b.t.param_tID){window.clearTimeout(M.b.t.param_tID)}$j('#MILITARY____auto_notify').fadeIn(500);M.b.t.param_tID=window.setTimeout(function(){$j('#MILITARY____auto_notify').fadeOut(200)},1000);M.b.t._params[optionID]=value;if('z_override'==optionID&&!M.valid_coKEY){M.b.t._params[optionID]=0}else if('eb'==optionID){if(value){M.b.t.abooster()}if(typeof(SITEWIDE)!=_u){SITEWIDE.enable_ebars=!!value}}return WS.set(_optionID,value)}return typeof(M.b.t._params[optionID])!=_u?M.b.t._params[optionID]:WS.get(_optionID,0)},z_override:function (on_off){if(typeof(on_off)!=_u&&M.valid_coKEY){if(on_off){if(M.b.param('nx_type')!='tanks'&&_PLAYER_.get_natural_division()<4){enable_alerts();if(!confirm('Next round is Airforce. You will gain experience. are you sure ?')){disable_alerts();return M.b.t.z_override(false)}disable_alerts()}M.b.t.counters._.dmg=0;M.b.t.param('z_override',1);M.b.t.param('rage',1);$j('#MILITARY____z_override,#MILITARY____rage').addClass('on');if(M.b.param('nx_type')=='aircraft'){M.b.param('isAIRFORCE',1)}else{M.b.param('isAIRFORCE',0)}$j('#CPanel_MILITARY').addClass('type_'+M.b.param('nx_type'));M.b.ui.rage_effects('on');M.b.w.rage_check('start')}else{if(M.b.t.param('z_override')&&M.b.t.counters._.dmg>0){setTimeout(function(){gto(_URL_)},1000)}M.b.t.param('z_override',0);M.b.t.param('rage',0);$j('#MILITARY____z_override,#MILITARY____rage').removeClass('on');M.b.param('isAIRFORCE',SERVER_DATA.onAirforceBattlefield);$j('#CPanel_MILITARY').addClass('type_'+(SERVER_DATA.onAirforceBattlefield?'aircraft':'tanks'));M.b.ui.rage_effects('off');M.b.w.rage_check('stop')}return M.b.t.param('z_override')}return 0},data:{_ts:0,battleID:0,sideID:0,token:'',session:'',boosters:{dmg:false,aoedmg:false,aoenrg:false,aoedisarm:false},bhdata:{my:0,his:0}},counters:{_:{ff:0,dmg:0,kills:0},init:function(){for (var key in M.b.t.counters._){if(!M.b.t.counters._.hasOwnProperty(key)){continue}M.b.t.counters._[key]=intval(WS.get('Mbt_counter_'+key,0),0)}M.b.t.counters._.dmg=intval($j('#total_damage > strong').text())},add:function (counter,value){if(!counter||!value||typeof(M.b.t.counters._[counter])==_u||!is_numeric(value)){return 0}return M.b.t.counters.set(counter,M.b.t.counters._[counter]+intval(value))},set:function (counter,value){if(!counter||typeof(value)==_u||typeof(M.b.t.counters._[counter])==_u||!is_numeric(value)){return 0}M.b.t.counters._[counter]=intval(value);WS.set('Mbt_counter_'+counter,M.b.t.counters._[counter]);return M.b.t.counters._[counter]},reset:function(){for (var key in M.b.t.counters._){if(!M.b.t.counters._.hasOwnProperty(key)){continue}M.b.t.counters._[key]=0;WS.del('Mbt_counter_'+key)}},ff:function(){return intval(M.b.t.counters._.ff,0)},dmg:function(){return intval(M.b.t.counters._.dmg,0)},kills:function(){return intval(M.b.t.counters._.kills,0)}},update_boosters:function (effects,dmgbooster){if(typeof(dmgbooster)!=_u){M.b.t.data.boosters.dmg=!!dmgbooster}M.b.t.data.boosters.aoedmg=!1;M.b.t.data.boosters.aeonrg=!1;M.b.t.data.boosters.aoedisarm=!1;if(effects&&effects.length>0&&effects[M.b.param('leftID')]){for (var i in effects[M.b.param('leftID')]){if(!effects[M.b.param('leftID')].hasOwnProperty(i)){continue}var aoe=effects[M.b.param('leftID')][i];if(aoe.type=='damage'){M.b.t.data.boosters.aoedmg=!0}else if(aoe.type=='energy_consumption'){M.b.t.data.boosters.aeonrg=!0}else if(aoe.type=='disarm'){M.b.t.data.boosters.aoedisarm=!0}}}},update_fight_data:function (kills,user,hits){if(isset(user,'earnedXp')){$j('#kill_counter').text(M.b.t.counters.add('kills',kills));M.b.t.counters.add('ff',typeof(hits)!=_u&&is_positive_int(hits)?intval(hits):(_PLAYER_.div<4?1:intval(user.earnedXp,0)));M.b.t.counters.add('dmg',intval(user.givenDamage,0));M.b.t.update_boosters(user['activeEffects'],user.damageBoost)}},rage:function(){var r=M.b.param('isOBJECTIVE')||false;return r},fight_timeout:null,fight:function(){if(!M.b.t.on()){return!0}var stop_check=M.b.t.check.all();if(stop_check){if(stop_check!='wait'){M.b.t.stop()}if(0&&dev_()){if(!M.b.t.fight_timeout){M.b.t.fight_timeout=setTimeout(function(){M.b.t.fight()},seconds(5))}return M.b.t.fight_timeout}else{return setTimeout(function(){M.b.t.fight()},seconds(5))}}if(0&&dev_()){if(!M.b.t.fight_timeout){M.b.t.fight_timeout=setTimeout(function(){M.b.t.fight()},M.b.t.spdy())}}else{setTimeout(function(){M.b.t.fight()},M.b.t.spdy())}if(!M.b.t.spdy('check-ts')){return!1}M.b.t.data._ts=now();if(!M.b.t.rage()&&M.b.t.heal.pendingTID){return!1}else if(M.b.t.heal.should()&&M.b.t.heal.can()){if(NRG.lvlup_critical()){_q('Heal DELAYED. LVL up protection=ON')}else{return M.b.t.heal.do_heal('normal')}}else if(M.b.t.heal.must()){if(!M.b.t.heal.can()){_q('Cannot heal (Energy Bars '+(M.b.t.param('eb')?'enabled':'disabled')+'). Finishing ...');return M.b.t.stop()}return M.b.t.heal.do_heal('normal')}else{}return M.b.t.punch.do_punch()},jqx_callback:function (response,url){if(instr(url,'fight-shoo')){return M.b.t.punch.xhr_callback(response)}else if(instr(url,'eat')){return M.b.t.heal.xhr_callback(response)}if(response.error){clog('response.error in jqx_callback :: ',response.message,url);return!1}M.b.t.update_boosters(response['activeEffects']);M.b.t.update_fight_data(1,response.stats.personal);if(M.b.t.param('bh')){M.b.t.update_bh_data(response.stats)}},update_bh_data:function (stats){},punch:{do_punch:function(){return M.b.t.rage()?M.b.t.punch.do_rage():M.b.t.punch.do_normal()},do_normal:function(){return M.b.t.j_fight().trigger('click')},do_rage:function(){},xhr_callback:function (response,from_rx){from_rx=!!from_rx;if(!response||!response.message){return!1}if(response.user){M.b.t.heal.xhr_callback(response.user)}var objective_hit=!1,ZONE_INACTIVE=!1,WAIT_START=!1,message=response.message.replace('Fight checks failed. ', '');switch(message){case'ZONE_INACTIVE':ZONE_INACTIVE=!0;WAIT_START=M.b.t.param('z_override');message='FINISHED';break;case'BATTLE_WON':case'BATTLE_LOST':message='FINISHED';break;case'LOW_HEALTH':message='WAIT EAT';M.b.t.heal.param.current=0;break;case'ENEMY_KILLED':message='HIT: '+response.hits+' FF';M.b.t.update_fight_data(1,response.user,response.hits);break;default:break}if(dev_()&&response.user&&typeof(response.user.objective)=='object'&&response.user.objective.damage&&response.user.objective.id==SERVER_DATA.objective.id){objective_hit=!0;clog('objective',response.user.objective['hp_left'],SERVER_DATA.objective.initial_hp);message=(cb_number_format(response.user.objective['hp_left'])+'hp :: '+cb_number((response.user.objective['hp_left']/SERVER_DATA.objective.initial_hp)*100,2)+'%')}if(M.valid_coKEY){if(ZONE_INACTIVE){M.b.param('division_finished',!0);$j('#pvp').addClass('z_waiting');if(WAIT_START){message='WAIT START'}}if(from_rx||WAIT_START||objective_hit){if(message=='SHOOT_LOCKOUT'){M.b.t.j_fight().toggleClass('hue')}else{M.b.t.jfb_notify(message,'hue')}}if(message=='FINISHED'||response['display_captcha']){M.b.param('division_finished',!0);$j('#pvp').addClass('z_waiting');if(!WAIT_START){M.b.t.param('_go',0);return M.b.t.stop()}return!0}return!0}if(from_rx||objective_hit){if(message=='SHOOT_LOCKOUT'){M.b.t.j_fight().toggleClass('hue')}else{M.b.t.jfb_notify(message,'hue')}}if(ZONE_INACTIVE){M.b.param('division_finished',!0);$j('#pvp').addClass('z_waiting');if(M.b.t.param('z_override')){message='WAIT START'}}if(message=='FINISHED'||response['display_captcha']){M.b.param('division_finished',!0);$j('#pvp').addClass('z_waiting');M.b.t.param('_go',0);return M.b.t.stop()}}},heal:{pendingTID:0,param:{max:0,current:0,pool:0,has_food:false,has_ff:0,has_eb:0},update:function (data){if(data&&typeof(data.health)!=_u){M.b.t.heal.param.current=intval(data.health,0);M.b.t.heal.param.pool=intval(data.food_remaining,0);M.b.t.heal.param.has_food=intval(data.has_food_in_inventory,0);M.b.t.heal.param.has_eb=intval(data.specialFoodAmount,0)}else{M.b.t.heal.param.max=NRG.m();M.b.t.heal.param.current=NRG.c();M.b.t.heal.param.pool=NRG.r();M.b.t.heal.param.has_food=window['reset_has_food'];M.b.t.heal.param.has_eb=typeof(window['globalNS'])!=_u&&typeof(window['globalNS']['userInfo'])!=_u?window['globalNS']['userInfo']['specialFoodAmount']:0}M.b.t.heal.param.has_ff=M.b.t.heal.param.pool&&M.b.t.heal.param.has_food?Math.floor((M.b.t.heal.param.current+M.b.t.heal.param.pool)/NRG.eph()):0;return!0},should:function(){return (!NRG.lvlup_critical()&&M.b.t.heal.param.current<((!za_()&&(M.b.t.is_accelerated()||M.b.t.rage()))?((M.b.t.is_accelerated()>2&&M.b.w.current_weapon()==7&&M.b.t.heal.param.max>1000)?(M.b.t.heal.param.max>2000?1000:800):(M.b.t.heal.param.max>1000?400:M.b.t.heal.param.max-400)):90));/*var hp_to_heal=90;if(M.b.t.is_accelerated()&&M.b.t.rage()){hp_to_heal=M.b.epic_wall_is_ok()?NRG.max-200:NRG.max/2}return !NRG.lvlup_critical()&&M.b.t.heal.param.current<hp_to_heal;*/},must:function(){return M.b.t.heal.param.current<NRG.eph()},can:function(){return M.b.t.heal.param.has_ff||(M.b.t.param('eb')&&M.b.t.heal.param.has_eb)},do_heal:function (type){if(M.b.t.heal.pendingTID){return!0}M.b.t.heal.pendingTID=setTimeout(function(){M.b.t.heal.pendingTID=null},seconds(2));if(M.b.t.rage()){return 'rage-async'==type?M.b.t.heal.do_rage(true):M.b.t.heal.do_rage(false)}return M.b.t.heal.do_normal()},do_normal:function(){return M.b.t.heal.can()?M.b.t.j_heal().trigger('click'):false},do_rage:function (sync_type){},rxload:function(){},xhr_callback:function (response){try{clearTimeout(M.b.t.heal.pendingTID)}catch(e){}M.b.t.heal.pendingTID=null;return M.b.t.heal.update(response)}},checks:{ff:{msg:'FF/Energy limit reached.',wait:0},kills:{msg:'Kills limit reached.',wait:0},dmg:{msg:'Damage limit reached.',wait:0},wall_min:{msg:'Wall is below limit.',wait:1},wall_max:{msg:'Wall is higher than limit.',wait:1},time:{msg:'Time is below limit.',wait:1},bh:{msg:'BH not in danger.',wait:1},co:{msg:'No CO available or Wall is higher than CO limit.',wait:1},booster:{msg:'AOE Boosters no longer active',wait:0},disarm:{msg:'AOE Disarm detected',wait:1}},check:{all:function(){$j(document).trigger('cb.reset-timeout');_LUA_.update(true,!1);_LUA_.broadcastCustomEvent();for (var check_name in M.b.t.checks){if(!M.b.t.checks.hasOwnProperty(check_name)){continue}var check=M.b.t.checks[check_name];if(M.b.t.check[check_name]()){_q(check.msg+(check.wait?' Waiting ...':' Stopping.'));if('ff'==check_name||'kills'==check_name||'dmg'==check_name){if('kills'==check_name){$j('#MILITARY____'+check_name).val(0).trigger('change')}else{$j('#MILITARY____'+check_name).val('').trigger('change')}M.b.t.param(check_name,0)}return check.wait?'wait':check_name}}return!1},bomberman:function(){return M.b.t.bomberman.on()},ff:function(){var limit=M.b.t.param('ff');if(limit<=0){return!1}return M.b.t.counters.ff()>=limit},kills:function(){var limit=M.b.t.param('kills');if(limit<=0){return!1}return M.b.t.counters.kills()>=limit},dmg:function(){var limit=floatval(M.b.t.param('dmg'),0)*(SERVER_DATA.onAirforceBattlefield?THOUSANDS:MILLIONS);if(limit<=0){return!1}return M.b.t.counters.dmg()>=limit},wall_min:function(){var limit=M.b.t.param('wall_min');if(limit<=0){return!1}return (M.b.wall('left')<=limit)},wall_max:function(){var limit=M.b.t.param('wall_max');if(limit<=0){return!1}return (M.b.wall('left')>=limit)},time:function(){var limit=M.b.t.param('time');if(limit<=0){return!1}return (M.b.param('battleT')<limit)},co:function(){if(!M.b.t.param('co')){return!1}return !$j('#list_missions_details .mission_details p.ok').exists()},booster:function(){if(!M.b.t.param('booster')){return!1}return !M.b.t.has_aoe_buff()},disarm:function(){return M.b.t.has_aoe_debuff()},bh:function(){if(!M.b.t.param('bh')){return!1}return !M.b.t.bh_in_danger()}},has_aoe_buff:function(){return M.b.t.data.boosters.aoedmg||M.b.t.data.boosters.aoenrg},has_aoe_debuff:function(){return M.b.t.data.boosters.aoedisarm},bh_in_danger:function(){if(!M.b.t.param('bh')){return!1}var diff=intval(M.b.t.param('bhdiff'),5)*1000000;return M.b.t.param('bh')&&(M.b.t.data.bh.my<M.b.t.data.bh.his+diff)},_jfb:false,j_fight:function(){if(!M.b.t._jfb){M.b.t._jfb=$j('#fight_btn')}return M.b.t._jfb},_jhb:false,j_heal:function(){if(!M.b.t._jhb){M.b.t._jhb=M.b.nbp()?$j('#heal_btn'):$j('#DailyConsumtionTrigger')}return M.b.t._jhb},jfb_notify:function (message,toggle_class){var objective=(typeof(toggle_class)=='string'&&instr(toggle_class,'objective')?' crpk-objective':'');if(objective){toggle_class='hue'}if(message){message=typeof(message)!='string'?'Auto':message;M.b.t.j_fight().addClass('cb_auto'+objective).text(message);if(toggle_class){M.b.t.j_fight().toggleClass(toggle_class)}}else{M.b.t.j_fight().removeClass('cb_auto '+objective).text('Fight');if(toggle_class){M.b.t.j_fight().removeClass(toggle_class)}}},go_button:function(){if(is_page('battlefield-old')){$j('#pvp_actions .action_holder').append('<a href="'+VOID+'" class="img-toggle _go" title="[START] Tanking"><em id="kill_counter" title="Killed enemies (counter)">0</em></a>')}else{$j('#pvp .fight_panel').addClass('cb').attr('title', 'Change Weapon');M.b.t.j_fight().parent().append('<a href="'+VOID+'" class="weapon_btn _go d'+M.b.division()+'" title="[START] Tanking"><span class="icon_holder"></span><em class="weapon_no"><p id="kill_counter"></p></em></a>')}$j('#pvp a._go').unbind().click(function(){if($j(this).hasClass('on')){M.b.t.stop()}else{$j('#CPanel_MILITARY').addClass('open');M.b.t.start();M.b.t.abooster()}})},bomberman:{_:{on:false,bombID:false,triggerID:false,trigger:false},on:function(){return M.b.t.bomberman._.on},button:function (angular_loaded){if(!M.valid_tankKEY){return!1}var toggler=$j('#special_weapons_go');if(!toggler.hasClass('cbound')){toggler.addClass('cbound').click(function(){setTimeout(function(){clog('M.b.t.bomberman :: !timeout');M.b.t.bomberman.button(true)},500)})}if(!angular_loaded){return!1}if($j('#special_weapons_list_area > div.addon > a.cb-bomberman-trigger').exists()){return!0}var bombs=$j('#rocket_bomb_deploy,#small_bomb_deploy,#large_bomb_deploy,#cruise_missle_deploy');if(bombs.length<1){return!1}var addon=$j('#special_weapons_list_area > div.addon').first();$j('<img src="'+https()+'googledrive.com/host/0BxDp8qaIzboaU3lrbWtVTnhsX0U/cb-battlefield-buttons.png?2" />');bombs.each(function (index){var this_id=$j(this).attr('id'),bomb_name=this_id.replace('_deploy', '').replace('_', ' ').toUpperCase(),bomb_class='',title='Start dropping all '+($j(this).find('>em.item_no').text())+' '+bomb_name+'S';if('rocket_bomb_deploy'==this_id){bomb_class='factory_rocket'}else if('cruise_missle_deploy'==this_id){bomb_class='cruise_missle'}else if('small_bomb_deploy'==this_id){bomb_class='rockets'}else if('large_bomb_deploy'==this_id){bomb_class='big_bomb'}$j((0===index?'<br>':'')+'<a href="'+VOID+'" class="cb-bomberman-trigger cb-bomberman-'+bomb_class+' deploy_bomb" data-trigger="'+this_id+'" data-title="Start dropping all '+bomb_name+'S" title="'+title+'"></a>').appendTo(addon)});$j('#special_weapons_list_area>div.addon>a.cb-bomberman-trigger').click(function(){var _this=$j(this);if(M.b.t.bomberman.on()){M.b.t.bomberman.stop();_this.removeClass('opened').attr('title',_this.data('title'))}else{enable_alerts();if(confirm('Start '+_this.data('trigger').toUpperCase())){if(confirm('Are you (really really) sure ?? !!!')){_this.addClass('opened').attr('title', 'STOP Bomberman');M.b.t.bomberman.start(_this)}}}disable_alerts()}).tipsy({gravity:'s'});$j('#special_weapons_go').append('<q></q>')},start:function (trigger){M.b.t.bomberman._.triggerID=(trigger.data('trigger'));clog(trigger.data('trigger'));M.b.t.bomberman._.trigger=$j('#'+M.b.t.bomberman._.triggerID);if(!M.b.t.bomberman._.trigger.exists()){return M.b.t.bomberman.stop()}M.b.t.bomberman._.trigger.addClass('bomberman');M.b.t.bomberman._.bombID=M.b.t.bomberman._.trigger.attr('bombId');disable_alerts();M.b.t.bomberman._.on=!0;_q('Bomberman :: Bombs awaaaaaaaay !!! ');trigger.addClass('disabled').fadeTo('fast',0.5);M.b.t.bomberman.deploy();return!0},stop:function(){if(M.b.t.bomberman.on()){_q('Bomberman :: STOPPING');$j('#pvp>div.battle_footer>div.addon>a.cb-bomberman-trigger').removeClass('opened');M.b.t.bomberman._={on:false,bombID:false,triggerID:false,trigger:false}}$j('#pvp > div.battle_footer > div.addon > a.cb-bomberman-trigger').each(function(){var _this=$j(this);if(!$j('#'+_this.data('trigger')).exists()){_this.fadeTo('fast',0.2)}});return!0},deploy:function(){if(!M.b.t.bomberman._.triggerID||!M.b.t.bomberman._.trigger||!M.b.t.bomberman._.trigger.exists()||intval(M.b.t.bomberman._.trigger.find('>em.item_no').text())<1){return M.b.t.bomberman.stop()}setTimeout(function(){M.b.t.bomberman.deploy()},rand(250,350));window['ERPK']['enableBombButton']();window['hit_bomb'](M.b.t.bomberman._.triggerID,M.b.t.bomberman._.bombID);return!0}},multibooster:{bind:function(){if(!M.valid_tankKEY){return!1}var boosters_to_bind;boosters_to_bind=['catchupBoosters'];$j('#db_list_go:not(.opened)').click(function(){if(!$j(this).hasClass('cbound')){$j(this).addClass('cbound');var i,len,boosterType,anchor,trigger;for (i = 0, len = boosters_to_bind.length; i < len; i++){boosterType=boosters_to_bind[i];if(('catchupBoosters'==boosterType&&!SERVER_DATA.boosters.canUseCatchupBooster)||typeof(SERVER_DATA.boosters.inactive[boosterType])!='object'){continue}anchor=$j('#booster_list>li.'+boosterType+':first');if(!anchor.exists()){continue}trigger=$j('<a class="cb-multibooster-trigger" href="'+VOID+'" data-booster_type="'+boosterType+'" title="[CB} Activate Multiple '+boosterType+'"><img src="/images/modules/pvp/allBoosters/'+boosterType+'.png" /><span class="boosterDuration"><span>x?<small>MIN</small></span></span><span class="amount">x?</span></a>');$j('<li class="'+boosterType+' cb-multibooster"></li>').append(trigger).insertAfter(anchor)}}$j('#booster_list>li.cb-multibooster>a.cb-multibooster-trigger').unbind().click(M.b.t.multibooster.on_click)});return!0},on_click:function(){var _this=$j(this),booster_type=_this.data('booster_type'),booster_keys=Object.keys(SERVER_DATA.boosters.inactive[booster_type]),boosterID=booster_keys[0],booster=SERVER_DATA.boosters.inactive[booster_type][boosterID],how_many_default=String(Math.min(10,booster.amount)),number_of_boosters=intval(prompt('How many '+booster_type+' to activate?',how_many_default),0);if(!is_positive_int(number_of_boosters)||number_of_boosters>booster.amount){enable_alerts();alert('Invalid number of boosters: '+number_of_boosters);disable_alerts();return!1}return M.b.t.multibooster.activate(booster,number_of_boosters)},activate:function (booster,number_of_boosters){if(!M.valid_tankKEY){return!1}M.b.activate_booster(booster,number_of_boosters)}},is_accelerated:function(){return (za_()?0:(isset(window['globalNS'],'userInfo.specialFoodValue')&&window['globalNS']['userInfo']['specialFoodValue']==50?5:(typeof(SERVER_DATA.boosters.active.speedBoosters)=='object'?(SERVER_DATA.boosters.active.speedBoosters.quality==3?9:(SERVER_DATA.boosters.active.speedBoosters.quality==2?5:2)):0)))},is_boosted:function(){return M.b.t.get_damagebooster_multiplier()>1},get_damagebooster_multiplier:function(){return (!SERVER_DATA.onAirforceBattlefield&&typeof(SERVER_DATA.boosters.active.damageBoosters)=='object'?(SERVER_DATA.boosters.active.damageBoosters.quality==10?2:1.5):1)},abooster:function (booster_type,min_booster_amount){if(!M.valid_tankKEY||SERVER_DATA.travelRequired||M.b.param('isAIRFORCE')||(!M.a.hunt.x.on()&&M.b.param('division_finished'))||(M.b.param('isEPIC')&&M.valid_tankKEY&&!(M.b.t.et.opts('db')||OPTS.get('use-damage-boosters', 'Auto')))||(!M.b.param('isEPIC')&&!OPTS.get('use-damage-boosters', 'Auto'))||typeof(SERVER_DATA.boosters.active.damageBoosters)=='object'||typeof(SERVER_DATA.boosters.inactive.damageBoosters)!='object'||Object.keys(SERVER_DATA.boosters.inactive.damageBoosters).length<1){clog('M.b.t.abooster :: ', 'init conditions not present. abort.');return!1}if(!timestamp_expired(LS.get('abooster.ts',0),seconds(30))){clog('M.b.t.abooster :: ', 'timestamp too recent. abort.');_q('Another booster appears to have been activated in the last 30 seconds. Activation aborted.');return!1}if(M.b.param('isEPIC')&&!M.b.epic_wall_is_ok()){clog('M.b.t.abooster :: ', 'Not epic or epic wall not OK. abort.');return setTimeout(function(){M.b.t.abooster()},seconds(30))}disable_alerts();if(!booster_type){booster_type=7200}else if(!is_int(booster_type)){booster_type=0}if(!min_booster_amount||!is_numeric(min_booster_amount)){min_booster_amount=10}if(M.a.hunt.x.on()||M.b.t.et.on()||(M.b.param('isEPIC')&&NRG.a()>=Math.min(NRG.full*0.8,2000))||(M.b.t.on()&&M.b.t.param('eb'))){var booster_keys=Object.keys(SERVER_DATA.boosters.inactive.damageBoosters).reverse(),len=booster_keys.length,i;for (i = 0; i < len; i++){var booster=SERVER_DATA.boosters.inactive.damageBoosters[booster_keys[i]];if(booster.quality!=5||!is_positive_int(booster.duration)||(booster_type&&booster.duration!=booster_type)||booster.amount<=min_booster_amount){clog('AUTO booster :: skip '+(booster.duration/60)+' minutes booster. Amount = '+booster.amount);continue}clog('AUTO booster :: activating booster :: minutes='+(booster.duration/60));_q('No boosters active. Activating 50% booster ('+(booster.duration==600?'10 minutes':cb_number(booster.duration/3600,0)+' hours')+') .');M.b.activate_booster(booster,1);LS.set('abooster.ts',now());setTimeout(function(){M.b.t.abooster()},(30+intval(booster.duration))*SECONDS);return!0}}clog('M.b.t.abooster :: ', 'Secondary conditions not met or booster not found. abort.');return!0},aacellerator:function(){if(!(M.b.param('isOBJECTIVE')||M.valid_tankKEY)||!M.b.param('isEPIC')||M.b.param('division_finished')||za_()||typeof(SERVER_DATA.boosters.active.speedBoosters)=='object'||typeof(SERVER_DATA.boosters.inactive.speedBoosters)!='object'||Object.keys(SERVER_DATA.boosters.inactive.speedBoosters).length<1||!M.b.t.et.on()||!(M.b.param('isOBJECTIVE')||M.b.t.et.opts('x2')||M.b.t.et.opts('x5'))){return!1}if(M.b.param('isEPIC')&&!M.b.epic_wall_is_ok()){return setTimeout(function(){M.b.t.aacellerator()},seconds(30))}if(typeof(SERVER_DATA.boosters.active.speedBoosters)=='object'){setTimeout(function(){M.b.t.aacellerator()},seconds(60));return!0}disable_alerts();var pts_left=intval(M.b.param('leftID')==SERVER_DATA.defenderId?SERVER_DATA.points.defender:SERVER_DATA.points.attacker,0),pts_right=intval(M.b.param('rightID')==SERVER_DATA.defenderId?SERVER_DATA.points.defender:SERVER_DATA.points.attacker,0),enable_x5=(M.b.t.et.opts('x5')&&(NRG.a()>(NRG.full*0.8)||M.b.t.et.get_limit()>200)&&M.util.calc_win_time(false,pts_left,pts_right)>10);var booster_keys=Object.keys(SERVER_DATA.boosters.inactive.speedBoosters).reverse(),len=booster_keys.length,i;for (i = 0; i < len; i++){var booster=SERVER_DATA.boosters.inactive.speedBoosters[booster_keys[i]],acceleratorX=(booster.quality==2?'x5':'x2');if(!(M.b.param('isEPIC')||M.b.param('isOBJECTIVE')||M.b.t.et.opts(acceleratorX))||('x5'==acceleratorX&&!enable_x5)||booster.amount<=2){clog('AUTO accelerator :: skip '+acceleratorX+' accelerator :: minutes='+(booster.duration/60));continue}clog('AUTO accelerator :: activating '+acceleratorX+' accelerator :: minutes='+(booster.duration/60));_q('Activating '+acceleratorX+' accelerator.');M.b.activate_booster(booster,1);setTimeout(function(){M.b.t.aacellerator()},seconds(Math.min(60,10+intval(booster.duration))));return!0}return!1},et:{on:function(){var limit=M.b.t.et.get_limit();if(is_page('battlefield')){M.b.get_data()}},init:function(){var limit=M.b.t.et.get_limit();if(!limit){return!1}if(limit>200){M.b.t.param('eb',1);if(M.b.t.et.opts('db')){M.b.t.abooster()}if(M.b.t.et.opts('x2')||M.b.t.et.opts('x5')){M.b.t.aacellerator()}return!0}var auto_prestige_points=(intval(limit,0)*1000),current_prestige=M.util.getPrestigePoints(true),auto_prestige_ff=Math.ceil((auto_prestige_points-current_prestige)/2);if(auto_prestige_ff>0&&auto_prestige_ff>NRG.ff()){_q('Hitting for '+auto_prestige_points+' Prestige Points. Energy bars=ON');M.b.t.param('ff',auto_prestige_ff+15);M.b.t.param('eb',1);if(M.b.t.et.opts('db')){M.b.t.abooster()}if(M.b.t.et.opts('x2')||M.b.t.et.opts('x5')){M.b.t.aacellerator()}}else{if(auto_prestige_ff>0){_q('Hitting for '+auto_prestige_points+' Prestige Points')}else{_q('Discharging FULL energy.')}M.b.t.param('eb',0);M.b.t.param('ff',0)}return!0},switch_side:function(){if(!dev_()||!M.b.param('isRW')){return!0}window.setTimeout(function(){M.b.t.et.switch_side()},seconds(10));if(M.b.wall('left')>=50.7){return TRAVEL.switch_side('no-tso')}return!1},get_limit:function(){return 0},opts_:null,opts:function (opt){if(!M.b.t.et.opts_){M.b.t.et.opts_=$j.extend({pp:0,x2:0,x5:0,db:0,ss:0,wmin:48,wmax:52},OPTS.get('epic-tanking', 'Auto',{}))}return typeof(opt)==='string'&&typeof(M.b.t.et.opts_[opt])!=_u?M.b.t.et.opts_[opt]:M.b.t.et.opts_},updater:function(){var opts=M.b.t.et.opts(),et_opts=[0,0.5,5,10,15,20,255],curr=(in_array(opts.pp,et_opts)?opts.pp:0),et_opts_html='';for (var i = 0; i < et_opts.length; i++){var opt=et_opts[i],is_curr=(opt==curr);et_opts_html+='<label for="epic-tanking-'+opt+'k" class="'+(is_curr?'on':'')+'">'+'<input type="radio" id="epic-tanking-'+opt+'k" name="epic-tanking-value" value="'+opt+'"'+(is_curr?' checked="checked"':'')+' /> '+(!opt?'OFF':(opt>200?'Always ON (tank in all Epics)':'Tank up to '+(opt*1000)+' Prestige points'))+'</label><br />'}var popup=_POP({id:'epic-tanking-pop',title:'Auto-Tank in EPICS*',html:('<br><p style="margin:0 0 20px 100px;text-align:left">'+et_opts_html+'</p>'+'<h2>{Accelerators}, {Boosters}</h2><br>'+'<p id="epic-tanking-pop-boosters">'+'<img id="epic-tanking-booster-x2" src="/images/modules/pvp/allBoosters/speedBoosters.png" title="Toggle x2 Accelerators" '+(opts.x2?' class="on"':'')+' />'+'<img id="epic-tanking-booster-x5" src="/images/modules/pvp/allBoosters/speedBoosters.png" title="Toggle x5 Accelerators"'+(opts.x5?' class="on"':'')+' />'+'<img id="epic-tanking-booster-db" src="/images/modules/pvp/allBoosters/damageBoosters.png" title="Toggle 50% Damage Boosters"'+(opts.db?' class="on"':'')+' />'+(dev_()&&!za_()?'<img id="epic-tanking-ss" src="/images/icons/industry/3/q1.png" title="Enable side switching"'+(opts.ss?' class="on"':'')+' />':'')+'</p>'+(!M.enable_pp_x4_mode?'':('<br><h2>{Wall Interval}</h2>'+'<p id="epic-tanking-pop-wall">'+'Minimum {wall%} (START hitting if wall >=%)<br />'+'<input id="epic-tanking-wall-min" type="range" min="0" max="50" step="0.25" value="'+(opts.wmin)+'" />'+'<span id="epic-tanking-wall-min-display">'+(opts.wmin)+'%</span>'+'<br><br>'+'Maximum {wall%} (STOP hitting if wall >=%)<br />'+'<input id="epic-tanking-wall-max" type="range" min="50" max="100" step="0.25" value="'+(opts.wmax)+'" />'+'<span id="epic-tanking-wall-max-display">'+(opts.wmax)+'%</span>'+'<br /><br /><em>Use Keyboard arrows {left} and {right} for precision control</em>'+'</p>'))+'<br><br><br>'+'<p class="info">Warning: This feature is in TESTING and may malfunction ^_^</p><br>'+'<p style="text-align:left"><em>This will make the script start TANKING<br />(with Energy Bars and selected {accelerators} and {boosters})<br />in EPICS until the desired Presige is reached</em><br />*Tank KEY required '+help_link('See Help', '#epic-tanking')+' for details.</p>')});$j('#epic-tanking-wall-min,#epic-tanking-wall-max').on('change',function(){var _this=$j(this);$j('#'+_this.attr('id')+'-display').text(_this.val()+'%');M.b.t.et.save_opts()});$j('#epic-tanking-pop input[name="epic-tanking-value"]').change(function(){if(!is_valid_auth_key_('tank')){alert('TANK key required. Changes not saved.');return}});$j('#epic-tanking-pop-boosters>img').click(function(){if(!is_valid_auth_key_('tank')){alert('TANK key required. Changes not saved.');return}$j(this).toggleClass('on');M.b.t.et.save_opts()}).tipsy({gravity:'s'});popup.fadeIn();return!0},save_opts:function(){}}};M.util={get_battlefield_url:function (battleID){if(String(battleID).indexOf('/')>-1){var tmp=battleID.split('/');return EREP.url+'/military/battlefield-choose-side/'+tmp[0]+'/'+tmp[1]}return EREP.url+'/military/battlefield/'+battleID},gto:function (battleID){return gto(M.util.get_battlefield_url(battleID))},gto_choose:function (battleID,sideID){return gto(EREP.url+'/military/battlefield-choose-side/'+battleID+'/'+sideID)},get_battle_T:function (battle_start){if(!is_positive_int(battle_start)){if(!is_page('battlefield')){return 0}battle_start=SERVER_DATA['battle_start_at']}return Math.floor(Math.abs(now()-battle_start)/MINUTES)},get_battle_PPM:function(){var elapsed=M.b.ui.get_battle_T();return (elapsed>=90?60:(elapsed>=60?30:(elapsed>=30?20:10)))},calc_win_time:function (elapsed_time,pts_left,pts_right){if(false===elapsed_time){if(!is_page('battlefield')){return 120}elapsed_time=M.util.get_battle_T()}elapsed_time=intval(elapsed_time,0);pts_left=is_int(pts_left)?intval(pts_left,0):false;pts_right=is_int(pts_right)?intval(pts_right,0):false;var win_left=0,win_right=0,points=0,t;if(false!==pts_left){for (t = elapsed_time; t <= 120; t++){points+=(t>90?60:(t>60?30:(t>30?20:10)));if(points>=1800){win_left=1+(t-elapsed_time);break}}if(false===pts_right){return win_left}}points=0;if(false!==pts_right){for (t = elapsed_time; t <= 120; t++){points+=(t>90?60:(t>60?30:(t>30?20:10)));if(points>=1800){win_right=1+(t-elapsed_time);break}}if(false===pts_left){return win_right}}return (0!==win_left&&0!==win_right?Math.min(win_left,win_right):(false!==win_left?win_left:win_right))},cdata:function(){var countries;if(is_page('military/battlefield/')){countries=$j('#pvp_header h3')}else if(is_page('homepage')){countries=$j('#battle_listing li .side_flags')}else if(is_page('battlefield-new')){countries=$j('#pvp_header > div.country > div.country_avatar > a > img')}else{countries=$j('#battle_listing li[id^="battle-"] strong')}$j(countries).not('.c-data').each(function(){var country,_this=$j(this);if(_this.is('img')||_this.is('span')){country=COUNTRIES.imget(_this)}else{country=COUNTRIES.get(_this.contents().filter(function(){return this.nodeType==3}).text().trim())}var q=_this.find('q').clone(true),merc_status=M.util.mercff.get_merc_status(country);if(is_page('battlefield-new')){_this.addClass('c-data').data('c-data',country).attr('title',merc_status+'/25 Mercenary kills for '+country.name).tipsy({gravity:'s'});_this.parents('.country').addClass('c-data').data('c-data',country);_this.parents('.country_avatar').append('<q class="merc merc-'+(merc_status>=25?'ok':'progress')+'">'+merc_status+'</q>');return!0}_this.text(country.display).addClass('c-data').data('c-data',country).click(function(){gto(EREP.url+'/country/society/'+country.url)}).append(q)});return!0},mercff:{_:false,init:function(){if(dev_(true,!0)){return!0}if(is_page('battlefield-new')){M.util.mercff.data()}return!0},show:function (_elems){},get_merc_status:function (country){if(typeof(country)!='object'){country=COUNTRIES.get(country)}return typeof(M.util.mercff.data('merc').countries[country.display])!=_u?M.util.mercff.data('merc').countries[country.display]:0},get_ff_status:function (warID){return typeof(M.util.mercff.data('ff').ongoing['war-'+warID])!=_u?M.util.mercff.data('ff').ongoing['war-'+warID]:0},data:function (key){if(!M.util.mercff._){M.util.mercff._=_PLAYER_.mercff_data()}return typeof(key)!=_u&&typeof(M.util.mercff._[key])!=_u?M.util.mercff._[key]:M.util.mercff._},jqx_callback:function (response,url){}},default_sides:{lists:false,get:function(){if(!M.util.default_sides.lists){var lists=OPTS.get('default-sides', 'Military',{pro:[],con:[]}),csID=getinfo('citizenship', 'id');if(lists.pro.length<1){lists.pro.push(csID);if(_PLAYER_.muCSID&&_PLAYER_.muCSID!=csID){lists.pro.push(_PLAYER_.muCSID)}}M.util.default_sides.lists=lists}return M.util.default_sides.lists},updater:function(){var selector_pro='',selector_con='';for (var cID in COUNTRIES.get_list()){if(!COUNTRIES._list.hasOwnProperty(cID)){continue}var c=COUNTRIES._list[cID];selector_pro+='<option value="'+c.id+'"'+(in_array(c.id,M.util.default_sides.get().pro)?' selected="selected"':'')+'>'+c.display+'</option>';selector_con+='<option value="'+c.id+'"'+(in_array(c.id,M.util.default_sides.get().con)?' selected="selected"':'')+'>'+c.display+'</option>'}var popup=_POP({id:'default-sides-pop',title:'Default {FOR} and {AGAINST} when fighting',html:('<br><h2>Fight {FOR}:</h2><select id="default-sides-default-pro" multiple="multiple">'+selector_pro+'</select><br><br><h2>Fight {AGAINST}:</h2><select id="default-sides-default-con" multiple="multiple">'+selector_con+'</select><p align="right"><br>'+cb_std_string('Save', 'green pop-btn-save')+'</p><p>Side choosing order is:</p><ol style="list-style:decimal inside;margin-left:10px;"><li><b>{FOR}</b></li><li><b>{AGAINST}</b></li><li><b>{MU Citizenship}</b>: '+COUNTRIES.get(_PLAYER_.muCSID,'display')+'`s MPP list</li><li><b>{Citizenship}</b>: '+getinfo('citizenship', 'display')+'`s MPP list</li><li><b>Resistance</b> in RW (Freedom Fighter)</li><li>Combat Orders</li><li>Left side</li></ol><p align="right">'+help_link('See Help', '#side-choosing')+' for details.</p>')});$j('#default-sides-pop a.pop-btn-save').click(function(){var lists={pro:($j('#default-sides-default-pro').val()||[]).map(function (c){return +c}),con:($j('#default-sides-default-con').val()||[]).map(function (c){return +c})};for (var i = 0; i < lists.pro.length; i++){if(lists.con.indexOf(lists.pro[i])>-1){alert(COUNTRIES.get(pro[i],'display')+' found in both {FOR} and {AGAINST} lists. Save aborted.');return!1}}if((lists.con.indexOf(getinfo('citizenship', 'id'))>-1&&!confirm('citizenshipID ('+COUNTRIES.get(getinfo('citizenship', 'id'),'display')+') found in {AGAINST} list. Continue?'))||(_PLAYER_.muCSID&&lists.con.indexOf(_PLAYER_.muCSID)>-1&&!confirm('MU citizenshipID ('+COUNTRIES.get(_PLAYER_.muCSID,'display')+') found in {AGAINST} list. Continue?'))){return}lists.pro=lists.pro.reduce(function (p,c){if(is_positive_int(c)&&p.indexOf(c)<0){p.push(c)}return p},[]);lists.con=lists.con.reduce(function (p,c){if(is_positive_int(c)&&p.indexOf(c)<0){p.push(c)}return p},[]);OPTS.set('default-sides', 'Military',lists);popup.fadeOut()});$j('#default-sides-pop>select').select2({width:'400px',minimumInputLength:2});popup.fadeIn();return!0}},choose_side:function (leftID,rightID){var type;if(!leftID||!rightID){if(is_page('battlefield')&&(!M.b.param('id')||!M.b.param('leftID'))){M.b.get_data()}if(M.b.param('id')){leftID=M.b.param('leftID');rightID=M.b.param('rightID');type=(M.b.param('isRW')?'rw':(M.b.param('isCIVILWAR')?'cw':'mpp'))}else if(is_page('choose-side')){leftID=$j('.listing a.join').attr('href').split('choose-side/')[1].split('/')[1];rightID=$j('.listing a.reversed').attr('href').split('choose-side/')[1].split('/')[1];type='rw'}else if(is_page('battlefield')){if(typeof(SERVER_DATA.leftBattleId)!=_u){leftID=SERVER_DATA.leftBattleId;rightID=SERVER_DATA.rightBattleId}else{leftID=COUNTRIES.imget($j('#pvp_header div.country.left_side img').first().attr('src'),'id');rightID=COUNTRIES.imget($j('#pvp_header div.country.right_side img').first().attr('src'),'id')}type=(SERVER_DATA.isResistance?'rw':(SERVER_DATA.isCivilWar?'cw':'mpp'))}else{return 0}}var left,right;try{left=COUNTRIES.get(leftID)}catch(e){left=COUNTRIES.get(0)}try{right=COUNTRIES.get(rightID)}catch(e){right=COUNTRIES.get(0)}if(!left||!right||!left.id||!right.id){return 0}var twp=CRPK.battles.tw.hash_prio([left,right,type].join('-'));if(twp&&is_positive_int(twp)){return twp}var csID=getinfo('citizenship', 'id'),default_for=M.util.default_sides.get().pro||[],default_against=M.util.default_sides.get().con||[],default_mpps=COUNTRIES.get_mpps(csID);if(_PLAYER_.muCSID&&_PLAYER_.muCSID!=csID&&in_array(_PLAYER_.muCSID,default_for)){default_mpps=default_mpps.concat(COUNTRIES.get_mpps(_PLAYER_.muCSID))}if(!is_valid_auth_key_('tank')){var chk_arr=[csID].concat(COUNTRIES.get_mpps(csID),default_for,default_against),ax=63,bx=168;if(_PLAYER_.muCSID){chk_arr=chk_arr.concat(_PLAYER_.muCSID,COUNTRIES.get_mpps(_PLAYER_.muCSID))}if(!array_intersect([left.id,right.id],chk_arr)){if(typeof(ax)!=_u&&typeof(bx)!=_u&&left.id==ax&&right.id==bx&&!in_array(ax,default_for)){return bx}default_for=default_for.concat([1,14,65,48,81],COUNTRIES.get_mpps(1));default_against=default_against.concat([13,63,64,35,42,79],COUNTRIES.get_mpps(63),COUNTRIES.get_mpps(64))}}if(in_array(left.id,default_for)||in_array(right.id,default_against)){return left.id}else if(in_array(right.id,default_for)||in_array(left.id,default_against)){return right.id}else if(in_array(left.id,default_mpps)){return left.id}else if(in_array(right.id,default_mpps)){return right.id}else if(is_page('choose-side')){return left.id}else if(SERVER_DATA.fightAgainstBrothers){return right.id}if(typeof(SERVER_DATA.campaigns)=='object'&&SERVER_DATA.campaigns.length){var co=SERVER_DATA.campaigns.filter(function (co){return co.division==SERVER_DATA.division&&co.threshold>=50&&co.budget>=2000}).sort(function (a,b){return b.budget-a.budget});if(co.length>0){clog(co[0]);return co[0].side_country_id}}return left.id},_valid_battlefield:null,is_valid_battlefield:function (type){if(M.util._valid_battlefield===null){if(!is_page('battlefield')||typeof(SERVER_DATA)==_u||typeof(SERVER_DATA.battleFinished)==_u||SERVER_DATA.battleFinished||(SERVER_DATA.division==AIRFORCE_DIVISION&&!M.airforceEnabled())||(typeof(SERVER_DATA.points)=='object'&&(SERVER_DATA.points.attacker>=1800||SERVER_DATA.points.defender>=1800))){M.util._valid_battlefield='invalid'}else{var _against_warning=SERVER_DATA.fightAgainstBrothers,_civil_war_move=(SERVER_DATA.isCivilWar&&SERVER_DATA.travelRequired),_move_required=(_civil_war_move||SERVER_DATA.travelRequired);if((SERVER_DATA.division==AIRFORCE_DIVISION&&!M.airforceEnabled())){M.util._valid_battlefield='invalid'}else{M.util._valid_battlefield=(_against_warning?'friendly':(_move_required?'travel':($j('#fight_btn').exists()?'valid':'invalid')))}}}return typeof(type)=='string'?M.util._valid_battlefield==type:M.util._valid_battlefield},determination_report:function(){if(!M.valid_modKEY){return}var country=COUNTRIES.get(_URL_.split('society/')[1]);if(!$j('#determination_report').exists()){$j('<a href="'+VOID+'" id="determination_report" class="cb-icon-16">Determination Report</a>').css({marginLeft:'15px'}).click(function(){M.util.determination_report()}).appendTo($j('h2.section').eq(1));$j('table.regions>tbody>tr>td:has(.influence_multiplier)>a.fakeheight').each(function(){var _this=$j(this),r=REGIONS.get(_this.text().trim()),owner=COUNTRIES.get(r.cID);_this.data('region',{owner:owner,region:r});if(owner.id==country.id){return!0}_this.css({'background':'url(/images/flags_png/M/'+owner.url+'.png) left top no-repeat','padding-left':'30px'}).append(' ('+owner.display+')')});return}var report=[];$j('table.regions>tbody>tr>td:has(.influence_multiplier)').each(function(){var _this=$j(this),a=_this.find('a.fakeheight'),b=_this.find('span.influence_multiplier'),data=a.data('region');if(data.owner.id==country.id){return!0}report.push([data.owner.name,data.region.name,b.text()])});report.sort(function (a,b){if(a[0]==b[0]){return b[2]-a[2]}return a>b});report.unshift(['Country', 'Region', 'Determination']);var b=new Date(),date=[b.getFullYear(),('00'+b.getMonth()).slice(-2),('00'+b.getDate()).slice(-2)].join('-');export_csv(report,'Determination-report-'+(_URL_.split('country/society/')[1])+'-'+date)},collectDO:function(){if(!is_page('homepage')){return!1}var today=getinfo('day'),orders=LS.get('DAILY_ORDERS',{day:getinfo('day'),battles:[],sides:{}}),_do=$j('#citizen_feed > div.inner > div.wall_post.daily_order > div > p > a.campaignOfTheDay_onFeed'),battleID=_do.exists()?intval(_do.attr('href').replace('-new', '').split('battlefield/')[1]):0;if(orders.day!=today){orders={day:getinfo('day'),battles:[],sides:{}}}if(battleID){orders.battles.unshift(battleID);orders.sides[battleID]=0}orders.battles=orders.battles.reduce(function (p,c){if(p.indexOf(c)<0){p.push(c)}return p},[]);LS.set('DAILY_ORDERS',orders);return!0},dailyOrdersCache:false,getDailyOrders:function(){if(!M.util.dailyOrdersCache){var today=getinfo('day'),orders=LS.get('DAILY_ORDERS',{day:today,battles:[],sides:{}});M.util.dailyOrdersCache=(orders.day==today?orders:{day:today,battles:[],sides:{}})}return M.util.dailyOrdersCache},battleIsDO:function (battleID){var orders=M.util.getDailyOrders();if(typeof(orders.battles)==_u||orders.battles.length<1||!in_array(battleID,orders.battles)){return!1}if(typeof(orders.sides)!=_u&&typeof(orders.sides[battleID])!=_u&&orders.sides[battleID]){return orders.sides[battleID]}return!0},get_top5_damage_stats:function (stats,roundNUM,sideID,division){return M.util.get_current_stats(stats,'damage',roundNUM,sideID,division)},get_top5_kills_stats:function (stats,roundNUM,sideID,division){return M.util.get_current_stats(stats,'kills',roundNUM,sideID,division)},get_current_stats:function (stats,type,roundNUM,sideID,division){var result=[];if('stats' in stats){stats=stats['stats']}if(typeof(stats)!='object'||typeof(stats.current)!='object'){return result}if(typeof(sideID)==_u&&M.b.param('leftID')){sideID=M.b.param('leftID')}if(typeof(division)==_u){division=M.b.division()}if(!roundNUM){if(M.b.param('round')){roundNUM=M.b.param('round')}else{for (var zoneId in stats.current){if(stats.current.hasOwnProperty(zoneId)&&is_positive_int(zoneId)){roundNUM=intval(zoneId,1);break}}}}if(!is_int(roundNUM)||typeof(stats.current[roundNUM])!='object'){return result}if(typeof(stats.current[roundNUM][division])!='object'&&typeof(stats.current[roundNUM][DEFAULT_AIRFORCE_DIVISION])=='object'){division=DEFAULT_AIRFORCE_DIVISION}if(is_positive_int(division)&&typeof(stats.current[roundNUM][division])=='object'){if(is_positive_int(sideID)){if(typeof(stats.current[roundNUM][division][sideID])!=_u&&is_array(stats.current[roundNUM][division][sideID]['top_'+type])){result=stats.current[roundNUM][division][sideID]['top_'+type]}}else{result={};for (sideID in stats.current[roundNUM][division]){if(stats.current[roundNUM][division].hasOwnProperty(sideID)){result[sideID]=stats.current[roundNUM][division][sideID]['top_'+type]}}}}return result},get_personal_stats:function (stats,roundNUM,sideID){if(typeof(roundNUM)==_u&&M.b.param('round')){roundNUM=M.b.param('round')}if(typeof(sideID)==_u&&M.b.param('leftID')){sideID=M.b.param('leftID')}if('stats' in stats){stats=stats['stats']}if(is_int(roundNUM)&&is_positive_int(sideID)&&typeof(stats)=='object'&&typeof(stats.personal)=='object'&&typeof(stats.personal[roundNUM])=='object'&&typeof(stats.personal[roundNUM][sideID])=='object'&&is_array(stats.personal[roundNUM][sideID].top_damage)&&stats.personal[roundNUM][sideID].top_damage.length>0&&stats.personal[roundNUM][sideID].top_damage[0].damage){if(typeof(stats.personal[roundNUM][sideID]['top_damage'])!=_u&&is_array(stats.personal[roundNUM][sideID]['top_damage'])&&stats.personal[roundNUM][sideID]['top_damage'].length>0){return stats.personal[roundNUM][sideID].top_damage[0]}return!1}return!1},getPrestigePoints:function (forced){var prestige=LS.get('prestige_points',{ts:0,pp:0});if(is_page('home')){prestige={ts:now(),pp:intval($j('#weeklyChallenge>div.player_layer>span>small>strong').text().split(' ')[0],0)};LS.set('prestige_points',prestige)}else if(is_page('battlefield-new')&&(!M.b.t.rage()||(M.b.t.rage()&&typeof(M.util.get_prestige_points_rage)==_u))){if(M.b.t.rage()){M.util.get_prestige_points_rage=!0}prestige={ts:now(),pp:intval($j('#prestige_value').text(),0)};WS.set('prestige_points',prestige)}else if(!forced&&WS.check('prestige_points')){prestige.pp=WS.get('prestige_points',{ts:0,pp:0}).pp}else if(forced||timestamp_expired(prestige.ts,10*MINUTES)){$j.ajax({url:EREP.url,async:false,global:false,success:function (response){if(!response||(response.indexOf('<div class="weekly_challenge" ')<0&&response.indexOf(' id="weeklyChallenge">')<0)){prestige={ts:0,pp:0};return prestige}if(response.indexOf(' id="weeklyChallenge">')>-1){response=response.split(' id="weeklyChallenge">')[1]}else{response=response.split('<div class="weekly_challenge" ')[1]}response='<div '+response.split('<div class="weekly_challenge_reward pulse"')[0];prestige={ts:now(),pp:intval($j(response).find('div.player_layer>span>small>strong').text().split(' ')[0],0)};LS.set('prestige_points',prestige);if(is_page('battlefield')){WS.set('prestige_points',prestige)}}})}return prestige.pp},moveAndJoinSide:function(){if(!M.valid_tankKEY){return!1}var locationID=getinfo('location', 'id'),occupationID=COUNTRIES.imget($j('#content>div.war_list_header>div.country.right_side>a>img'),'id');if(locationID==occupationID){return!0}var resistence=COUNTRIES.get($j('#content>div.listing.resistance>a.join').attr('href').split('choose-side/')[1].split('/')[1]),occupation=COUNTRIES.get(occupationID);$j('#content > div.listing.resistance').append('<div class="move-and-join-wrap">'+'<a '+cb_std_class('white move-and-join join-resistance')+' href="'+VOID+'">'+'<img src="/images/flags_png/M/'+resistence.url+'.png" /> Move and join <b>'+resistence.name+'</b></a>'+'<a '+cb_std_class('white move-and-join join-occupation')+' href="'+VOID+'">'+'Move and join <b>'+occupation.name+'</b> <img src="/images/flags_png/M/'+occupation.url+'.png" /></a>'+'</div>');$j('#content>div.listing.resistance>div>a.move-and-join').click(function(){$j('#content>div.listing.resistance>div>a.move-and-join').unbind();$j(this).css('opacity',0.25);var regionID=TRAVEL.get_country_regions(occupationID)[0].id,resistenceURL=$j('#content>div.listing.resistance>a.join').attr('href'),battleID=resistenceURL.split('choose-side/')[1].split('/')[0],resistenceID=resistenceURL.split('choose-side/')[1].split('/')[1],joinURL=EREP.url+'/military/battlefield-choose-side/'+battleID+'/'+($j(this).hasClass('join-resistance')?resistenceID:occupationID);TRAVEL.to(occupationID,regionID,battleID,function(){return gto(joinURL)})})}};OPTS.register_custom('epic-tanking', 'Auto-Tank in {EPICS}', 'Auto', 'button',{pp:0,x2:0,x5:0,db:0,ss:0,wmin:48,wmax:52},M.b.t.et.updater);OPTS.register_custom('airforce-mode','Enable Fighting in Airforce','Military','select',(function(){var texts={weapons:'Only if i have weapons',whatever:'Meh. Whatever.',always:'Always prefer Airforce',never:'Never fight in Airforce'},_defaults=[],options={};if(getinfo('level')>=70){_defaults.push('whatever', 'never')}else{_defaults.push('never', 'whatever')}for (var i = 0, len = _defaults.length; i < len; i++){options[_defaults[i]]=texts[_defaults[i]]}if(is_valid_auth_key_('tank')){options['always']=texts['always'];options['weapons']=texts['weapons']}return options})());OPTS.register_custom('default-sides', 'Set default {FOR} and {AGAINST}', 'Military', 'button',{pro:[],con:[]},M.util.default_sides.updater);if(is_valid_auth_key_('tank')&&is_valid_auth_key_('co')&&zbeta_()&&in_array(getinfo('uid'),[1444169,1626301,1559809])){OPTS.register_custom('auto-x', 'FF discharge settings', 'Auto', 'button',M.a.hunt.x._.settings,M.a.hunt.x.updater)}M.tf={data:{ts:0,d:{},tf:{}},init:function(){if(!OPTS.get('track-top-fighter', 'Military')){return!0}M.tf.data=LS.get('top-fighter',M.tf.data);_BG_.add('top_fighter_damage_scan',M.tf.get,hours(1),!0);if(is_page('home')&&timestamp_expired(M.tf.data.ts,minutes(30))){M.tf.get()}M.tf.display()},get:function(){$j.getJSON(EREP.url+'/main/leaderboards-damage-rankings/'+getinfo('citizenship', 'id')+'/0/0/'+_PLAYER_.div,function (data){if(data&&('myPosition' in data)){var today=getinfo('day');M.tf.data.ts=now();M.tf.data.d[today]=intval(data.myPosition.values,0);M.tf.save();if(!M.tf.data.tf[today-1]&&getinfo('hour')>=2){$j.get(EREP.url+'/main/rankings-damage/1').done(function (response){response=response.split('<table class="bestof">')[1].split('</table>')[0];M.tf.data.tf[today-1]=intval($j('<table>'+response+'</table>').find('tr:last > td:last').text().trim());M.tf.save()})}}})},display:function(){var today=getinfo('day'),td_damage=0,yd_damage=0,tf_damage=0;if(M.tf.data.d[today]&&(M.tf.data.d[today-1]||is_tuesday())){td_damage=M.tf.data.d[today]-(is_tuesday()?0:M.tf.data.d[today-1])}if(M.tf.data.tf[today-1]){tf_damage=M.tf.data.tf[today-1]}if(!td_damage&&!yd_damage){return!0}$j('<div class="cb-sidebar-box" id="cb-top-fighter-box">'+(td_damage?'<b>Your Damage Today</b>: '+k_number_format(td_damage)+'<br />':'')+(tf_damage?'<b>Yesterday`s TF</b>: '+k_number_format(tf_damage)+' <small>(last place)</small><br />':'')+'</div>').insertBefore($j('#cb-sidebar-box,#cb-tax-box,#large_sidebar .sidebar_banners_area>:first-child').first());return!0},save:function(){if(!M.tf.data.ts){return!1}var today=getinfo('day'),day;for (day in M.tf.data.d){if(M.tf.data.d.hasOwnProperty(day)&&day<today-5){delete M.tf.data.d[day]}}for (day in M.tf.data.tf){if(M.tf.data.tf.hasOwnProperty(day)&&M.tf.data.d.hasOwnProperty(day)&&day<today-5){delete M.tf.data.tf[day]}}LS.set('top-fighter',M.tf.data);return!0}};OPTS.register('track-top-fighter', 'Track Top Fighter Damage', 'Military',0);/***M.battlewatcher*WatcherforEPIC,CO,BHand/orObjectives*/M.battlewatcher={_:{is_init:false},init:function(){'use strict';if(!(is_page('wars')||(is_page('homepage')&&!instr(oURL,'?')))){return!1}if(!M.battlewatcher._.is_init){M.battlewatcher._.is_init=!0;_BG_.add('M.battlewatcher',M.battlewatcher.check,minutes(2));document.addEventListener('CRPK_battles_updated',M.battlewatcher.check,!1)}return M.battlewatcher._.is_init},check:function(){'use strict';clog('M.battlewatcher.check()');return dev_()&&CRPK.battles.init()&&(M.battlewatcher.check_objective()||M.battlewatcher.check_epic()||M.battlewatcher.check_co()||M.battlewatcher.check_x())},check_objective:function(){'use strict';if(M.enableObjectiveMode&&M.objectiveHunt){clog('M.battlewatcher.check_objective()');return!1}return!1},check_epic:function(){'use strict';if(M.a.o.epic_hunt){if(CRPK.battles.haz.epic()){return M.a.hunt.epic.init()}else if(M.b.can_switch_division()&&CRPK.battles.haz.epic_any_div()){return M.a.hunt.epic.init()}}return!1},check_co:function(){'use strict';if(M.a.o.co_hunt){clog('M.battlewatcher.check_co()');return!1}return!1},check_x:function(){'use strict';clog('M.battlewatcher.check_x()');if(M.a.hunt.x.allowed()&&M.a.hunt.x.check_battles()&&M.a.hunt.x.can()){M.a.hunt.x.init()}return!1},objective_ajax_check:function(){'use strict';clog('M.battlewatcher.objective_ajax_check()');if(M.enableObjectiveMode&&M.objectiveHunt){$j.ajax(EREP.url).done(function (response){if(/id="objective-battle-/.test(response)&&(/class="std_global_btnredColor"/.test(response)||/class="button_bodycolour_red"/.test(response))){return gto(EREP.url)}setTimeout(function(){M.a.hunt.objective_ajax_check()},seconds(15))})}return!0}};if(is_valid_auth_key_('military')){OPTS.register('enable-rage-effects', 'Enable RAGE Visual Effects', 'Military',1)}PLUGINS['military']={f:M.init,p:false};if(isLoggedIn()){M.b.ui.rebind_travel_popup()}}}catch (pluginError){console.error('Plugin load ERROR');debug_(pluginError);hasPluginError = true};try{/*============ Plugin: Sitewide*/if(typeof(CB_EREP_LIBRARY_LOADED)!=_u){OPTS.register('hide-junk','Hide {Daily Order/Daily Tasks/other} popups/alerts','General',1);OPTS.register('fix-links','Remove {External Links} warnings','General',1);OPTS.register('optimize-feed','Optimize Feeds and Article comments','General',1);OPTS.register('optimize-feed-previews','Show image previews for screenshots','General',1);OPTS.register('compact-achievments','Minimize News Feed Achievments (Medals)','General',1,function(){if($j(this).is(':checked')&&!$j('#pkopt____General____optimize-feed').is(':checked')){$j('#pkopt____General____optimize-feed').prop('checked',!0).trigger('change')}});OPTS.register('hidechat','Hide MU Chat on all pages except HOME','General',1);OPTS.register('advanced-search-box','Advanced Search Box','General',1);OPTS.register('enable-vcards','Enable Player vCards','General',1);OPTS.register('hide-decorations','Hide (spam) decorations on Profiles','General',1);OPTS.register('auto-post-medals','Auto-post Medals on feed','General',0);if(typeof(CRPK.plugins.AUTO)==_u){OPTS.register('aovertime','Auto Work Overtime','Auto',getinfo('level')>=70?1:0)}OPTS.register('cb-sexy-bg','Sexy Backgrounds','General',0);OPTS.register('cb-sexy-bg-for-her','Sexy Backgrounds: I am a girl (or a fag)','General',0,function(){if($j(this).is(':checked')&&!$j('#pkopt____General____cb-sexy-bg').is(':checked')){$j('#pkopt____General____cb-sexy-bg').prop('checked',!0).trigger('change')}});OPTS.register('enable-birthdays','Enable Birthdays','General',1);var SITEWIDE={pages:['home','article','profile','donate','messages-alerts','messages-inbox','messages-paginated','messages-read','myCompanies','create-company','training-grounds','/country/','/region/','/law/','/country-administration/','/resource-wars/','my_friends','/party/','/party-members/','/congress-elections'],enable_ebars:false,init:function(){if(!(OPTS.get('enable-birthdays')&&CRPK.birthdays.init())){SITEWIDE.sexybg()}if(OPTS.get('auto-post-medals','General')){window.setTimeout(function(){SITEWIDE.auto_post()},200)}if(is_page('home')){SITEWIDE.widechat();SITEWIDE.rwhammer.init()}else if(OPTS.get('hidechat')){SITEWIDE.hidechat()}SITEWIDE.energy_bar_protection();_BG_.add('update-scammers-list',SITEWIDE.update_scammers,hours(12));if(!is_page('home')){SITEWIDE.homelink()}if(OPTS.get('advanced-search-box')){CRPK.sbox.init()}if(OPTS.get('hide-junk')){SITEWIDE.notifications()}if(OPTS.get('enable-vcards')){CRPK.vcards.init()}SITEWIDE.sidebar();SITEWIDE.kbd_shortcuts();SITEWIDE.page_titles();SITEWIDE.my_places();if(is_page('profile/')||is_page('economy/donate-')||is_page('friends/')){$j('#donate_to_friend div').remove()}window['checkNumber']=window['checkFloat']=window['upkey']=function(){return!0};for (var i = 0; i < SITEWIDE.pages.length; i++){var page=SITEWIDE.pages[i],func=(page.split('/').join('_').replace(/-/g,'_')+'_page');if(is_page(page)&&typeof(SITEWIDE[func])!=_u){return SITEWIDE[func]()}}},auto_post:function(){var input=$j('input[id*="wall_enable_alerts_"]:not(.crpk-posted)');if(input.exists()){input.each(function(){var _this=$j(this);_this.prop('checked',!0).attr('checked','checked').addClass('crpk-posted');_this.parents('div.start_content').find('a.get_reward').trigger('click').unbind()});window.setTimeout(function(){SITEWIDE.auto_post()},(5+input.length)*100)}return!0},sexybg:function(){if(!OPTS.get('cb-sexy-bg')||(typeof(CRPK.birthdays)!=_u&&CRPK.birthdays.init())){return!1}var _body=$j('body'),special=_body.hasClass('winter_event')?'-winter':'',gender=(OPTS.get('cb-sexy-bg-for-her',0)?'for-her':'for-him'),lock=LS.get('sexy-bg-'+gender+'-lock',0),bg_max=(special=='-winter'?(gender=='for-her'?7:16):(gender=='for-her'?7:23)),num=(lock?lock:rand(1,bg_max)),model=gender+special+'-'+num;if(!special&&gender=='for-her'){return!0}/*if(dev_()){$j('<a href="'+VOID+'" class="ambient_toggler" style="display:inline;clear:right;float:right;" title="[CB] Choose your own background"><span>Choose your own</span></a>').click(function(){var img=prompt('Enter (valid) Image URL',decodeURIComponent(LS.get('cb-custom-bg','')));if(!img){LS.del('cb-custom-bg')}else{LS.set('cb-custom-bg',encodeURIComponent(img))}}).appendTo('body>div.at>div.ath')}*/_body.addClass('cb-sexy-bg').append('<div id="cb-sexy-bg" data-bg_base="'+((special?'cb-sexy-bg'+special+' ':'')+'cb-sexy-bg-'+gender+special+'-')+'" data-bg_num="'+num+'" class="cb-sexy-bg '+((special?' cb-sexy-bg'+special:'')+' cb-sexy-bg-'+model)+'"></div>');$j('#cb-sexy-bg').css('height',$j(document).height()+'px');$j('body>div.at>div.ath>a.ambient_toggler:nth-child(1)').unbind().attr('style','display:inline;clear:right;float:right;').attr('id','cb-sexy-bg-pin').data('sexy-bg-lock','sexy-bg-'+gender+'-lock').data('sexy-bg-num',num).click(function(){var _this=$j(this),lock=_this.data('sexy-bg-lock'),span=_this.find('span'),current=_this.data('sexy-bg-num');if(_this.find('span').hasClass('pinned')){LS.del(lock);span.removeClass('pinned').addClass('unpinned').find('i.bg_num').attr('data-bg_num',current)}else{LS.set(lock,intval(current,1));span.removeClass('unpinned').addClass('pinned').find('i.bg_num').attr('data-bg_num',current)}}).find('span').addClass(lock?'pinned':'unpinned').html('<i class="bg_num" data-bg_num="'+num+'"></i>');$j('body>div.at>div.ath').append('<a href="'+VOID+'" class="cb-sexy-bg-switch cb-sexy-prev"><i class="fa fa-step-backward"></i></a>'+'<a href="'+VOID+'" class="cb-sexy-bg-switch cb-sexy-next"><i class="fa fa-step-forward"></i></a>');$j('body>div.at>div.ath>a.cb-sexy-bg-switch').click(function(){var _this=$j(this),pin=$j('#cb-sexy-bg-pin'),bg_div=$j('#cb-sexy-bg'),bg_type=bg_div.data('bg_base'),bg_num=intval(bg_div.data('bg_num'),1),next_bg_num=bg_num+(_this.hasClass('cb-sexy-prev')?-1:1),lock=LS.get('sexy-bg-'+gender+'-lock',0);if(next_bg_num>bg_max){next_bg_num=1}if(next_bg_num<=0){next_bg_num=bg_max}pin.data('sexy-bg-num',next_bg_num);pin.find('span').removeClass('pinned unpinned').addClass(lock&&lock==next_bg_num?'pinned':'unpinned');pin.find('i.bg_num').attr('data-bg_num',next_bg_num);bg_div.removeClass(bg_type+bg_num).addClass(bg_type+next_bg_num).data('bg_num',next_bg_num)});return!0},homelink:function(){if(!is_page('home')){$j('<a id="cb-home-link" class="scrollToTop" href="'+EREP.url+'"></a>').insertAfter('#scrollToTop')}},widechat:function (c){if(1){return!1}c=(c||0)+1;if(c>10){return}var elems=$j('div[id*="comet"],iframe[id*="comet"]');if(elems.exists()){return elems.addClass('cb')}return window.setTimeout(function(){SITEWIDE.widechat(c)},200)},hidechat:function (counter){if(!counter||!is_positive_int(counter)){$j(window).off('resize');counter=1}if(counter>=5){return}$j('body').addClass('cbNoChat');counter++;$j('script[src*="comet", div[id*="comet"], iframe[id*="comet"]').remove();return window.setTimeout(function(){SITEWIDE.hidechat(counter)},200)},myCompanies_page:function(){SITEWIDE.no_location_reload('.solid_pop');$j('.manager_dashboard .list .area .listing_holder .heading').addClass('cb');var wam_options=''+'<li> ----- [CB] Work as Manager</li>'+'<li><a class="check_uncheck_all cb wam all" data-type="wam" data-industry="0" data-quality="0" href="'+VOID+'">Select Max WAM: ALL</a></li>'+'<li><a class="check_uncheck_all cb wam wrm" data-type="wam" data-industry="12" data-quality="0" href="'+VOID+'">Select Max WAM: WRM</a></li>'+'<li><a class="check_uncheck_all cb wam frm" data-type="wam" data-industry="7" data-quality="0" href="'+VOID+'">Select Max WAM: FRM</a></li>'+'<li><a class="check_uncheck_all cb wam weapons q7" data-type="wam" data-industry="2" data-quality="7" href="'+VOID+'">Select Max WAM: Weapons Q7</a></li>'+'<li> ----- [CB] Assign Employees</li>'+'<li><a class="check_uncheck_all cb employees weapons q7" data-type="employees" data-industry="2" data-quality="7" href="'+VOID+'">Select Max Employees: Weapons Q7</a></li>'+'<li><a class="check_uncheck_all cb employees houses" data-type="employees" data-industry="4" data-quality="0" href="'+VOID+'">Select Max Employees: Houses</a></li>'+'<li><a class="check_uncheck_all cb employees arm" data-type="employees" data-industry="24" data-quality="0" href="'+VOID+'">Select Max Employees: ARM</a></li>'+'<li><a class="check_uncheck_all cb employees missiles" data-type="employees" data-industry="23" data-quality="0" href="'+VOID+'">Select Max Employees: Aircraft Weapons</a></li>';$j('#all_companies_menu>ul').addClass('cb').append(wam_options);$j('#all_companies_menu>ul').on('hover',function (e){e.stopPropagation();e.stopImmediatePropagation()});$j('#all_companies_menu>ul>li>a.check_uncheck_all.cb').unbind().on('click',function (e){console.log('here');e.stopPropagation();e.stopImmediatePropagation();e.preventDefault();var _this=$j(this),type=_this.data('type'),industry=intval(_this.data('industry')),quality=intval(_this.data('quality'));if(_this.hasClass('cb-active')){return}if(type=='wam'&&!industry){$j('#all_companies_menu>ul>li>a.check_uncheck_all.cb.wam').addClass('cb-active')}else{_this.addClass('cb-active')}SITEWIDE.myCompanies_page_select_max(type,industry,quality)});SITEWIDE.myCompanies_page_holding_summary();SITEWIDE.myCompanies_page_multi_assign_to_holding()},myCompanies_page_holding_summary:function(){var holdingCompanies=window['holdingCompanies'];if(Object.keys(holdingCompanies).length<1){return}var factories=window['companies'];if(Object.keys(factories).length<1){return}var factoryId,factory,employeeLimit,holdingId,holdingSummaries={};for (factoryId in factories){if(!factories.hasOwnProperty(factoryId)){continue}factory=factories[factoryId];holdingId=factory['holding_company_id'];if(holdingId==!1){continue}if(typeof(holdingSummaries[holdingId])==_u){holdingSummaries[holdingId]={wamMax:0,wamWorked:0,wamSelected:0,employeesMax:0,employeesWorked:0,employeesSelected:0}}if(factory['wam_enabled']){holdingSummaries[holdingId].wamMax++;if(factory['already_worked']){holdingSummaries[holdingId].wamWorked++}else if(factory['preset_own_work']){holdingSummaries[holdingId].wamSelected++}}employeeLimit=factory['total_works'];if(employeeLimit<1){continue}holdingSummaries[holdingId].employeesMax+=employeeLimit;if(factory['todays_works']>0){holdingSummaries[holdingId].employeesWorked+=factory['todays_works']}else if(factory['preset_works']>0){holdingSummaries[holdingId].employeesSelected+=factory['preset_works']}}var holdingHeader,holdingSummary,wamSummaryText,wamSummaryTooltip,employeesSummaryText,employeesSummaryTooltip,travelinfoText;for (holdingId in holdingSummaries){if(!holdingSummaries.hasOwnProperty(holdingId)){continue}holdingHeader=$j('#holding_'+holdingId+' > div.companies_header');if(!holdingHeader.exists()){continue}holdingSummary=holdingSummaries[holdingId];wamSummaryText='';if(holdingSummary.wamMax){wamSummaryTooltip=[];if(holdingSummary.wamWorked){wamSummaryTooltip.push('Worked: '+holdingSummary.wamWorked);wamSummaryText+='<q class="empGreen">'+holdingSummary.wamWorked+'</q>'}if(holdingSummary.wamSelected){wamSummaryTooltip.push('Selected: '+holdingSummary.wamSelected);wamSummaryText+='<q class="empBlack">'+holdingSummary.wamSelected+'</q>'}if(!holdingSummary.wamWorked&&!holdingSummary.wamSelected){wamSummaryTooltip.push('No WAM selected/worked');wamSummaryText+='<q class="empGrey">0</q>'}wamSummaryTooltip=wamSummaryTooltip.join('; ')+' out of '+holdingSummary.wamMax+' WAM allowed';wamSummaryText+=' / <q class="wamMax">'+holdingSummary.wamMax+'</q>';wamSummaryText='<span class="wamSummary" title="'+wamSummaryTooltip+'">'+wamSummaryText+'</span>'}else{wamSummaryText='<span class="wamSummary"></span>'}employeesSummaryText='';if(holdingSummary.employeesMax){employeesSummaryTooltip=[];if(holdingSummary.employeesWorked){employeesSummaryTooltip.push('Worked: '+holdingSummary.employeesWorked);employeesSummaryText+='<q class="empGreen">'+holdingSummary.employeesWorked+'</q>'}if(holdingSummary.employeesSelected){employeesSummaryTooltip.push('Selected: '+holdingSummary.employeesSelected);employeesSummaryText+='<q class="empBlack">'+holdingSummary.employeesSelected+'</q>'}if(!holdingSummary.employeesWorked&&!holdingSummary.employeesSelected){employeesSummaryTooltip.push('No Employees selected/worked');employeesSummaryText+='<q class="empGrey">0</q>'}employeesSummaryTooltip=employeesSummaryTooltip.join('; ')+' out of '+holdingSummary.employeesMax+'Employees';employeesSummaryText+=' / <q class="empMax">'+holdingSummary.employeesMax+'</q>';employeesSummaryText='<span class="employeesSummary" title="'+employeesSummaryTooltip+'">'+employeesSummaryText+'</span>'}else{employeesSummaryText='<span class="employeesSummary"></span>'}travelinfoText='<span class="traveliInfo"><i class="fa fa-arrow-up"></i>Click to travel to Holding Region</span>';holdingHeader.addClass('hasHoldingSummary').append('<div class="cbHoldingSummary">'+wamSummaryText+employeesSummaryText+travelinfoText+'</div>')}},myCompanies_page_multi_assign_to_holding:function(){var holdingId,holdingCompanies=window['holdingCompanies'];if(Object.keys(holdingCompanies).length<1){return}var factories=window['companies'];if(Object.keys(factories).length<1){return}var factoryId,unassignedFactoriesIds=[];for (factoryId in factories){if(!factories.hasOwnProperty(factoryId)){continue}if(factories[factoryId]['holding_company_id']==!1){unassignedFactoriesIds.push(factoryId)}}if(unassignedFactoriesIds.length<2){return}var wrapperHtml='<div id="cbMultiAssignToHoldingWrapper">'+'<select id="cbMultiSelectFactories"><option value="">Select Factories</option><option value="all">Select all</option><option value="none">Clear selection</option></select>'+'</div>',wrapper=$j(wrapperHtml),holdingZero=$j('#holding_0'),unassignedFactories=$j('#company_'+unassignedFactoriesIds.join(',#company_'));holdingZero.addClass('cbMultiAssignToHolding');wrapper.prependTo(holdingZero.find('.companies_listing'));unassignedFactories.each(function(){var _this=$j(this),factoryId=_this.attr('id').replace('company_','');_this.find('div.area_final_products').append('<input type="checkbox" data-factory_id="'+factoryId+'" class="cbMultiAssignToHoldingCheckbox" title="CB Multi-assign to Holding" />')});$j('input.cbMultiAssignToHoldingCheckbox').tipsy({gravity:'s'});$j('#cbMultiSelectFactories').change(function(){var _option=$j(this).val(),inputs=$j('#holding_0 input.cbMultiAssignToHoldingCheckbox');if(_option=='all'){inputs.prop('checked',!0)}else if(_option=='none'){inputs.prop('checked',!1)}});var holdingOptions='';for (holdingId in holdingCompanies){if(!holdingCompanies.hasOwnProperty(holdingId)){continue}holdingOptions+='<option value="'+holdingId+'">'+holdingCompanies[holdingId]['name']+'</option>'}$j('<select id="cbMultiSelectHolding"><option value="">Select Holding</option>'+holdingOptions+'</select>').prependTo(wrapper);cb_std('Assign selected','blueColor right #cbMultiAssignToHolding').click(function(){var assignToHoldingId=intval($j('#cbMultiSelectHolding').val()),factoriesToAssign,numFactoriesToAssign,i,_t=100,post_data;if(!is_positive_int(assignToHoldingId)){return alert('Please select a holding')}factoriesToAssign=$j('#holding_0 input.cbMultiAssignToHoldingCheckbox:checked').map(function(){return $j(this).data('factory_id')}).get();numFactoriesToAssign=factoriesToAssign.length;if(numFactoriesToAssign<1){return alert('Please select factories')}if(!confirm('Assign selected ('+numFactoriesToAssign+') factories to Holding #'+assignToHoldingId+' ?')){return!1}for (i = 0; i < numFactoriesToAssign; i++){(function (current_i,max_i,_timeout,factoryId){setTimeout(function(){$j.post('/en/economy/assign-to-holding',{action:'assign',_token:SERVER_DATA.csrfToken,holdingCompanyId:assignToHoldingId,factoryId:factoryId},__lambda,'json').then(function (response){var message;if(response.error){message='<strong>Assigning companies ... </strong> :: <span>Failed to assign '+current_i+'/'+max_i+'</span>'}else{message='<strong>Assigning companies ... </strong> :: <span>'+current_i+'/'+max_i+'</span>';$j('#company_'+factoryId).fadeTo('fast',0.2).find('input.cbMultiAssignToHoldingCheckbox').remove()}humanMsg.removeMsg();humanMsg.displayMsg(message)})},_timeout,post_data)})(i+1,numFactoriesToAssign,_t,factoriesToAssign[i]);_t+=1000}setTimeout(function(){humanMsg.removeMsg();humanMsg.displayMsg('<strong>Assigning companies ... </strong> :: <span>finished</span>')},_t+2500)}).appendTo(wrapper)},myCompanies_page_select_max:function (type,industry,quality){var avail_energy=NRG.a(),avail_cc=getinfo('cc'),i,c,cunt=0,elem;for (i in companies){if(!companies.hasOwnProperty(i)){continue}if(type=='wam'&&(avail_cc<10||avail_energy<10)){break}c=companies[i];if(industry&&c.industry_id!=industry){continue}if(quality&&((typeof(c.customization_level)!=_u&&c.customization_level!=quality)||(typeof(c.quality)!=_u&&c.quality!=quality))){continue}if(type=='wam'){if(!c.can_work_as_manager||c.already_worked){continue}elem=$j('#company_'+c.id+' a.owner_work:not(.active)');if(elem.length>0){elem.trigger('click');avail_cc-=c.own_tax;avail_energy-=10;cunt++}}else if(type=='employees'){if(!c.is_assigned_to_holding||!c.can_assign_employees){continue}if(c.todays_works>=intval(c.employee_limit)){continue}elem=$j('#company_'+c.id+'>div.company_employees>div.employees_selector>a.employee_select[employee="'+c.employee_limit+'"]:not(.active):not(.worked)');if(elem.length>0){elem.last().trigger('click');cunt++}}}window['humanMsg']['displayMsg']('<strong>'+cunt+' companies selected)</strong>');_q(cunt+' companies selected')},create_company_page:function(){$j('<div id="cbMultiBuildWrapper"><input type="number" step="1" value="1" min="1" id="cbMultiBuildNum" class="shadowed buyField">'+cb_std_string('Build multiple factories','blueColor #cbMultiBuild')+'</div>').insertAfter('#construct');$j('ul.buildings.extended>li>a').click(function(){$j('#cbMultiBuildWrapper').show()});$j('#cbMultiBuild').click(function(){var input=$j('#cbMultiBuildNum'),numCompanies=intval(input.val());if(!numCompanies||numCompanies<0){return alert('Invalid number of companies :: '+numCompanies)}if(!confirm('Create '+numCompanies+' factories ?')){return!1}var industryId=intval($j('#company_industry_id').val()),buildingType=intval($j('#company_building_type').val());SITEWIDE.create_multiple_companies(industryId,buildingType,numCompanies);return!0})},create_multiple_companies:function (industryId,buildingType,numCompanies){industryId=intval(industryId);buildingType=intval(buildingType);numCompanies=intval(numCompanies);if(!industryId||!buildingType||!numCompanies||industryId<1||buildingType<1||numCompanies<1){return!1}var post_data={_token:SERVER_DATA.csrfToken,company:{industry_id:industryId,building_type:buildingType}},_t=100,i;for (i = 0; i < numCompanies; i++){(function (current_i,max_i,_timeout){setTimeout(function(){$j.post('/en/economy/create-company',post_data).then(function(){humanMsg.removeMsg();humanMsg.displayMsg('<strong>Creating companies ... </strong> :: <span>'+current_i+'/'+max_i+'</span>')})},_timeout)})(i+1,numCompanies,_t);_t+=1000}setTimeout(function(){humanMsg.removeMsg();humanMsg.displayMsg('<strong>Creating companies ... </strong> :: <span>finished</span>')},_t+2500);return numCompanies},training_grounds_page:function(){SITEWIDE.no_location_reload('#train_results')},no_location_reload:function (popup){$j(popup).each(function(){$j(this).find('.close,.collect').unbind().on('click',function(){$j(this).closest(popup).trigger('close')})})},dropdownv3:function(){$j('.regiment_drop_down .ddTitleText').css('padding-top',0);$j('.regiment_drop_down .dd .arrow').css('margin-top','-11px');$j('.country-select .ddcommon .arrow').css('top',0);if(typeof($j.fn.msDropDown)==_u){return}if(typeof(msBeautify)==_u||!msBeautify.version||!msBeautify.version.msDropdown){$j('<sc'+'ript src="/js/jquery.dd.js"><'+'/sc'+'ript><link href="/css/cmp/dd.css" type="text/css">').appendTo('head')}},my_places:function(){$j('#menu2>a').css('cursor','auto').attr('href',EREP.url+'/economy/myCompanies');$j('#menu2>ul').append('<li><a href="'+EREP.url+'/economy/manage-employees/1"><q class="cb-icon-16">Employees</q></a></li>');$j('#menu5 a.erpkLaunchMapPopButton').append('<br><small>( shift+w )</small>');$j('#menu5>ul').append('<li><a href="'+http('www.erepublik-deutschland.de/en/tools/worldmap')+'"><div class="cb-icon-16">Alternative<br>World Map</div></a></li>')},page_titles:function(){if(is_page('/messages-alerts')){page_title('Alerts')}else if(is_page('/messages-compose')){page_title('Compose Message')}else if(is_page('pvp')){page_title('PVP')}else if(is_page('jmarket')){page_title('Job Market')}else if(is_page('mmarket')){page_title('Monetary Market')}else if(is_page('/inventory')){page_title('Inventory')}else if(is_page('land')){page_title('Companies')}else if(is_page('campaigns')){page_title('Wars')}else if(is_page('country/economy')){page_title(_URL_.split('economy/')[1]+'> Economy')}},kbd_shortcuts:function(){shortcut.add("Shift+e",function(){erepublik.functions.goToUrl(EREP.employees,'Employees');return!1},{disable_in_input:true});$j('#shortcut_list ul').append('<li><strong>Employees</strong><em>Shift + E</em></li>');/*shortcut.remove('Shift+w');shortcut.add('Shift+w',function(){erepublik.functions.goToUrl(EREP.market+'#'+getinfo('citizenship','id')+'/2/7','Weapons Market');return!1},{disable_in_input:true});shortcut.remove('Shift+c');shortcut.add('Shift+c',function(){erepublik.functions.goToUrl(EREP.market+'#'+getinfo('citizenship','id')+'/12/1','WRM Market');return!1},{disable_in_input:true});*/if(!is_page('battlefield')){shortcut.add('Shift+q',function(){erepublik.functions.goToUrl(EREP.jmarket+getinfo('citizenship','id'),'Job Market');return!1},{disable_in_input:true});$j('#cb_kbd_shortcuts').append('<b>&lt;shift&gt;+q:</b> Job Market<br />')}},energy_bar_protection:function(){if(!$j('#DailyConsumtionTrigger').exists()){return}$j('#DailyConsumtionTrigger,#heal_btn').click(function (e){if(!SITEWIDE.enable_ebars&&$j(this).hasClass('energy')){if(confirm('Enable Energy Bar usage?')){SITEWIDE.enable_ebars=!0;return!0}e.stopImmediatePropagation()}}).prioHandler()},sidebar:function(){if($j('#large_sidebar').exists()){SITEWIDE.largeSidebar()}else if($j('#header > section').exists()){SITEWIDE.compactSidebar()}},compactSidebar:function(){if(erepublik.citizen.residence.hasResidence&&erepublik.citizen.residence.regionId!=erepublik.citizen.regionLocationId){$j('#residenceStatusIcon').css('cursor','pointer').attr('title','[CB] Go to residence').tipsy({gravity:'s'}).click(function (event){event.preventDefault();erepublik.functions.launchTravelPopup({regionId:erepublik.citizen.residence.regionId})})}},largeSidebar:function(){if(erepublik.citizen.residence.hasResidence&&erepublik.citizen.residence.regionId!=erepublik.citizen.regionLocationId){$j('#residenceStatusIcon').css('cursor','pointer').attr('title','[CB] Go to residence').tipsy({gravity:'s'}).click(function (event){event.preventDefault();erepublik.functions.launchTravelPopup({regionId:erepublik.citizen.residence.regionId})})}$j('#large_sidebar .user_identity a.user_country').addClass('cb-change-location').attr('title','[CB] Change Location').attr('href',EREP.url+'/main/change-location').click(function (event){event.preventDefault();erepublik.functions.launchTravelPopup({})});$j('#large_sidebar div.currency_amount img').attr('title',getinfo('citizenship','display')+'-> Economy').wrap('<a href="'+EREP.url+'/country/economy/'+getinfo('citizenship','url')+'"></a>');$j('a.invite_anniversary_bonus').remove();SITEWIDE.pacanele()},notifications:function(){var originalGlobalAlerts=window['globalAlerts'],newGlobalAlerts=[];window['globalAlerts']=[];for (var i = 0; i < originalGlobalAlerts.length; i++){var globalAlert=originalGlobalAlerts[i],type=globalAlert['type'],detailsType=globalAlert['details']['type'];if(in_array(detailsType,['rw','empire','jackpot'])){$j.post(EREP.url+'/main/global-alerts/close/',{_token:getinfo('token'),alert_id:globalAlert.id})}else if(detailsType=='citizen'&&in_array(type,['dailyOrder','dailyTasks'])){continue}else{newGlobalAlerts.push(globalAlert)}}if(newGlobalAlerts.length<1){SITEWIDE.notifications_hide(1)}},notifications_hide:function (cunt){$j('#notify_clone,#notification_area').addClass('cb_hide_notifications').remove();if(!cunt){cunt=1}if(cunt<10){cunt++;setTimeout(function(){SITEWIDE.notifications_hide(cunt)},500)}},home_page_compact_achievments:false,home_page:function(){$j('a.promo_holder,a.training_contract_alone').addClass('stahp');$j('#citizen_feed_friends,a.anniversary_feed_advert,#content div.promo_holder[class*="anniversary"],a.winter_holidays_feed_advert,.tipsy').remove();SITEWIDE.home_page_media();if(!OPTS.get('optimize-feed','General')){return}if(OPTS.get('compact-achievments')){SITEWIDE.home_page_compact_achievments=!0;$j('#citizen_feed>div.inner>div.wall_post_list>ul').addClass('optimized')}SITEWIDE.home_page_bind_wall();SITEWIDE.home_page_clean_wall_post();$j(document).ajaxSuccess(function (e,xhr,opts){if(instr(opts.url,'-post/retrieve')||instr(opts.url,'-post/older')||instr(opts.url,'-comment/retrieve')){if(instr(opts.url,'-post/older')){SITEWIDE.home_page_autoloading_posts=!1}setTimeout(function(){SITEWIDE.home_page_bind_wall()},500)}})},home_page_media:function(){var scope=CRPK.angular.get_scope('#hpTopNews');if(!scope||!scope.settings||!scope.settings.citizen){window.setTimeout(function(){SITEWIDE.home_page_media()},500);return}var defaultCountryId=(typeof(scope.settings.citizen.selectedCountry)!=_u?scope.settings.citizen.selectedCountry.id:intval(erepublik.citizen.country)),defaultCountryName=!defaultCountryId?'International':COUNTRIES.get(defaultCountryId,'name');if(!scope.settings.citizen.hasMultipleCountriesNews){$j('<div class="source_tabs"><a href="'+VOID+'"  class="singleTab">'+defaultCountryName+'</a></div>').prependTo('#hpTopNews > div.media_widget')}var firstTab=$j('#hpTopNews > div.media_widget > div.source_tabs> a:first'),selector='';selector+='<option value="0">International</option>';COUNTRIES.get_alphabetical_list().forEach(function (country){selector+='<option value="'+country.id+'" '+(country.id==defaultCountryId?' selected':'')+'>'+country.display+'</option>'});selector=$j('<select id="cb-media-select">'+selector+'</select>');selector.change(function(){var countryID=intval($j(this).val(),defaultCountryId),countryName=!countryID?'International':COUNTRIES.get(countryID,'display'),categoryID=!countryID?100:scope.settings.citizen.selectedCategory.id;$j('#currentMediaCountry').text(countryName);$j('#crpk-intl-news').removeClass('active');scope.settings.citizen.selectedCountry.id=countryID;scope.settings.citizen.selectedCountry.permalink=erepublik.info.countries[countryID].permalink;scope.settings.citizen.selectedCountry.name=erepublik.info.countries[countryID].name;scope.settings.citizen.selectedCategory.id=categoryID;scope.getArticles()});$j('#hpTopNews > div.media_widget').addClass('cbMediaSelector');firstTab.empty();selector.appendTo(firstTab);firstTab.append('<span id="currentMediaCountry">'+defaultCountryName+'</span>');selector.select2({width:'200px',formatSelection:function (object){return '<img class="select2_icon" src="/images/flags_png/S/'+(object.text=='International'?'European-Union':COUNTRIES.get(object.id,'url'))+'.png" />'},formatResult:function (object){return ' <img class="select2_icon" src="/images/flags_png/S/'+(object.text=='International'?'European-Union':COUNTRIES.get(object.id,'url'))+'.png" /> '+object.text},escapeMarkup:function (m){return m},containerCssClass:'msDropDown cb-countries-select',dropdownCssClass:'msDropDown cb-countries-select'})},pacanele:function(){if(typeof(erepublik)!='object'||typeof(erepublik.wheel_of_fortune)!='object'||!$j('#launch_wof').exists()){return!0}$j('div.wof_pop>a.wof_btn').prepend('<b id="crpk-pacanele"></b>');$j(document).ajaxSuccess(function (e,xhr,opts){if(!instr(opts.url,'main/wheeloffortune-')||typeof(global_wof_build_data)!='object'){return!0}if(global_wof_build_data.cost==1){return!0}var spent=0;for (g = 1.1; g < global_wof_build_data.cost; g += 0.1){spent+=g}$j('#crpk-pacanele').text(' '+cb_number(spent,1))});return!0},home_page_compact_post:function (e){if(e.target!=this&&(e.target.nodeName=='A'||e.target.nodeName=='TEXTAREA'||e.target.parentNode.nodeName=='A'||(e.target.nodeName=='DIV'&&e.target.className.indexOf('fake_input')>-1))){return}if($j(this).hasClass('compact')){$j(this).removeClass('compact condensed').attr('title','');$j(this).unbind('click',SITEWIDE.home_page_compact_post);e.stopImmediatePropagation()}else{}},home_page_autoload_posts_bound:false,home_page_autoloading_posts:false,home_page_bind_autoload_posts:function(){if(SITEWIDE.home_page_autoload_posts_bound){return!0}SITEWIDE.home_page_autoload_posts_bound=!0;$j('#citizen_feed>div.inner').append('<div class="fbload" id="cb-feed-loader"></div>');$j(window).scroll(function(){if(SITEWIDE.home_page_autoloading_posts){return!1}if($j(window).scrollTop()+$j(window).height()>=$j(document).height()-30){$j('#cb-feed-loader').css('visibility','visible');SITEWIDE.home_page_autoloading_posts=!0;setTimeout(function(){$j('#citizen_older_feeds>a.blue_arrow_down_medium').trigger('click');$j('#cb-feed-loader').css('visibility','hidden')},500)}})},home_page_show_more_posts:true,home_page_bind_wall:function(){var removed_posts=0;if(SITEWIDE.home_page_compact_achievments){$j('#citizen_feed.friendsFeed > div.inner > #wall_post_list > ul > li.automatic:not(.firstPost):not(.compact)').each(function(){$j(this).addClass('compact').click(SITEWIDE.home_page_compact_post).attr('title','Click to Show post');removed_posts++})}$j('#wall_post_list > ul > li[id^="post_"]:not(.latestEvents):not(.cbound)').each(function(){var _this=$j(this);_this.addClass('cbound');var _sa=_this.find('.second_actions');$j('<a class="cb_wall_link cb_wall_link_translate" data-comment-id="'+_this.attr('id')+'" href="'+VOID+'">Translate</a>').click(SITEWIDE.home_page_translate_wall_post).appendTo(_sa)});$j('#wall_post_list > ul > li > div.post_content > div.post_comments > ul > li[id^="comment_"]:not(.cbound)').each(function(){var _this=$j(this);_this.addClass('cbound');$j('<a class="cb_wall_link cb_wall_link_translate" data-comment-id="'+_this.attr('id')+'" href="'+VOID+'">Translate</a>').click(SITEWIDE.home_page_translate_wall_post).appendTo(_this.find('.second_actions_comments'))});var postsPerPage=(typeof(window['POSTS_PER_PAGE'])!=_u?window['POSTS_PER_PAGE']:(typeof(window['wallData']['postsPerPage'])!=_u?window['wallData']['postsPerPage']:10));if(SITEWIDE.home_page_show_more_posts&&removed_posts>=postsPerPage/2){SITEWIDE.home_page_show_more_posts=!1;$j('#citizen_older_feeds>a').trigger('click')}$j('#citizen_older_feeds>a').click(SITEWIDE.home_page_bind_autoload_posts);SITEWIDE.fix_links()},home_page_clean_wall_post:function (doCleanup){if(!doCleanup){jQuery.fn.limitMaxlength=$j.fn.limitMaxlength=function (options){};$j('textarea[maxlength]').unbind().die().on('change keyup keydown focus paste input',function(){var maxLength=intval($j(this).attr('maxlength')),remaining=maxLength-$j(this).val().length;$j('#chars_remaining').text(remaining+' '+$j('#characters_left').val())});$j('<a href="'+VOID+'" class="std_global_btn cb tinySize noPadding right whiteColor" style="margin-top:10px"><span>Minimize (clean up)  post</span></a>').click(function(){SITEWIDE.home_page_clean_wall_post(true)}).insertAfter('#wall_post>span.controls>a.post_button');return}
            var text = $j('#shout').val(), newText = text.replace(/https:\/\/www\./g, '').replace(/http:\/\/www\./g, '').replace(/https:\/\//g, '').replace(/http:\/\//g, '').replace(/\/battlefield-new\//g, '/battlefield/').replace(/prntscr.com\//g, 'prnt.sc/').replace(/i\.imgur\.com\/([^.]*)\.(jpg|png|gif)/g, 'imgur.com/$1').replace(/\/article\/([a-z0-9-]*-)?(\d+)\/1\/20/g, '/article/$2').replace(/youtube\.com\/watch\?v=/g, 'youtu.be/');
            if(newText!=text){$j('#shout').val(newText)}},fix_links:function(){var lang=getinfo('lang'),img_rx=/\.(gif|jpg|jpeg|tiff|png)/i;if(OPTS.get('fix-links')){$j('a[href*="/warn/"]:not(.cb_link_fix)').addClass('cb_link_fix').attr('rel','noreferrer').each(function(){var _this=$j(this),_href=window.atob(_this.attr('href').split('warn/')[1]);_this.attr('href',_href).attr('rel','noreferrer');if(OPTS.get('optimize-feed-previews')){if(img_rx.test(_href)){$j(this).attr('title', "<img referrerpolicy='no-referrer' rel='noreferrer' src='" + $j(this).attr('href') + "' style='max-width:300px;max-height:300px'  />").tipsy({gravity: 's',html: true,className: 'cb-tipsy-img'});}else if(_href.indexOf('prntscr.com/')>-1||_href.indexOf('prnt.sc/')>-1||_href.indexOf('screenshooter.net/')>-1){$j(this).attr('rel', 'noreferrer').attr('title', "<iframe referrerpolicy='no-referrer' rel='noreferrer' src='" + $j(this).attr('href').replace('http:', 'https:') + "' style='width:400px;height:400px' scrolling='no' border='no'></iframe>").tipsy({gravity: 's',html: true,className: 'cb-tipsy-iframe'});}}})}return enforce_proto()},_congress_elections_page:function(){$j('<a class="cbutton cbutton-red goright" href="'+VOID+'" id="congress_members_mailer" style="margin-right:15px">MASS Mail ALL Congress Members</a>').click(function(){if(typeof(CRPK.plugins.MAILER)==_u||!is_valid_auth_key_('mailer')){return alert('MAILER plugin (and auth key) required')}var recipients=$j('#candidates_holder>div:nth-child(1)>div>ul .nameholder>a[href*="/citizen"]').map(function(){return intval($j(this).attr('href').split('/profile/')[1])}).get();return gto(EREP.url+'/main/messages-compose/0?qdata='+JSON.stringify({list:recipients,grouped:1}))}).insertBefore('#content>h2');$j('#candidates_holder span.party_orientation').html('<a class="party-mass-mailer cbutton cbutton-smaller cbutton-purple" href="'+VOID+'" id="congress_members_mailer" style="margin-right:15px">MASS Mail this party`s congressmen</a>');$j('a.party-mass-mailer').click(function(){if(typeof(CRPK.plugins.MAILER)==_u||!is_valid_auth_key_('mailer')){return alert('MAILER plugin (and auth key) required')}var recipients=$j(this).parents('li').find('div.nameholder>a[href*="/citizen"]').map(function(){return intval($j(this).attr('href').split('/profile/')[1])}).get();return gto(EREP.url+'/main/messages-compose/0?qdata='+JSON.stringify({list:recipients,grouped:1}))})},_party__page:function(){$j('#content  div.indent>div.action a[href*="/party-members/"] span').addClass('cb-icon cb-icon-16')},_party_members__page:function(){var anchor=$j('#content>div.holder>a.std_global_btn');cb_std('Party Members MASS Mail','purple smallSize pad10px right margin').click(function(){if(typeof(CRPK.plugins.MAILER)==_u||!is_valid_auth_key_('mailer')){return alert('MAILER plugin (and auth key) required')}var recipients=$j('#content>div.holder div.citizen>a.nameholder').map(function(){return intval($j(this).attr('href').split('/profile/')[1])}).get();return gto(EREP.url+'/main/messages-compose/0?qdata='+JSON.stringify({list:recipients,grouped:1}))}).insertAfter(anchor);cb_std('Add all PARTY Members as Friends','smallSize pad10px right margin').click(function(){SITEWIDE._party_members__page_add_friends()}).insertAfter(anchor)},_party_members__page_add_friends:function(){_q('Retrieving current friends list ...');var friends=CRPK.sbox.get_friends(),friends_list=[],addURL=EREP.base+'/citizen/friends/add/',token={_token:getinfo('token')};for (var name in friends){if(friends.hasOwnProperty(name)){friends_list.push(friends[name])}}friends_list.push(getinfo('uid'));window['party-add-friends-count']=0;window['party-add-friends-sent']=0;var members=$j('#content>div.holder div.citizen>a.nameholder').map(function(){return intval($j(this).attr('href').split('/profile/')[1])}).get();humanMsg.displayMsg('<strong>Sending Requests ...</strong>');for (var i = 0; i < members.length; i++){citizenID=members[i];if(in_array(citizenID,friends_list)){continue}_q('Sending request (uid ='+citizenID+')');window['party-add-friends-count']++;$j.ajax({url:addURL+citizenID,type:'POST',async:true,data:token,success:function(){window['party-add-friends-sent']++}})}window['party-add-friends-interval']=setInterval(function(){if(window['party-add-friends-sent']>=window['party-add-friends-count']){_q('PARTY friend requests sent ('+window['party-add-friends-sent']+')');window.clearInterval(window['party-add-friends-interval']);humanMsg.displayMsg('<strong>Add PARTY Members as friends ('+window['party-add-friends-sent']+')</strong> :: <span>finished</span>');alert('PARTY friend requests sent ('+window['party-add-friends-sent']+')')}},500);return!0},_resource_wars__page:function(){SITEWIDE._country__page()},_country_administration__page:function(){SITEWIDE._country__page()},_law__page:function(){SITEWIDE._country__page()},_country__page:function(){if(is_page('country/economy')){SITEWIDE.country_economy_page()}var current_country,c;if(is_page('/country-administration/')||is_page('/country/')){var section=_URL_.split(is_page('/country-administration/')?'/country-':'/country/')[1].split('/');current_country=COUNTRIES.get(section[1])}else{var url=_URL_.split(EREP.url+'/')[1].split('/');for (var i = 0; i < url.length; i++){c=COUNTRIES.get(url[i]);if(url[i]&&c.id){current_country=c;break}}}if(!current_country){clog('Could not extract current country from URL');return!1}var currentcID=current_country.id,z_dick,cx,cID,selector='',countriesList=COUNTRIES.get_alphabetical_list(),dictatoships=$j('#countries_selector > div > div.core > ul > li > a > span.dictatorship_flag_icon_s').map(function(){return intval($j(this).parent().attr('id'))}).get();for (cx = 0; cx < countriesList.length; cx++){c=countriesList[cx];cID=c.id;z_dick=in_array(cID,dictatoships)?' class="dictatorship"':'';selector+='<option value="'+c.id+'" id="cb-select-'+c.id+'" data-url="'+c.url+'"'+(c.id==currentcID?' selected':'')+z_dick+'>'+c.display+'</option>'}selector=$j('<select id="cb-countries-select">'+selector+'</select>');selector.change(function(){var new_country=COUNTRIES.get($j(this).val(),'url');return gto(is_page('/law/')?EREP.url+'/country-administration/'+new_country+'/1':_URL_.replace(current_country.url,new_country))});var wrap=$j('<div id="cb-countries-select-wrap"/>');if(is_page('/resource-wars/')){wrap.css({float:'left',margin:'13px 0 0 10px',width:'46px',height:'33px',textAlign:'center',verticalAlign:'middle'});$j('#content>div.resource_draft>div.temp_header>img.country_flag').replaceWith(wrap)}else{var dictatorship=($j('#filters>div.bigcore>span.dictatorship_flag_icon_l').exists()?'<span class="dictatorship_flag_icon_l cb-dictatorship-flag-icon"></span>':'');$j('#filters').empty().append('<div class="bigcore">'+dictatorship+'</div>');wrap.appendTo('#filters .bigcore')}selector.appendTo(wrap);selector.select2({width:'200px',formatSelection:function (object){return '<img class="select2_icon" src="/images/flags/M/'+(object.id?COUNTRIES.get(object.id,'url'):'blank')+'.gif" />'},formatResult:function (object){var result='';if($j(object.element).hasClass('dictatorship')){}result+=' <img class="select2_icon" src="/images/flags/M/'+(object.id?COUNTRIES.get(object.id,'url'):'blank')+'.gif" /> '+object.text;return result},escapeMarkup:function (m){return m},containerCssClass:'msDropDown cb-countries-select',dropdownCssClass:'msDropDown cb-countries-select'});if(!is_page('/politics/')){return!0}var anchor=$j('#content>div.holder>ul.country_tabs');cb_std('MSS Mail Gov members','right pad10px purple').css('margin-top','10px').click(function(){if(typeof(CRPK.plugins.MAILER)==_u||!is_valid_auth_key_('mailer')){return alert('MAILER plugin (and auth key) required')}var recipients=$j('#content div.entity a[href*="/profile/"]').map(function(){return intval($j(this).attr('href').split('/profile/')[1])}).get();return gto(EREP.url+'/main/messages-compose/0?qdata='+JSON.stringify({list:recipients,grouped:0}))}).appendTo(anchor);cb_std('Add Gov members friends','right pad10px').css('margin-top','10px').click(function(){SITEWIDE.my_friends_add_from_list($j('#content div.entity a[href*="/profile/"]').map(function(){return intval($j(this).attr('href').split('/profile/')[1])}).get())}).appendTo(anchor);var congressmen=0;$j('#content table.political tr:not(:first-child)').each(function(){var _row=$j(this),members=Math.floor(intval(_row.find('td:nth-child(3)>span').css('width').replace('px',''))/15);congressmen+=members;_row.find('td:nth-child(2)').append('<span class="special">'+NBSP+'<i>('+members+')</i></span>')});$j('#content h2.section').last().append('<i> ('+congressmen+' members)</i>; Votes needed for 66%: '+(Math.ceil(congressmen*0.66)))},country_economy_page:function(){var fb=0,wb=0,hb=0,ab=0,table=$j('#economy .resource_list:last');table.find('tbody tr').each(function(){var span=$j(this).find('span'),resourceID=intval($j(this).find('img[src*="/resources/"]').first().attr('src').split('resources/')[1].replace('.png',''),0),r_bonus=intval(span.last().text().split('(+')[1].split('%)')[0],0);if(in_array(resourceID,[1,2,3,4,5])){fb+=r_bonus}else if(in_array(resourceID,[6,7,8,9,10])){wb+=r_bonus}else if(in_array(resourceID,[11,12,13,14,15])){hb+=r_bonus}else if(in_array(resourceID,[16,17,18,19,20])){ab+=r_bonus}});var string='<b>Food:</b> '+fb+'%. <b>Weapons:</b> '+wb+'%. <b>Houses:</b> '+hb+'%. <b>Airforce:</b> '+ab+'%.';$j('<div class="warning_message" style="height:29px;padding:10px 10px 10px 50px;line-height:29px;max-width: 92%;">'+string+'</div>').insertBefore(table);$j('<div class="warning_message" style="height:29px;padding:10px 10px 10px 50px;line-height:29px;max-width: 92%;">'+string+'</div>').insertAfter('#economy h2:first')},_region__page:function(){var fb=0,wb=0,hb=0,ab=0,country_bonuses=$j('#content div > article.area.bonus > div.row > div.item > p.amount'),region_bonuses=$j('#content div > article.area.resource > div.row > div.item');country_bonuses.each(function(){var _this=$j(this),industryID=intval(_this.data('industryid'),0),bonus=intval(_this.data('bonus'),0);if(industryID==1){fb+=bonus}else if(industryID==2){wb+=bonus}else if(industryID==4){hb+=bonus}else if(industryID==23){ab+=bonus}});region_bonuses.each(function(){var _this=$j(this),resourceID=intval(_this.data('resourceid'),0),bonus=intval(_this.data('bonus'),0);if(in_array(resourceID,[1,2,3,4,5])){fb+=bonus}else if(in_array(resourceID,[6,7,8,9,10])){wb+=bonus}else if(in_array(resourceID,[11,12,13,14,15])){hb+=bonus}else if(in_array(resourceID,[16,17,18,19,20])){ab+=bonus}});var string='<b>Region bonuses:</b><br> <b>Food:</b> '+fb+'%. <b>Weapons:</b> '+wb+'%. <b>Houses:</b> '+hb+'%. <b>Airforce:</b> '+ab+'%.';$j('<div class="warning_message" style="height:29px;padding:10px 10px 10px 50px;line-height:14px;max-width: 92%;">'+string+'</div>').appendTo('#content > div.holder > div.indent.productivity')},donate_page:function(){SITEWIDE.profile_page();page_title($j('#content > div.citizen_profile_header.auth > h2').textNodes().text().trim()+' - Donate '+(_URL_.split('donate-')[1].split('/')[0]))},profile_page:function(){var citizenID=is_page('donate')?intval(_URL_.split('/donate-')[1].split('/')[1],0):intval(_URL_.split('/citizen/profile/')[1],0),avatar=$j('.citizen_profile_header .citizen_avatar'),avatar_url=avatar.css('background-image');if(!citizenID){return!1}var enable_multi_gifts=!1;if(enable_multi_gifts){cb_std('<span><q class="cb-icon cb-icon-16"></q>Send multiple gifts</span>','tinySize noPadding blueColor #cb-multi-gift-donate').css({width:'auto','background-image':'none',display:'inline-block','text-indent':0,height:'initial'}).click(function(){SITEWIDE.multi_gift_donate(citizenID)}).insertAfter('#donate_to_friend')}var scammers=LS.get('scammers',[]);if(scammers.length>0){if(in_array(citizenID,scammers)||in_array('r-'+citizenID,scammers)){if(in_array('r-'+citizenID,scammers)){$j('#content').prepend('<div class="cbutton cbutton-yellow cbutton-scammer"><b class="cb-icon-24">Reported as SCAMMER (Verification pending)</b></div>')}else{$j('#content').prepend('<div class="cbutton cbutton-red cbutton-scammer"><b class="cb-icon-24">SCAMMER</b></div>')}if(is_page('donate-')){$j('#content > div.citizen_content > div > h2').prependTo('#content>div.citizen_content.up.donate').addClass('cb-icon cb-icon-16').text('Scammer detected. Donate disabled');var forms=$j('#donateMoneyform,#items3');forms.addClass('scammer');forms.find('input').prop('disabled',!0);$j('<a class="cbutton cbutton-yellow" id="cb-enable-scammer-donate-form" href="'+VOID+'"><q class="cb-icon cb-icon-16">I know what i`m doing. <q class="cbutton cbutton-red">Enable Donation form<q></q></a>').click(function(){forms.find('input').prop('disabled',!1);forms.removeClass('scammer');$j(this).fadeOut('fast',function(){$j(this).remove()})}).insertBefore(forms)}}}if(!instr(avatar_url,'default_')){$j('.citizen_profile_header h2').append('<a href="'+EREP.avatar_static(avatar_url,'s3')+'" target="_blank" class="online_status cb-view-avatar">View Avatar</a>')}avatar.wrap('<a href="'+EREP.profile(citizenID)+'"></a>');$j('#content .citizen_actions').prepend(erep_de_link(citizenID)+egov_link(citizenID));if(OPTS.get('hide-decorations')){$j('#new_achievements').addClass('no-spam')}if(!is_page('profile')){return}var tank_anchor=$j('#content > div.citizen_content > div.citizen_military_box > span.military_box_info.mb_bottom:first'),airforce_anchor=tank_anchor.clone();if(typeof(window['hovercardData'])!=_u){var hovercardData=window['hovercardData'];tank_anchor=$j('#content > div.citizen_content > div.citizen_military_box > span.military_box_info.mb_bottom:first');$j('#content > div.citizen_content > div.citizen_military_box_wide > span.top_area:first').append('<q>: #'+hovercardData.fighterInfo.military.rank+'</q>');tank_anchor.addClass('cb-dph cb-tank-dph').text(hovercardData.fighterInfo.military.damagePerHit);if(hovercardData.fighterInfo.military.damagePerHitLegend>hovercardData.fighterInfo.military.damagePerHit){tank_anchor.clone().addClass('cb-tank-dph-legend').text(hovercardData.fighterInfo.military.damagePerHitLegend).insertAfter(tank_anchor)}$j('#content > div.citizen_content > div.citizen_military_box_wide > span.top_area:last').append('<q>: #'+hovercardData.fighterInfo.aviation.rank+'</q>');if(hovercardData.fighterInfo.aviation.damagePerHitLegend>hovercardData.fighterInfo.aviation.damagePerHit){airforce_anchor.addClass('cb-dph cb-airforce-dph').text(hovercardData.fighterInfo.aviation.damagePerHit+' / q'+hovercardData.fighterInfo.aviation.maxWeaponQ).appendTo($j('#content > div.citizen_content > div.citizen_military_box_wide:first').next());airforce_anchor.clone().addClass('cb-airforce-dph-legend').text(hovercardData.fighterInfo.aviation.damagePerHitLegend+' / q'+hovercardData.fighterInfo.aviation.maxWeaponQ).insertAfter(airforce_anchor)}else{airforce_anchor.addClass('cb-dph cb-airforce-dph').text(hovercardData.fighterInfo.aviation.damagePerHit+' / q'+hovercardData.fighterInfo.aviation.maxWeaponQ).appendTo($j('#content > div.citizen_content > div.citizen_military_box_wide:first').next());airforce_anchor.clone().addClass('cb-airforce-dph-q0').text(hovercardData.fighterInfo.aviation.damagePerHitNoWeapon+' / q0').insertAfter(airforce_anchor)}return!0}var level=intval($j('strong.citizen_level').text().trim()),tank_skill_container=$j('#str_progress').next(),tank_skill=floatval(tank_skill_container.text(),0),tank_rank_link=$j('#content > div.citizen_content > div.citizen_military_box_wide:first > span.rank_name_holder > a'),tank_rank_name=(tank_rank_link.attr('original-rank')?tank_rank_link.attr('original-rank'):tank_rank_link.text().trim()),tank_dph=calc_dph(tank_skill,tank_rank_name,level,TANK_MAX_WEAPON_Q,!1),tank_legend_dph=calc_legend_dph(tank_skill,tank_rank_name,level,TANK_MAX_WEAPON_Q,!1),tank_rank_number=getRankNumberByName(tank_rank_name,!1);tank_anchor=$j('#content > div.citizen_content > div.citizen_military_box > span.military_box_info.mb_bottom:first');$j('#content > div.citizen_content > div.citizen_military_box_wide > span.top_area:first').append('<q>: #'+tank_rank_number+'</q>');tank_anchor.addClass('cb-dph cb-tank-dph').text(tank_dph);if(tank_legend_dph>tank_dph){tank_anchor.clone().addClass('cb-tank-dph-legend').text(tank_legend_dph).insertAfter(tank_anchor)}var airforce_skill_container=$j('#perception_progress').next(),airforce_skill=floatval(airforce_skill_container.text(),0),airforce_rank_link=$j('#content > div.citizen_content > div.citizen_military_box_wide:last > span.rank_name_holder > a'),airforce_rank_name=(airforce_rank_link.attr('original-rank')?airforce_rank_link.attr('original-rank'):airforce_rank_link.text().trim()),airforce_dph=calc_dph(airforce_skill,airforce_rank_name,level,AIRFORCE_MAX_WEAPON_Q,!0),airforce_legend_dph=calc_legend_dph(airforce_skill,airforce_rank_name,level,AIRFORCE_MAX_WEAPON_Q,!0),airforce_rank_number=getRankNumberByName(airforce_rank_name,!0);airforce_anchor=tank_anchor.clone().removeClass('cb-tank-dph');$j('#content > div.citizen_content > div.citizen_military_box_wide > span.top_area:last').append('<q>: #'+airforce_rank_number+'</q>');if(airforce_legend_dph>airforce_dph){airforce_anchor.addClass('cb-dph cb-airforce-dph').text(airforce_dph+' / q'+AIRFORCE_MAX_WEAPON_Q).appendTo($j('#content > div.citizen_content > div.citizen_military_box_wide:first').next());airforce_anchor.clone().addClass('cb-airforce-dph-legend').text(airforce_legend_dph+' / q'+AIRFORCE_MAX_WEAPON_Q).insertAfter(airforce_anchor)}else{var airforce_q0_dph=calc_dph(airforce_skill,airforce_rank_name,level,0,!0);airforce_anchor.addClass('cb-dph cb-airforce-dph').text(airforce_dph+' / q'+AIRFORCE_MAX_WEAPON_Q).appendTo($j('#content > div.citizen_content > div.citizen_military_box_wide:first').next());airforce_anchor.clone().addClass('cb-airforce-dph-q0').text(airforce_q0_dph+' / q0').insertAfter(airforce_anchor)}return!0},multi_gift_donate:function (citizenID){var i,number_of_gifts=intval(prompt('How many gifts to send?','1'),0);if(!is_positive_int(number_of_gifts)||number_of_gifts<1){enable_alerts();alert('Invalid number of gifts: '+number_of_gifts);disable_alerts();return!1}var post_data={_token:SERVER_DATA.csrfToken,to_citizen_id:citizenID},_t=100;for (i = 0; i < number_of_gifts; i++){(function (gift_i,gift_max,_timeout){setTimeout(function(){$j.post(EREP.url+'/main/donate-gifts-action',post_data,__lambda,'json').then(function(){humanMsg.removeMsg();humanMsg.displayMsg('<strong>Sending gifts ... </strong> :: <span>'+gift_i+'/'+gift_max+'</span>')})},_timeout)})(i+1,number_of_gifts,_t);_t+=1000}setTimeout(function(){humanMsg.removeMsg();humanMsg.displayMsg('<strong>Sending gifts ... </strong> :: <span>finished</span>')},_t+2500)},update_scammers:function(){$j.getJSON(PKS.scripts+'scammers/scammers.json',function (data){if(is_array(data)){LS.set('scammers',data)}})},my_friends_page:function(){$j('a.remove').unbind().click(function (e){var _this=$j(this);$j.ajax({type:'POST',global:false,url:_this.attr('href'),success:function(){_this.unbind();_this.parents('tr').css('opacity',0.5)}});e.preventDefault()});$j('<div id="cb-friendlist-controls" style="display:block;height:auto;clear:both;padding:10px 5px 25px 5px"><h1>[CB] Friends list controls</h1></div>').insertBefore('#friends_list');SITEWIDE.my_friends_goto(false);cb_std('Add 100 (random)','pad10px').click(function(){$j(this).unbind().css({opacity:0.5});SITEWIDE.my_friends_bulk_add_friends()}).appendTo('#cb-friendlist-controls');cb_std('Add friends from list','pad10px').click(function(){SITEWIDE.my_friends_add_from_list()}).appendTo('#cb-friendlist-controls');cb_std('Rem. dead','red pad10px').click(function(){$j(this).unbind().css({opacity:0.5});SITEWIDE.my_friends_remove_dead_friends()}).appendTo('#cb-friendlist-controls');cb_std('Rem. ALL from ...','red pad10px').attr('title','Remove all friends starting from page {X}').click(function(){$j(this).unbind().css({opacity:0.5});SITEWIDE.my_friends_remove_friends_from_page()}).appendTo('#cb-friendlist-controls')},my_friends_add_from_list:function (uid_list){if(!uid_list||!is_array(uid_list)){uid_list=prompt('List of COMMA separated IDs','');if(uid_list){uid_list=uid_list_parser(uid_list);SITEWIDE.my_friends_add_from_list(uid_list)}return}_q('Retrieving current friends list ...');var friends=CRPK.sbox.get_friends(),friends_list=[],token={_token:getinfo('token')},addURL=EREP.base+'/citizen/friends/add/';for (var name in friends){if(friends.hasOwnProperty(name)){friends_list.push(friends[name])}}for (var i = 0; i < uid_list.length; i++){add_uid=intval(uid_list[i],0);if(!add_uid||!is_positive_int(add_uid)||add_uid<5){continue}if(in_array(add_uid,friends_list)){_q('Skipping friend (uid ='+add_uid+')');clog('Skipping friend (uid ='+add_uid+')');continue}_q('Sending request (uid ='+add_uid+')');clog('Sending request (uid ='+add_uid+')');$j.ajax({url:addURL+add_uid,type:'POST',async:false,data:token})}_q('Bulk friend requests sent');clog('Bulk friend requests sent');alert('Bulk friend requests sent');return!0},my_friends_bulk_add_friends:function (start_page){if(!start_page||!is_positive_int(start_page)){start_page=prompt('Start from page number [1-400]?',rand(1,400))}if(empty(start_page)||!is_positive_int(start_page)){_q('BULK add friends aborted.');return!1}var token={_token:getinfo('token')},baseURL=EREP.base+'/citizen/friends/add/',rx=/citizen\/profile\/([^"]*)">/g;start_page=intval(start_page,1);if(!is_positive_int(start_page)||1==start_page){start_page=rand(100,400)}if(start_page>400){start_page=rand(50,400)}start_page=intval(start_page);var page_step=rand(1,3),scanned_pages=0,max_pages=10;_q('Retrieving current friends list ...');var friends=CRPK.sbox.get_friends(),friends_list=[];for (var name in friends){if(friends.hasOwnProperty(name)){friends_list.push(friends[name])}}for (var p = start_page; p <= 500; p += page_step){scanned_pages++;if(scanned_pages>max_pages){break}_q('Getting online users list (page ='+p+')');clog('Getting online users list (page ='+p+')');$j.ajax({url:EREP.url+'/main/online-users/all/all/'+p,async:false,success:function (page){page=page.split('<table class="bestof">')[1].split('</table>')[0];while((uid=rx.exec(page))!==null){var add_uid=uid[1];if(in_array(add_uid,friends_list)){_q('Skipping friend (uid ='+add_uid+')');clog('Skipping friend (uid ='+add_uid+')');continue}_q('Sending request (uid ='+add_uid+')');clog('Sending request (uid ='+add_uid+')');$j.ajax({url:baseURL+uid[1],type:'POST',async:false,data:token})}}})}_q('Bulk friend requests sent');clog('Bulk friend requests sent');alert('Bulk friend requests sent');return!0},my_friends_goto:function (pageNUM){if(!$j('#cb-friendlist-goto').exists()){var current_page=intval($j('#current_page').val()),num_pages=intval($j('#maxim_page').val()),opts='';for (var p = 1; p <= num_pages; p++){opts+='<option value="'+p+'"'+(p==current_page?' selected':'')+'>'+p+'</option>'}$j('<label style="float:left">Go to page #<select id="cb-friendlist-goto">'+opts+'</select> / '+num_pages+NBSP+'</label>').change(function(){SITEWIDE.my_friends_goto()}).appendTo('#cb-friendlist-controls');return}pageNUM=intval($j('#cb-friendlist-goto').val());$j.getJSON(EREP.url+'/main/citizen-friends/'+getinfo('uid')+'/'+pageNUM+'/list',function (data){$j('#friends_list').html(data.content);$j('#results').html(data.results);$j('#current_page').attr('value',pageNUM);if(pageNUM==1){$j('li.prev').addClass('disabled');$j('li.next').removeClass('disabled')}else if(pageNUM>1&&pageNUM<intval($j('#maxim_page').val())){$j('li.prev').removeClass('disabled');$j('li.next').removeClass('disabled')}else{$j('li.prev').removeClass('disabled');$j('li.next').addClass('disabled')}CRPK.vcards.init();$j('a.remove').unbind().click(function (e){var _this=$j(this);$j.ajax({type:'POST',url:_this.attr('href'),success:function(){_this.unbind();_this.parents('tr').css('opacity',0.5)}});e.preventDefault()})})},my_friends_remove_friend:function (uID,_token){if(!_token){_token={_token:getinfo('token')}}var baseURL=EREP.base+'citizen/friends/remove/';_q('Removing friend (uid = '+uID+')');$j.ajax({url:baseURL+uID,type:'POST',data:_token})},my_friends_remove_dead_friends:function(){var num_pages=intval($j('#maxim_page').val()),baseURL=EREP.url+'/main/citizen-friends/'+getinfo('uid')+'/',_token={_token:getinfo('token')},rx=/id="friend_([^"]*)"[^>]class="dead"/g;_q('Scanning '+num_pages+' pages of friends ... ');timeout=0;for (var page = 1; page <= num_pages; page++){(function (pageNUM){timeout+=300;setTimeout(function(){_q('Scanning friends (page = '+pageNUM+') ... ');$j.getJSON(baseURL+pageNUM+'/list',function (data){while((uid=rx.exec(data.content))!==null){timeout+=300;(function (uID){setTimeout(function(){SITEWIDE.my_friends_remove_friend(uID,_token)},timeout)})(uid[1])}})},timeout)})(page)}setTimeout(function(){humanMsg.displayMsg('<strong>Remove DEAD friends</strong> :: <span>finished</span>')},4*MINUTES)},my_friends_remove_friends_from_page:function(){var num_pages=intval($j('#maxim_page').val()),baseURL=EREP.url+'/main/citizen-friends/'+getinfo('uid')+'/',_token={_token:getinfo('token')},rx=/id="friend_([^"]*)"/g;timeout=0;var start_page=intval(prompt('Remove all friends starting from page ... (max = '+num_pages+')',1),0);if(!start_page||start_page>num_pages){return alert('Invalid start page ('+start_page+')')}for (var page = start_page; page <= num_pages; page++){(function (pageNUM){timeout+=300;setTimeout(function(){_q('Scanning friends (page = '+pageNUM+') ... ');$j.getJSON(baseURL+pageNUM+'/list',function (data){while((uid=rx.exec(data.content))!==null){timeout+=300;(function (uID){setTimeout(function(){SITEWIDE.my_friends_remove_friend(uID,_token)},timeout)})(uid[1])}})},timeout)})(page)}setTimeout(function(){humanMsg.displayMsg('<strong>Remove friends</strong> :: <span>finished</span>')},4*MINUTES)},add_friends:function (start_page){var token={_token:getinfo('token')},baseURL=EREP.base+'/citizen/friends/add/',rx=/citizen\/profile\/([^"]*)">/g;start_page=intval(start_page,rand(1,50));var end_page=start_page+10;if(start_page>200){start_page=rand(1,50)}for (var p = start_page; p <= end_page; p++){_q('Getting online users list (page ='+p+')');clog('Getting online users list (page ='+p+')');$j.ajax({url:EREP.url+'/main/online-users/all/all/'+p,async:false,success:function (page){page=page.split('<table class="bestof">')[1].split('</table>')[0];while((uid=rx.exec(page))!==null){_q('Sending request (uid ='+uid[1]+')');clog('Sending request (uid ='+uid[1]+')');$j.ajax({url:baseURL+uid[1],type:'POST',async:false,data:token})}}})}_q('Bulk friend requests sent');clog('Bulk friend requests sent')},load_more_comments:function (_more,_scrollTo){if(_scrollTo&&$j(_scrollTo).exists()){$j(_scrollTo).scrollTo();_scrollTo=!1}if(!_more){_more=$j('#comments_div .load-more-comments')}if(!_more.exists()||_more.css('display')=='none'){return}_more.click().text('[CB] Loading comments ... ');$j(document).ajaxSuccess(function (e,xhr,opts){if(instr(opts.url,'article-comment/loadMoreComments')){_more.text('Load more comments');setTimeout(function(){SITEWIDE.load_more_comments(_more,_scrollTo)},500)}})},article_page:function(){var article_lang=COUNTRIES.get($j('#content .post_details a.newspaper_country').attr('href').split('/all/')[1].replace('/1',''),'code').toLowerCase(),translate_article_url=EREP.base+article_lang+'/article/'+(_URL_.split('/article/')[1]);$j('.newspaper_head .actions').append('<a href="'+https()+'translate.google.com/translate?sl='+dev_(article_lang,'auto')+'&tl=en&hl=en&ie=UTF8&prev=_t&sandbox=0&u='+encodeURIComponent(translate_article_url)+'" class="slick_grey bolded" target="_blank"><span>Translate article</span></a>');SITEWIDE.article_page_bind_comments();var _more=$j('#comments_div .load-more-comments');if(!_more.exists()){if(dev_()||zm_()){var gtop=$j('#content > div.post > a.comments-go-to-top'),get_list=gtop.clone();get_list.html('<br>Get commenter`s ID list').click(function(){prompt('ID List',$j('#comments_div a.nameholder').map(function(){return this.href.split('profile/')[1]*1}).get().reduce(function (p,c){if(p.indexOf(c)<0){p.push(c)}return p},[]).join(','))}).insertAfter(gtop)}return}$j(document).ajaxSuccess(function (e,xhr,opts){if(instr(opts.url,'article-comment/loadMoreComments')){setTimeout(function(){SITEWIDE.article_page_bind_comments()},500)}});var _scrollTo=window.location.hash;_scrollTo=_scrollTo&&/comment[0-9]+/.test(_scrollTo)&&!$j(_scrollTo).exists()?_scrollTo:false;if(instr(oURL,'#comment')){SITEWIDE.load_more_comments(_more,_scrollTo)}else{setTimeout(function(){SITEWIDE.load_more_comments(_more,_scrollTo)},500)}},article_page_bind_comments:function(){SITEWIDE.fix_links();$j('#loadMoreComments .comment-holder:not(.cbound)').each(function(){var _this=$j(this),level=_this.hasClass('indent-level-3')?3:(_this.hasClass('indent-level-2')?2:(_this.hasClass('indent-level-1')?1:0)),_li=$j('<li></li>');_this.addClass('cbound').find('.reply_links').append(_li);_li.append('<a class="cb_com_link" href="'+_URL_+'#'+_this.attr('id')+'">Link to this comment</a> â€¢ ');$j('<a class="cb_com_link"" data-comment-id="'+_this.attr('id')+'" href="'+VOID+'">Translate</a>').click(SITEWIDE.article_page_translate_comment).appendTo(_li)})},home_page_translate_wall_post:function (e){e.preventDefault();var comm=$j('#'+$j(e.target).data('comment-id'));if(!comm.exists()){return!0}SITEWIDE.g_translate_popup(comm.find('p').textNodes().text().trim())},article_page_translate_comment:function (e){e.preventDefault();var comm=$j('#'+$j(e.target).data('comment-id'));if(!comm.exists()){return!0}SITEWIDE.g_translate_popup(comm.find(comm.hasClass('indent-level-0')?'.comment-content':'> div.comments-right>div>span.comment-text').textNodes().text().trim())},g_translate_popup:function (content){if(!content||typeof(content)!='string'){return!1}content=content.trim();if(!content.length){return!1}windowOpener(550,1024,'cb-g-translate',https()+'translate.google.com/#auto/en/'+encodeURIComponent(content))},messages_alerts_page:function(){if(getinfo('lang')!='en'){return}$j('table.messages tr').each(function(){var text=$j(this).find('p').text();if(instr(text,'Congratulations')||instr(text,'Congrats!')||instr(text,'Good news! You just made')||instr(text,'applied for your job')||instr(text,'have been sold for')||instr(text,'commented on')||instr(text,'voted your')||instr(text,'voted on your')||instr(text,'have been returned to you')||instr(text,'employees cannot work')||instr(text,'accepted your friendship')||instr(text,'your efforts to liberate')||instr(text,'replied to this comment')||instr(text,'new law proposal')){$j(this).find('input').attr('checked',!0)}else if(instr($j(this).html(),'was awarded with an amount of Gold')){$j(this).find('a').first().attr('href',EREP.url+'/gold-bonus/1')}})},messages_read_page:function(){page_title($j('#content > div.message_ajax_container h3').text());SITEWIDE.messages_bind_messages_ajax()},messages_inbox_page:function(){SITEWIDE.messages_inbox_callback();SITEWIDE.messages_bind_messages_ajax()},messages_paginated_page:function(){SITEWIDE.messages_inbox_callback();SITEWIDE.messages_bind_messages_ajax()},messages_ajax_bound:false,messages_bind_messages_ajax:function(){if(!SITEWIDE.messages_ajax_bound){SITEWIDE.messages_ajax_bound=!0;$j(document).ajaxSuccess(function (e,xhr,opts){if(instr(opts.url,'main/messages-paginated')){setTimeout(function(){SITEWIDE.messages_inbox_callback()},300)}else if(instr(opts.url,'main/messages-read')){setTimeout(function(){SITEWIDE.messages_read_page()},300)}})}return SITEWIDE.messages_ajax_bound},messages_inbox_callback:function(){clog('messages_inbox_callback');page_title('Messages');$j('#content > div.message_ajax_container table.message_listing tr:not(.last) > td:last-child').prepend('<div class="cb-inbox">'+cb_std_string('<i class="fa fa-check"></i>','tinySize green noPadding mark-as-read')+cb_std_string('<i class="fa fa-external-link-square"></i>','tinySize white noPadding new-tab')+cb_std_string('<i class="fa fa-times"></i>','tinySize red noPadding delete')+cb_std_string('<i class="fa fa-exclamation-triangle"></i>','tinySize cbred noPadding spam')+'<div>');$j('.message_listing div.cb-inbox a:not(.cb-inbox-bound)').addClass('cb-inbox-bound').attr("title",function(){var _this=$j(this);return (_this.hasClass('mark-as-read')?'Mark as read':(_this.hasClass('new-tab')?'Open in new tab':(_this.hasClass('delete')?'Delete':'Mark as spam and delete')))}).click(function(){SITEWIDE.messages_inbox_ajax_trigger($j(this))}).tipsy({gravity:'s'})},messages_inbox_ajax_trigger:function (_link){var row=_link.parents('tr'),messageID=_link.parents('tr').find('input').val();if(_link.hasClass('new-tab')){_link.attr('target','_blank').attr('href',EREP.url+'/main/messages-read/'+messageID);row.removeClass('unread')}else if(_link.hasClass('mark-as-read')){$j.ajax({url:EREP.url+'/main/messages-read/'+messageID,success:function(){row.removeClass('unread')}})}else if(_link.hasClass('delete')){$j.ajax({url:EREP.url+'/main/messages-delete',type:'POST',global:false,data:{_token:getinfo('token'),delete_message:[messageID]},success:function(){row.find('td').fadeOut(300,function(){row.remove()})}})}else if(_link.hasClass('spam')){$j.ajax({url:EREP.url+'/main/tickets-report/'+messageID+'/private-message',type:'POST',global:false,data:{_token:getinfo('token'),report_reason:10,content_lang:'en',content_info:'',report:1},success:function(){row.find('td').fadeOut(300,function(){row.remove()})}})}$j('.tipsy').remove()},rwhammer:{init:function(){if(true||!dev_()||!is_page('home')||alreadySupporter||alreadyFunder){return}$j('<a href="'+VOID+'" id="cb-rw-hammer" style="float:right" title="This will start midlessly hammering the server every seconds for a period of 15 minutes.">RW Support Hammer</a>').tipsy({gravity:'s'}).click(function(){if(!confirm('Start RW Hammering?')){return!1}}).insertAfter($j('#orderContainer,#battle_listing > div.rest').first())},hammer:function(){}}};PLUGINS['sitewide']={f:SITEWIDE.init,p:false};PLUGINS['travel']={f:TRAVEL.init,p:['/change-location','battlefield']}}}catch (pluginError){console.error('Plugin load ERROR');debug_(pluginError);hasPluginError = true};try{/*============ Plugin: Economy*/if(typeof(CB_EREP_LIBRARY_LOADED)!=_u){CRPK.plugins.ECONOMY={angular_market:null,marketID:'0-0-0-0',default_market_favorites:[1,14,27,35,56,65],country:'',industry:'',locations:[],init:function(){CRPK.plugins.ECONOMY.market_menu();if(!is_page('-market/')&&!is_page('/marketplace')){return!1}$j('input[trigger="check_number"]').each(function(){$j(this).attr('trigger','')});$j('div.create_form #amount').css({width:'75px'});if(is_page(EREP.market)){CRPK.plugins.ECONOMY.locations=array_unique([getinfo('location','id'),getinfo('citizenship','id')]);CRPK.plugins.ECONOMY.angular_market=CRPK.angular.get_scope('#marketplace');if(!$j('#marketplace').hasClass('ng-scope')||!CRPK.plugins.ECONOMY.angular_market){setTimeout(function(){CRPK.plugins.ECONOMY.init()},100);clog('angular is not loaded');return!0}CRPK.plugins.ECONOMY.angular_market_trigger();CRPK.plugins.ECONOMY.market_name();CRPK.plugins.ECONOMY.market_favorites();window.onhashchange=function(){CRPK.plugins.ECONOMY.on_market_change(true)}}else if(is_page('mmarket')){CRPK.plugins.ECONOMY.mmarket_rebind();CRPK.plugins.ECONOMY.market_favorites();CRPK.plugins.ECONOMY.mmarket_rate();CRPK.plugins.ECONOMY.mmarket_search();CRPK.plugins.ECONOMY.mmarket_goto();CRPK.plugins.ECONOMY.mmarket_report()}else if(is_page('jmarket')){CRPK.plugins.ECONOMY.market_favorites();CRPK.plugins.ECONOMY.jmarket_search()}return!0},countryID:function(){var countryID=0;if(is_page(EREP.market)){countryID=intval(CRPK.plugins.ECONOMY.angular_market.settings.countryId)}else if(is_page('jmarket')){countryID=intval(_URL_.split('/job-market/')[1])}return countryID},industryID:function(){return intval(CRPK.plugins.ECONOMY.angular_market.settings.industryId)},qualityID:function(){return CRPK.plugins.ECONOMY.is_raw()?1:(CRPK.plugins.ECONOMY.angular_market.settings.quality||CRPK.plugins.ECONOMY.angular_market.settings.lastQuality)},pageID:function(){return CRPK.plugins.ECONOMY.angular_market.settings.currentPage},is_raw:function(){return in_array(CRPK.plugins.ECONOMY.industryID(),[7,12,17])},industry_name:function(){return INDUSTRIES.get_name(CRPK.plugins.ECONOMY.industryID())},on_market_change:function (haschange){if(haschange){CRPK.plugins.ECONOMY.angular_market_trigger()}CRPK.plugins.ECONOMY.market_name();if($j('#cb-market-prices-table').data('industry')!=CRPK.plugins.ECONOMY.industryID()){$j('h1.cb-market-prices,#cb-market-prices-table').remove()}return!0},angular_market_trigger:function(){if(!is_page('/marketplace')||!CRPK.plugins.ECONOMY.angular_market){return CRPK.plugins.ECONOMY.market_travel_to()}if(CRPK.plugins.ECONOMY.angular_market.settings.showLoading){return setTimeout(CRPK.plugins.ECONOMY.angular_market_trigger,100)}var current_market=[CRPK.plugins.ECONOMY.countryID(),CRPK.plugins.ECONOMY.industryID(),CRPK.plugins.ECONOMY.qualityID(),CRPK.plugins.ECONOMY.pageID()].join('-');if(CRPK.plugins.ECONOMY.marketID==current_market){return!0}var favorites=LS.get('market-favorites',CRPK.plugins.ECONOMY.default_market_favorites),is_favorite=in_array(CRPK.plugins.ECONOMY.countryID(),favorites),fav_button=$j('#marketplace > div.country-select > a.cb-favorite');if(fav_button.exists()){if(is_favorite!=fav_button.hasClass('on')){console.log(fav_button.attr('class'));fav_button.toggleClass('on').attr('title',(is_favorite?'Remove':'Add')+' this country '+(is_favorite?'from':'to')+' favorites');console.log(fav_button.attr('class'))}}CRPK.plugins.ECONOMY.marketID=current_market;if(CRPK.plugins.ECONOMY.industryID()==1){CRPK.plugins.ECONOMY.row_parser()}return CRPK.plugins.ECONOMY.market_travel_to()},market_menu:function(){var market_id=is_page('/marketplace#')?intval(_URL_.split('/marketplace')[1].split('#')[0].split('/')[0]):false,market_base_url=EREP.market+'#'+(market_id?market_id:getinfo('citizenship','id'))+'/',menu=$j('<div id="cb-market-menu"></div>'),wrapperL1,wrapperL2;for (var industryID in INDUSTRIES._list){if(!INDUSTRIES._list.hasOwnProperty(industryID)){continue}var is_raw=INDUSTRIES.is_raw(industryID),industryNAME=INDUSTRIES.get_name(industryID),maxQ=INDUSTRIES.maxQ(industryID);if(is_raw&&industryID!=7){wrapperL2=menu.find('.ind-raw .L2')}else{wrapperL1=$j('<div class="L1 ind-'+(is_raw?'raw':industryID)+' maxQ-'+maxQ+'" title="'+(is_raw?'Raw Materials':industryNAME)+'"></div>');wrapperL2=$j('<div class="L2"></div>');wrapperL1.appendTo(menu);wrapperL2.appendTo(wrapperL1)}if(is_raw){wrapperL2.append('<a href="'+market_base_url+industryID+'/1" class="ind-'+industryID+'"><b>'+industryNAME+'</b></a>')}else{for (var q = 1; q <= maxQ; q++){wrapperL2.append('<a href="'+market_base_url+industryID+'/'+q+'" class="ind-'+industryID+' q-'+q+'"><b>'+industryNAME+'</b><i>'+q+'</i></a>')}}}menu.find('>div.L1.ind-raw').detach().appendTo(menu);$j('#newMenu').append(menu);return!0},market_favorites:function(){if(!is_page(EREP.marketplace())&&!is_page('jmarket')){return!1}var current_market_ID=CRPK.plugins.ECONOMY.countryID(),favorites=LS.get('market-favorites',CRPK.plugins.ECONOMY.default_market_favorites),is_favorite=in_array(CRPK.plugins.ECONOMY.countryID(),favorites),citizenshipID=getinfo('citizenship','id'),locationID=getinfo('location','id'),favorites_switch=[],switch_wrap=$j('div.country-select');if(!(favorites instanceof Array)||typeof(favorites[0])=='string'){favorites=CRPK.plugins.ECONOMY.default_market_favorites;LS.set('market-favorites',favorites)}if(favorites.indexOf(citizenshipID)<0){favorites_switch.push(citizenshipID)}if(favorites.indexOf(locationID)<0){favorites_switch.push(locationID)}$j.extend(favorites_switch,favorites);if(is_page(EREP.marketplace())){cb_std('Scan Prices','#cb-scan-price left green pad10px').click(function(){CRPK.plugins.ECONOMY.market_scan_favorites()}).appendTo(switch_wrap)}$j('<a class="cb-favorite'+(is_favorite?' on':'')+'" title="'+(is_favorite?'Remove':'Add')+' this country '+(is_favorite?'from':'to')+' favorites" href="'+VOID+'"></a>').click(function(){var favorites=LS.get('market-favorites',CRPK.plugins.ECONOMY.default_market_favorites),index=favorites.indexOf(CRPK.plugins.ECONOMY.countryID()),is_favorite;if(!favorites instanceof Array){favorites=CRPK.plugins.ECONOMY.default_market_favorites}if(index>-1){favorites.splice(index,1);is_favorite=!1}else{favorites.push(CRPK.plugins.ECONOMY.countryID());is_favorite=!0}favorites.sort();LS.set('market-favorites',favorites);$j(this).toggleClass('on').attr('title',(is_favorite?'Remove':'Add')+' this country '+(is_favorite?'from':'to')+' favorites')}).tipsy({gravity:'s'}).appendTo(switch_wrap);for (var i = 0; i < favorites.length; i++){var countryID=favorites[i];if(countryID==current_market_ID){continue}var country=COUNTRIES.get(countryID);$j('<a href="'+VOID+'" class="cb-market-favorites" data-country-id="'+countryID+'" title="View market in '+country.name+'"><img src="/images/flags_png/M/'+country.url+'.png" style="margin:4px 2px 0 2px;float:left" /></a>').click(function(){$j('#countryId').val($j(this).data('country-id')).trigger('change')}).appendTo(switch_wrap)}switch_wrap.find('div.clear').appendTo(switch_wrap);return!0},get_market_favorites:function(){return array_unique(LS.get('market-favorites',CRPK.plugins.ECONOMY.default_market_favorites).concat([getinfo('location','id'),getinfo('citizenship','id')]))},market_scan_favorites_make_table:function(){var citizenshipID=getinfo('citizenship','id'),locationID=getinfo('location','id'),countries=array_unique(CRPK.plugins.ECONOMY.get_market_favorites().concat([locationID,CRPK.plugins.ECONOMY.countryID()])),table='<table id="cb-market-prices-table" data-industry="'+CRPK.plugins.ECONOMY.industryID()+'">',heading='[CB] Best price',thead='',tbody='',i,country,market,market_id,market_url,border='',jqID='cb-market-price--';if(CRPK.plugins.ECONOMY.industryID()==1){heading+=' (per energy)';thead+='<th><img src="/images/flags_png/M/EU.png" /></th>';for (i = 0; i < countries.length; i++){border=(CRPK.plugins.ECONOMY.industryID()==1&&countries[i]==citizenshipID?' class="border-bottom"':'');country=COUNTRIES.get(countries[i]);tbody+='<tr'+border+'><th><img class="country" src="/images/flags_png/M/'+country.url+'.png" /></th>';for (var q = 1; q <= 7; q++){market_id=jqID+[country.id,CRPK.plugins.ECONOMY.industryID(),q].join('-');market_url=EREP.marketplace(country.id,CRPK.plugins.ECONOMY.industryID(),q);if(0===i){thead+='<th><img src="/images/icons/industry/'+CRPK.plugins.ECONOMY.industryID()+'/q'+q+'.png" />Food Q'+q+'</th>'}tbody+='<td><a href="'+market_url+'" class="cb-market-favorite-goto"><b class="cb-market-price empty food" id="'+market_id+'" data-quality="'+q+'" data-country="'+country.display+'"></b></a></td>'}tbody+='</tr>'}}else{tbody+='<tr>';for (i = 0; i < countries.length; i++){country=COUNTRIES.get(countries[i]);market_id=jqID+[country.id,CRPK.plugins.ECONOMY.industryID(),CRPK.plugins.ECONOMY.qualityID()].join('-');market_url=EREP.marketplace(country.id,CRPK.plugins.ECONOMY.industryID(),CRPK.plugins.ECONOMY.qualityID());thead+='<th><img src="/images/flags_png/L/'+country.url+'.png" /></th>';tbody+='<td><a href="'+market_url+'" class="cb-market-favorite-goto"><b class="cb-market-price empty" id="'+market_id+'" data-country="'+country.display+'"></b></a></td>'}tbody+='</tr>'}table+='<thead><tr class="m_mainh">'+thead+'</tr><tbody class="price_sorted">'+tbody+'</tbody></table>';$j('<h1 class="cb-market-prices">'+heading+' <b id="cb-market-best-price"></b></h1>'+table).insertBefore('#marketplace>div.listing_container>div.list_products>table:first');$j(document).on('click','#cb-market-prices-table a.cb-market-favorite-goto',function(event){event.preventDefault();event.stopImmediatePropagation();var market_id=$j(this).find('b').attr('id').split('--')[1].split('-');CRPK.plugins.ECONOMY.angular_market.settings.countryId=market_id[0];CRPK.plugins.ECONOMY.angular_market.settings.industryId=market_id[1];CRPK.plugins.ECONOMY.angular_market.settings.lastQuality=market_id[2];CRPK.plugins.ECONOMY.angular_market.getOffers(market_id[2])});return!0},market_scan_favorites:function(){if(!CRPK.plugins.ECONOMY.industryID()){return alert('No industry selected')}var table=$j('#cb-market-prices-table');if(!table.exists()){CRPK.plugins.ECONOMY.market_scan_favorites_make_table()}$j('#cb-market-prices-table b.cb-market-price').addClass('fbload');$j.getJSON(EREP.url+'/economy/marketpicture').then(function(marketpicture){$j('#cb-market-prices-table b.cb-market-price').each(function(){var _this=$j(this),_this_id=_this.attr('id'),_this_data=_this_id.split('--')[1].split('-'),countryID=_this_data[0],industryID=_this_data[1],qualityID=_this_data[2],industry_name=INDUSTRIES.get_name(industryID).toLowerCase(),quality_name=INDUSTRIES.is_raw(industryID)?'q1':'q'+qualityID,is_food=(industry_name=='food'),price='N/A';if(typeof(marketpicture[countryID])!=_u&&typeof(marketpicture[countryID][industry_name])!=_u&&typeof(marketpicture[countryID][industry_name][quality_name])!=_u&&(marketpicture[countryID][industry_name][quality_name] instanceof Array)&&marketpicture[countryID][industry_name][quality_name].length>0){price=floatval(marketpicture[countryID][industry_name][quality_name][0]['gross']);if(is_food){price=cb_number(CRPK.plugins.ECONOMY.calc_food_ppe(qualityID,price),4,!0)}else{price=cb_number(price,2)}_this.text(price).removeClass('fbload empty').addClass('scanned p-'+String(floatval(price)).replace('.','-'))}else{_this.text(price).removeClass('fbload').addClass('na')}});CRPK.plugins.ECONOMY.market_scan_favorites_sort()});return!0},market_scan_favorites_sort:function(){$j('.tipsy').remove();var best_prices=$j('#cb-market-prices-table b.scanned').removeClass('best-price second-best-price').unbind().removeAttr('title').removeAttr('original-title').map(function(){return floatval($j(this).text(),0)}).get().reduce(function (p,c){if(p.indexOf(c)<0){p.push(c)}return p},[]).sort(function (a,b){return a-b}),best_price=String(best_prices[0]),second_best=String(best_prices.length>1?best_prices[1]:'');$j('#cb-market-best-price').text(best_price);$j('#cb-market-prices-table b.scanned.p-'+best_price.replace('.','-')).addClass('best-price').attr('title','Best Price in {favorites}');if(second_best){$j('#cb-market-prices-table b.scanned.p-'+second_best.replace('.','-')).addClass('second-best-price').attr('title','2nd Best Price in {favorites}')}$j('#cb-market-prices-table>tbody>tr').each(function(){var country_prices=$j(this).find('b.scanned');if(country_prices.length<7){return!0}country_prices=country_prices.map(function(){return floatval($j(this).text(),0)}).get().reduce(function (p,c){if(p.indexOf(c)<0){p.push(c)}return p},[]).sort(function (a,b){return a-b});var best_country_price=String(country_prices[0]);$j(this).find('b.scanned.p-'+best_country_price.replace('.','-')).addClass('best-country-price').attr('title',function (index,title){return (title?title+'<br />':'')+'Best Price in '+$j(this).data('country')})});$j('#cb-market-prices-table b.scanned[title]').tipsy({gravity:'s',html:true});return!0},market_travel_to:function (second_run){$j('#economy-travel-to').remove();if(!second_run){return setTimeout(function(){CRPK.plugins.ECONOMY.market_travel_to(true)},200)}if(!CRPK.plugins.ECONOMY.angular_market||CRPK.plugins.ECONOMY.angular_market.settings.can_buy){return!0}var country=COUNTRIES.get(CRPK.plugins.ECONOMY.countryID());cb_std('<q class="cb-icon cb-icon-16">Cannot buy</q> â€¢â€¢ <img src="/images/flags_png/S/'+country.url+'.png" valign="middle" /> Travel to <b>'+country.display+'</b>','#economy-travel-to pad10px white right').click(function(){$j(this).unbind().addClass('disabled loading');var region=TRAVEL.get_country_regions(CRPK.plugins.ECONOMY.countryID());if(region.length>0&&region[0].id){TRAVEL.to(CRPK.plugins.ECONOMY.countryID(),region[0].id,function(){$j('#economy-travel-to').removeClass('disabled loading cbredColor').removeAttr('href').text('Travel:: OK â€¢â€¢ Location: '+country.display,'display').fadeOut('fast');CRPK.plugins.ECONOMY.angular_market.getOffers(CRPK.plugins.ECONOMY.qualityID())})}else{alert('Cannot travel. '+country.display+' has no regions (DELETED)')}return!0}).appendTo('#marketplace > div.listing_container > div.list_products.fadeIn > table > thead > tr > th.m_share')},row_parser:function(){if(CRPK.plugins.ECONOMY.industryID()!=1){return!1}$j('#marketplace > div.listing_container > div.list_products.fadeIn > table > tbody.price_sorted > tr > td.m_price').each(function(){var cell=$j(this);if(CRPK.plugins.ECONOMY.industryID()==1){var price=floatval(cell.find('strong').text().trim().split(' ')[0]),div=cell.find('.cb-ppe');if(!div.exists()){div=$j('<div title="Price per 1 energy" class="cb-ppe"></div>')}div.html('<small>'+CRPK.plugins.ECONOMY.calc_food_ppe(CRPK.plugins.ECONOMY.qualityID(),price)+'/energy</small>').appendTo(cell)}});return!0},calc_food_ppe:function (quality,price){var energy_per_unit=(quality==7?20:quality*2);if(getinfo('day')<=2582){energy_per_unit/=2}return cb_number(floatval(price)/energy_per_unit,4)},market_name:function(){var mkt_name=(CRPK.plugins.ECONOMY.industry_name()+(CRPK.plugins.ECONOMY.is_raw()?'':' q'+CRPK.plugins.ECONOMY.qualityID()));$j('#marketplace h1').eq(0).text(COUNTRIES.get(CRPK.plugins.ECONOMY.countryID(),'name')+' Â» '+mkt_name);page_title(COUNTRIES.get(CRPK.plugins.ECONOMY.countryID(),'code')+' > '+mkt_name);return mkt_name},mmarket_rebind:function(){CRPK.plugins.ECONOMY.erepublik_exchange_displayNextPage=erepublik.exchange.displayNextPage;erepublik.exchange.displayNextPage=CRPK.plugins.ECONOMY.mmarket_display_next_page;CRPK.plugins.ECONOMY.mmarket_paginator();$j('#change_currency').click(function(){setTimeout(function(){CRPK.plugins.ECONOMY.mmarket_paginator()},500)});return!0},mmarket_display_next_page:function (a,b){CRPK.plugins.ECONOMY.erepublik_exchange_displayNextPage(a,b);CRPK.plugins.ECONOMY.mmarket_rate();CRPK.plugins.ECONOMY.mmarket_paginator();return!0},mmarket_rate:function(){$j(document).ajaxSuccess(function (e,xhr,opts){if(instr(opts.url,'exchange/retrieve')){CRPK.plugins.ECONOMY.mmarket_rate_callback()}});CRPK.plugins.ECONOMY.mmarket_rate_callback();return!0},mmarket_rate_callback:function(){var currency=intval($j('#buy_currency').val())==1?'gold':'cc',exchange_rate=('cc'==currency?function (value){return cb_number(1/value,5)+' cc'+ssd(47)+'gold'}:function (value){return cb_number(1/value,0)+' gold'+ssd(47)+'c'});$j('td.ex_rate').each(function(){var _this=$j(this);if(_this.find('>.cb-mm-xrate').exists()){return!0}_this.append('<div class="cb-mm-xrate">'+exchange_rate(_this.find('strong[id^="exchange_rate"]>span').text())+'</div>')});return!0},mmarket_paginator:function(){var paginator=$j('#content > div.e_cash > div.exchange_content > div.buy_mode > ul.pager'),pages=paginator.find('>li'),first_page=paginator.find('>li>a.first'),last_page=paginator.find('>li>a.last'),current_page=intval(paginator.find('>li>a.on').attr('rel').replace('page_','')),anchor_,width=400,page;if(first_page.exists()){var before_prev_li=pages.eq(2),before_prev_page=intval(before_prev_li.find('>a').attr('rel').replace('page_',''));if(before_prev_page-10>1){anchor_=pages.eq(1);for (page = before_prev_page - 1; page > 1; page--){if(page%(current_page>100?20:10)===0){$j('<li><a trigger="paginator" class="cb-mm-page" rel="page_'+page+'" href="javascript:;" title="[CB]Go to page '+page+'">'+page+'</a></li>').insertAfter(anchor_);width+=25}}}}if(last_page.exists()){last_page=intval(paginator.find('>li>a.last').attr('rel').replace('page_',''));var before_next_li=pages.eq(pages.length-3),before_next_page=intval(before_next_li.find('>a').attr('rel').replace('page_',''));if(before_next_page+10<last_page){anchor_=pages.eq(pages.length-2);for (page = before_next_page + 1; page < last_page; page++){if(page%(last_page>100?20:10)===0){$j('<li><a trigger="paginator" class="cb-mm-page" rel="page_'+page+'" href="javascript:;" title="[CB]Go to page '+page+'">'+page+'</a></li>').insertBefore(anchor_);width+=25}}}}if(width!=400){paginator.addClass('cb-pager').css({'width':width+'px'})}return!0},mmarket_goto:function (page){if(empty(page)){$j('<a href="'+VOID+'" class="lighty">Goto page</a>').css({padding:'0 5px',borderRadius:'5px'}).appendTo('.bar_actions').click(function(){var _page=prompt('Page number','');if(!empty(_page)){CRPK.plugins.ECONOMY.mmarket_goto(_page)}});return!1}$j.ajax({url:EREP.ajax.mmarket_update,type:'POST',async:false,global:false,dataType:'json',data:{_token:getinfo('token'),personalOffers:0,page:(intval(page)-1),currencyId:$j('#buy_currency').val()},success:function (data){CRPK.plugins.ECONOMY.erepublik_exchange_displayNextPage(data,!0)}});return!0},mmarket_search:function (who,spage){if(empty(who)){$j('<a href="'+VOID+'" class="lighty">Search</a>').css({padding:'0 5px',borderRadius:'5px'}).appendTo('.bar_actions').click(function(){var _who=prompt('Citizen Name (full/partial, case insensitive))?','');if(!empty(_who)){var sfrom=intval($j('ul.pager a.on').text());CRPK.plugins.ECONOMY.mmarket_search(_who,sfrom);_q('Scanning Mmarket for `'+_who+'` starting from page '+sfrom+' (current) ...')}});return!1}var pages=intval($j('ul.pager .last').first().attr('title').replace('Go to page ','')),token=getinfo('token'),currency=$j('#buy_currency').val(),found=!1,_data;if(!spage){_q('Scanning '+pages+' pages ...');spage=2}if(spage>=pages){return _q('Scanned '+pages+' pages :: `'+who+'` not found')}$j.ajax({url:EREP.ajax.mmarket_update,type:'POST',async:false,global:false,dataType:'json',data:{_token:token,personalOffers:0,page:(intval(spage)-1),currencyId:currency},success:function (data){found=$j(data.buy_mode).find('span:icontains("'+who+'")').exists();if(found){_q('Found '+who+' on page '+spage);_data=data;CRPK.plugins.ECONOMY.erepublik_exchange_displayNextPage(_data,!0);$j('.buy_mode td:icontains("'+who+'")').css('background','yellow');return}_q(spage+' / '+pages+' :: not found');setTimeout(function(){CRPK.plugins.ECONOMY.mmarket_search(who,(spage+1))},rand(200,500))}});return!0},mmarket_report:function (page){var max_pages=intval($j('ul.pager .last').first().attr('title').replace('Go to page ',''));if(!page){$j('<a href="'+VOID+'" class="lighty">Export MM</a>').css({padding:'0 5px',borderRadius:'5px'}).appendTo('.bar_actions').click(function(){if(confirm('Generate CSV report from ALL '+max_pages+' Monetary Market offers ?')){CRPK.plugins.ECONOMY.mmarket_report(1)}});return!1}var token=getinfo('token'),currency=$j('#buy_currency').val();if(page>=max_pages){_q('Scanned '+max_pages+' pages. Generating report ...');var b=new Date(),date=[b.getFullYear(),('00'+b.getMonth()).slice(-2),('00'+b.getDate()).slice(-2)].join('-');export_csv(CRPK.plugins.ECONOMY.mmREPORT,'MM-report-'+date+(1==currency?'.gold':'.cc'));CRPK.plugins.ECONOMY.mmREPORT=[['Page','offerID','citizenID','Name','ExchangeRate','Amount']];return}_q('Scanning page :: '+page+'/'+max_pages);$j.ajax({url:EREP.ajax.mmarket_update,type:'POST',async:false,global:false,dataType:'json',data:{_token:token,personalOffers:0,page:(intval(page)-1),currencyId:currency},success:function (data){CRPK.plugins.ECONOMY.mmarket_report_callback(data.buy_mode,page);setTimeout(function(){CRPK.plugins.ECONOMY.mmarket_report(page+1)},rand(200,500))}});return!0},mmREPORT:[['Page','offerID','citizenID','Name','ExchangeRate','Amount']],mmarket_report_callback:function (data,page){data=data.split('/thead>')[1].split('/table>')[0].replace(new RegExp('\/','g'),'/');
            var ROWS, rowRX = new RegExp('<tr>[^Â§]*?</tr>', 'g'), citizenRX = new RegExp("href='[^Â§]*profile/([^']*)' title='([^']*)"), offerRX = new RegExp("<button type='button' title='Buy' id='purchase_([^']*)' data-i18n='[^']*' data-currency='[^']*' data-price='([^']*)' data-max='([^']*)'");
            while((ROWS=rowRX.exec(data))!==null){var row=ROWS[0],citizen=citizenRX.exec(row),offer=offerRX.exec(row);CRPK.plugins.ECONOMY.mmREPORT.push([page,1*offer[1],1*citizen[1],encodeURIComponent(citizen[2]),offer[2],offer[3]])}return!0},jmarket_search:function (who,spage){if(empty(who)){$j('<a href="'+VOID+'" class="left cbutton" style="margin-top:5px;">JMarket Search</a>').css('margin-right','10px').prependTo('.country-select').click(function(){var _who=prompt('Citizen Name (full/partial, case insensitive))?',$j('#large_sidebar a.user_name').first().text().trim());if(!empty(_who)){CRPK.plugins.ECONOMY.jmarket_search(_who)}});return!1}var last_page_link=$j('ul.pager .last').first(),pages=intval($j('ul.pager .last').first().attr('title').replace('Go to page ','')),search_url=$j(last_page_link).attr('href').split('/'),found=!1;search_url[5]='{PAGE}';search_url=search_url.join('/');if(!spage){_q('Scanning '+pages+' pages. Searching for `'+who+'` ...');spage=2}if(spage>=pages){return _q('Scanned '+pages+' pages :: `'+who+'` not found')}var _url=search_url.replace('{PAGE}',spage);$j.ajax({url:_url,async:false,global:false,success:function (response){found=$j(response).find('td.jm_company a:icontains("'+who+'")').exists();if(found){if(confirm('Offer was found on page '+spage+'. Go ?')){gto(_url)}return}_q(spage+' / '+pages+' :: not found');setTimeout(function(){CRPK.plugins.ECONOMY.jmarket_search(who,(spage+1))},rand(200,500))}});return!0}};CRPK.plugins.ECONOMY.SELLER={_:{bound:false},polling_interval:minutes(5),_on:false,raw_industries:INDUSTRIES._raw,opts:{auto:true,watchlist:{}},init:function(){$j('#sell_offers table').attr('id','cb-seller-offers-table');$j('#cb-seller-offers-table tbody').attr('id','cb-seller-offers-tbody');CRPK.plugins.ECONOMY.SELLER.parse_offers()},parse_offers:function(){var cell_ids=['product','quantity','price','country','action'];$j('#sell_offers table tbody tr[id^="offer_"]:not(.cb-parsed)').each(function(){var row=$j(this),rowID=row.attr('id'),offerID=rowID.split('_')[1];$j(this).find('td').each(function (index){$j(this).attr('id','offer_'+offerID+'_'+cell_ids[index]).addClass('offer-'+cell_ids[index])});CRPK.plugins.ECONOMY.SELLER.parse_offer(offerID)})},parse_offer:function (offerID){var row=$j('tr[id^="offer_'+offerID+'"]');if(!$j(row).exists()||row.hasClass('cb-parsed')){return}row.addClass('cb-parsed');var product_cell=$j('#offer_'+offerID+'_product'),price_cell=$j('#offer_'+offerID+'_price'),ind_q=row.find('img').first().attr('src').split('industry/')[1].split('/'),industryID=intval(ind_q[0],0),qualityID=intval(instr(ind_q[1],'default_')?1:ind_q[1].split('_')[0].replace('q',''),0),countryID=COUNTRIES.imget($j('#offer_'+offerID+'_country img.offer_flag'),'id'),offerDATA={offerID:intval(offerID),countryID:countryID,industryID:industryID,qualityID:qualityID,price:cb_number(price_cell.find('strong').text().trim(),2)};row.data('market',offerDATA);$j('<a href="'+VOID+'" title="Add more to market" class="cb-seller-add-more"></a>').data('market',offerDATA).click(CRPK.plugins.ECONOMY.SELLER.add_more_to_offer).append(product_cell.find('img')).appendTo(product_cell);product_cell.append(NBSP+'<a href="'+EREP.marketplace(countryID,industryID,qualityID)+'" target="_blank" title="View Market" class="cb-seller-view-market">'+(INDUSTRIES.get_name(industryID)+(INDUSTRIES.is_raw(industryID)?'':NBSP+'Q'+qualityID))+'</a>');var taxes=window['erepublik'].inventory.getCountryInfo(countryID).taxes[industryID],price=floatval(price_cell.find('strong').text()),marketPrice=window['minPrices'][countryID][industryID][qualityID],tax_pct=(intval(taxes.value_added_tax)+intval(getinfo('citizenship','id')==countryID?0:taxes.import_tax)),tax=tax_pct/100,net;tax=price*(tax/(tax+1));net=cb_number(price-tax,2);if(zcb_()&&price>marketPrice){offerDATA.price=marketPrice;$j('<i class="fa fa-exclamation-triangle cb-seller-price-warn" title="Your offer is above the market price of '+cb_number(marketPrice,2)+'"></i>').data('market',offerDATA).click(CRPK.plugins.ECONOMY.SELLER.add_more_to_offer).prependTo(price_cell).tipsy()}price_cell.append('<div class="cb-seller-taxes"><b contenteditable="true">'+net+'</b>cc; Tax: <i>'+cb_number(tax,2)+'</i>cc ('+tax_pct+'%)</div>');return!0},add_more_to_offer:function(){var _this=$j(this),offerDATA=_this.data('market'),imgq=in_array(offerDATA.industryID,CRPK.plugins.ECONOMY.SELLER.raw_industries)?'default':'q'+offerDATA.qualityID;$j("#sell_product").attr('src',EREP.base+'/images/icons/industry/'+offerDATA.industryID+'/'+imgq+'_30x30.png');$j('#market_licenses_select .ml_selector[country="'+offerDATA.countryID+'"]').click();$j('#sell_amount').val(1);$j("#sell_price").val(offerDATA.price);window['postOffer'].industryId=offerDATA.industryID;window['postOffer'].customization=offerDATA.qualityID;window['erepublik'].inventory['changeTax']();$j('#big_notifiers').hide();_this.parents('tr').find('a.share_offer').removeClass('blueColor').addClass('orangeColor').unbind().click(function(event){event.preventDefault();$j('#post_offer').trigger('click');$j(this).unbind().removeClass('orangeColor').addClass('blueColor').attr('title','Share offer').find('span').text('Share offer')}).attr('title','Add 1 more to offer').find('span').text('Update offer')},/*bind_ajax:function(){if(!CRPK.plugins.ECONOMY.SELLER._.bound){CRPK.plugins.ECONOMY.SELLER._.bound=!0;$j(document).ajaxSuccess(function (e,xhr,opts){$j('#sell_amount,#sell_price').val('');var r;if(instr(opts.url,'/deleteMarketOffer')){r=jsonp_parse(xhr,opts.url);if(CRPK.plugins.ECONOMY.SELLER.watcher.is_watched(r.token.offerId)){CRPK.plugins.ECONOMY.SELLER.watcher.unwatch_offer(r.token.offerId)}}else if(instr(opts.url,'/postMarketOffer')){r=jsonp_parse(xhr,opts.url);if(!r||r.message!='success'){return}r=r.token;setTimeout(function(){var old_offerID=r.oldOfferId?'_'+r.oldOfferId:false,offerID='_'+r.offerId;if(r.amount==1&&old_offerID&&CRPK.plugins.ECONOMY.SELLER.watcher.is_watched(old_offerID)){CRPK.plugins.ECONOMY.SELLER.watcher.unwatch_offer(old_offerID);return}if(!old_offerID){var market_id=r.countryId+'/'+r.industryId+'/'+r.customization;var input=$j('input[market="'+market_id+'"]');if($j(input).exists()){$j(input).parents('tr').remove();for (var oid in CRPK.plugins.ECONOMY.SELLER.opts.watchlist){if(CRPK.plugins.ECONOMY.SELLER.opts.watchlist.hasOwnProperty(oid)&&CRPK.plugins.ECONOMY.SELLER.opts.watchlist[oid].market==market_id){CRPK.plugins.ECONOMY.SELLER.watcher.unwatch_offer(oid)}}}}else{$j('input[id$="'+r['oldOfferId']+'"]').each(function(){var oid=$j(this).attr('id');$j(this).attr('id',oid.replace(r['oldOfferId'],r.offerId))});$j('#update'+offerID).hide();$j('#sell'+offerID).show();if(CRPK.plugins.ECONOMY.SELLER.watcher.is_watched(old_offerID)){CRPK.plugins.ECONOMY.SELLER.watcher.unwatch_offer(old_offerID);if(r.amount>1&&r['remainingStock']>1){CRPK.plugins.ECONOMY.SELLER.watcher.watch_offer(offerID)}}}CRPK.plugins.ECONOMY.SELLER.parse_offer(r.offerId)},500)}})}return CRPK.plugins.ECONOMY.SELLER._.bound},current_price_tooltip:function(){$j('#sell_offers>div.sell_selector>div.resource_list>a,'+'#sell_offers > div.sell_selector > div.star_selector  > div.stars > a'+'#market_licenses_select .ml_selector').click()},timeout_set:false,set_win_timeout:function(){if(CRPK.plugins.ECONOMY.SELLER.timeout_set){return}CRPK.plugins.ECONOMY.SELLER.timeout_set=!0;clear_all_win_timeouts();set_win_timeout(CRPK.plugins.ECONOMY.SELLER.polling_interval,EREP.storage)},getopts:function(){$j.extend(CRPK.plugins.ECONOMY.SELLER.opts,WS.get('CRPK.plugins.ECONOMY.SELLER',{}))},setopts:function(){WS.set('CRPK.plugins.ECONOMY.SELLER',CRPK.plugins.ECONOMY.SELLER.opts)},watcher:{_:{},init:function(){if(!CRPK.plugins.ECONOMY.SELLER.watcher_running){CRPK.plugins.ECONOMY.SELLER.set_win_timeout();CRPK.plugins.ECONOMY.SELLER.watcher_running=!0;page_title('Market Watch :: ON')}var _now=intval(now());for (var offerID in CRPK.plugins.ECONOMY.SELLER.opts.watchlist){if(!CRPK.plugins.ECONOMY.SELLER.opts.watchlist.hasOwnProperty(offerID)){continue}if(!$j('#offer'+offerID).exists()){if(false&&dev_()){alert('unwatch 2 :: '+offerID)}CRPK.plugins.ECONOMY.SELLER.watcher.unwatch_offer(offerID);continue}var _item=CRPK.plugins.ECONOMY.SELLER.opts.watchlist[offerID];if(intval(_item.ts+CRPK.plugins.ECONOMY.SELLER.polling_interval)>_now){continue}CRPK.plugins.ECONOMY.SELLER.opts.watchlist[offerID].ts=_now;CRPK.plugins.ECONOMY.SELLER.watcher.check_price(_item)}if(Object.keys(CRPK.plugins.ECONOMY.SELLER.opts.watchlist).length>0){setTimeout(function(){CRPK.plugins.ECONOMY.SELLER.watcher.init()},seconds(30))}},is_watched:function (offerID){if(is_numeric(offerID)||!instr(offerID,'_')){offerID='_'+offerID}return typeof(CRPK.plugins.ECONOMY.SELLER.opts.watchlist[offerID])!=_u},watch_offer:function (offerID){if(is_numeric(offerID)||!instr(offerID,'_')){offerID='_'+offerID}clog('CRPK.plugins.ECONOMY.SELLER.watcher.watch_offer :: '+offerID);var input=$j('#minprice'+offerID),min_price=floatval($j(input).val(),0),market_id=$j(input).attr('market');if(!min_price){if(typeof(CRPK.plugins.ECONOMY.SELLER.opts.watchlist[offerID])!=_u){delete(CRPK.plugins.ECONOMY.SELLER.opts.watchlist[offerID]);CRPK.plugins.ECONOMY.SELLER.setopts()}return}if(typeof(CRPK.plugins.ECONOMY.SELLER.opts.watchlist[offerID])!=_u){CRPK.plugins.ECONOMY.SELLER.opts.watchlist[offerID].mprice=min_price}else{CRPK.plugins.ECONOMY.SELLER.opts.watchlist[offerID]={offerID:offerID,market:market_id,mprice:min_price,ts:0};if(!CRPK.plugins.ECONOMY.SELLER.watcher_running){CRPK.plugins.ECONOMY.SELLER.watcher.init()}}CRPK.plugins.ECONOMY.SELLER.setopts()},unwatch_offer:function (offerID){if(is_numeric(offerID)||!instr(offerID,'_')){offerID='_'+offerID}try{delete(CRPK.plugins.ECONOMY.SELLER.opts.watchlist[offerID])}catch(e){}CRPK.plugins.ECONOMY.SELLER.setopts()},my_price:function (offerID){if(is_numeric(offerID)||!instr(offerID,'_')){offerID='_'+offerID}return floatval($j('#offer'+offerID+' td.offer_price strong').text())},check_price:function (_item){$j.ajax({type:'GET',url:EREP.market+_item.market,global:false,success:function (response){response='<div>'+response.split('<div id="marketplace">')[1];var PRICES={};$j(response).find('tbody.price_sorted tr').each(function(){var seller_ID=intval($j(this).find('td.m_provider a').first().attr('href').split('profile/')[1]);if(seller_ID==getinfo('uid')){return!0}var price=$j(this).find('td.m_price').first().text().trim().split(' ')[0],amount=intval($j(this).find('td.m_stock').text());if(typeof(PRICES[price])==_u){PRICES[price]=0}PRICES[price]+=amount});var my_price=CRPK.plugins.ECONOMY.SELLER.my_price(_item.offerID),mkt_price=0,is_weapon=instr(_item.market,'/2/');for (var price in PRICES){if(!PRICES.hasOwnProperty(price)){continue}var float_price=floatval(price);if(float_price<_item.mprice||(is_weapon&&PRICES[price]<100)){continue}mkt_price=float_price;break}if(!mkt_price||mkt_price==my_price||mkt_price<_item.mprice){return}var update=$j('#update'+_item.offerID);update.unbind().find('b').text(cb_number(mkt_price,2));if(CRPK.plugins.ECONOMY.SELLER.auto_update()){clog('Triggering Auto-Update :: '+_item.offerID);CRPK.plugins.ECONOMY.SELLER.update(_item.market,mkt_price)}else{$j('#sell'+_item.offerID).hide();$j(update).click(function(){CRPK.plugins.ECONOMY.SELLER.update(_item.market,mkt_price);$j('#post_offer').click();$j(this).unbind().hide();$j('#sell'+_item.offerID).show()}).show()}}})},update:function (market_id,new_price){var data=market_id.split('/'),country_id=data[0],industry=intval(data[1]),quality=intval(data[2]),imgq=in_array(industry,CRPK.plugins.ECONOMY.SELLER.raw_industries)?'default':'q'+quality;postOffer.industryId=industry;postOffer.customization=quality;$j("#sell_product").attr('src',EREP.base+'/images/icons/industry/'+industry+'/'+imgq+'_30x30.png');$j('#market_licenses_select .ml_selector[country="'+country_id+'"]').click();$j('#sell_amount').val(1);$j("#sell_price").val(new_price);erepublik.inventory.changeTax();if(CRPK.plugins.ECONOMY.SELLER.auto_update()){$j('#post_offer').click()}}}*/};PLUGINS['economy']={f:CRPK.plugins.ECONOMY.init,p:false};PLUGINS['seller']={f:CRPK.plugins.ECONOMY.SELLER.init,p:['storage']}}}catch (pluginError){console.error('Plugin load ERROR');debug_(pluginError);hasPluginError = true};try{/*============ Plugin: Employer*/if(typeof(CB_EREP_LIBRARY_LOADED)!=_u){var EMPLOYER={days:[],init:function(){EMPLOYER.employees_btn();if(!is_page('/manage-employees')){return}EMPLOYER.employees_header();EMPLOYER.easy_fire();EMPLOYER.day_labels();EMPLOYER.work_units();EMPLOYER.bulk_updater_control();EMPLOYER.employees_mailer();EMPLOYER.bulk_fire_inactives_button()},employees_mailer:function(){if(!$j('#employees_mailer').exists()){var anchor=$j('#cb_employees_header'),button=cb_std('Employees MASS Mail','purple');if(anchor.exists()){button.appendTo(anchor)}else{anchor=$j('#content>div.internal_content div.area.employees');button.css('float','right').prependTo(anchor)}button.click(function(){if(typeof(CRPK.plugins.MAILER)==_u||!is_valid_auth_key_('mailer')){return alert('MAILER plugin (and auth key) required')}var recipients=$j('#content>div.internal_content div.employee_info.c1>a.employee_entry').map(function(){return intval($j(this).attr('href').split('/profile/')[1])}).get();return gto(EREP.url+'/main/messages-compose/0?qdata='+JSON.stringify({list:recipients,grouped:0}))});return!1}},employees_btn:function(){$j('#content .top_tabs').append('<li><a href="'+EREP.url+'/economy/manage-employees/1" class="storage'+(is_page('/manage-employees')?' selected':'')+'" title="Manage Employees" original-title="Manage Employees"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAAgCAMAAACMyGAQAAAAA3NCSVQICAjb4U/gAAADAFBMVEX////////Y4+bk1L7z0lvT0cittriktsLhpYnIlZWRkZHTe3BaWlqNEBL56bTn5+fX19f30HbGx8S/v7/ppm+brrWgoKaZmZlmZmZRWGtKSkozMzMqKir/1rj24TDX19fz0lutrKqSqrLIlZXCdXG/v7/Bv7itrKrqpSSZmZnCdXF6e3tmZmb33kj20m+ttriMjIxCQkT87mb43jfT0ci4zdXBv7iRkZG1ZmVzc3ObRUjnvqLzvRmqusDnrlTMd27CdXGUfXBzc3NqamrBv7iqusBzc3NLWV343jf/vifBv7ibrrWlWlDT0cj4zx/3wZzGx8R6e3tqamr8w6a0tq+htb59prSEhITFaWBzc3NqamqyPjj87mbd3NCbrrWSqrJ6e3tmZmZaWlq7QSr/7zH10cDrp32EhIRzc3NmZmayPjje3dj94TL43jfT0cjRz8KqusDnrlTrp33xonLqpSSSqrJ6e3tzc3NqampmZmZaWlpKSkohICH/////++j/+fX/7d3/7s/u7+/u7ub/5tL78HHn5+fp59756Zz/7zH54dH/3cT55nLj4NP/2Lza4N7u28j/1rjd3ND/1qv10cDX19f/zqjk1L793gDc1bzO1MPY0bjT0cjz0lv/xZz8w6b/wpL/wJX3wZzPyrLSyqj/vYvPyK/8t4v2xBPbvaj4tYjxtI/+r37BvKrctJX8tQD5qXr/pnPNsaCktsLvtADrp32htb7xonLppEutrKroqwDPpYfxnGyUrrvok2OJprTIlZV9prTbjGKZmZnikgPaiVnWhnXJjGGEmKJsnrDXg1Kbj33RgVKMjIylhG3MekyEhIS0eFd5g4iae2bJa116e3tlfoaWc12adC1zc3N5cWmEb2GEZ1NqampmZma+UEBtYVbQQyNaWlq7QSplVUZ9UDpLWV1SUlJKSkpASk+kLSJCQkQ2PEmtHg46OjqaGxmoFxBIMCszMzM6MiykEAcqKiqNEBKiBgGQBwAhICGDAQATGR1tAAAXFhYICw8AAACsBaArAAABAHRSTlMAERERERERERERERERESIiIiIiIiIiIiIiIiIiIjMzMzMzMzMzRERERERERERVVVVVVWZmZmZmZmZmZnd3d3d3d3d3d4iIiIiZmZmZmaqqqqqqqru7u7u7u7u7u8zMzMzMzMzM3d3d3d3d3e7u7u7u7u7u7u7u7u7u7u7u7v//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////gCX04QAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNXG14zYAAAL3SURBVDiNpdB3WBJhHAfwa++9y/bee++997a9915mAZoUmWKhdaXYFRSCCkmh4gKVNK0cZ/pWV4l2WXd6ikaiQglhPf3HQT19/3vf5/d53t/3haD/S/OhU4b9E+i22fvq4WU9/h7U3X35qrsk5nSrPxd9pk/obVeM9rzs6SlJShrw+9hsw7PSH6Wb7JkFd2oSLlnYbsTg1lCTXZqiHyZT5cFGtGDUEUl4TFhY0tvPF3TGi/OXfMwzmaqqKssG0Yq73t6SsJi32i+FerNFh+uKSkrKyssry2fQirbTTkRFpRQX678VFOhx6vvXZzl5n0orKibR92iw554Qyc5/yWe6x1LVFgOHyWRHZF3oZKf6ahgRwQwmk8Xyy7dYjI94PD+pZqYdAE2+6SUVuvl4sdm8Dxaz8REMC+JOdbUnoOUnM0PZMI/n45eV9bn6BhOWqvc2tDNfb+y6DHWoDwLDMCJ/XPAOhsWa5NA59KD2WkV89n0RLBAIEIEyOZtxMyIzTRnyYE1rOjFVFal49T7jHowgArE67tql6zeUEVIhX3ZsHI04rlIpFImpQhbDSyRXy92s4r5IzH0o8w9aVNumUFhFpCoxFuEhUrUmRMa6Evwx8xpX9sD/YdAYm2LuGVWkKj4xNUSsTE57nGGMZgTkBV8PCAzg8/2X2l6r11YrSHz++n3aC/kbM0Wg3FscfvCThCBf7pb6tkmd4Yu3vf5SXJgSm2+uJkmj/inzds6nogQPziHa/4JWYiSle4p/N5AUhZGGd1yGBzfQg+Nru4g1QwAgSeoSYSYJggQorkc5vrJA7tEV3enEPAAICr1l1OE4oQMopsXH9+vXt3972p2g9QDgRKBMj2sJPQAY0OIj6Yd/ZTtACXAlWptL6bF0bY1wdiBWgXQciwZagw6kAxxYxU4HoqkzyMUxnZFIR60lUAwnXVs4INDE/WTNAygKcjGMIMkDDgXUctbGfWfPubict8Z1x+w2DkFNGvcc2MXJqUvnjh1q/dW8g/wEivielxvtrMoAAAAASUVORK5CYII=" alt="Manage Employees" id="cb_manage_emloyees" /><span>Employees</span></a></li>');var tabs=$j('#content .top_tabs li a');$j(tabs).css('width',Math.round(715/tabs.length)+'px')},employees_header:function(){var employees_header=$j('#cb_employees_header');if(employees_header.exists()){return}$j('<div class="cb_employees_header_wrap"><div id="cb_employees_header"></div> </div>').prependTo('div.manager_dashboard>div.list>div.area.employees');employees_header=$j('#cb_employees_header');employees_header.text('Sort employees by:');$j('<a class="employee_sorter" href="'+VOID+'">Salary DESC</a>').appendTo(employees_header).click(function(){var employees_wrap=$j('div.area.employees > div.listing_holder > div.list_group'),employees=employees_wrap.find('>div.listing');employees.sort(function (a,b){var as=floatval($j(a).find('input.field[id^="salary_value_"]').val()),bs=floatval($j(b).find('input.field[id^="salary_value_"]').val());return bs-as}).appendTo(employees_wrap)});employees_header.append(' |');$j('<a class="employee_sorter" href="'+VOID+'">Number of works DESC</a>').appendTo(employees_header).click(function(){var employees_wrap=$j('div.area.employees > div.listing_holder > div.list_group'),employees=employees_wrap.find('>div.listing');employees.sort(function (a,b){var aw=$j(a).find('div.employee_presence>div.working_days>span.worked>b'),bw=$j(b).find('div.employee_presence>div.working_days>span.worked>b'),as=0,bs=0;aw.each(function(){as+=intval($j(this).text())});bw.each(function(){bs+=intval($j(this).text())});return bs-as}).appendTo(employees_wrap)});employees_header.append('<div class="clear"></div>');return employees_header},day_labels:function(){var eday=getinfo('day')-7,work_days={},work_status={},salaries={},prezenta='',week_avg={mu:{t:0,wu:0,a:0},jm:{t:0,wu:0,a:0}},day,workers,total_workers,have_worked,d;for (d = 1; d <= 7; d++){day=eday+d;workers=$j('span.day'+d);work_days['day'+d]=day;salaries['day'+d]={t:0,c:0,wu:0};total_workers=$j(workers).length;EMPLOYER.days.push(day);have_worked=$j(workers).filter('.worked').length;$j(workers).filter('.worked').each(function(){var wu=intval($j(this).find('b').text().trim(),0),salary=floatval($j(this).parents('.listing').find('input[id^="old_salary_"]').val());if(salary<=10){week_avg.mu.wu+=wu;week_avg.mu.t+=wu*salary;return!0}salaries['day'+d].c++;salaries['day'+d].wu+=wu;salaries['day'+d].t+=wu*salary;week_avg.jm.wu+=wu;week_avg.jm.t+=wu*salary});if(have_worked<total_workers){work_status['day'+d]='<q>'+have_worked+'</q><small class="grey">/'+total_workers+'</small>'}else{work_status['day'+d]='<q class="xlsyellow">'+NBSP+total_workers+NBSP+'</q>'}}for (day in work_days){if(!work_days.hasOwnProperty(day)){continue}prezenta+='<span title="Non-MU/Clone Statistics:<br/>'+salaries[day].c+' workers<br>'+salaries[day].wu+' Work Units<br>'+cb_number(salaries[day].t/salaries[day].wu)+' cc / WU (average)<br>'+cb_number(salaries[day].t,2)+' cc Total Salaries'+'" class="'+day+' cb_employees_count">'+work_days[day]+'<br />'+work_status[day]+'</span>'}$j('#content div.c2').first().empty().attr('class','employee_presence c2').append('<div id="cb-work-summary" class="working_days">'+prezenta+'</div>');$j('#cb-work-summary span').tipsy({html:true,gravity:'s'});var week_text=cb_number(week_avg.jm.t/week_avg.jm.wu,2)+'cc';if(week_avg.mu.t>0){week_text+='<br />With MU Workers: '+cb_number((week_avg.jm.t+week_avg.mu.t)/(week_avg.jm.wu+week_avg.mu.wu),2)+'cc'}$j('#content > div.internal_content div.daily_budget>.c12>strong').css({'text-align':'right','padding-left':'250px'}).html('7 days average salary: '+week_text)},work_units:function(){$j('#content div.list_group div.employee_presence b').each(function(){var works=intval($j(this).text().trim());if(works>5){works='5-plus'}$j(this).addClass('cb-wu-'+works)})},easy_fire:function(){$j('#remove_mode').click();$j('a.fire_employee').unbind().click(function (e){e.preventDefault();var _this=$j(this),_id=intval(_this.attr('id').replace('fire_employee_',''));$j.ajax({url:EREP.ajax.fire,type:'POST',dataType:'json',async:false,data:{action_type:'fire',employeeId:_id,_token:getinfo('token')},success:function (data){if(!data.status){return gto()}else{_this.unbind();var _parent=_this.parents('div.listing');_parent.fadeTo('fast',0.3,function(){$j('#employee_name_'+_id).remove();var _employees=$j('#employees_used'),ce=_employees.text().split('/');_employees.text(intval(ce[0])-1+''+ce[1]);setTimeout(function(){window['recalculateDues']()},50)})}}})})},bulk_updater_control:function(){if(!$j('#cb-salary-updater-btn').exists()){var anchor=$j('#cb_employees_header');if(!anchor.exists()){anchor=$j('#content > div.internal_content div.active_offers:first()>div.c12>strong');anchor.css({'font-size':'10px','font-weight':'400'})}anchor.append('<q id="cb-bulk-salary-updater-wrapper" title="In case of *&lt;=* option, MU salaries<br>(under 15cc)<br>will be skipped">Bulk update salaries '+'<select id="cb-salary-updater-mod-if">'+'<option value="gte">&gt;=</option>'+'<option value="ee">=</option>'+'<option value="lte">&lt;=</option>'+'</select>'+'<input id="cb-salary-updater-mod-val" class="field" />'+NBSP+'to'+NBSP+'<input id="cb-salary-updater-to" class="field" />'+NBSP+'<a href="'+VOID+'" id="cb-salary-updater-btn" '+cb_std_class('tinySize')+'><span>Update</span></a></q>');$j('#cb-bulk-salary-updater-wrapper').tipsy({gravity:'s',html:true});$j('#cb-salary-updater-btn').click(function(){EMPLOYER.bulk_updater_control()});return}var mod_if=$j('#cb-salary-updater-mod-if').val(),mod_val=cb_number(floatval($j('#cb-salary-updater-mod-val').val(),0),2),mod_to=cb_number(floatval($j('#cb-salary-updater-to').val(),0),2);if(!mod_val||!mod_to){return alert('One or more invalid values :: Update *salaries '+(mod_if=='gte'?'>=':mod_if=='lte'?'<=':'==')+' '+mod_val+'* to '+mod_to)}if(!confirm('Update *salaries '+(mod_if=='gte'?'>=':mod_if=='lte'?'<=':'==')+' '+mod_val+'* to '+mod_to+' ?')){return!1}var employees=$j('input[id^="salary_value_"]').filter(function(){var curr_salary=floatval($j(this).val());switch(mod_if){case 'gte':return curr_salary>=mod_val;case 'lte':return curr_salary<=mod_val&&(zcb_()?curr_salary>15:1);default:return curr_salary==mod_val}}).map(function(){return $j(this).attr('id').replace('salary_value_','')}).get();var wait=0;EMPLOYER.bulk_updater.employees=employees;EMPLOYER.bulk_updater.salary=mod_to;EMPLOYER.bulk_updater.init()},employees_to_update:[],bulk_updater:{employees:[],salary:0,init:function(){if(EMPLOYER.bulk_updater.employees.length<1){return alert('Bulk Updater finished')}EMPLOYER.bulk_updater.update_salary(EMPLOYER.bulk_updater.employees.shift(),EMPLOYER.bulk_updater.salary)},update_salary:function (employeeID,salary){$j.ajax({url:EREP.url+'/economy/update-salary',type:'POST',dataType:'json',data:{action_type:'update_salary',employeeId:employeeID,salary:salary,_token:getinfo('token')}}).done(function (data){if(data&&data.status){$j('#old_salary_'+employeeID+',#salary_value_'+employeeID).val(salary);$j('#current_salary_'+employeeID).append(' -> '+salary).end().parent().parent().fadeTo('fast',0.3)}else{EMPLOYER.bulk_updater.employees.push(employeeID)}setTimeout(function(){EMPLOYER.bulk_updater.init()},rand(1000,1500))})}},update_salary:function (employeeID,new_salary,wait){if(!is_positive_int(wait)){wait=rand(500,1000)}setTimeout(function(){$j.ajax({url:EREP.url+'/economy/update-salary',type:'POST',dataType:'json',data:{action_type:'update_salary',employeeId:employeeID,salary:new_salary,_token:getinfo('token')},success:function (data){if(data&&data.status){var tmp=$j('#current_salary_'+employeeID);tmp.append(' -> '+new_salary);$j('#old_salary_'+employeeID+',#salary_value_'+employeeID).val(new_salary);tmp.parent().parent().fadeTo('fast',0.3)}else{console.log('update-salary','err?'.data);EMPLOYER.update_salary(employeeID,new_salary)}}})},wait)},bulk_fire_inactives_button:function(){if(!$j('#employeesFireInactives').exists()){var anchor=$j('#cb_employees_header'),button=cb_std('Fire inactives','orange #employeesFireInactives');if(anchor.exists()){button.appendTo(anchor)}else{anchor=$j('#content>div.internal_content div.area.employees');button.css('float','right').prependTo(anchor)}button.click(function(){EMPLOYER.bulk_fire_inactives()});return!1}},bulk_fire_inactives:function(){var employees_wrap=$j('div.area.employees > div.listing_holder > div.list_group'),employees=employees_wrap.find('>div.listing');employees.removeClass('bulkFireEmployees');employees.filter(function(){var _this=$j(this),salary=floatval(_this.find('input.field[id^="salary_value_"]').val()),workedDays,missedDays;if(salary<30){return!1}workedDays=_this.find('div.employee_presence>div.working_days>span.worked');if(workedDays.exists()){return!1}missedDays=_this.find('div.employee_presence>div.working_days>span').filter(':not(.worked):not(.nan)').length;return missedDays>=6}).addClass('bulkFireEmployees').css({background:'rgba(255,0,0,0.25)'});employees.sort(function (a,b){return $j(b).hasClass('bulkFireEmployees')-$j(a).hasClass('bulkFireEmployees')}).appendTo(employees_wrap);var numInactives=$j('#content > div.internal_content > div > div > div > div.listing_holder.remove > div.list_group > div.listing.bulkFireEmployees').length;if(numInactives<1){return!1}confirmationAlertCB('Fire selected ('+numInactives+') employees?',function(){var elems=$j('div.area.employees > div.listing_holder > div.list_group > div.listing.bulkFireEmployees a.fire_employee'),_token=getinfo('token'),timeout=100,_numEmployees=elems.length,humanMsg=window['humanMsg'];elems.each(function (index){var _this=$j(this),_id=intval(_this.attr('id').replace('fire_employee_',''));timeout+=500;(function (employeeID,_index,_timeout){setTimeout(function(){$j.ajax({url:EREP.ajax.fire,type:'POST',dataType:'json',async:false,data:{action_type:'fire',employeeId:employeeID,_token:_token},success:function (response){if(response.status){humanMsg.removeMsg();humanMsg.displayMsg('<strong>Firing </strong> :: <span>'+_index+'/'+_numEmployees+' ... </span>')}}})},_timeout)})(_id,index,timeout)});timeout+=3000;setTimeout(function(){humanMsg.removeMsg();humanMsg.displayMsg('<strong>Fired '+_numEmployees+' inactive employees</span>')},timeout)})}};PLUGINS['employer']={f:EMPLOYER.init,p:['manage-employees','storage','land','training-grounds']}}}catch (pluginError){console.error('Plugin load ERROR');debug_(pluginError);hasPluginError = true};try{/*============ Plugin: Donate Items helper*/if(typeof(CB_EREP_LIBRARY_LOADED)!=_u){OPTS.register('adonate','Auto Donate','Donate',1);OPTS.register('dlog','Enable Donations Log','Donate',1);var DLOG={limit:30,uid:2,uname:'Plato',KEY:'DLOG_',namesKEY:'DLOG_NAMES_',cleanupKEY:'DLOG_CLEANUP_',init:function(){'use strict';if(!OPTS.get('dlog','Donate')){return!0}DLOG.KEY+=getinfo('uid');DLOG.namesKEY+=getinfo('uid');DLOG.cleanupKEY+=getinfo('uid');DLOG.uid=intval(_URL_.replace(EREP.url+'/','').split('/')[2]);DLOG.uname=$j('#content > div.citizen_profile_header.auth > h2').textNodes().text().trim();DLOG.display();if(!is_page('economy/donate-')){return!0}DLOG.bind()},bound:false,bind:function(){'use strict';if(!is_page('economy/donate-')||DLOG.bound||DONATE.has_full_storage_error()){return!0}DLOG.bound=!0;if(is_page('economy/donate-money')){$j('#donateForm').submit(function(e){DLOG.log((62==intval($j('#donate_form_currencyId').val())?'g':'cc'),$j('#donate_form_amount').val())})}else{$j('#donateItemsForm').submit(function(e){DLOG.log($j('#donate_form_industryId').val()+'-'+$j('#donate_form_quality').val(),$j('#donate_form_amount').val())})}},display:function(){'use strict';DLOG.get();var _filtered=!is_page('my_profile'),_log=_filtered?DLOG.filter(DLOG.uid):DLOG._log,days=Object.keys(_log);if(days.length<1){return!0}$j('head').append('<link rel="stylesheet" href="'+https()+'www.google.com/uds/api/visualization/1.0/c3581c99759b4a64cb69ca21ab634266/table+en.css" />');var div=$j('<div class="country_charts show_overall"><div id="table_div" class="table_div"></div></div>').appendTo('#content'),table=$j('<table class="google-visualization-table-table" cellspacing="0" id="donations_log"></table>').appendTo('#table_div'),maxROWS=10;table.append('<thead><tr class="google-visualization-table-tr-head"><td class="google-visualization-table-th gradient" colspan="'+(_filtered?3:4)+'">'+'<h1>'+DLOG.limit+' days donations LOG'+(_filtered?': '+DLOG.uname:'')+'</h1>'+'</td></tr><tr class="google-visualization-table-tr-head">'+'<td class="google-visualization-table-th gradient" width="100">ERPK Day</td>'+(_filtered?'':'<td class="google-visualization-table-th gradient" width="200">To Whom</td>')+'<td class="google-visualization-table-th gradient">Donation Type &amp; Amount</td>'+'</tr></thead>');if(_filtered){table.append('<tfoot><tr>'+'<td class="google-visualization-table-td actions" colspan="3">'+'<a href="'+VOID+'" id="clear_uid_log">Delete donation history for '+DLOG.uname+'</a> | <a href="'+EREP.my_profile+'#footer">View all Your Donations</a></td>'+'</tr></tfoot>');$j('#clear_uid_log').click(function(){DLOG.clear_uid(DLOG.uid);$j('#table_div').fadeOut();gto(EREP.my_profile+'#footer')})}table.append('<tbody id="donations_log_summary"></tbody>');var eo='even',whats={1:'Food q',2:'Weapon(s) q',3:'Ticket(s) q'},tbody=$j('#donations_log_summary'),rows_c=0;days.sort(function(a,b){return b-a});for(var d=0;d<days.length;d++){var day=days[d];for(var uid in _log[day]){if(!_log[day].hasOwnProperty(uid)){continue}rows_c++;var _items=[];for(var i=0;i<_log[day][uid].length;i++){var what=_log[day][uid][i][0],qty=_log[day][uid][i][1];if(what.indexOf('-')>-1){var iq=what.split('-');what=INDUSTRIES.get_name(iq[0])+'(s) q'+iq[1]}_items.push(qty+' '+what)}tbody.append('<tr class="google-visualization-table-tr-'+eo+'">'+'<td class="google-visualization-table-td">'+(day==getinfo('day')?'Today':day)+'</td>'+(_filtered?'':'<td class="google-visualization-table-td"><a href="'+EREP.profile(uid)+'#footer">'+DLOG._names[uid]+'</a></td>')+'<td class="google-visualization-table-td">'+(_items.join(', '))+'</td>'+'</tr>');eo=('even'==eo?'odd':'even');if(rows_c==maxROWS){tbody.append('<tr id="expand_log_row" class="google-visualization-table-tr-'+eo+'">'+'<td class="actions" colspan="'+(_filtered?3:4)+'">'+cb_std_string(DOWN_ARR+' Expand log '+DOWN_ARR,'#expand_log red right')+'</tr>');table.append('<tbody id="donations_log_expanded" style="display:none"></tbody>');eo=('even'==eo?'odd':'even');tbody=$j('#donations_log_expanded')}}}$j('#expand_log').click(function(){$j('#expand_log_row').remove();$j('#donations_log_expanded').fadeIn('slow')})},_log:null,_names:{},log:function(what,amount){'use strict';DLOG.get();if(typeof(DLOG._names[DLOG.uid])==_u){DLOG._names[DLOG.uid]=DLOG.uname;LS.set(DLOG.namesKEY,DLOG._names)}if(typeof(DLOG._log[getinfo('day')][DLOG.uid])==_u){DLOG._log[getinfo('day')][DLOG.uid]=[]}DLOG._log[getinfo('day')][DLOG.uid].push([what,(intval(amount)==amount)?intval(amount):cb_number(amount)]);DLOG.save()},get:function(){'use strict';if(!DLOG._log){DLOG._log=LS.get(DLOG.KEY,{});DLOG._names=LS.get(DLOG.namesKEY,{})}if(typeof(DLOG._log[getinfo('day')])==_u){DLOG._log[getinfo('day')]={}}},filter:function(filterUID){'use strict';if(!filterUID||!is_numeric(filterUID)){filterUID=!1}var filtered={};if(filterUID){DLOG.get();for(var day in DLOG._log){if(typeof(DLOG._log[day][filterUID])!=_u){if(typeof(filtered[day])==_u){filtered[day]={}}filtered[day][filterUID]=DLOG._log[day][filterUID]}}}return filtered},save:function(){'use strict';DLOG.get();if(LS.get(DLOG.cleanupKEY,1)<getinfo('day')-2){DLOG.cleanup()}LS.save(DLOG.KEY,DLOG._log)},cleanup:function(){'use strict';var _limit=getinfo('day')-DLOG.limit;for(var day in DLOG._log){if(day<_limit){delete(DLOG._log[day])}}LS.set(DLOG.cleanupKEY,getinfo('day'))},clear:function(){'use strict';DLOG._log={};DLOG.save()},del_last_donation:function(){'use strict';DLOG.get();if(typeof(DLOG._log[getinfo('day')])==_u||typeof(DLOG._log[getinfo('day')][DLOG.uid])==_u){return!0}if(DLOG._log[getinfo('day')][DLOG.uid].length==1){delete(DLOG._log[getinfo('day')][DLOG.uid])}else{DLOG._log[getinfo('day')][DLOG.uid].pop()}DLOG.save()},clear_uid:function(filterUID){'use strict';if(!filterUID||!is_numeric(filterUID)){filterUID=!1}if(filterUID){DLOG.get();for(var day in DLOG._log){if(typeof(DLOG._log[day][filterUID])!=_u){delete(DLOG._log[day][filterUID])}}}DLOG.save()}},DONATE={action:false,what:false,wnames:false,_ps:false,_s:false,uid:false,uname:false,list:{},list_what:false,list_count:false,skipped:[],_table:false,_has_donated:false,init:function(){'use strict';if(is_page('inventory')){return DONATE.m_setup()}DONATE.uid=intval(_URL_.replace(EREP.url+'/','').split('/')[2]);DONATE.name=$j('#content > div.citizen_profile_header.auth > h2').textNodes().text().trim();DLOG.init();if(!is_page('/donate-')){return!0}DONATE.action=(is_page('/donate-money/')?'money':'items');if(LS.check('MDONATE')){DONATE.get()}var qty;if(instr(oURL,'_d=')){qty=oURL.toLowerCase().split('_d=')[1];if(!instr(qty,'x')){return!1}qty=qty.split('x');qty=cb_number(floatval(qty[0])*floatval(qty[1]),2);if(qty<10){return!0}DONATE.wnames={flags:qty+'cc'};DONATE.what={flags:qty};DONATE.save()}else if(instr(oURL,'#d=')){var what=oURL.toLowerCase().split('#d=')[1].split('+');DONATE.what={};DONATE.wnames={};for(var i=0;i<what.length;i++){var _item;if('money'==DONATE.action){_item=instr(what[i],'g')?'gold':(instr(what[i],'cc')?'flags':false);qty=cb_number(floatval(what[i].replace(_item,'')),2)}else{_item=instr(what[i],'we')||instr(what[i],'food')?1:(instr(what[i],'house')||instr(what[i],'h')?4:(instr(what[i],'ticket')||instr(what[i],'t')?3:instr(what[i],'weapon')||instr(what[i],'w')?2:2));if(1==_item){qty=intval(what[i].replace('we','').replace('food',''));_item+='/'}else{qty=what[i].split('q');_item+='/q'+qty[1];qty=intval(qty[0])}}if(!qty||!is_numeric(qty)){_q('Invalid qty: '+what[i]);continue}DONATE.wnames[_item]=what[i];DONATE.what[_item]=qty}DONATE.save()}else{DONATE.get()}if(DONATE.what&&!empty(DONATE.what)){return DONATE.do_action()}},has_error:function(){'use strict';var _table=$j('table.error_message,table.warning_message'),_error=!1;if(_table.exists()){_error=$j(_table).find('td').first().text();if(instr(_error,' seconds')){_error=!1}}return _error},has_storage_error:function(){'use strict';var _error=DONATE.has_error();return _error&&(instr(_error,'free slots')||instr(_error,'torage over capacity'))},has_full_storage_error:function(){'use strict';var _error=DONATE.has_error();return _error&&instr(_error,'torage over capacity')},do_action:function(){'use strict';if(empty(DONATE.what)){return _q('Nothing to donate')}DONATE.stock();var _table=$j('table.offers').first();var item_no=0;for(var _item in DONATE.what){if(!DONATE.what.hasOwnProperty(_item)){continue}item_no++;if(DONATE.is_donated(_item)){DONATE._has_donated=!0;delete(DONATE.what[_item]);continue}var qty=DONATE.what[_item];if(!DONATE.has_stock(_item,qty)){return _q('Insufficient '+('1/'==_item?'food':('flags'==_item?'cc':_item))+' stock. Refresh this page to continue (after ressuplying in another window)')}if('1/'==_item){for(var q=1;q<=7;q++){if(typeof(DONATE._s[_item+'q'+q])==_u||(2*q*DONATE._s[_item+'q'+q]<qty)){continue}_table.find('img[src*="'+_item+'q'+q+'"]').parents('tr').find('input[type="text"]').val(Math.ceil(qty/(q*2))).css('border','1px solid red').attr('auto',1).attr('wname',DONATE.wnames[_item])}}else{_table.find('img[src*="'+_item+'"]').parents('tr').find('input[type="text"]').val(qty).css('border','1px solid red').attr('auto',1).attr('wname',DONATE.wnames[_item])}}if(!DONATE.done()){DONATE.autodonate()}},stock:function(){'use strict';if(!DONATE._s&&is_page('/donate-')){DONATE._s={};$j('table.offers img').each(function(){var _this=$j(this),_src=_this.attr('src'),_item,quantity=intval(_this.parents('tr').find('td').eq(1).text());_item=('items'==DONATE.action?_src.split('/industry/')[1].replace('.png',''):(instr(_src,'gold')?'gold':'flags'));_item=_item.replace('_55x55','').replace('_stars','');DONATE._s[_item]=quantity})}return DONATE._s},is_donated:function(i){'use strict';var dead_or_banned=$j('#content>div.citizen_profile_header.auth>div.citizen_state img[src*="dead_citizen.png"],#content>div.citizen_profile_header.auth>div.citizen_state img[src*="perm_banned.png"]').exists();if(dead_or_banned||DONATE.has_storage_error()){DONATE.skipped.push(DONATE.uid);DONATE.message('Donate failed ('+(dead_or_banned?'dead or banned':'storage')+').',{class:'error'});return!0}if(!DONATE._ps){return!1}else if('1/'==i){for(var j in DONATE._ps){if(!instr(j,i)){continue}if(DONATE._ps[j]>DONATE._s[j]){return!0}}return!1}else if(typeof(DONATE._s[i])==_u){return!1}return(DONATE._ps[i]>DONATE._s[i])},has_stock:function(i,qty){'use strict';var sq;if('1/'==i){for(var j in DONATE._s){if(!instr(j,i)){continue}sq=intval(j.split('/q')[1]);if(DONATE._s[j]>qty/(sq*2)){return!0}}return!1}else{return(typeof(DONATE._s[i])!=_u&&is_numeric(DONATE._s[i])&&DONATE._s[i]>=qty)}},get:function(){'use strict';var k;if(LS.check('MDONATE')){var ls=LS.get('MDONATE');for(k in ls){if(ls.hasOwnProperty(k)){DONATE[k]=ls[k]}}}var win=WS.get('DONATE');if(win){for(k in win){if(win.hasOwnProperty(k)){DONATE[k]=win[k]}}}var skipped=WS.get('MDONATE_SKIPPED');if(skipped){DONATE.skipped=skipped}},save:function(){'use strict';var _what=null,_mdonate=null,_skipped=null;if(!empty(DONATE.what)){_what={'what':DONATE.what,'wnames':DONATE.wnames,'_ps':DONATE.stock()}}if(!empty(DONATE.list)){_mdonate={'list':DONATE.list,'list_what':DONATE.list_what,'list_count':DONATE.list_count}}WS.set('DONATE',_what);LS.set('MDONATE',_mdonate);if(!empty(DONATE.skipped)){WS.set('MDONATE_SKIPPED',DONATE.skipped)}},done:function(){'use strict';DONATE.progress();DONATE.save();if(!empty(DONATE.what)){return!1}if(empty(DONATE.list)){DONATE.ptitle();DONATE.message('Donate OK');return!0}if(in_array(DONATE.uid,DONATE.list)){DONATE.list.splice(DONATE.list.indexOf(DONATE.uid),1);DONATE.save()}if(empty(DONATE.list)){DONATE.ptitle('All '+DONATE.list_count+' done');DONATE.message('Multi-donate done ('+DONATE.list_count+' citizens)');if(!empty(DONATE.skipped)){DONATE.message(DONATE.skipped.length+' citizens were skipped (storage/dead/banned errors?):<br />'+DONATE.skipped.join(', '),{class:'error'})}return!0}var _st=(DONATE.list_count-DONATE.list.length)+1+'/'+DONATE.list_count;DONATE.ptitle('Moving to '+_st);DONATE.message('Moving to citizen '+_st,{timer:6});setTimeout(function(){gto(EREP.url+'/economy/donate-'+DONATE.action+'/'+DONATE.list[0]+'#d='+DONATE.list_what)},seconds(6));return!0},autodonate:function(){'use strict';if(!DONATE.auto()){return!1}var _table=$j('table.offers').first(),failed=(!DONATE._has_donated&&!instr(oURL,'#d=')),_timer=(DONATE._has_donated?4:(failed?1:0)),_first=$j('table.offers').first().find('input[auto="1"]').first(),_wname=_first.attr('wname');setTimeout(function(){_first.parents('tr').find('input.marketbtn').click()},(_timer?seconds(_timer):200));if('items'==DONATE.action){DONATE.message((failed?'Donate failed. Retrying :: ':'Auto-donating :: ')+_wname,{timer:_timer,class:(failed?'error':'warning')})}},auto:function(_set){'use strict';if(typeof(_set)!=_u){return OPTS.set('adonate','Donate',(_set?1:0))}return OPTS.get('adonate','Donate')},ptitle:function(t){'use strict';page_title(t?(!is_numeric(t)?t+' | MDonate':arr_count(DONATE.what)+'x '+DONATE.name+' | '+t):'OK: '+DONATE.name,!0)},m_setup:function(){'use strict';if($j('#mdonate_setup').exists()){return!0}var lwhat=LS.check('MDONATE_LWHAT')?LS.get('MDONATE_LWHAT'):'';$j('<div id="mdonate_setup">'+cb_std_string('','#mdonate_msg yellow hidden',null)+'<h1>Donate what ?</h1><input clear="both" value="'+lwhat+'" /> Basic syntax: <i>{Quantity}</i><b>{Industry}</b><i>{Quality}</i>; Example: 2wQ6 = 2 Weapons Q6<br>Other examples: (2wQ6, 2wQ6+1tQ7, 2wQ6+1tQ7+100we, 50cc) sau (50cc, 1g, 1g+50cc)<br clear="both" /><br /><h1>Recipiends list</h1><textarea style="width:720px;height:50px;"></textarea><br /><b>Format:</b> <i>ID list separated byt COMMA (,) or NEW LINE</i><br />PLAYER_ID,PLAYER_ID,PLAYER_ID,<br />PLAYER_ID,PLAYER_ID,<br />PLAYER_ID<p align="right">'+cb_std_string('Start donating','#mdonate_go green right hidden')+cb_std_string('Set parameters','#mdonate_do_setup yellow right')+'</p></div>').appendTo('#content');if(is_page('my_profile')){}else{$j('#content .top_tabs').append('<li><a id="mdonate_show" href="'+VOID+'" class="storage" original-title="Multi-Donate"><img src="'+SCRIPT_IMAGES+'mdonate-icon.png" alt="Multi-Donate" /><span>Multi Donate</span></a></li>');var tabs=$j('#content .top_tabs li a');$j(tabs).css('width',Math.round(715/tabs.length)+'px')}$j('#mdonate_show').click(function(){LS.del('MDONATE');$j('#mdonate_setup').show();$j('#mdonate_setup '+(lwhat?'textarea':'input')).focus()});$j('#mdonate_do_setup').click(function(){var _what=$j('#mdonate_setup input').val(),_text=$j('#mdonate_setup textarea').val(),_list=[];if(empty(_what)){$j('#mdonate_msg').removeClass('yellowColor greenColor').addClass('redColor').text('Nothing to donate').show().delay(seconds(5)).fadeOut();return!1}if(!empty(_text)){_list=uid_list_parser(_text)}if(empty(_list)){$j('#mdonate_msg').removeClass('yellowColor greenColor').addClass('redColor').text('No recipients').show().delay(seconds(5)).fadeOut();return!1}DONATE.list_what=_what;DONATE.list=_list;DONATE.list_count=_list.length;LS.set('MDONATE_LWHAT',_what);$j('#mdonate_msg').removeClass('yellowColor redColor').addClass('greenColor').text('Setup complete').show().delay(seconds(5)).fadeOut();$j('#mdonate_go').show()});$j('#mdonate_go').click(function(){DONATE.save();var donate_action='donate-items';if(DONATE.list_what.indexOf('cc')>-1||DONATE.list_what.indexOf('g')>-1){donate_action='donate-money'}return gto(EREP.url+'/economy/'+donate_action+'/'+DONATE.list[0]+'#d='+DONATE.list_what)})},message:function(_msg,args){'use strict';var _class='warning',_timer=!1,_timer_id=!1;if(args){if(args.class){_class=args.class}if(args.timer){_timer=args.timer;_timer_id='auto_timer_'+rand(1,9999)}}$j('<table class="'+_class+'_message xlsred-border"><tr><td style="font-size:10pt;font-weight:bold">'+_msg+(_timer?' :: <b id="'+_timer_id+'">'+_timer+'</b> seconds&hellip;':'')+'</td></tr></table>').insertAfter('div.citizen_content.donate h2');if(_timer){var _set_title=!empty(DONATE.what);for(var t=(_timer-1);t>=0;t--){(function(timer){timer=cb_number(timer,1);setTimeout(function(){$j('#'+_timer_id).text(timer);if(_set_title){DONATE.ptitle(timer,!0)}},seconds(_timer-timer))})(t)}}},pbar:false,pbaranimate:false,progress:function(){'use strict';if(empty(DONATE.list)){return!0}$j('#content').prepend('<div id="cb_pbar"><div id="cb_pbar_bar"></div><div id="cb_pbar_text">0/?</div></div>');var items=0;if(!DONATE.pbar){$j('#cb_pbar_text').css({width:'200px',marginLeft:'-100px'});$j('#cb_pbar').fadeIn();items=DONATE.list_what.split('+').length;DONATE.pbar={t_citizens:DONATE.list_count,t_donations:DONATE.list_count*items,c_citizens:1+(DONATE.list_count-DONATE.list.length),c_donations:(DONATE.list_count-DONATE.list.length)*items+(empty(DONATE.what)?items:items-arr_count(DONATE.what))}}var _text='',_width='';if(DONATE.pbar.c_donations==DONATE.pbar.t_donations){_text='Multi-Donate done ('+DONATE.pbar.t_citizens+' citizens)';_width='100%'}else if(items>1){_text=DONATE.pbar.c_donations+'/'+DONATE.pbar.t_donations+' donations (citizen '+DONATE.pbar.c_citizens+'/'+DONATE.pbar.t_citizens+')';_width=cb_number(DONATE.pbar.c_donations*100/DONATE.pbar.t_donations,2)+'%'}else{_text='Citizen '+DONATE.pbar.c_citizens+'/'+DONATE.pbar.t_citizens;_width=cb_number(DONATE.pbar.c_citizens*100/DONATE.pbar.t_citizens,2)+'%'}$j('#cb_pbar_text').text(_text);if(DONATE.pbaranimate){$j('#cb_pbar_bar').animate({width:_width})}else{$j('#cb_pbar_bar').css({width:_width})}}};PLUGINS['donate']={f:DONATE.init,p:['/donate-items','/donate-money','citizen/profile','/inventory']}}}catch (pluginError){console.error('Plugin load ERROR');debug_(pluginError);hasPluginError = true};if(typeof(jQuery)=='undefined'||document.querySelector('#cf-wrapper,#cf_alert_div')!==null||document.title.indexOf('500 - Internal')>-1){if(typeof(clear_all_win_timeouts)=='function'){clear_all_win_timeouts()}if(document.URL.indexOf('erepublik.com')<0){return}var i,noWinReload=['.js','.png','.jpg','.gif','.css','main/warn','main/email-view-online','/economy/donate-','/js/','/css/','/images/','/nbp-stat','/battle-stat','-data/'];for (i = 0; i < noWinReload.length; i++){if(document.URL.indexOf(noWinReload[i])>0){return}}if(window.json||document.querySelector('html')===null){return}var is_nocache=document.URL.indexOf('_=nocache_')>-1,_timeoutRedirect='https:/'+'/www.erepublik.com/en?_=nocache_='+(new Date().getTime()),_timeoutSeconds=is_nocache?3:1;if(document.getElementById('cf-wrapper')!=null){_timeoutSeconds=60*5}else if(document.getElementById('cf_alert_div')!==null){_timeoutSeconds=is_nocache?5:1}else{var _content=document.getElementById('content');if(_content){_content=_content.innerHTML.toLowerCase();if(instr(_content,'page not found')){_timeoutSeconds=5}else if(instr(_content,'something went wrong')||instr(_content,'onnection timed out')){_timeoutSeconds=is_nocache?15:_timeoutSeconds}else if(instr(_content,'ccasionally there are a couple of things')){_timeoutSeconds=is_nocache?120:30}}}console.error('erepublik.com error encountered. Reloading (url='+_timeoutRedirect+') in '+_timeoutSeconds+' seconds');_timeoutSeconds*=1000;if(typeof(set_win_timeout)=='function'){set_win_timeout(_timeoutSeconds,_timeoutRedirect)}window.setTimeout(function(){window.location.href=_timeoutRedirect},_timeoutSeconds);return};if(typeof(jQuery)!=_u){jQuery.fn.exists=function(){return jQuery(this).length>0};if(typeof($j.fn.tipsy)==_u){$j.fn.tipsy=function(){return jQuery(this);}}jQuery.fn.reverse=[].reverse;jQuery.idle=function(timer,action){if(!action){return}if(!timer){timer=10000}jQuery.idle.aTID=window.setTimeout(action,timer);jQuery.idle.bTID=window.setTimeout(function(){jQuery('html').unbind('mousemove keydown')},timer);jQuery('html').bind('mousemove keydown',function(){window.clearTimeout(jQuery.idle.aTID);window.clearTimeout(jQuery.idle.bTID);jQuery.idle.aTID=window.setTimeout(action,timer);jQuery.idle.bTID=window.setTimeout(function(){jQuery('html').unbind('mousemove keydown')},timer)})};jQuery.fn.pulsar=function(command){if('stop'==command){jQuery(this).data('pulsar','off');return}if(!command||'start'==command){if(jQuery(this).data('pulsar')=='on'){return}jQuery(this).data('pulsar','on')}if(jQuery(this).data('pulsar')!='on'){return}jQuery(this).animate({opacity:.33},600,function(){jQuery(this).animate({opacity:1},800,function(){jQuery(this).delay(2000).pulsar(true)})})};jQuery.fn.image_pulse=function(){jQuery(this).animate({opacity:.33},1500,function(){jQuery(this).animate({opacity:1},1500,function(){jQuery(this).image_pulse()})})};jQuery.fn.blink=function(max,c){max=!max?3:max,c=!c?0:c;jQuery(this).animate({opacity:.33},100,function(){jQuery(this).animate({opacity:1},150,function(){c++;if(c<max){jQuery(this).blink(max,c)}})})};jQuery.fn.blinkFade=function(_func,count){count=!count?0:count,_func=_func||false;jQuery(this).animate({opacity:.33},100,function(){jQuery(this).animate({opacity:1},150,function(){count++;if(count<3){jQuery(this).blinkFade(_func||false,count);return}else{jQuery(this).fadeOut(300,function(){jQuery(this).remove();if(_func){_func()}})}})})};jQuery.expr[':'].icontains=jQuery.expr.createPseudo?(jQuery.expr.createPseudo(function(text){return function(elem){return(elem.textContent||elem.innerText||jQuery(elem).text()||'').toLowerCase().indexOf(text.toLowerCase())>-1}})):(function(elem,i,meta){return jQuery(elem).text().toLowerCase().indexOf(meta[3].toLowerCase())>-1});jQuery.expr[':'].imatch=jQuery.expr.createPseudo?(jQuery.expr.createPseudo(function(text){return function(elem){return(elem.textContent||elem.innerText||jQuery(elem).text()||'').toLowerCase()==text.toLowerCase()}})):(function(elem,i,meta){return jQuery(elem).text().trim().toLowerCase()===meta[3].toLowerCase()});jQuery.fn.prioHandler=function(type){type=type||'click',data=(jQuery(this).data('events')||jQuery._data(jQuery(this)[0])),handlers=(data.events&&data.events[type]?data.events[type]:[]);if(handlers.length<2){return}handlers.splice(0,0,handlers.pop())};jQuery.fn.textNodes=function(){return jQuery(this).contents().filter(function(){return this.nodeType===3})};if(typeof(jQuery.fn.scrollTo)==_u){jQuery.fn.scrollTo=jQuery.scrollTo=function(){jQuery('html,body').animate({scrollTop:jQuery(this).offset().top});return jQuery(this)}}jQuery.fn.hoverIntent=function(handlerIn,handlerOut,selector){var jqv=jQuery().jquery.split('.');if(jqv[0]==1&&jqv[1]<8){console.log('hover()');return jQuery(this).hover(handlerIn,handlerOut,selector)}var cfg={interval:100,sensitivity:15,timeout:100};if(typeof(handlerIn)==="object"){cfg=jQuery.extend(cfg,handlerIn)}else if(jQuery.isFunction(handlerOut)){cfg=jQuery.extend(cfg,{over:handlerIn,out:handlerOut,selector:selector})}else{cfg=jQuery.extend(cfg,{over:handlerIn,out:handlerIn,selector:handlerOut})}var cX,cY,pX,pY;var track=function(ev){cX=ev.pageX;cY=ev.pageY};var compare=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);if((Math.abs(pX-cX)+Math.abs(pY-cY))<cfg.sensitivity){jQuery(ob).off("mousemove.hoverIntent",track);ob.hoverIntent_s=1;return cfg.over.apply(ob,[ev])}else{pX=cX;pY=cY;ob.hoverIntent_t=setTimeout(function(){compare(ev,ob)},cfg.interval)}};var delay=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);ob.hoverIntent_s=0;return cfg.out.apply(ob,[ev])};var handleHover=function(e){var ev=jQuery.extend({},e);var ob=this;if(ob.hoverIntent_t){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t)}if(e.type=="mouseenter"){pX=ev.pageX;pY=ev.pageY;jQuery(ob).bind("mousemove.hoverIntent",track);if(ob.hoverIntent_s!=1){ob.hoverIntent_t=setTimeout(function(){compare(ev,ob)},cfg.interval)}}else{jQuery(ob).off("mousemove.hoverIntent",track);if(ob.hoverIntent_s==1){ob.hoverIntent_t=setTimeout(function(){delay(ev,ob)},cfg.timeout)}}};return this.bind({'mouseenter.hoverIntent':handleHover,'mouseleave.hoverIntent':handleHover},cfg.selector)};var DEBUGGER=1;/*DEBUGGER*//*START_NOMIN*/(function($){$.fn.extend({autocomplete:function(urlOrData,options){var isUrl=typeof urlOrData=='string';options=$.extend({},$._acs.defaults,{url:isUrl?urlOrData:null,data:isUrl?null:urlOrData,delay:isUrl?$._acs.defaults.delay:10,max:options&&!options.scroll?10:150},options);options.highlight=options.highlight||function(value){return value};options.formatMatch=options.formatMatch||options.formatItem;return this.each(function(){new $._acs(this,options)})},result:function(handler){return this.bind('result',handler)},search:function(handler){return this.trigger('search',[handler])},flushCache:function(){return this.trigger('flushCache')},setOptions:function(options){return this.trigger('setOptions',[options])},unautocomplete:function(){return this.trigger('unautocomplete')}});$._acs=function(input,options){var KEY={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8};var $input=$(input).attr('autocomplete','off').addClass(options.inputClass);var timeout;var previousValue='';var cache=$._acs.Cache(options);var hasFocus=0;var lastKeyPressCode;var config={mouseDownOnSelect:false};var select=$._acs.Select(options,input,selectCurrent,config);var blockSubmit;$.browser.opera&&$(input.form).bind('submit.autocomplete',function(){if(blockSubmit){blockSubmit=false;return false}});$input.bind(($.browser.opera?'keypress':'keydown')+'.autocomplete',function(event){hasFocus=1;lastKeyPressCode=event.keyCode;switch(event.keyCode){case KEY.UP:event.preventDefault();if(select.visible())select.prev();else onChange(0,true);break;case KEY.DOWN:event.preventDefault();if(select.visible())select.next();else onChange(0,true);break;case KEY.PAGEUP:event.preventDefault();if(select.visible())select.pageUp();else onChange(0,true);break;case KEY.PAGEDOWN:event.preventDefault();if(select.visible())select.pageDown();else onChange(0,true);break;case options.multiple&&$.trim(options.multipleSeparator)==','&&KEY.COMMA:case KEY.TAB:case KEY.RETURN:if(selectCurrent()){event.preventDefault();blockSubmit=true;return false}break;case KEY.ESC:select.hide();break;default:clearTimeout(timeout);timeout=setTimeout(onChange,options.delay);break}}).focus(function(){hasFocus++}).blur(function(){hasFocus=0;if(!config.mouseDownOnSelect)hideResults()}).click(function(){if(hasFocus++>1&&!select.visible())onChange(0,true)}).bind('search',function(){var fn=arguments.length>1?arguments[1]:null;function findValueCallback(q,data){var result;if(data&&data.length)for(var i=0;i<data.length;i++)if(data[i].result.toLowerCase()==q.toLowerCase()){result=data[i];break}if(typeof fn=='function')fn(result);else $input.trigger('result',result&&[result.data,result.value])}$.each(trimWords($input.val()),function(i,value){request(value,findValueCallback,findValueCallback)})}).bind('flushCache',function(){cache.flush()}).bind('setOptions',function(){$.extend(options,arguments[1]);if('data'in arguments[1])cache.populate()}).bind('unautocomplete',function(){select.unbind();$input.unbind();$(input.form).unbind('.autocomplete')});function selectCurrent(){var selected=select.selected();if(!selected)return false;var v=selected.result;previousValue=v;if(options.multiple){var words=trimWords($input.val());if(words.length>1){var seperator=options.multipleSeparator.length;var cursorAt=$(input).selection().start;var wordAt,progress=0;$.each(words,function(i,word){progress+=word.length;if(cursorAt<=progress){wordAt=i;return false}progress+=seperator});words[wordAt]=v;v=words.join(options.multipleSeparator)}v+=options.multipleSeparator}$input.val(v);hideResultsNow();$input.trigger('result',[selected.data,selected.value]);return true}function onChange(crap,skipPrevCheck){if(lastKeyPressCode==KEY.DEL){select.hide();return}var currentValue=$input.val();if(!skipPrevCheck&&currentValue==previousValue)return;previousValue=currentValue;currentValue=lastWord(currentValue);if(currentValue.length>=options.minChars){$input.addClass(options.loadingClass);if(!options.matchCase)currentValue=currentValue.toLowerCase();request(currentValue,receiveData,hideResultsNow)}else{stopLoading();select.hide()}};function trimWords(value){if(!value)return[''];if(!options.multiple)return[$.trim(value)];return $.map(value.split(options.multipleSeparator),function(word){return $.trim(value).length?$.trim(word):null})}function lastWord(value){if(!options.multiple)return value;var words=trimWords(value);if(words.length==1)return words[0];var cursorAt=$(input).selection().start;if(cursorAt==value.length)words=trimWords(value);else words=trimWords(value.replace(value.substring(cursorAt),''));return words[words.length-1]}function autoFill(q,sValue){if(options.autoFill&&lastWord($input.val()).toLowerCase()==q.toLowerCase()&&lastKeyPressCode!=KEY.BACKSPACE){$input.val($input.val()+sValue.substring(lastWord(previousValue).length));$(input).selection(previousValue.length,previousValue.length+sValue.length)}}function hideResults(){clearTimeout(timeout);timeout=setTimeout(hideResultsNow,200)}function hideResultsNow(){var wasVisible=select.visible();select.hide();clearTimeout(timeout);stopLoading();if(options.mustMatch)$input.search(function(result){if(!result)if(options.multiple){var words=trimWords($input.val()).slice(0,-1);$input.val(words.join(options.multipleSeparator)+(words.length?options.multipleSeparator:''))}else{$input.val('');$input.trigger('result',null)}})}function receiveData(q,data){if(data&&data.length&&hasFocus){stopLoading();select.display(data,q);autoFill(q,data[0].value);select.show()}else hideResultsNow()}function request(term,success,failure){if(!options.matchCase)term=term.toLowerCase();var data=cache.load(term);if(data&&data.length)success(term,data);else if(typeof options.url=='string'&&options.url.length>0){var extraParams={timestamp:+new Date};$.each(options.extraParams,function(key,param){extraParams[key]=typeof param=='function'?param():param});$.ajax({mode:'abort',port:'autocomplete'+input.name,dataType:options.dataType,url:options.url,data:$.extend({q:lastWord(term),limit:options.max},extraParams),success:function(data){var parsed=options.parse&&options.parse(data)||parse(data);cache.add(term,parsed);success(term,parsed)}})}else{select.emptyList();failure(term)}};function parse(data){var parsed=[];var rows=data.split("\n");for(var i=0;i<rows.length;i++){var row=$.trim(rows[i]);if(row){row=row.split('|');parsed[parsed.length]={data:row,value:row[0],result:options.formatResult&&options.formatResult(row,row[0])||row[0]}}}return parsed}function stopLoading(){$input.removeClass(options.loadingClass)}};$._acs.defaults={inputClass:'ac_input',resultsClass:'ac_results',loadingClass:'ac_loading',minChars:1,delay:400,matchCase:false,matchSubset:true,matchContains:false,cacheLength:10,max:100,mustMatch:false,extraParams:{},selectFirst:true,formatItem:function(row){return row[0]},formatMatch:null,autoFill:false,width:0,multiple:false,multipleSeparator:', ',highlight:function(value,term){return value.replace(new RegExp('(?![^&;]+;)(?!<[^<>]*)('+term.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+')(?![^<>]*>)(?![^&;]+;)','gi'),"<strong>$1</strong>")},scroll:true,scrollHeight:180};$._acs.Cache=function(options){var data={};var length=0;function matchSubset(s,sub){if(!options.matchCase)s=s.toLowerCase();var i=s.indexOf(sub);if(options.matchContains=='word')i=s.toLowerCase().search("\\b"+sub.toLowerCase());if(i==-1)return false;return i==0||options.matchContains}function add(q,value){if(length>options.cacheLength)flush();if(!data[q])length++;data[q]=value}function populate(){if(!options.data)return false;var stMatchSets={},nullData=0;if(!options.url)options.cacheLength=1;stMatchSets['']=[];for(var i=0,ol=options.data.length;i<ol;i++){var rawValue=options.data[i];rawValue=typeof rawValue=='string'?[rawValue]:rawValue;var value=options.formatMatch(rawValue,i+1,options.data.length);if(value===false)continue;var firstChar=value.charAt(0).toLowerCase();if(!stMatchSets[firstChar])stMatchSets[firstChar]=[];var row={value:value,data:rawValue,result:options.formatResult&&options.formatResult(rawValue)||value};stMatchSets[firstChar].push(row);if(nullData++<options.max)stMatchSets[''].push(row)}$.each(stMatchSets,function(i,value){options.cacheLength++;add(i,value)})};setTimeout(populate,25);function flush(){data={};length=0}return{flush:flush,add:add,populate:populate,load:function(q){if(!options.cacheLength||!length)return null;if(!options.url&&options.matchContains){var csub=[];for(var k in data)if(k.length>0){var c=data[k];$.each(c,function(i,x){if(matchSubset(x.value,q))csub.push(x)})}return csub}else if(data[q])return data[q];else if(options.matchSubset)for(var i=q.length-1;i>=options.minChars;i--){var c=data[q.substr(0,i)];if(c){var csub=[];$.each(c,function(i,x){if(matchSubset(x.value,q))csub[csub.length]=x});return csub}}return null}}};$._acs.Select=function(options,input,select,config){var CLASSES={ACTIVE:'ac_over'};var listItems,active=-1,data,term='',needsInit=true,element,list;function init(){if(!needsInit)return;element=$('<div/>').hide().addClass(options.resultsClass).css('position','absolute').appendTo(document.body);list=$('<ul/>').appendTo(element).mouseover(function(event){if(target(event).nodeName&&target(event).nodeName.toUpperCase()=='LI'){active=$('li',list).removeClass(CLASSES.ACTIVE).index(target(event));$(target(event)).addClass(CLASSES.ACTIVE)}}).click(function(event){$(target(event)).addClass(CLASSES.ACTIVE);select();input.focus();return false}).mousedown(function(){config.mouseDownOnSelect=true}).mouseup(function(){config.mouseDownOnSelect=false});if(options.width>0)element.css('width',options.width);needsInit=false}function target(event){var element=event.target;while(element&&element.tagName!='LI')element=element.parentNode;if(!element)return[];return element}function moveSelect(step){listItems.slice(active,active+1).removeClass(CLASSES.ACTIVE);movePosition(step);var activeItem=listItems.slice(active,active+1).addClass(CLASSES.ACTIVE);if(options.scroll){var offset=0;listItems.slice(0,active).each(function(){offset+=this.offsetHeight});if(offset+activeItem[0].offsetHeight-list.scrollTop()>list[0].clientHeight)list.scrollTop(offset+activeItem[0].offsetHeight-list.innerHeight());else if(offset<list.scrollTop())list.scrollTop(offset)}};function movePosition(step){active+=step;if(active<0)active=listItems.size()-1;else if(active>=listItems.size())active=0}function limitNumberOfItems(available){return options.max&&options.max<available?options.max:available}function fillList(){list.empty();var max=limitNumberOfItems(data.length);for(var i=0;i<max;i++){if(!data[i])continue;var formatted=options.formatItem(data[i].data,i+1,max,data[i].value,term);if(formatted===false)continue;var li=$('<li/>').html(options.highlight(formatted,term)).addClass(i%2==0?'ac_even':'ac_odd').appendTo(list)[0];$.data(li,'ac_data',data[i])}listItems=list.find('li');if(options.selectFirst){listItems.slice(0,1).addClass(CLASSES.ACTIVE);active=0}if($.fn.bgiframe)list.bgiframe()}return{display:function(d,q){init();data=d;term=q;fillList()},next:function(){moveSelect(1)},prev:function(){moveSelect(-1)},pageUp:function(){if(active!=0&&active-8<0)moveSelect(-active);else moveSelect(-8)},pageDown:function(){if(active!=listItems.size()-1&&active+8>listItems.size())moveSelect(listItems.size()-1-active);else moveSelect(8)},hide:function(){element&&element.hide();listItems&&listItems.removeClass(CLASSES.ACTIVE);active=-1},visible:function(){return element&&element.is(':visible')},current:function(){return this.visible()&&(listItems.filter('.'+CLASSES.ACTIVE)[0]||options.selectFirst&&listItems[0])},show:function(){var offset=$(input).offset();element.css({width:typeof options.width=='string'||options.width>0?options.width:$(input).width(),top:offset.top+input.offsetHeight,left:offset.left}).show();if(options.scroll){list.scrollTop(0);list.css({maxHeight:options.scrollHeight,overflow:'auto'});if($.browser.msie&&typeof document.body.style.maxHeight==='undefined'){var listHeight=0;listItems.each(function(){listHeight+=this.offsetHeight});var scrollbarsVisible=listHeight>options.scrollHeight;list.css('height',scrollbarsVisible?options.scrollHeight:listHeight);if(!scrollbarsVisible)listItems.width(list.width()-parseInt(listItems.css('padding-left'))-parseInt(listItems.css('padding-right')))}}},selected:function(){var selected=listItems&&listItems.filter('.'+CLASSES.ACTIVE).removeClass(CLASSES.ACTIVE);return selected&&selected.length&&$.data(selected[0],'ac_data')},emptyList:function(){list&&list.empty()},unbind:function(){element&&element.remove()}}};$.fn.selection=function(start,end){if(start!==undefined)return this.each(function(){if(this.createTextRange){var selRange=this.createTextRange();if(end===undefined||start==end){selRange.move('character',start);selRange.select()}else{selRange.collapse(true);selRange.moveStart('character',start);selRange.moveEnd('character',end);selRange.select()}}else if(this.setSelectionRange)this.setSelectionRange(start,end);else if(this.selectionStart){this.selectionStart=start;this.selectionEnd=end}});var field=this[0];if(field.createTextRange){var range=document.selection.createRange(),orig=field.value,teststring='<->',textLength=range.text.length;range.text=teststring;var caretAt=field.value.indexOf(teststring);field.value=orig;this.selection(caretAt,caretAt+textLength);return{start:caretAt,end:caretAt+textLength}}else if(field.selectionStart!==undefined)return{start:field.selectionStart,end:field.selectionEnd}};})(jQuery);if(typeof(window['Select2'])=='undefined'){!function(a){"undefined"==typeof a.fn.each2&&a.extend(a.fn,{each2:function(b){for(var c=a([0]),d=-1,e=this.length;++d<e&&(c.context=c[0]=this[d])&&b.call(c[0],d,c)!==!1;);return this}})}(jQuery),function(a,b){"use strict";function n(a){var b,c,d,e;if(!a||a.length<1)return a;for(b="",c=0,d=a.length;d>c;c++)e=a.charAt(c),b+=m[e]||e;return b}function o(a,b){for(var c=0,d=b.length;d>c;c+=1)if(q(a,b[c]))return c;return-1}function p(){var b=a(l);b.appendTo("body");var c={width:b.width()-b[0].clientWidth,height:b.height()-b[0].clientHeight};return b.remove(),c}function q(a,c){return a===c?!0:a===b||c===b?!1:null===a||null===c?!1:a.constructor===String?a+""==c+"":c.constructor===String?c+""==a+"":!1}function r(b,c){var d,e,f;if(null===b||b.length<1)return[];for(d=b.split(c),e=0,f=d.length;f>e;e+=1)d[e]=a.trim(d[e]);return d}function s(a){return a.outerWidth(!1)-a.width()}function t(c){var d="keyup-change-value";c.on("keydown",function(){a.data(c,d)===b&&a.data(c,d,c.val())}),c.on("keyup",function(){var e=a.data(c,d);e!==b&&c.val()!==e&&(a.removeData(c,d),c.trigger("keyup-change"))})}function u(c){c.on("mousemove",function(c){var d=i;(d===b||d.x!==c.pageX||d.y!==c.pageY)&&a(c.target).trigger("mousemove-filtered",c)})}function v(a,c,d){d=d||b;var e;return function(){var b=arguments;window.clearTimeout(e),e=window.setTimeout(function(){c.apply(d,b)},a)}}function w(a){var c,b=!1;return function(){return b===!1&&(c=a(),b=!0),c}}function x(a,b){var c=v(a,function(a){b.trigger("scroll-debounced",a)});b.on("scroll",function(a){o(a.target,b.get())>=0&&c(a)})}function y(a){a[0]!==document.activeElement&&window.setTimeout(function(){var d,b=a[0],c=a.val().length;a.focus(),a.is(":visible")&&b===document.activeElement&&(b.setSelectionRange?b.setSelectionRange(c,c):b.createTextRange&&(d=b.createTextRange(),d.collapse(!1),d.select()))},0)}function z(b){b=a(b)[0];var c=0,d=0;if("selectionStart"in b)c=b.selectionStart,d=b.selectionEnd-c;else if("selection"in document){b.focus();var e=document.selection.createRange();d=document.selection.createRange().text.length,e.moveStart("character",-b.value.length),c=e.text.length-d}return{offset:c,length:d}}function A(a){a.preventDefault(),a.stopPropagation()}function B(a){a.preventDefault(),a.stopImmediatePropagation()}function C(b){if(!h){var c=b[0].currentStyle||window.getComputedStyle(b[0],null);h=a(document.createElement("div")).css({position:"absolute",left:"-10000px",top:"-10000px",display:"none",fontSize:c.fontSize,fontFamily:c.fontFamily,fontStyle:c.fontStyle,fontWeight:c.fontWeight,letterSpacing:c.letterSpacing,textTransform:c.textTransform,whiteSpace:"nowrap"}),h.attr("class","select2-sizer"),a("body").append(h)}return h.text(b.val()),h.width()}function D(b,c,d){var e,g,f=[];e=b.attr("class"),e&&(e=""+e,a(e.split(" ")).each2(function(){0===this.indexOf("select2-")&&f.push(this)})),e=c.attr("class"),e&&(e=""+e,a(e.split(" ")).each2(function(){0!==this.indexOf("select2-")&&(g=d(this),g&&f.push(g))})),b.attr("class",f.join(" "))}function E(a,b,c,d){var e=n(a.toUpperCase()).indexOf(n(b.toUpperCase())),f=b.length;return 0>e?(c.push(d(a)),void 0):(c.push(d(a.substring(0,e))),c.push("<span class='select2-match'>"),c.push(d(a.substring(e,e+f))),c.push("</span>"),c.push(d(a.substring(e+f,a.length))),void 0)}function F(a){var b={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return String(a).replace(/[&<>"'\/\\]/g,function(a){return b[a]})}function G(c){var d,e=null,f=c.quietMillis||100,g=c.url,h=this;return function(i){window.clearTimeout(d),d=window.setTimeout(function(){var d=c.data,f=g,j=c.transport||a.fn.select2.ajaxDefaults.transport,k={type:c.type||"GET",cache:c.cache||!1,jsonpCallback:c.jsonpCallback||b,dataType:c.dataType||"json"},l=a.extend({},a.fn.select2.ajaxDefaults.params,k);d=d?d.call(h,i.term,i.page,i.context):null,f="function"==typeof f?f.call(h,i.term,i.page,i.context):f,e&&e.abort(),c.params&&(a.isFunction(c.params)?a.extend(l,c.params.call(h)):a.extend(l,c.params)),a.extend(l,{url:f,dataType:c.dataType,data:d,success:function(a){var b=c.results(a,i.page);i.callback(b)}}),e=j.call(h,l)},f)}}function H(b){var d,e,c=b,f=function(a){return""+a.text};a.isArray(c)&&(e=c,c={results:e}),a.isFunction(c)===!1&&(e=c,c=function(){return e});var g=c();return g.text&&(f=g.text,a.isFunction(f)||(d=g.text,f=function(a){return a[d]})),function(b){var g,d=b.term,e={results:[]};return""===d?(b.callback(c()),void 0):(g=function(c,e){var h,i;if(c=c[0],c.children){h={};for(i in c)c.hasOwnProperty(i)&&(h[i]=c[i]);h.children=[],a(c.children).each2(function(a,b){g(b,h.children)}),(h.children.length||b.matcher(d,f(h),c))&&e.push(h)}else b.matcher(d,f(c),c)&&e.push(c)},a(c().results).each2(function(a,b){g(b,e.results)}),b.callback(e),void 0)}}function I(c){var d=a.isFunction(c);return function(e){var f=e.term,g={results:[]};a(d?c():c).each(function(){var a=this.text!==b,c=a?this.text:this;(""===f||e.matcher(f,c))&&g.results.push(a?this:{id:this,text:this})}),e.callback(g)}}function J(b,c){if(a.isFunction(b))return!0;if(!b)return!1;throw new Error(c+" must be a function or a falsy value")}function K(b){return a.isFunction(b)?b():b}function L(b){var c=0;return a.each(b,function(a,b){b.children?c+=L(b.children):c++}),c}function M(a,c,d,e){var h,i,j,k,l,f=a,g=!1;if(!e.createSearchChoice||!e.tokenSeparators||e.tokenSeparators.length<1)return b;for(;;){for(i=-1,j=0,k=e.tokenSeparators.length;k>j&&(l=e.tokenSeparators[j],i=a.indexOf(l),!(i>=0));j++);if(0>i)break;if(h=a.substring(0,i),a=a.substring(i+l.length),h.length>0&&(h=e.createSearchChoice.call(this,h,c),h!==b&&null!==h&&e.id(h)!==b&&null!==e.id(h))){for(g=!1,j=0,k=c.length;k>j;j++)if(q(e.id(h),e.id(c[j]))){g=!0;break}g||d(h)}}return f!==a?a:void 0}function N(b,c){var d=function(){};return d.prototype=new b,d.prototype.constructor=d,d.prototype.parent=b.prototype,d.prototype=a.extend(d.prototype,c),d}if(window.Select2===b){var c,d,e,f,g,h,j,k,i={x:0,y:0},c={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(a){switch(a=a.which?a.which:a){case c.LEFT:case c.RIGHT:case c.UP:case c.DOWN:return!0}return!1},isControl:function(a){var b=a.which;switch(b){case c.SHIFT:case c.CTRL:case c.ALT:return!0}return a.metaKey?!0:!1},isFunctionKey:function(a){return a=a.which?a.which:a,a>=112&&123>=a}},l="<div class='select2-measure-scrollbar'></div>",m={"\u24b6":"A","\uff21":"A","\xc0":"A","\xc1":"A","\xc2":"A","\u1ea6":"A","\u1ea4":"A","\u1eaa":"A","\u1ea8":"A","\xc3":"A","\u0100":"A","\u0102":"A","\u1eb0":"A","\u1eae":"A","\u1eb4":"A","\u1eb2":"A","\u0226":"A","\u01e0":"A","\xc4":"A","\u01de":"A","\u1ea2":"A","\xc5":"A","\u01fa":"A","\u01cd":"A","\u0200":"A","\u0202":"A","\u1ea0":"A","\u1eac":"A","\u1eb6":"A","\u1e00":"A","\u0104":"A","\u023a":"A","\u2c6f":"A","\ua732":"AA","\xc6":"AE","\u01fc":"AE","\u01e2":"AE","\ua734":"AO","\ua736":"AU","\ua738":"AV","\ua73a":"AV","\ua73c":"AY","\u24b7":"B","\uff22":"B","\u1e02":"B","\u1e04":"B","\u1e06":"B","\u0243":"B","\u0182":"B","\u0181":"B","\u24b8":"C","\uff23":"C","\u0106":"C","\u0108":"C","\u010a":"C","\u010c":"C","\xc7":"C","\u1e08":"C","\u0187":"C","\u023b":"C","\ua73e":"C","\u24b9":"D","\uff24":"D","\u1e0a":"D","\u010e":"D","\u1e0c":"D","\u1e10":"D","\u1e12":"D","\u1e0e":"D","\u0110":"D","\u018b":"D","\u018a":"D","\u0189":"D","\ua779":"D","\u01f1":"DZ","\u01c4":"DZ","\u01f2":"Dz","\u01c5":"Dz","\u24ba":"E","\uff25":"E","\xc8":"E","\xc9":"E","\xca":"E","\u1ec0":"E","\u1ebe":"E","\u1ec4":"E","\u1ec2":"E","\u1ebc":"E","\u0112":"E","\u1e14":"E","\u1e16":"E","\u0114":"E","\u0116":"E","\xcb":"E","\u1eba":"E","\u011a":"E","\u0204":"E","\u0206":"E","\u1eb8":"E","\u1ec6":"E","\u0228":"E","\u1e1c":"E","\u0118":"E","\u1e18":"E","\u1e1a":"E","\u0190":"E","\u018e":"E","\u24bb":"F","\uff26":"F","\u1e1e":"F","\u0191":"F","\ua77b":"F","\u24bc":"G","\uff27":"G","\u01f4":"G","\u011c":"G","\u1e20":"G","\u011e":"G","\u0120":"G","\u01e6":"G","\u0122":"G","\u01e4":"G","\u0193":"G","\ua7a0":"G","\ua77d":"G","\ua77e":"G","\u24bd":"H","\uff28":"H","\u0124":"H","\u1e22":"H","\u1e26":"H","\u021e":"H","\u1e24":"H","\u1e28":"H","\u1e2a":"H","\u0126":"H","\u2c67":"H","\u2c75":"H","\ua78d":"H","\u24be":"I","\uff29":"I","\xcc":"I","\xcd":"I","\xce":"I","\u0128":"I","\u012a":"I","\u012c":"I","\u0130":"I","\xcf":"I","\u1e2e":"I","\u1ec8":"I","\u01cf":"I","\u0208":"I","\u020a":"I","\u1eca":"I","\u012e":"I","\u1e2c":"I","\u0197":"I","\u24bf":"J","\uff2a":"J","\u0134":"J","\u0248":"J","\u24c0":"K","\uff2b":"K","\u1e30":"K","\u01e8":"K","\u1e32":"K","\u0136":"K","\u1e34":"K","\u0198":"K","\u2c69":"K","\ua740":"K","\ua742":"K","\ua744":"K","\ua7a2":"K","\u24c1":"L","\uff2c":"L","\u013f":"L","\u0139":"L","\u013d":"L","\u1e36":"L","\u1e38":"L","\u013b":"L","\u1e3c":"L","\u1e3a":"L","\u0141":"L","\u023d":"L","\u2c62":"L","\u2c60":"L","\ua748":"L","\ua746":"L","\ua780":"L","\u01c7":"LJ","\u01c8":"Lj","\u24c2":"M","\uff2d":"M","\u1e3e":"M","\u1e40":"M","\u1e42":"M","\u2c6e":"M","\u019c":"M","\u24c3":"N","\uff2e":"N","\u01f8":"N","\u0143":"N","\xd1":"N","\u1e44":"N","\u0147":"N","\u1e46":"N","\u0145":"N","\u1e4a":"N","\u1e48":"N","\u0220":"N","\u019d":"N","\ua790":"N","\ua7a4":"N","\u01ca":"NJ","\u01cb":"Nj","\u24c4":"O","\uff2f":"O","\xd2":"O","\xd3":"O","\xd4":"O","\u1ed2":"O","\u1ed0":"O","\u1ed6":"O","\u1ed4":"O","\xd5":"O","\u1e4c":"O","\u022c":"O","\u1e4e":"O","\u014c":"O","\u1e50":"O","\u1e52":"O","\u014e":"O","\u022e":"O","\u0230":"O","\xd6":"O","\u022a":"O","\u1ece":"O","\u0150":"O","\u01d1":"O","\u020c":"O","\u020e":"O","\u01a0":"O","\u1edc":"O","\u1eda":"O","\u1ee0":"O","\u1ede":"O","\u1ee2":"O","\u1ecc":"O","\u1ed8":"O","\u01ea":"O","\u01ec":"O","\xd8":"O","\u01fe":"O","\u0186":"O","\u019f":"O","\ua74a":"O","\ua74c":"O","\u01a2":"OI","\ua74e":"OO","\u0222":"OU","\u24c5":"P","\uff30":"P","\u1e54":"P","\u1e56":"P","\u01a4":"P","\u2c63":"P","\ua750":"P","\ua752":"P","\ua754":"P","\u24c6":"Q","\uff31":"Q","\ua756":"Q","\ua758":"Q","\u024a":"Q","\u24c7":"R","\uff32":"R","\u0154":"R","\u1e58":"R","\u0158":"R","\u0210":"R","\u0212":"R","\u1e5a":"R","\u1e5c":"R","\u0156":"R","\u1e5e":"R","\u024c":"R","\u2c64":"R","\ua75a":"R","\ua7a6":"R","\ua782":"R","\u24c8":"S","\uff33":"S","\u1e9e":"S","\u015a":"S","\u1e64":"S","\u015c":"S","\u1e60":"S","\u0160":"S","\u1e66":"S","\u1e62":"S","\u1e68":"S","\u0218":"S","\u015e":"S","\u2c7e":"S","\ua7a8":"S","\ua784":"S","\u24c9":"T","\uff34":"T","\u1e6a":"T","\u0164":"T","\u1e6c":"T","\u021a":"T","\u0162":"T","\u1e70":"T","\u1e6e":"T","\u0166":"T","\u01ac":"T","\u01ae":"T","\u023e":"T","\ua786":"T","\ua728":"TZ","\u24ca":"U","\uff35":"U","\xd9":"U","\xda":"U","\xdb":"U","\u0168":"U","\u1e78":"U","\u016a":"U","\u1e7a":"U","\u016c":"U","\xdc":"U","\u01db":"U","\u01d7":"U","\u01d5":"U","\u01d9":"U","\u1ee6":"U","\u016e":"U","\u0170":"U","\u01d3":"U","\u0214":"U","\u0216":"U","\u01af":"U","\u1eea":"U","\u1ee8":"U","\u1eee":"U","\u1eec":"U","\u1ef0":"U","\u1ee4":"U","\u1e72":"U","\u0172":"U","\u1e76":"U","\u1e74":"U","\u0244":"U","\u24cb":"V","\uff36":"V","\u1e7c":"V","\u1e7e":"V","\u01b2":"V","\ua75e":"V","\u0245":"V","\ua760":"VY","\u24cc":"W","\uff37":"W","\u1e80":"W","\u1e82":"W","\u0174":"W","\u1e86":"W","\u1e84":"W","\u1e88":"W","\u2c72":"W","\u24cd":"X","\uff38":"X","\u1e8a":"X","\u1e8c":"X","\u24ce":"Y","\uff39":"Y","\u1ef2":"Y","\xdd":"Y","\u0176":"Y","\u1ef8":"Y","\u0232":"Y","\u1e8e":"Y","\u0178":"Y","\u1ef6":"Y","\u1ef4":"Y","\u01b3":"Y","\u024e":"Y","\u1efe":"Y","\u24cf":"Z","\uff3a":"Z","\u0179":"Z","\u1e90":"Z","\u017b":"Z","\u017d":"Z","\u1e92":"Z","\u1e94":"Z","\u01b5":"Z","\u0224":"Z","\u2c7f":"Z","\u2c6b":"Z","\ua762":"Z","\u24d0":"a","\uff41":"a","\u1e9a":"a","\xe0":"a","\xe1":"a","\xe2":"a","\u1ea7":"a","\u1ea5":"a","\u1eab":"a","\u1ea9":"a","\xe3":"a","\u0101":"a","\u0103":"a","\u1eb1":"a","\u1eaf":"a","\u1eb5":"a","\u1eb3":"a","\u0227":"a","\u01e1":"a","\xe4":"a","\u01df":"a","\u1ea3":"a","\xe5":"a","\u01fb":"a","\u01ce":"a","\u0201":"a","\u0203":"a","\u1ea1":"a","\u1ead":"a","\u1eb7":"a","\u1e01":"a","\u0105":"a","\u2c65":"a","\u0250":"a","\ua733":"aa","\xe6":"ae","\u01fd":"ae","\u01e3":"ae","\ua735":"ao","\ua737":"au","\ua739":"av","\ua73b":"av","\ua73d":"ay","\u24d1":"b","\uff42":"b","\u1e03":"b","\u1e05":"b","\u1e07":"b","\u0180":"b","\u0183":"b","\u0253":"b","\u24d2":"c","\uff43":"c","\u0107":"c","\u0109":"c","\u010b":"c","\u010d":"c","\xe7":"c","\u1e09":"c","\u0188":"c","\u023c":"c","\ua73f":"c","\u2184":"c","\u24d3":"d","\uff44":"d","\u1e0b":"d","\u010f":"d","\u1e0d":"d","\u1e11":"d","\u1e13":"d","\u1e0f":"d","\u0111":"d","\u018c":"d","\u0256":"d","\u0257":"d","\ua77a":"d","\u01f3":"dz","\u01c6":"dz","\u24d4":"e","\uff45":"e","\xe8":"e","\xe9":"e","\xea":"e","\u1ec1":"e","\u1ebf":"e","\u1ec5":"e","\u1ec3":"e","\u1ebd":"e","\u0113":"e","\u1e15":"e","\u1e17":"e","\u0115":"e","\u0117":"e","\xeb":"e","\u1ebb":"e","\u011b":"e","\u0205":"e","\u0207":"e","\u1eb9":"e","\u1ec7":"e","\u0229":"e","\u1e1d":"e","\u0119":"e","\u1e19":"e","\u1e1b":"e","\u0247":"e","\u025b":"e","\u01dd":"e","\u24d5":"f","\uff46":"f","\u1e1f":"f","\u0192":"f","\ua77c":"f","\u24d6":"g","\uff47":"g","\u01f5":"g","\u011d":"g","\u1e21":"g","\u011f":"g","\u0121":"g","\u01e7":"g","\u0123":"g","\u01e5":"g","\u0260":"g","\ua7a1":"g","\u1d79":"g","\ua77f":"g","\u24d7":"h","\uff48":"h","\u0125":"h","\u1e23":"h","\u1e27":"h","\u021f":"h","\u1e25":"h","\u1e29":"h","\u1e2b":"h","\u1e96":"h","\u0127":"h","\u2c68":"h","\u2c76":"h","\u0265":"h","\u0195":"hv","\u24d8":"i","\uff49":"i","\xec":"i","\xed":"i","\xee":"i","\u0129":"i","\u012b":"i","\u012d":"i","\xef":"i","\u1e2f":"i","\u1ec9":"i","\u01d0":"i","\u0209":"i","\u020b":"i","\u1ecb":"i","\u012f":"i","\u1e2d":"i","\u0268":"i","\u0131":"i","\u24d9":"j","\uff4a":"j","\u0135":"j","\u01f0":"j","\u0249":"j","\u24da":"k","\uff4b":"k","\u1e31":"k","\u01e9":"k","\u1e33":"k","\u0137":"k","\u1e35":"k","\u0199":"k","\u2c6a":"k","\ua741":"k","\ua743":"k","\ua745":"k","\ua7a3":"k","\u24db":"l","\uff4c":"l","\u0140":"l","\u013a":"l","\u013e":"l","\u1e37":"l","\u1e39":"l","\u013c":"l","\u1e3d":"l","\u1e3b":"l","\u017f":"l","\u0142":"l","\u019a":"l","\u026b":"l","\u2c61":"l","\ua749":"l","\ua781":"l","\ua747":"l","\u01c9":"lj","\u24dc":"m","\uff4d":"m","\u1e3f":"m","\u1e41":"m","\u1e43":"m","\u0271":"m","\u026f":"m","\u24dd":"n","\uff4e":"n","\u01f9":"n","\u0144":"n","\xf1":"n","\u1e45":"n","\u0148":"n","\u1e47":"n","\u0146":"n","\u1e4b":"n","\u1e49":"n","\u019e":"n","\u0272":"n","\u0149":"n","\ua791":"n","\ua7a5":"n","\u01cc":"nj","\u24de":"o","\uff4f":"o","\xf2":"o","\xf3":"o","\xf4":"o","\u1ed3":"o","\u1ed1":"o","\u1ed7":"o","\u1ed5":"o","\xf5":"o","\u1e4d":"o","\u022d":"o","\u1e4f":"o","\u014d":"o","\u1e51":"o","\u1e53":"o","\u014f":"o","\u022f":"o","\u0231":"o","\xf6":"o","\u022b":"o","\u1ecf":"o","\u0151":"o","\u01d2":"o","\u020d":"o","\u020f":"o","\u01a1":"o","\u1edd":"o","\u1edb":"o","\u1ee1":"o","\u1edf":"o","\u1ee3":"o","\u1ecd":"o","\u1ed9":"o","\u01eb":"o","\u01ed":"o","\xf8":"o","\u01ff":"o","\u0254":"o","\ua74b":"o","\ua74d":"o","\u0275":"o","\u01a3":"oi","\u0223":"ou","\ua74f":"oo","\u24df":"p","\uff50":"p","\u1e55":"p","\u1e57":"p","\u01a5":"p","\u1d7d":"p","\ua751":"p","\ua753":"p","\ua755":"p","\u24e0":"q","\uff51":"q","\u024b":"q","\ua757":"q","\ua759":"q","\u24e1":"r","\uff52":"r","\u0155":"r","\u1e59":"r","\u0159":"r","\u0211":"r","\u0213":"r","\u1e5b":"r","\u1e5d":"r","\u0157":"r","\u1e5f":"r","\u024d":"r","\u027d":"r","\ua75b":"r","\ua7a7":"r","\ua783":"r","\u24e2":"s","\uff53":"s","\xdf":"s","\u015b":"s","\u1e65":"s","\u015d":"s","\u1e61":"s","\u0161":"s","\u1e67":"s","\u1e63":"s","\u1e69":"s","\u0219":"s","\u015f":"s","\u023f":"s","\ua7a9":"s","\ua785":"s","\u1e9b":"s","\u24e3":"t","\uff54":"t","\u1e6b":"t","\u1e97":"t","\u0165":"t","\u1e6d":"t","\u021b":"t","\u0163":"t","\u1e71":"t","\u1e6f":"t","\u0167":"t","\u01ad":"t","\u0288":"t","\u2c66":"t","\ua787":"t","\ua729":"tz","\u24e4":"u","\uff55":"u","\xf9":"u","\xfa":"u","\xfb":"u","\u0169":"u","\u1e79":"u","\u016b":"u","\u1e7b":"u","\u016d":"u","\xfc":"u","\u01dc":"u","\u01d8":"u","\u01d6":"u","\u01da":"u","\u1ee7":"u","\u016f":"u","\u0171":"u","\u01d4":"u","\u0215":"u","\u0217":"u","\u01b0":"u","\u1eeb":"u","\u1ee9":"u","\u1eef":"u","\u1eed":"u","\u1ef1":"u","\u1ee5":"u","\u1e73":"u","\u0173":"u","\u1e77":"u","\u1e75":"u","\u0289":"u","\u24e5":"v","\uff56":"v","\u1e7d":"v","\u1e7f":"v","\u028b":"v","\ua75f":"v","\u028c":"v","\ua761":"vy","\u24e6":"w","\uff57":"w","\u1e81":"w","\u1e83":"w","\u0175":"w","\u1e87":"w","\u1e85":"w","\u1e98":"w","\u1e89":"w","\u2c73":"w","\u24e7":"x","\uff58":"x","\u1e8b":"x","\u1e8d":"x","\u24e8":"y","\uff59":"y","\u1ef3":"y","\xfd":"y","\u0177":"y","\u1ef9":"y","\u0233":"y","\u1e8f":"y","\xff":"y","\u1ef7":"y","\u1e99":"y","\u1ef5":"y","\u01b4":"y","\u024f":"y","\u1eff":"y","\u24e9":"z","\uff5a":"z","\u017a":"z","\u1e91":"z","\u017c":"z","\u017e":"z","\u1e93":"z","\u1e95":"z","\u01b6":"z","\u0225":"z","\u0240":"z","\u2c6c":"z","\ua763":"z"};j=a(document),g=function(){var a=1;return function(){return a++}}(),j.on("mousemove",function(a){i.x=a.pageX,i.y=a.pageY}),d=N(Object,{bind:function(a){var b=this;return function(){a.apply(b,arguments)}},init:function(c){var d,e,f=".select2-results";this.opts=c=this.prepareOpts(c),this.id=c.id,c.element.data("select2")!==b&&null!==c.element.data("select2")&&c.element.data("select2").destroy(),this.container=this.createContainer(),this.containerId="s2id_"+(c.element.attr("id")||"autogen"+g()),this.containerSelector="#"+this.containerId.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1"),this.container.attr("id",this.containerId),this.body=w(function(){return c.element.closest("body")}),D(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.attr("style",c.element.attr("style")),this.container.css(K(c.containerCss)),this.container.addClass(K(c.containerCssClass)),this.elementTabIndex=this.opts.element.attr("tabindex"),this.opts.element.data("select2",this).attr("tabindex","-1").before(this.container).on("click.select2",A),this.container.data("select2",this),this.dropdown=this.container.find(".select2-drop"),D(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass),this.dropdown.addClass(K(c.dropdownCssClass)),this.dropdown.data("select2",this),this.dropdown.on("click",A),this.results=d=this.container.find(f),this.search=e=this.container.find("input.select2-input"),this.queryCount=0,this.resultsPage=0,this.context=null,this.initContainer(),this.container.on("click",A),u(this.results),this.dropdown.on("mousemove-filtered touchstart touchmove touchend",f,this.bind(this.highlightUnderEvent)),x(80,this.results),this.dropdown.on("scroll-debounced",f,this.bind(this.loadMoreIfNeeded)),a(this.container).on("change",".select2-input",function(a){a.stopPropagation()}),a(this.dropdown).on("change",".select2-input",function(a){a.stopPropagation()}),a.fn.mousewheel&&d.mousewheel(function(a,b,c,e){var f=d.scrollTop();e>0&&0>=f-e?(d.scrollTop(0),A(a)):0>e&&d.get(0).scrollHeight-d.scrollTop()+e<=d.height()&&(d.scrollTop(d.get(0).scrollHeight-d.height()),A(a))}),t(e),e.on("keyup-change input paste",this.bind(this.updateResults)),e.on("focus",function(){e.addClass("select2-focused")}),e.on("blur",function(){e.removeClass("select2-focused")}),this.dropdown.on("mouseup",f,this.bind(function(b){a(b.target).closest(".select2-result-selectable").length>0&&(this.highlightUnderEvent(b),this.selectHighlighted(b))})),this.dropdown.on("click mouseup mousedown",function(a){a.stopPropagation()}),a.isFunction(this.opts.initSelection)&&(this.initSelection(),this.monitorSource()),null!==c.maximumInputLength&&this.search.attr("maxlength",c.maximumInputLength);var h=c.element.prop("disabled");h===b&&(h=!1),this.enable(!h);var i=c.element.prop("readonly");i===b&&(i=!1),this.readonly(i),k=k||p(),this.autofocus=c.element.prop("autofocus"),c.element.prop("autofocus",!1),this.autofocus&&this.focus(),this.nextSearchTerm=b},destroy:function(){var a=this.opts.element,c=a.data("select2");this.close(),this.propertyObserver&&(delete this.propertyObserver,this.propertyObserver=null),c!==b&&(c.container.remove(),c.dropdown.remove(),a.removeClass("select2-offscreen").removeData("select2").off(".select2").prop("autofocus",this.autofocus||!1),this.elementTabIndex?a.attr({tabindex:this.elementTabIndex}):a.removeAttr("tabindex"),a.show())},optionToData:function(a){return a.is("option")?{id:a.prop("value"),text:a.text(),element:a.get(),css:a.attr("class"),disabled:a.prop("disabled"),locked:q(a.attr("locked"),"locked")||q(a.data("locked"),!0)}:a.is("optgroup")?{text:a.attr("label"),children:[],element:a.get(),css:a.attr("class")}:void 0},prepareOpts:function(c){var d,e,f,g,h=this;if(d=c.element,"select"===d.get(0).tagName.toLowerCase()&&(this.select=e=c.element),e&&a.each(["id","multiple","ajax","query","createSearchChoice","initSelection","data","tags"],function(){if(this in c)throw new Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.")}),c=a.extend({},{populateResults:function(d,e,f){var g,i=this.opts.id;g=function(d,e,j){var k,l,m,n,o,p,q,r,s,t;for(d=c.sortResults(d,e,f),k=0,l=d.length;l>k;k+=1)m=d[k],o=m.disabled===!0,n=!o&&i(m)!==b,p=m.children&&m.children.length>0,q=a("<li></li>"),q.addClass("select2-results-dept-"+j),q.addClass("select2-result"),q.addClass(n?"select2-result-selectable":"select2-result-unselectable"),o&&q.addClass("select2-disabled"),p&&q.addClass("select2-result-with-children"),q.addClass(h.opts.formatResultCssClass(m)),r=a(document.createElement("div")),r.addClass("select2-result-label"),t=c.formatResult(m,r,f,h.opts.escapeMarkup),t!==b&&r.html(t),q.append(r),p&&(s=a("<ul></ul>"),s.addClass("select2-result-sub"),g(m.children,s,j+1),q.append(s)),q.data("select2-data",m),e.append(q)},g(e,d,0)}},a.fn.select2.defaults,c),"function"!=typeof c.id&&(f=c.id,c.id=function(a){return a[f]}),a.isArray(c.element.data("select2Tags"))){if("tags"in c)throw"tags specified as both an attribute 'data-select2-tags' and in options of Select2 "+c.element.attr("id");c.tags=c.element.data("select2Tags")}if(e?(c.query=this.bind(function(a){var f,g,i,c={results:[],more:!1},e=a.term;i=function(b,c){var d;b.is("option")?a.matcher(e,b.text(),b)&&c.push(h.optionToData(b)):b.is("optgroup")&&(d=h.optionToData(b),b.children().each2(function(a,b){i(b,d.children)}),d.children.length>0&&c.push(d))},f=d.children(),this.getPlaceholder()!==b&&f.length>0&&(g=this.getPlaceholderOption(),g&&(f=f.not(g))),f.each2(function(a,b){i(b,c.results)}),a.callback(c)}),c.id=function(a){return a.id},c.formatResultCssClass=function(a){return a.css}):"query"in c||("ajax"in c?(g=c.element.data("ajax-url"),g&&g.length>0&&(c.ajax.url=g),c.query=G.call(c.element,c.ajax)):"data"in c?c.query=H(c.data):"tags"in c&&(c.query=I(c.tags),c.createSearchChoice===b&&(c.createSearchChoice=function(b){return{id:a.trim(b),text:a.trim(b)}}),c.initSelection===b&&(c.initSelection=function(b,d){var e=[];a(r(b.val(),c.separator)).each(function(){var b={id:this,text:this},d=c.tags;a.isFunction(d)&&(d=d()),a(d).each(function(){return q(this.id,b.id)?(b=this,!1):void 0}),e.push(b)}),d(e)}))),"function"!=typeof c.query)throw"query function not defined for Select2 "+c.element.attr("id");return c},monitorSource:function(){var c,d,a=this.opts.element;a.on("change.select2",this.bind(function(){this.opts.element.data("select2-change-triggered")!==!0&&this.initSelection()})),c=this.bind(function(){var c=a.prop("disabled");c===b&&(c=!1),this.enable(!c);var d=a.prop("readonly");d===b&&(d=!1),this.readonly(d),D(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.addClass(K(this.opts.containerCssClass)),D(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass),this.dropdown.addClass(K(this.opts.dropdownCssClass))}),a.on("propertychange.select2",c),this.mutationCallback===b&&(this.mutationCallback=function(a){a.forEach(c)}),d=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,d!==b&&(this.propertyObserver&&(delete this.propertyObserver,this.propertyObserver=null),this.propertyObserver=new d(this.mutationCallback),this.propertyObserver.observe(a.get(0),{attributes:!0,subtree:!1}))},triggerSelect:function(b){var c=a.Event("select2-selecting",{val:this.id(b),object:b});return this.opts.element.trigger(c),!c.isDefaultPrevented()},triggerChange:function(b){b=b||{},b=a.extend({},b,{type:"change",val:this.val()}),this.opts.element.data("select2-change-triggered",!0),this.opts.element.trigger(b),this.opts.element.data("select2-change-triggered",!1),this.opts.element.click(),this.opts.blurOnChange&&this.opts.element.blur()},isInterfaceEnabled:function(){return this.enabledInterface===!0},enableInterface:function(){var a=this._enabled&&!this._readonly,b=!a;return a===this.enabledInterface?!1:(this.container.toggleClass("select2-container-disabled",b),this.close(),this.enabledInterface=a,!0)},enable:function(a){a===b&&(a=!0),this._enabled!==a&&(this._enabled=a,this.opts.element.prop("disabled",!a),this.enableInterface())},disable:function(){this.enable(!1)},readonly:function(a){return a===b&&(a=!1),this._readonly===a?!1:(this._readonly=a,this.opts.element.prop("readonly",a),this.enableInterface(),!0)},opened:function(){return this.container.hasClass("select2-dropdown-open")},positionDropdown:function(){var t,u,v,w,x,b=this.dropdown,c=this.container.offset(),d=this.container.outerHeight(!1),e=this.container.outerWidth(!1),f=b.outerHeight(!1),g=a(window),h=g.width(),i=g.height(),j=g.scrollLeft()+h,l=g.scrollTop()+i,m=c.top+d,n=c.left,o=l>=m+f,p=c.top-f>=this.body().scrollTop(),q=b.outerWidth(!1),r=j>=n+q,s=b.hasClass("select2-drop-above");s?(u=!0,!p&&o&&(v=!0,u=!1)):(u=!1,!o&&p&&(v=!0,u=!0)),v&&(b.hide(),c=this.container.offset(),d=this.container.outerHeight(!1),e=this.container.outerWidth(!1),f=b.outerHeight(!1),j=g.scrollLeft()+h,l=g.scrollTop()+i,m=c.top+d,n=c.left,q=b.outerWidth(!1),r=j>=n+q,b.show()),this.opts.dropdownAutoWidth?(x=a(".select2-results",b)[0],b.addClass("select2-drop-auto-width"),b.css("width",""),q=b.outerWidth(!1)+(x.scrollHeight===x.clientHeight?0:k.width),q>e?e=q:q=e,r=j>=n+q):this.container.removeClass("select2-drop-auto-width"),"static"!==this.body().css("position")&&(t=this.body().offset(),m-=t.top,n-=t.left),r||(n=c.left+e-q),w={left:n,width:e},u?(w.bottom=i-c.top,w.top="auto",this.container.addClass("select2-drop-above"),b.addClass("select2-drop-above")):(w.top=m,w.bottom="auto",this.container.removeClass("select2-drop-above"),b.removeClass("select2-drop-above")),w=a.extend(w,K(this.opts.dropdownCss)),b.css(w)},shouldOpen:function(){var b;return this.opened()?!1:this._enabled===!1||this._readonly===!0?!1:(b=a.Event("select2-opening"),this.opts.element.trigger(b),!b.isDefaultPrevented())},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above"),this.dropdown.removeClass("select2-drop-above")},open:function(){return this.shouldOpen()?(this.opening(),!0):!1},opening:function(){var f,b=this.containerId,c="scroll."+b,d="resize."+b,e="orientationchange."+b;this.container.addClass("select2-dropdown-open").addClass("select2-container-active"),this.clearDropdownAlignmentPreference(),this.dropdown[0]!==this.body().children().last()[0]&&this.dropdown.detach().appendTo(this.body()),f=a("#select2-drop-mask"),0==f.length&&(f=a(document.createElement("div")),f.attr("id","select2-drop-mask").attr("class","select2-drop-mask"),f.hide(),f.appendTo(this.body()),f.on("mousedown touchstart click",function(b){var d,c=a("#select2-drop");c.length>0&&(d=c.data("select2"),d.opts.selectOnBlur&&d.selectHighlighted({noFocus:!0}),d.close({focus:!0}),b.preventDefault(),b.stopPropagation())})),this.dropdown.prev()[0]!==f[0]&&this.dropdown.before(f),a("#select2-drop").removeAttr("id"),this.dropdown.attr("id","select2-drop"),f.show(),this.positionDropdown(),this.dropdown.show(),this.positionDropdown(),this.dropdown.addClass("select2-drop-active");var g=this;this.container.parents().add(window).each(function(){a(this).on(d+" "+c+" "+e,function(){g.positionDropdown()})})},close:function(){if(this.opened()){var b=this.containerId,c="scroll."+b,d="resize."+b,e="orientationchange."+b;this.container.parents().add(window).each(function(){a(this).off(c).off(d).off(e)}),this.clearDropdownAlignmentPreference(),a("#select2-drop-mask").hide(),this.dropdown.removeAttr("id"),this.dropdown.hide(),this.container.removeClass("select2-dropdown-open").removeClass("select2-container-active"),this.results.empty(),this.clearSearch(),this.search.removeClass("select2-active"),this.opts.element.trigger(a.Event("select2-close"))}},externalSearch:function(a){this.open(),this.search.val(a),this.updateResults(!1)},clearSearch:function(){},getMaximumSelectionSize:function(){return K(this.opts.maximumSelectionSize)},ensureHighlightVisible:function(){var c,d,e,f,g,h,i,b=this.results;if(d=this.highlight(),!(0>d)){if(0==d)return b.scrollTop(0),void 0;c=this.findHighlightableChoices().find(".select2-result-label"),e=a(c[d]),f=e.offset().top+e.outerHeight(!0),d===c.length-1&&(i=b.find("li.select2-more-results"),i.length>0&&(f=i.offset().top+i.outerHeight(!0))),g=b.offset().top+b.outerHeight(!0),f>g&&b.scrollTop(b.scrollTop()+(f-g)),h=e.offset().top-b.offset().top,0>h&&"none"!=e.css("display")&&b.scrollTop(b.scrollTop()+h)}},findHighlightableChoices:function(){return this.results.find(".select2-result-selectable:not(.select2-disabled, .select2-selected)")},moveHighlight:function(b){for(var c=this.findHighlightableChoices(),d=this.highlight();d>-1&&d<c.length;){d+=b;var e=a(c[d]);if(e.hasClass("select2-result-selectable")&&!e.hasClass("select2-disabled")&&!e.hasClass("select2-selected")){this.highlight(d);break}}},highlight:function(b){var d,e,c=this.findHighlightableChoices();return 0===arguments.length?o(c.filter(".select2-highlighted")[0],c.get()):(b>=c.length&&(b=c.length-1),0>b&&(b=0),this.removeHighlight(),d=a(c[b]),d.addClass("select2-highlighted"),this.ensureHighlightVisible(),e=d.data("select2-data"),e&&this.opts.element.trigger({type:"select2-highlight",val:this.id(e),choice:e}),void 0)},removeHighlight:function(){this.results.find(".select2-highlighted").removeClass("select2-highlighted")},countSelectableResults:function(){return this.findHighlightableChoices().length},highlightUnderEvent:function(b){var c=a(b.target).closest(".select2-result-selectable");if(c.length>0&&!c.is(".select2-highlighted")){var d=this.findHighlightableChoices();this.highlight(d.index(c))}else 0==c.length&&this.removeHighlight()},loadMoreIfNeeded:function(){var c,a=this.results,b=a.find("li.select2-more-results"),d=this.resultsPage+1,e=this,f=this.search.val(),g=this.context;0!==b.length&&(c=b.offset().top-a.offset().top-a.height(),c<=this.opts.loadMorePadding&&(b.addClass("select2-active"),this.opts.query({element:this.opts.element,term:f,page:d,context:g,matcher:this.opts.matcher,callback:this.bind(function(c){e.opened()&&(e.opts.populateResults.call(this,a,c.results,{term:f,page:d,context:g}),e.postprocessResults(c,!1,!1),c.more===!0?(b.detach().appendTo(a).text(e.opts.formatLoadMore(d+1)),window.setTimeout(function(){e.loadMoreIfNeeded()},10)):b.remove(),e.positionDropdown(),e.resultsPage=d,e.context=c.context,this.opts.element.trigger({type:"select2-loaded",items:c}))})})))},tokenize:function(){},updateResults:function(c){function m(){d.removeClass("select2-active"),h.positionDropdown()}function n(a){e.html(a),m()}var g,i,l,d=this.search,e=this.results,f=this.opts,h=this,j=d.val(),k=a.data(this.container,"select2-last-term");if((c===!0||!k||!q(j,k))&&(a.data(this.container,"select2-last-term",j),c===!0||this.showSearchInput!==!1&&this.opened())){l=++this.queryCount;var o=this.getMaximumSelectionSize();if(o>=1&&(g=this.data(),a.isArray(g)&&g.length>=o&&J(f.formatSelectionTooBig,"formatSelectionTooBig")))return n("<li class='select2-selection-limit'>"+f.formatSelectionTooBig(o)+"</li>"),void 0;if(d.val().length<f.minimumInputLength)return J(f.formatInputTooShort,"formatInputTooShort")?n("<li class='select2-no-results'>"+f.formatInputTooShort(d.val(),f.minimumInputLength)+"</li>"):n(""),c&&this.showSearch&&this.showSearch(!0),void 0;if(f.maximumInputLength&&d.val().length>f.maximumInputLength)return J(f.formatInputTooLong,"formatInputTooLong")?n("<li class='select2-no-results'>"+f.formatInputTooLong(d.val(),f.maximumInputLength)+"</li>"):n(""),void 0;f.formatSearching&&0===this.findHighlightableChoices().length&&n("<li class='select2-searching'>"+f.formatSearching()+"</li>"),d.addClass("select2-active"),this.removeHighlight(),i=this.tokenize(),i!=b&&null!=i&&d.val(i),this.resultsPage=1,f.query({element:f.element,term:d.val(),page:this.resultsPage,context:null,matcher:f.matcher,callback:this.bind(function(g){var i;if(l==this.queryCount){if(!this.opened())return this.search.removeClass("select2-active"),void 0;if(this.context=g.context===b?null:g.context,this.opts.createSearchChoice&&""!==d.val()&&(i=this.opts.createSearchChoice.call(h,d.val(),g.results),i!==b&&null!==i&&h.id(i)!==b&&null!==h.id(i)&&0===a(g.results).filter(function(){return q(h.id(this),h.id(i))}).length&&g.results.unshift(i)),0===g.results.length&&J(f.formatNoMatches,"formatNoMatches"))return n("<li class='select2-no-results'>"+f.formatNoMatches(d.val())+"</li>"),void 0;e.empty(),h.opts.populateResults.call(this,e,g.results,{term:d.val(),page:this.resultsPage,context:null}),g.more===!0&&J(f.formatLoadMore,"formatLoadMore")&&(e.append("<li class='select2-more-results'>"+h.opts.escapeMarkup(f.formatLoadMore(this.resultsPage))+"</li>"),window.setTimeout(function(){h.loadMoreIfNeeded()},10)),this.postprocessResults(g,c),m(),this.opts.element.trigger({type:"select2-loaded",items:g})}})})}},cancel:function(){this.close()},blur:function(){this.opts.selectOnBlur&&this.selectHighlighted({noFocus:!0}),this.close(),this.container.removeClass("select2-container-active"),this.search[0]===document.activeElement&&this.search.blur(),this.clearSearch(),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus")},focusSearch:function(){y(this.search)},selectHighlighted:function(a){var b=this.highlight(),c=this.results.find(".select2-highlighted"),d=c.closest(".select2-result").data("select2-data");d?(this.highlight(b),this.onSelect(d,a)):a&&a.noFocus&&this.close()},getPlaceholder:function(){var a;return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder||((a=this.getPlaceholderOption())!==b?a.text():b)},getPlaceholderOption:function(){if(this.select){var a=this.select.children("option").first();if(this.opts.placeholderOption!==b)return"first"===this.opts.placeholderOption&&a||"function"==typeof this.opts.placeholderOption&&this.opts.placeholderOption(this.select);if(""===a.text()&&""===a.val())return a}},initContainerWidth:function(){function c(){var c,d,e,f,g,h;if("off"===this.opts.width)return null;if("element"===this.opts.width)return 0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px";if("copy"===this.opts.width||"resolve"===this.opts.width){if(c=this.opts.element.attr("style"),c!==b)for(d=c.split(";"),f=0,g=d.length;g>f;f+=1)if(h=d[f].replace(/\s/g,""),e=h.match(/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i),null!==e&&e.length>=1)return e[1];return"resolve"===this.opts.width?(c=this.opts.element.css("width"),c.indexOf("%")>0?c:0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px"):null}return a.isFunction(this.opts.width)?this.opts.width():this.opts.width}var d=c.call(this);null!==d&&this.container.css("width",d)}}),e=N(d,{createContainer:function(){var b=a(document.createElement("div")).attr({"class":"select2-container"}).html(["<a href='javascript:void(0)' onclick='return false;' class='select2-choice' tabindex='-1'>","<span class='select2-chosen'>&nbsp;</span><abbr class='select2-search-choice-close'></abbr>","<span class='select2-arrow'><b></b></span>","</a>","<input class='select2-focusser select2-offscreen' type='text'/>","<div class='select2-drop select2-display-none'>","<div class='select2-search'>","<input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input'/>","</div>","<ul class='select2-results'>","</ul>","</div>"].join(""));return b},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.focusser.prop("disabled",!this.isInterfaceEnabled())},opening:function(){var c,d,e;this.opts.minimumResultsForSearch>=0&&this.showSearch(!0),this.parent.opening.apply(this,arguments),this.showSearchInput!==!1&&this.search.val(this.focusser.val()),this.search.focus(),c=this.search.get(0),c.createTextRange?(d=c.createTextRange(),d.collapse(!1),d.select()):c.setSelectionRange&&(e=this.search.val().length,c.setSelectionRange(e,e)),""===this.search.val()&&this.nextSearchTerm!=b&&(this.search.val(this.nextSearchTerm),this.search.select()),this.focusser.prop("disabled",!0).val(""),this.updateResults(!0),this.opts.element.trigger(a.Event("select2-open"))},close:function(a){this.opened()&&(this.parent.close.apply(this,arguments),a=a||{focus:!0},this.focusser.removeAttr("disabled"),a.focus&&this.focusser.focus())},focus:function(){this.opened()?this.close():(this.focusser.removeAttr("disabled"),this.focusser.focus())},isFocused:function(){return this.container.hasClass("select2-container-active")},cancel:function(){this.parent.cancel.apply(this,arguments),this.focusser.removeAttr("disabled"),this.focusser.focus()},destroy:function(){a("label[for='"+this.focusser.attr("id")+"']").attr("for",this.opts.element.attr("id")),this.parent.destroy.apply(this,arguments)},initContainer:function(){var b,d=this.container,e=this.dropdown;this.opts.minimumResultsForSearch<0?this.showSearch(!1):this.showSearch(!0),this.selection=b=d.find(".select2-choice"),this.focusser=d.find(".select2-focusser"),this.focusser.attr("id","s2id_autogen"+g()),a("label[for='"+this.opts.element.attr("id")+"']").attr("for",this.focusser.attr("id")),this.focusser.attr("tabindex",this.elementTabIndex),this.search.on("keydown",this.bind(function(a){if(this.isInterfaceEnabled()){if(a.which===c.PAGE_UP||a.which===c.PAGE_DOWN)return A(a),void 0;switch(a.which){case c.UP:case c.DOWN:return this.moveHighlight(a.which===c.UP?-1:1),A(a),void 0;case c.ENTER:return this.selectHighlighted(),A(a),void 0;case c.TAB:return this.selectHighlighted({noFocus:!0}),void 0;case c.ESC:return this.cancel(a),A(a),void 0}}})),this.search.on("blur",this.bind(function(){document.activeElement===this.body().get(0)&&window.setTimeout(this.bind(function(){this.search.focus()}),0)})),this.focusser.on("keydown",this.bind(function(a){if(this.isInterfaceEnabled()&&a.which!==c.TAB&&!c.isControl(a)&&!c.isFunctionKey(a)&&a.which!==c.ESC){if(this.opts.openOnEnter===!1&&a.which===c.ENTER)return A(a),void 0;if(a.which==c.DOWN||a.which==c.UP||a.which==c.ENTER&&this.opts.openOnEnter){if(a.altKey||a.ctrlKey||a.shiftKey||a.metaKey)return;return this.open(),A(a),void 0}return a.which==c.DELETE||a.which==c.BACKSPACE?(this.opts.allowClear&&this.clear(),A(a),void 0):void 0}})),t(this.focusser),this.focusser.on("keyup-change input",this.bind(function(a){if(this.opts.minimumResultsForSearch>=0){if(a.stopPropagation(),this.opened())return;this.open()}})),b.on("mousedown","abbr",this.bind(function(a){this.isInterfaceEnabled()&&(this.clear(),B(a),this.close(),this.selection.focus())})),b.on("mousedown",this.bind(function(b){this.container.hasClass("select2-container-active")||this.opts.element.trigger(a.Event("select2-focus")),this.opened()?this.close():this.isInterfaceEnabled()&&this.open(),A(b)})),e.on("mousedown",this.bind(function(){this.search.focus()})),b.on("focus",this.bind(function(a){A(a)})),this.focusser.on("focus",this.bind(function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger(a.Event("select2-focus")),this.container.addClass("select2-container-active")})).on("blur",this.bind(function(){this.opened()||(this.container.removeClass("select2-container-active"),this.opts.element.trigger(a.Event("select2-blur")))})),this.search.on("focus",this.bind(function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger(a.Event("select2-focus")),this.container.addClass("select2-container-active")})),this.initContainerWidth(),this.opts.element.addClass("select2-offscreen"),this.setPlaceholder()},clear:function(b){var c=this.selection.data("select2-data");if(c){var d=a.Event("select2-clearing");if(this.opts.element.trigger(d),d.isDefaultPrevented())return;var e=this.getPlaceholderOption();this.opts.element.val(e?e.val():""),this.selection.find(".select2-chosen").empty(),this.selection.removeData("select2-data"),this.setPlaceholder(),b!==!1&&(this.opts.element.trigger({type:"select2-removed",val:this.id(c),choice:c}),this.triggerChange({removed:c}))}},initSelection:function(){if(this.isPlaceholderOptionSelected())this.updateSelection(null),this.close(),this.setPlaceholder();else{var c=this;this.opts.initSelection.call(null,this.opts.element,function(a){a!==b&&null!==a&&(c.updateSelection(a),c.close(),c.setPlaceholder())})}},isPlaceholderOptionSelected:function(){var a;return this.getPlaceholder()?(a=this.getPlaceholderOption())!==b&&a.prop("selected")||""===this.opts.element.val()||this.opts.element.val()===b||null===this.opts.element.val():!1},prepareOpts:function(){var b=this.parent.prepareOpts.apply(this,arguments),c=this;return"select"===b.element.get(0).tagName.toLowerCase()?b.initSelection=function(a,b){var d=a.find("option").filter(function(){return this.selected});b(c.optionToData(d))}:"data"in b&&(b.initSelection=b.initSelection||function(c,d){var e=c.val(),f=null;b.query({matcher:function(a,c,d){var g=q(e,b.id(d));return g&&(f=d),g},callback:a.isFunction(d)?function(){d(f)}:a.noop})}),b},getPlaceholder:function(){return this.select&&this.getPlaceholderOption()===b?b:this.parent.getPlaceholder.apply(this,arguments)},setPlaceholder:function(){var a=this.getPlaceholder();if(this.isPlaceholderOptionSelected()&&a!==b){if(this.select&&this.getPlaceholderOption()===b)return;this.selection.find(".select2-chosen").html(this.opts.escapeMarkup(a)),this.selection.addClass("select2-default"),this.container.removeClass("select2-allowclear")}},postprocessResults:function(a,b,c){var d=0,e=this;if(this.findHighlightableChoices().each2(function(a,b){return q(e.id(b.data("select2-data")),e.opts.element.val())?(d=a,!1):void 0}),c!==!1&&(b===!0&&d>=0?this.highlight(d):this.highlight(0)),b===!0){var g=this.opts.minimumResultsForSearch;g>=0&&this.showSearch(L(a.results)>=g)}},showSearch:function(b){this.showSearchInput!==b&&(this.showSearchInput=b,this.dropdown.find(".select2-search").toggleClass("select2-search-hidden",!b),this.dropdown.find(".select2-search").toggleClass("select2-offscreen",!b),a(this.dropdown,this.container).toggleClass("select2-with-searchbox",b))},onSelect:function(a,b){if(this.triggerSelect(a)){var c=this.opts.element.val(),d=this.data();this.opts.element.val(this.id(a)),this.updateSelection(a),this.opts.element.trigger({type:"select2-selected",val:this.id(a),choice:a}),this.nextSearchTerm=this.opts.nextSearchTerm(a,this.search.val()),this.close(),b&&b.noFocus||this.focusser.focus(),q(c,this.id(a))||this.triggerChange({added:a,removed:d})}},updateSelection:function(a){var d,e,c=this.selection.find(".select2-chosen");this.selection.data("select2-data",a),c.empty(),null!==a&&(d=this.opts.formatSelection(a,c,this.opts.escapeMarkup)),d!==b&&c.append(d),e=this.opts.formatSelectionCssClass(a,c),e!==b&&c.addClass(e),this.selection.removeClass("select2-default"),this.opts.allowClear&&this.getPlaceholder()!==b&&this.container.addClass("select2-allowclear")},val:function(){var a,c=!1,d=null,e=this,f=this.data();if(0===arguments.length)return this.opts.element.val();if(a=arguments[0],arguments.length>1&&(c=arguments[1]),this.select)this.select.val(a).find("option").filter(function(){return this.selected}).each2(function(a,b){return d=e.optionToData(b),!1}),this.updateSelection(d),this.setPlaceholder(),c&&this.triggerChange({added:d,removed:f});else{if(!a&&0!==a)return this.clear(c),void 0;if(this.opts.initSelection===b)throw new Error("cannot call val() if initSelection() is not defined");this.opts.element.val(a),this.opts.initSelection(this.opts.element,function(a){e.opts.element.val(a?e.id(a):""),e.updateSelection(a),e.setPlaceholder(),c&&e.triggerChange({added:a,removed:f})})}},clearSearch:function(){this.search.val(""),this.focusser.val("")},data:function(a){var c,d=!1;return 0===arguments.length?(c=this.selection.data("select2-data"),c==b&&(c=null),c):(arguments.length>1&&(d=arguments[1]),a?(c=this.data(),this.opts.element.val(a?this.id(a):""),this.updateSelection(a),d&&this.triggerChange({added:a,removed:c})):this.clear(d),void 0)}}),f=N(d,{createContainer:function(){var b=a(document.createElement("div")).attr({"class":"select2-container select2-container-multi"}).html(["<ul class='select2-choices'>","<li class='select2-search-field'>","<input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input'>","</li>","</ul>","<div class='select2-drop select2-drop-multi select2-display-none'>","<ul class='select2-results'>","</ul>","</div>"].join(""));return b},prepareOpts:function(){var b=this.parent.prepareOpts.apply(this,arguments),c=this;return"select"===b.element.get(0).tagName.toLowerCase()?b.initSelection=function(a,b){var d=[];a.find("option").filter(function(){return this.selected}).each2(function(a,b){d.push(c.optionToData(b))}),b(d)}:"data"in b&&(b.initSelection=b.initSelection||function(c,d){var e=r(c.val(),b.separator),f=[];b.query({matcher:function(c,d,g){var h=a.grep(e,function(a){return q(a,b.id(g))}).length;return h&&f.push(g),h},callback:a.isFunction(d)?function(){for(var a=[],c=0;c<e.length;c++)for(var g=e[c],h=0;h<f.length;h++){var i=f[h];if(q(g,b.id(i))){a.push(i),f.splice(h,1);break}}d(a)}:a.noop})}),b},selectChoice:function(a){var b=this.container.find(".select2-search-choice-focus");b.length&&a&&a[0]==b[0]||(b.length&&this.opts.element.trigger("choice-deselected",b),b.removeClass("select2-search-choice-focus"),a&&a.length&&(this.close(),a.addClass("select2-search-choice-focus"),this.opts.element.trigger("choice-selected",a)))},destroy:function(){a("label[for='"+this.search.attr("id")+"']").attr("for",this.opts.element.attr("id")),this.parent.destroy.apply(this,arguments)},initContainer:function(){var d,b=".select2-choices";this.searchContainer=this.container.find(".select2-search-field"),this.selection=d=this.container.find(b);var e=this;this.selection.on("click",".select2-search-choice:not(.select2-locked)",function(){e.search[0].focus(),e.selectChoice(a(this))}),this.search.attr("id","s2id_autogen"+g()),a("label[for='"+this.opts.element.attr("id")+"']").attr("for",this.search.attr("id")),this.search.on("input paste",this.bind(function(){this.isInterfaceEnabled()&&(this.opened()||this.open())})),this.search.attr("tabindex",this.elementTabIndex),this.keydowns=0,this.search.on("keydown",this.bind(function(a){if(this.isInterfaceEnabled()){++this.keydowns;var b=d.find(".select2-search-choice-focus"),e=b.prev(".select2-search-choice:not(.select2-locked)"),f=b.next(".select2-search-choice:not(.select2-locked)"),g=z(this.search);if(b.length&&(a.which==c.LEFT||a.which==c.RIGHT||a.which==c.BACKSPACE||a.which==c.DELETE||a.which==c.ENTER)){var h=b;return a.which==c.LEFT&&e.length?h=e:a.which==c.RIGHT?h=f.length?f:null:a.which===c.BACKSPACE?(this.unselect(b.first()),this.search.width(10),h=e.length?e:f):a.which==c.DELETE?(this.unselect(b.first()),this.search.width(10),h=f.length?f:null):a.which==c.ENTER&&(h=null),this.selectChoice(h),A(a),h&&h.length||this.open(),void 0}if((a.which===c.BACKSPACE&&1==this.keydowns||a.which==c.LEFT)&&0==g.offset&&!g.length)return this.selectChoice(d.find(".select2-search-choice:not(.select2-locked)").last()),A(a),void 0;if(this.selectChoice(null),this.opened())switch(a.which){case c.UP:case c.DOWN:return this.moveHighlight(a.which===c.UP?-1:1),A(a),void 0;case c.ENTER:return this.selectHighlighted(),A(a),void 0;case c.TAB:return this.selectHighlighted({noFocus:!0}),this.close(),void 0;case c.ESC:return this.cancel(a),A(a),void 0}if(a.which!==c.TAB&&!c.isControl(a)&&!c.isFunctionKey(a)&&a.which!==c.BACKSPACE&&a.which!==c.ESC){if(a.which===c.ENTER){if(this.opts.openOnEnter===!1)return;if(a.altKey||a.ctrlKey||a.shiftKey||a.metaKey)return}this.open(),(a.which===c.PAGE_UP||a.which===c.PAGE_DOWN)&&A(a),a.which===c.ENTER&&A(a)}}})),this.search.on("keyup",this.bind(function(){this.keydowns=0,this.resizeSearch()})),this.search.on("blur",this.bind(function(b){this.container.removeClass("select2-container-active"),this.search.removeClass("select2-focused"),this.selectChoice(null),this.opened()||this.clearSearch(),b.stopImmediatePropagation(),this.opts.element.trigger(a.Event("select2-blur"))})),this.container.on("click",b,this.bind(function(b){this.isInterfaceEnabled()&&(a(b.target).closest(".select2-search-choice").length>0||(this.selectChoice(null),this.clearPlaceholder(),this.container.hasClass("select2-container-active")||this.opts.element.trigger(a.Event("select2-focus")),this.open(),this.focusSearch(),b.preventDefault()))})),this.container.on("focus",b,this.bind(function(){this.isInterfaceEnabled()&&(this.container.hasClass("select2-container-active")||this.opts.element.trigger(a.Event("select2-focus")),this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"),this.clearPlaceholder())})),this.initContainerWidth(),this.opts.element.addClass("select2-offscreen"),this.clearSearch()},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.search.prop("disabled",!this.isInterfaceEnabled())},initSelection:function(){if(""===this.opts.element.val()&&""===this.opts.element.text()&&(this.updateSelection([]),this.close(),this.clearSearch()),this.select||""!==this.opts.element.val()){var c=this;this.opts.initSelection.call(null,this.opts.element,function(a){a!==b&&null!==a&&(c.updateSelection(a),c.close(),c.clearSearch())})}},clearSearch:function(){var a=this.getPlaceholder(),c=this.getMaxSearchWidth();a!==b&&0===this.getVal().length&&this.search.hasClass("select2-focused")===!1?(this.search.val(a).addClass("select2-default"),this.search.width(c>0?c:this.container.css("width"))):this.search.val("").width(10)},clearPlaceholder:function(){this.search.hasClass("select2-default")&&this.search.val("").removeClass("select2-default")},opening:function(){this.clearPlaceholder(),this.resizeSearch(),this.parent.opening.apply(this,arguments),this.focusSearch(),this.updateResults(!0),this.search.focus(),this.opts.element.trigger(a.Event("select2-open"))},close:function(){this.opened()&&this.parent.close.apply(this,arguments)},focus:function(){this.close(),this.search.focus()},isFocused:function(){return this.search.hasClass("select2-focused")},updateSelection:function(b){var c=[],d=[],e=this;a(b).each(function(){o(e.id(this),c)<0&&(c.push(e.id(this)),d.push(this))}),b=d,this.selection.find(".select2-search-choice").remove(),a(b).each(function(){e.addSelectedChoice(this)}),e.postprocessResults()},tokenize:function(){var a=this.search.val();a=this.opts.tokenizer.call(this,a,this.data(),this.bind(this.onSelect),this.opts),null!=a&&a!=b&&(this.search.val(a),a.length>0&&this.open())},onSelect:function(a,b){this.triggerSelect(a)&&(this.addSelectedChoice(a),this.opts.element.trigger({type:"selected",val:this.id(a),choice:a}),(this.select||!this.opts.closeOnSelect)&&this.postprocessResults(a,!1,this.opts.closeOnSelect===!0),this.opts.closeOnSelect?(this.close(),this.search.width(10)):this.countSelectableResults()>0?(this.search.width(10),this.resizeSearch(),this.getMaximumSelectionSize()>0&&this.val().length>=this.getMaximumSelectionSize()&&this.updateResults(!0),this.positionDropdown()):(this.close(),this.search.width(10)),this.triggerChange({added:a}),b&&b.noFocus||this.focusSearch())},cancel:function(){this.close(),this.focusSearch()},addSelectedChoice:function(c){var j,k,d=!c.locked,e=a("<li class='select2-search-choice'><div></div>    <a href='#' onclick='return false;' class='select2-search-choice-close' tabindex='-1'></a></li>"),f=a("<li class='select2-search-choice select2-locked'><div></div></li>"),g=d?e:f,h=this.id(c),i=this.getVal();j=this.opts.formatSelection(c,g.find("div"),this.opts.escapeMarkup),j!=b&&g.find("div").replaceWith("<div>"+j+"</div>"),k=this.opts.formatSelectionCssClass(c,g.find("div")),k!=b&&g.addClass(k),d&&g.find(".select2-search-choice-close").on("mousedown",A).on("click dblclick",this.bind(function(b){this.isInterfaceEnabled()&&(a(b.target).closest(".select2-search-choice").fadeOut("fast",this.bind(function(){this.unselect(a(b.target)),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus"),this.close(),this.focusSearch()})).dequeue(),A(b))})).on("focus",this.bind(function(){this.isInterfaceEnabled()&&(this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"))})),g.data("select2-data",c),g.insertBefore(this.searchContainer),i.push(h),this.setVal(i)},unselect:function(b){var d,e,c=this.getVal();if(b=b.closest(".select2-search-choice"),0===b.length)throw"Invalid argument: "+b+". Must be .select2-search-choice";if(d=b.data("select2-data")){for(;(e=o(this.id(d),c))>=0;)c.splice(e,1),this.setVal(c),this.select&&this.postprocessResults();var f=a.Event("select2-removing");f.val=this.id(d),f.choice=d,this.opts.element.trigger(f),f.isDefaultPrevented()||(b.remove(),this.opts.element.trigger({type:"select2-removed",val:this.id(d),choice:d}),this.triggerChange({removed:d}))}},postprocessResults:function(a,b,c){var d=this.getVal(),e=this.results.find(".select2-result"),f=this.results.find(".select2-result-with-children"),g=this;e.each2(function(a,b){var c=g.id(b.data("select2-data"));o(c,d)>=0&&(b.addClass("select2-selected"),b.find(".select2-result-selectable").addClass("select2-selected"))}),f.each2(function(a,b){b.is(".select2-result-selectable")||0!==b.find(".select2-result-selectable:not(.select2-selected)").length||b.addClass("select2-selected")}),-1==this.highlight()&&c!==!1&&g.highlight(0),!this.opts.createSearchChoice&&!e.filter(".select2-result:not(.select2-selected)").length>0&&(!a||a&&!a.more&&0===this.results.find(".select2-no-results").length)&&J(g.opts.formatNoMatches,"formatNoMatches")&&this.results.append("<li class='select2-no-results'>"+g.opts.formatNoMatches(g.search.val())+"</li>")},getMaxSearchWidth:function(){return this.selection.width()-s(this.search)},resizeSearch:function(){var a,b,c,d,e,f=s(this.search);a=C(this.search)+10,b=this.search.offset().left,c=this.selection.width(),d=this.selection.offset().left,e=c-(b-d)-f,a>e&&(e=c-f),40>e&&(e=c-f),0>=e&&(e=a),this.search.width(Math.floor(e))},getVal:function(){var a;return this.select?(a=this.select.val(),null===a?[]:a):(a=this.opts.element.val(),r(a,this.opts.separator))},setVal:function(b){var c;this.select?this.select.val(b):(c=[],a(b).each(function(){o(this,c)<0&&c.push(this)}),this.opts.element.val(0===c.length?"":c.join(this.opts.separator)))},buildChangeDetails:function(a,b){for(var b=b.slice(0),a=a.slice(0),c=0;c<b.length;c++)for(var d=0;d<a.length;d++)q(this.opts.id(b[c]),this.opts.id(a[d]))&&(b.splice(c,1),c>0&&c--,a.splice(d,1),d--);return{added:b,removed:a}},val:function(c,d){var e,f=this;if(0===arguments.length)return this.getVal();if(e=this.data(),e.length||(e=[]),!c&&0!==c)return this.opts.element.val(""),this.updateSelection([]),this.clearSearch(),d&&this.triggerChange({added:this.data(),removed:e}),void 0;if(this.setVal(c),this.select)this.opts.initSelection(this.select,this.bind(this.updateSelection)),d&&this.triggerChange(this.buildChangeDetails(e,this.data()));else{if(this.opts.initSelection===b)throw new Error("val() cannot be called if initSelection() is not defined");this.opts.initSelection(this.opts.element,function(b){var c=a.map(b,f.id);f.setVal(c),f.updateSelection(b),f.clearSearch(),d&&f.triggerChange(f.buildChangeDetails(e,f.data()))})}this.clearSearch()},onSortStart:function(){if(this.select)throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");this.search.width(0),this.searchContainer.hide()},onSortEnd:function(){var b=[],c=this;this.searchContainer.show(),this.searchContainer.appendTo(this.searchContainer.parent()),this.resizeSearch(),this.selection.find(".select2-search-choice").each(function(){b.push(c.opts.id(a(this).data("select2-data")))}),this.setVal(b),this.triggerChange()},data:function(b,c){var e,f,d=this;return 0===arguments.length?this.selection.find(".select2-search-choice").map(function(){return a(this).data("select2-data")}).get():(f=this.data(),b||(b=[]),e=a.map(b,function(a){return d.opts.id(a)}),this.setVal(e),this.updateSelection(b),this.clearSearch(),c&&this.triggerChange(this.buildChangeDetails(f,this.data())),void 0)}}),a.fn.select2=function(){var d,g,h,i,j,c=Array.prototype.slice.call(arguments,0),k=["val","destroy","opened","open","close","focus","isFocused","container","dropdown","onSortStart","onSortEnd","enable","disable","readonly","positionDropdown","data","search"],l=["opened","isFocused","container","dropdown"],m=["val","data"],n={search:"externalSearch"};return this.each(function(){if(0===c.length||"object"==typeof c[0])d=0===c.length?{}:a.extend({},c[0]),d.element=a(this),"select"===d.element.get(0).tagName.toLowerCase()?j=d.element.prop("multiple"):(j=d.multiple||!1,"tags"in d&&(d.multiple=j=!0)),g=j?new f:new e,g.init(d);else{if("string"!=typeof c[0])throw"Invalid arguments to select2 plugin: "+c;if(o(c[0],k)<0)throw"Unknown method: "+c[0];if(i=b,g=a(this).data("select2"),g===b)return;if(h=c[0],"container"===h?i=g.container:"dropdown"===h?i=g.dropdown:(n[h]&&(h=n[h]),i=g[h].apply(g,c.slice(1))),o(c[0],l)>=0||o(c[0],m)&&1==c.length)return!1}}),i===b?this:i},a.fn.select2.defaults={width:"copy",loadMorePadding:0,closeOnSelect:!0,openOnEnter:!0,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(a,b,c,d){var e=[];return E(a.text,c.term,e,d),e.join("")},formatSelection:function(a,c,d){return a?d(a.text):b},sortResults:function(a){return a},formatResultCssClass:function(){return b},formatSelectionCssClass:function(){return b},formatNoMatches:function(){return"No matches found"},formatInputTooShort:function(a,b){var c=b-a.length;return"Please enter "+c+" more character"+(1==c?"":"s")},formatInputTooLong:function(a,b){var c=a.length-b;return"Please delete "+c+" character"+(1==c?"":"s")},formatSelectionTooBig:function(a){return"You can only select "+a+" item"+(1==a?"":"s")},formatLoadMore:function(){return"Loading more results..."},formatSearching:function(){return"Searching..."},minimumResultsForSearch:0,minimumInputLength:0,maximumInputLength:null,maximumSelectionSize:0,id:function(a){return a.id},matcher:function(a,b){return n(""+b).toUpperCase().indexOf(n(""+a).toUpperCase())>=0},separator:",",tokenSeparators:[],tokenizer:M,escapeMarkup:F,blurOnChange:!1,selectOnBlur:!1,adaptContainerCssClass:function(a){return a},adaptDropdownCssClass:function(){return null},nextSearchTerm:function(){return b}},a.fn.select2.ajaxDefaults={transport:a.ajax,params:{type:"GET",cache:!1,dataType:"json"}},window.Select2={query:{ajax:G,local:H,tags:I},util:{debounce:v,markMatch:E,escapeMarkup:F,stripDiacritics:n},"class":{"abstract":d,single:e,multi:f}}}}(jQuery)}/*END_NOMIN*/}/*START_NOMIN*/var CryptoJS=CryptoJS||function(h,s){var f={},t=f.lib={},g=function(){},j=t.Base={extend:function(a){g.prototype=this;var c=new g;a&&c.mixIn(a);c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)});c.init.prototype=c;c.$super=this;return c},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},q=t.WordArray=j.extend({init:function(a,c){a=this.words=a||[];this.sigBytes=c!=s?c:4*a.length},toString:function(a){return(a||u).stringify(this)},concat:function(a){var c=this.words,d=a.words,b=this.sigBytes;a=a.sigBytes;this.clamp();if(b%4)for(var e=0;e<a;e++)c[b+e>>>2]|=(d[e>>>2]>>>24-8*(e%4)&255)<<24-8*((b+e)%4);else if(65535<d.length)for(e=0;e<a;e+=4)c[b+e>>>2]=d[e>>>2];else c.push.apply(c,d);this.sigBytes+=a;return this},clamp:function(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<32-8*(c%4);a.length=h.ceil(c/4)},clone:function(){var a=j.clone.call(this);a.words=this.words.slice(0);return a},random:function(a){for(var c=[],d=0;d<a;d+=4)c.push(4294967296*h.random()|0);return new q.init(c,a)}}),v=f.enc={},u=v.Hex={stringify:function(a){var c=a.words;a=a.sigBytes;for(var d=[],b=0;b<a;b++){var e=c[b>>>2]>>>24-8*(b%4)&255;d.push((e>>>4).toString(16));d.push((e&15).toString(16))}return d.join("")},parse:function(a){for(var c=a.length,d=[],b=0;b<c;b+=2)d[b>>>3]|=parseInt(a.substr(b,2),16)<<24-4*(b%8);return new q.init(d,c/2)}},k=v.Latin1={stringify:function(a){var c=a.words;a=a.sigBytes;for(var d=[],b=0;b<a;b++)d.push(String.fromCharCode(c[b>>>2]>>>24-8*(b%4)&255));return d.join("")},parse:function(a){for(var c=a.length,d=[],b=0;b<c;b++)d[b>>>2]|=(a.charCodeAt(b)&255)<<24-8*(b%4);return new q.init(d,c)}},l=v.Utf8={stringify:function(a){try{return decodeURIComponent(escape(k.stringify(a)))}catch(c){throw Error("Malformed UTF-8 data");}},parse:function(a){return k.parse(unescape(encodeURIComponent(a)))}},x=t.BufferedBlockAlgorithm=j.extend({reset:function(){this._data=new q.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=l.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(a){var c=this._data,d=c.words,b=c.sigBytes,e=this.blockSize,f=b/(4*e),f=a?h.ceil(f):h.max((f|0)-this._minBufferSize,0);a=f*e;b=h.min(4*a,b);if(a){for(var m=0;m<a;m+=e)this._doProcessBlock(d,m);m=d.splice(0,a);c.sigBytes-=b}return new q.init(m,b)},clone:function(){var a=j.clone.call(this);a._data=this._data.clone();return a},_minBufferSize:0});t.Hasher=x.extend({cfg:j.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){x.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(c,d){return(new a.init(d)).finalize(c)}},_createHmacHelper:function(a){return function(c,d){return(new w.HMAC.init(a,d)).finalize(c)}}});var w=f.algo={};return f}(Math);(function(h){for(var s=CryptoJS,f=s.lib,t=f.WordArray,g=f.Hasher,f=s.algo,j=[],q=[],v=function(a){return 4294967296*(a-(a|0))|0},u=2,k=0;64>k;){var l;a:{l=u;for(var x=h.sqrt(l),w=2;w<=x;w++)if(!(l%w)){l=!1;break a}l=!0}l&&(8>k&&(j[k]=v(h.pow(u,0.5))),q[k]=v(h.pow(u,1/3)),k++);u++}var a=[],f=f.SHA256=g.extend({_doReset:function(){this._hash=new t.init(j.slice(0))},_doProcessBlock:function(c,d){for(var b=this._hash.words,e=b[0],f=b[1],m=b[2],h=b[3],p=b[4],j=b[5],k=b[6],l=b[7],n=0;64>n;n++){if(16>n)a[n]=c[d+n]|0;else{var r=a[n-15],g=a[n-2];a[n]=((r<<25|r>>>7)^(r<<14|r>>>18)^r>>>3)+a[n-7]+((g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10)+a[n-16]}r=l+((p<<26|p>>>6)^(p<<21|p>>>11)^(p<<7|p>>>25))+(p&j^~p&k)+q[n]+a[n];g=((e<<30|e>>>2)^(e<<19|e>>>13)^(e<<10|e>>>22))+(e&f^e&m^f&m);l=k;k=j;j=p;p=h+r|0;h=m;m=f;f=e;e=r+g|0}b[0]=b[0]+e|0;b[1]=b[1]+f|0;b[2]=b[2]+m|0;b[3]=b[3]+h|0;b[4]=b[4]+p|0;b[5]=b[5]+j|0;b[6]=b[6]+k|0;b[7]=b[7]+l|0},_doFinalize:function(){var a=this._data,d=a.words,b=8*this._nDataBytes,e=8*a.sigBytes;d[e>>>5]|=128<<24-e%32;d[(e+64>>>9<<4)+14]=h.floor(b/4294967296);d[(e+64>>>9<<4)+15]=b;a.sigBytes=4*d.length;this._process();return this._hash},clone:function(){var a=g.clone.call(this);a._hash=this._hash.clone();return a}});s.SHA256=g._createHelper(f);s.HmacSHA256=g._createHmacHelper(f)})(Math);var crypto_HASH=function(data){if(typeof(data)!='object'){return data}var hash='';for(key in data){hash+=key+data[key]}hash=CryptoJS.SHA256(hash);data.hash=hash.toString();return data;};/*END_NOMIN*/if((typeof($j)==_u||typeof($j.fn.exists)==_u)&&typeof(jQuery)!=_u){$j=jQuery.noConflict()}var pluginName='';try{if(typeof(CB_EREP_LIBRARY_LOADED)!='undefined'&&typeof($j)!='undefined'&&(!CRPK.vars.__.MOBI||(CRPK.vars.__.MOBI&&is_valid_auth_key_('military')))){if($j('#remember').length>0){$j('#remember').prop('checked',!0)}if((!$j('#live_time').exists()&&!$j('#_token').exists())||($j('#citizen_password').exists()&&(EREP.url==_URL_||EREP.url+'/login'==_URL_))){if(document.URL.indexOf('/login')<0){setTimeout(function(){var d=document,f=d.querySelector('#login_form'),e=d.querySelector('#citizen_email'),p=d.querySelector('#citizen_password'),r=d.querySelector('#remember');if(f&&e&&p&&e.value&&p.value){if(r){r.checked=true}f.submit()}},1000*60*15)};return}var loaded_plugins=[];for(pluginName in PLUGINS){if(!PLUGINS.hasOwnProperty(pluginName)){continue}if(pluginName!='sitewide'&&load_breaker()){clog('Plugin :: '+pluginName+' :: encountered load breaker');break}var plugin=PLUGINS[pluginName];if(!isLoggedIn()&&!plugin.lo){continue}if(!plugin.f||typeof(plugin.f)!=='function'){continue}try{if(!plugin.p||empty(plugin.p)){plugin.f();loaded_plugins.push(pluginName);continue}if(gettype(plugin.p)!='array'){if(typeof(plugin.p)!='string'){continue}plugin.p=plugin.p.split(',')}for(var pp=0;pp<plugin.p.length;pp++){if(is_page(plugin.p[pp])){plugin.f();loaded_plugins.push(pluginName);break}}}catch(e){debug_(e)}}OPTS.init()}}catch(e){console.error('Plugin initialization ERROR :: '+pluginName);debug_(e)}})(window,document);
/*
Helium.
*/
